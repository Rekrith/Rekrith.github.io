<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>The Compass House</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:0.1em}0%,to{top:0px}}@keyframes shudder{25%{left:0.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:0.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:0.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%, to{transform:translateX(0em)}5%, 25%, 45%{transform:translateX(-1em)}15%, 35%, 55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%, to{transform:translateY(0em)}5%, 25%, 45%{transform:translateY(-1em)}15%, 35%, 55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%, 8.1%, 82.1%, 31.1%, 38.1%, 44.1%, 40.1%, 47.1%, 74.1%, 16.1%, 27.1%, 72.1%, 24.1%, 95.1%, 6.1%, 36.1%, 20.1%, 4.1%, 91.1%, 14.1%, 87.1%, to{left:0px;top:0px}8%, 82%, 31%, 38%, 44%{left:-1px}40%, 47%, 74%, 16%, 27%{left:1px}72%, 24%, 95%, 6%, 36%{top:-1px}20%, 4%, 91%, 14%, 87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:0.2}64%{opacity:0.4}78%{opacity:0.6}87%{opacity:0.8}92%, to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:black;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" title="' attr(title) '">'}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,0.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,0.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,0.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,0.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,0.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,0.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,0.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,0.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,0.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,0.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,0.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,0.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,0.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,0.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 0.5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,0.5)}.debug-mode tw-hook{background-color:rgba(0,85,255,0.1) !important}.debug-mode tw-hook::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,0.1) !important}.debug-mode tw-collapsed::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 50%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, rgba(255,204,189,0.25) 0%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,0.2)}.debug-mode tw-enchantment{animation:enchantment 0.5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,0.1)}.debug-mode tw-include::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(type) ' "' attr(title) '"'}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:0em 0.5em 0.5em 1em;font-size:1.25em;font-family:sans-serif;color:#000;border-left:solid #000 2px;border-top:solid #000 2px;border-top-left-radius:.5em;background:#fff;opacity:1}tw-debugger select{margin-right:1em;width:12em}tw-debugger button{border-radius:3px;border:solid #999 1px;margin:auto 4px;background-color:#fff;font-size:inherit;color:#000}tw-debugger button.enabled{background-color:#eee;box-shadow:inset #ddd 3px 5px 0.5em}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;max-height:40vh;overflow-y:scroll;overflow-x:hidden;z-index:999998;background:#fff;border:inherit;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:0.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger .panel-source,tw-debugger .panel-row-source{font-family:monospace;overflow-x:scroll;white-space:pre;-ms-flex-preferred-size:100%;flex-basis:100%}tw-debugger .panel-row-source{margin:5px 0}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background:#EEE}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:0.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:0.8;font-size:0.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#444;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,0.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .error-row>*{display:table-cell;padding:0.25em 0.5em}tw-debugger .error-row .error-message{cursor:help}tw-debugger .error-row .error-passage{color:#444}tw-debugger .storylet-row{background-color:rgba(201,233,222,0.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(128,203,178,0.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;opacity:0.4;background-color:rgba(217,217,217,0.3)}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:rgba(166,166,166,0.3)}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,0.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .tabs{padding-bottom:0.5em}tw-debugger .tab{border-radius:0px 0px 0.5em 0.5em;border-top:none}tw-debugger .resizer{position:absolute;height:3em;border-left:2px solid #ccc;border-right:2px solid #ccc;top:10px;left:4px;width:8px;cursor:ew-resize}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media (min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop ~ tw-backdrop{display:none}tw-link,.link,tw-icon,.enchantment-clickblock{cursor:pointer}tw-link,.enchantment-link{color:#4169E1;font-weight:bold;text-decoration:none;transition:color 0.2s ease-in-out}tw-passage [style^="color"] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^="color"][hover="true"] tw-link:hover,tw-passage [style*=" color"][hover="true"] tw-link:hover,tw-passage [style^="color"] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^="color"][hover="true"] .enchantment-link:hover,tw-passage [style*=" color"][hover="true"] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#DD4B39}.visited{color:#6941e1}tw-passage [style^="color"] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^="color"][hover="true"] .visited:hover,tw-passage [style*=" color"][hover="true"] .visited:hover{color:inherit}.visited:hover{color:#E3E}tw-broken-link{color:#993333;border-bottom:2px solid #993333;cursor:not-allowed}tw-passage [style^="color"] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^="color"][hover="true"] tw-broken-link:hover,tw-passage [style*=" color"][hover="true"] tw-broken-link:hover{color:inherit}.enchantment-mouseover{border-bottom:2px dashed #999}.enchantment-mouseout{border:rgba(64,149,191,0.6) 1px solid}.enchantment-mouseout:hover{background-color:rgba(175,197,207,0.75);border:transparent 1px solid;border-radius:0.2em}.enchantment-clickblock{width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,0.5);transition:color 0.2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,0.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,0.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 0.5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 0.5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,0.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,0.75);border:transparent 2px solid;border-radius:0.2em}tw-link.enchantment-button,.enchantment-link.enchantment-button,.enchantment-button:not(.enchantment-link) tw-link,.enchantment-button:not(.enchantment-link) .enchantment-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia, serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media (min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:transparent;font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:transparent;font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 0.5em}tw-story tw-noscript{animation:appear 0.8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media (min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}}tw-icon{display:inline-block;margin:0.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:0.2}tw-icon[alt]:hover{opacity:0.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:0.2em;padding:0.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,0.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,0.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:0.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:1px;border:1px solid black;font-size:0.8rem;margin:0 0.4rem;padding:2px;white-space:pre}tw-folddown::after{content:"\25b6"}tw-folddown.open::after{content:"\25bc"}tw-open-button::after{content:"Open"}tw-notifier{border-radius:0.2em;padding:0.2em;font-size:1rem;background-color:rgba(223,182,58,0.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid black;display:inline-block;width:1em;height:1em}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:0.3em 0 0.6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,0.6);background-color:#ff9}ins{color:rgba(0,0,0,0.6);background-color:rgba(255,242,204,0.5);border-radius:0.5em;box-shadow:0em 0em 0.2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play The Compass House.</tw-noscript></noscript></tw-story>
<tw-storydata name="The Compass House" startnode="1" creator="Twine" creator-version="2.3.13" ifid="C6E31B4B-085E-40CA-B3B8-5B7AA3C155AD" zoom="0.6" format="Harlowe" format-version="3.2.1" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">body, tw-story
{
  font-family: Brandon Grotesque;
  font-size: 18px;
  color: #ffffff;
  background-color: #000000;
}
tw-link, .enchantment-link { 
  color: #b8eb02;
}
tw-link:hover, .enchantment-link:hover { 
  color: #daff57;
  text-decoration: underline;
}
tw-link:active, .enchantment-link:active {
  color: #83cc0e;
  text-decoration: underline;
}
.visited {
  color: #83cc0e;
}
.visited:hover {
  color: #b8eb02;
  text-decoration: underline;
}</style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name="open" tags="" position="398,0" size="100,100">&lt;center&gt;[[&gt; Click to begin.-&gt;The Compass House]]

Please note that this experience is lengthy. You may at any point hold down a button (such as spacebar or an arrow key) to make text advance more quickly, for replaying or skipping lengthy scenes.

This is a project that helps point Chosen Ones and uncertain insiders towards the House that would best suit them. The Cult of Byle is also a possible outcome.

As it is a blind test, content is not flagged within the experience. However, most content is not extreme, and should be manageable for anyone who enjoys the themes explored within the City of Nodd.

Content you may encounter on your journey includes:
Noncon, gore, transformation, tgtf, watersports, vore, death, weight gain, and mind alteration.

Please take care during your experience and, as ever

(text-colour: #02d987)+(text-style: &quot;smear&quot;, &quot;buoy&quot;)[**May the City speak your name**]

&lt;/center&gt;</tw-passagedata><tw-passagedata pid="2" name="The Compass House" tags="" position="347,115" size="200,200">(set: $tsn to (transition: &quot;dissolve&quot;) + (transition-time: 2s) + (text-colour: white))(set: $tsnGrey to (transition: &quot;dissolve&quot;) + (transition-time: 2s) + (text-colour: grey))(set: $vorn to 0)(set: $psi to 0)(set: $viv to 0)(set: $umbra to 0)(set: $omn to 0)(set: $morph to 0)(set: $byle to 0)(set: $npc to (text-style: &quot;italic&quot;)+(color: #aaffcc))(set: $charmed to false)(set: $genderTF to false)
(text-colour: #02d987)[####The Compass House]
$tsn[Pushing open the toothy door and stepping into the small, ribbed chamber within, you find yourself greeted by a tall and splendid-looking lehlt. He rises from a chair - he, you see immediately by the enormous and prominent balls hanging between his wide-stanced legs - and gives you a smile that you can&#39;t help but read as (link-reveal: &quot;condescending&quot;)[(show: ?canopy)]. He sniffs the air, then spreads his slender-fingered hands to either side of himself.]|canopy)[$tsnGrey[
*Lehlt, you recall, are frequently accompanied by a haughtiness that manifests in more ways than one can count. Perhaps this one is a little arrogant?*]](set: $timer to 8000)

(after: $timer, 200)[=$tsn[The lehlt doesn&#39;t bow, but does make the sign of the City with his hands. Forming a triangle with both slender index fingers and thumbs, his eyes look over your frame thoughtfully.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Welcome to the Compass House,&quot;] the lehlt says amiably. $npc[&quot;I am Velvadius Kythrian, the keeper of this...]](set: $timer to 2000) (after: time + $timer, 200)[=$tsn[$npc[...Splendid establishment.&quot;]](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[Velvadius opens his mouth to add more when there&#39;s a sudden blur that moves from the side of the room. You find yourself startled by a blue and scaly creature that can&#39;t be bigger than a nurk. It rushes up to you, brimming with energy.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Aaah! A customer!&quot;] comes its spry and eager voice. Velvadius immediately sighs, before nodding.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;Yes, a customer,&quot;] he repeats. $npc[&quot;Please forgive my assistant-&quot;
&quot;Partner!&quot;] corrects the blue creature, its reptilian and scaled snout smiling broadly.
$npc[&quot;*Assistant*, for his exuberance.&quot;]](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Velvadius smiles again (though it seems slightly forced), then steps gracefully to one side to reveal a chair, his heavy sack and prominent sheath jostling as he does. The kobold bounces merrily, looking up at you.](click: &quot;chair&quot;)[(append: ?hooker)[

(set: $chairPeek to true)$tsn[The chair appears to be large and accommodating. It moves a little bit, hinting at ambulance, but seems relatively well-trained to act its part. You can&#39;t help but notice the manacles for wrists, ankles, and an adjustable strap for various types of tail...
$npc[&quot;Oh!&quot;] says Velvadius&#39; &#39;assistant&#39;. $npc[&quot;No worry! The chair is *really* great and lets you find out what House you belong in! Maji loves sitting in it and taking the test.&quot;]](show: ?advance)]](click: &quot;prominent sheath&quot;)[(append: ?hooker)[

(unless: $chairPeek is true)[$tsnGrey[Your eyes follow Velvadius&#39; crotch as he moves, seemingly glued to the heavy sway of his sack. It&#39;s hard not to imagine the sort of potency he would surely pump out into anyone he bedded...]
$tsn[$npc[&quot;Something else on your mind, hmm?&quot;] Velvadius asks. $npc[&quot;You&#39;ve not even *looked* at the chair yet. Well, if you&#39;re so eager, perhaps I&#39;ll give you another seat after we&#39;re done.&quot;]
You feel your heart skip a little at having been caught out.](set: $eagerFuck to 2)](else:)[$tsnGrey[Your eyes drift back to Velvadius&#39; crotch, admiring the heavy sway of his sack. It&#39;s hard not to imagine the sort of potency he would surely pump out into anyone he bedded... You notice Velvadius smiling at your admiration.](set: $eagerFuck to 1)]]](click: &quot;blue creature&quot;)[(append: ?hooker)[

$tsnGrey[The creature appears to be an Outsider of some kind. You believe you&#39;ve heard the term *kobold* used in recent times.]]]|hooker)[]

|advance)[$tsn[[[&gt; &quot;The test?&quot;-&gt;test?]]
[[&gt; Sit in the chair-&gt;chair]]]]</tw-passagedata><tw-passagedata pid="3" name="test?" tags="" position="202,218" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[$npc[&quot;Ah, the test,&quot;] Velvadius says with a smile.](set: $timer to 3000)

(after: $timer, 200)[=$tsn[$npc[&quot;It was Maji&#39;s idea!&quot;] the smaller creature exclaims.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[Velvadius sighs, his eyes looking skywards. He quickly presses the smile back in place, though, and nods.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Yes. I found Maji in the streets, proclaiming the solution to any lost Outsider--&quot;] Velvadius pauses.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;**Ahem**, *Chosen One*&#39;s House problems. With his assistance-&quot;]](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Partnership!&quot;]](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;-Assistance, I was able to create this boutique. *The Compass House*. So named after the six great Houses, of course. A place where one may sit and experience some carefully curated &#39;tests&#39; via a modified version of the Maze Mind spell that helps establish which House they may enjoy.&quot;]](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;If you would, we can get started. You *do* wish to know which House you would suit, yes?&quot;] Velvadius asks.
Maji nods eagerly.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; &quot;On second thoughts...&quot;-&gt;charm]]
[[&gt; Sit in the chair-&gt;chair]]]</tw-passagedata><tw-passagedata pid="4" name="chair" tags="" position="401,401" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[(if: $charmed is true)[You sit in the chair, smiling at Velvadius and Maji as they strap you into place. You feel a little excited and can&#39;t help but admire the lehlt&#39;s package. (if: $eagerfuck is 2)[You look up at him, hoping that he&#39;ll make good on his earlier offer. Velvadius doesn&#39;t seem too concerned with your wants right now, though.]](else:)[You swallow nervously as you sit in the chair, Velvadius and Maji stepping up and commencing with securing your limbs in the (link-reveal: &quot;straps&quot;)[(show: ?straps)]. Maji secures your legs while Velvadius fixes up your arms. (if: $eagerfuck &gt; 0)[It *is* nice having Velvadius so close, though.]]]|straps)[
$tsn[You ask if the straps are really necessary.
$npc[&quot;Oh, yes. Extremely,&quot;] assures Velvadius.
$npc[&quot;Maji loves the straps!&quot;] Maji declares.]](set: $timer to 6000)

(after: $timer, 200)[=$tsn[Once you&#39;re secure, Velvadius steps away and collects something from a case by the wall. He walks back over to you as Maji gazes up at you with a bright-eyed expression, his purple eyes fixed on you exuberantly. (if: $charmed is true)[You smile back down at your friend. He&#39;s so... friendly.]](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Velvadius stops in front of you, holding a large cartridge of Gloam.
$npc[&quot;Now, this is a somewhat... *modified* cast of the Maze Mind spell that will give you some experiences that my assistant-&quot;
&quot;Partner!&quot;
&quot;-Assistant and I can &#39;tune in&#39; to. Each test will present you with a scenario. Simply... try to do as you would like to do, hmm?&quot;] He offers you a (if: $charmed is true)[dazzling](else:)[thin] smile, before sliding one hand under your jaw. He tilts your head up as his eyes flick down across your body. $npc[&quot;Now, so I can do a little *fine-tuning*, do tell me what trite little assets you have, hmm?&quot;]](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[(if: $charmed is true)[You find it hard to think of any reason not to answer the handsome Lehlt. Maybe you&#39;re even his type...](else:)[You feel like it&#39;s probably in your best interest to be honest with the lehlt, here.] You tell him that you (cycling-link: bind $assetAnswer, &quot;just have a dick&quot;, &quot;have a dick and balls&quot;, &quot;have both a pussy and a dick&quot;, &quot;have breasts and a dick&quot;, &quot;have a pussy, dick and balls, and breasts&quot;, &quot;have a pussy, dick, and breasts&quot;, &quot;have breasts and a pussy&quot;, &quot;just have a pussy&quot;).](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;chair2]]]</tw-passagedata><tw-passagedata pid="5" name="charm" tags="" position="202,368" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You express that, after seeing those manacles, you&#39;re rather having second thoughts.](set: $timer to 3000)

(after: $timer, 200)[=$tsn[Velvadius nods, pressing his hands together understandingly. $npc[&quot;Of course,&quot;] he says, the lehlt&#39;s expression looking apologetic. $npc[&quot;We completely understand. We are still strangers; there is no **friendship** between us yet. Is there, Maji?&quot;]](set: $timer to 4000)
(after: time + $timer, 200)[=$tsnGrey[*Why did that sound so awkward to say?*](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[Maji gasps, as if hearing an alarm ring, before he springs up with a broad smile on his snout and gestures at you with his tiny, scaled hands. There&#39;s a pulse that thumps through the air and a little puff of greenish mist disperses around you. The world seems fuzzy for a moment, and you lose your train of thought entirely.](set: $tsn to (transition: &quot;dissolve&quot;) + (transition-time: 2s) + (text-colour: #ccffcc))(set: $charmed to true)(set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You blink through the confusion for a few moments, trying to clear your head, before giving a baffled smile. Did... something just happen?](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Velvadius smiles at you - his smile seems so warm and charming - and then places a hand on your shoulder. He urges you towards the chair.
$npc[&quot;Come,&quot;] your friend says. $npc[&quot;Let&#39;s sit you down for the test.&quot;]
Somehow, you trust him completely.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You feel Maji&#39;s little hands groping at your ass, and can&#39;t help but blush a little as your best friend touches you so intimately. You press back against him, before Velvadius ushers the handsome little reptile away and helps you sit down.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Sit in the chair-&gt;chair]]]</tw-passagedata><tw-passagedata pid="6" name="test1" tags="" position="699,103" size="100,100">$tsn[A moment later, though time feels a little strange suddenly, you find yourself in an empty expanse.](set: $timer to 4000)
(after: $timer, 200)[=$tsn[It feels like being lost in a void. You look around and see nothing but endless, inky (text-style: &quot;outline&quot;)[black]. As though you&#39;re in...](set: $timer to 4000)

(after: time + $timer, 200)[=(transition: &quot;dissolve&quot;)+(transition-time: 2s)+(text-colour: #333333)+(text-style: &quot;smear&quot;)+(css: &quot;font-size: 130%;&quot;)[The Abyss](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You look around for something. Anything. (if: $charmed is true)[Surely your best friends wouldn&#39;t have sent you to an empty nothingness?](else:)[Surely Velvadius and Maji wouldn&#39;t have sent you to an empty nothingness?]](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Suddenly, you see something on the ground at your feet. It appears to be a box! You quickly pick it up and open the lid to look at what&#39;s inside.](set: $timer to 3000)

(set: $test1 to 0)(after: time + $timer, 200)[=$tsn[Inside the box you see a bottle, a bone, a ring, and a mirror. There also appears to be a switch under the lid of the box.](click: &quot;bone&quot;)[(append: ?looker)[(set: $test1 to it + 1)(if: $test1 &gt; 4)[(show: ?links)]

$tsn[The bone appears to be a bleached femur. It looks like it might once have belonged to a nurk, judging by the size of it. You can see etchings on the surface that seem to be some kind of writing that you can almost decipher.]]](click: &quot;mirror&quot;)[(append: ?looker)[(set: $test1 to it + 1)(if: $test1 &gt; 4)[(show: ?links)]

$tsn[The mirror seems to be ornate and made of a brass-like metal. Its ornamented rim bears images of numerous faces, each one twisted into a unique expression. Some laugh, some cry, some sneer. As you gaze into the silvered surface of the mirror, you feel like you can almost see flickering lights in the darkness behind your face. They play tricks with your eyes and make you feel a little dizzy.]]](click: &quot;ring&quot;)[(append: ?looker)[(set: $test1 to it + 1)(if: $test1 &gt; 4)[(show: ?links)]

$tsn[The ring appears to have etchings on the outside of its surface that look lewd and enticing. Imagery hints at copulating Noddish creatures, and you have the distinct feeling that this ring is meant to go around someone&#39;s cock.]]](click: &quot;bottle&quot;)[(append: ?looker)[(set: $test1 to it + 1)(if: $test1 &gt; 4)[(show: ?links)]

$tsn[The bottle seems to be made of dark and frosted glass leaving you unable to see inside of it. Still, as you hold it up to your face, you can see subtle shadows shifting and squirming inside the vessel. They flop and wriggle about ominously.]]](click: &quot;switch&quot;)[(append: ?looker)[(set: $test1 to it + 1)(if: $test1 &gt; 4)[(show: ?links)]

$tsn[There&#39;s a small switch under the box lid. As you examine it, you see a small label beside it. The label reads...
*&#39;Different items&#39;*
Perhaps pressing it will somehow give you a new set of objects?]]]|looker&gt;[]

|links)[$tsn[Having inspected each of the items in turn, you have a strange feeling that you should choose one to take. Or else, you should use the switch...
(link: &quot;Take the bone&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test2&quot;)]
(link: &quot;Take the mirror&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test2&quot;)]
(link: &quot;Take the ring&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test2&quot;)]
(link: &quot;Take the bottle&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test2&quot;)]
(link: &quot;Press the switch&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test2&quot;)]]]</tw-passagedata><tw-passagedata pid="7" name="test2" tags="" position="850,98" size="100,100">(text-colour: #333333)[####The Abyss]
(if: $choice is &quot;morph&quot;)[$tsn[No sooner has your finger flicked the switch than you feel a disorienting swirl. The box snaps shut as you jerk your arm away.]](else:)[$tsn[You move to pluck it from the box when you suddenly feel a disorienting swirl. The box snaps shut as you jerk your arm away.]] 
$tsn[You look down at the box, questioning the point of the whole thing when you hear someone laughing behind you.](set: $timer to 5000)

(after: $timer, 200)[=$tsn[You spin to face them and find yourself face-to-face with a nurk.](set: $timer to 4000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;Haha!&quot;] they laugh, snaggle-toothed snout grinning manically.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[$npc[&quot;Did you think you would get something?&quot;] 
The Nurk&#39;s nose twitches rapidly and he touches his claws together. $npc[&quot;No one gets anything in this place, haha!&quot;]](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[The nurk&#39;s smile falls just as quickly as it came though, and the small creature turns to gaze mournfully at five doors that now stand in the Abyss.](set: $timer to 4000) (after: time + $timer, 200)[=$tsn[You aren&#39;t sure where they came from, nor how they got here.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;That&#39;s why I want to get out of here. But... I don&#39;t know where to go!&quot;] The nurk touches both paws together, shifting his weight from one foot to the other. His ears twitch unhappily as he looks back and forth from each door in turn.](set: $timer to 6000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;Help?&quot;]](set: $timer to 1000)

(after: time + $timer, 200)[=$tsn[[[&gt; Ask how you can help-&gt;test2-2]]]</tw-passagedata><tw-passagedata pid="8" name="chair2" tags="" position="401,551" size="100,100">(if: $assetAnswer is &quot;just have a dick&quot;)[(set: $dick to true)(set: $pussy to false)(set: $breasts to false)(set: $balls to false)](else-if: $assetAnswer is &quot;have breasts and a pussy&quot;)[(set: $dick to false)(set: $pussy to true)(set: $breasts to true)(set: $balls to false)](else-if: $assetAnswer is &quot;just have a pussy&quot;)[(set: $dick to false)(set: $pussy to true)(set: $breasts to false)(set: $balls to false)](else-if: $assetAnswer is &quot;have both a pussy and a dick&quot;)[(set: $dick to true)(set: $pussy to true)(set: $breasts to false)(set: $balls to false)](else-if: $assetAnswer is &quot;have breasts and a dick&quot;)[(set: $dick to true)(set: $pussy to false)(set: $breasts to true)(set: $balls to false)](else-if: $assetAnswer is &quot;have a dick and balls&quot;)[(set: $dick to true)(set: $pussy to false)(set: $breasts to false)(set: $balls to true)](else-if: $assetAnswer is &quot;have a pussy, dick, and breasts&quot;)[(set: $dick to true)(set: $pussy to true)(set: $breasts to true)(set: $balls to false)](else:)[(set: $dick to true)(set: $pussy to true)(set: $breasts to true)(set: $balls to true)](text-colour: #02d987)[####The Compass House]
$tsn[$npc[&quot;Interesting,&quot;] Velvadius says, his eyes dipping down across your body. $dick[
$npc[&quot;Maji loves big thick dicks, mhm!&quot;] Maji declares loudly. Velvadius rolls his eyes.](if: $eagerFuck &gt; 0)[
$npc[&quot;I&#39;m personally quite partial to what you&#39;ve got down there, my dear patron,&quot;] Velvadius says quietly into your ear. His hand slides down to stroke your inner thigh.(if: $eagerFuck is 2)[ $npc[&quot;And after this, perhaps you shall have the pleasure of me acquainting myself with you.&quot;]]]](set: $timer to 6000)

(after: $timer, 200)[=$tsn[$npc[&quot;Okay!&quot;] says Maji. $npc[&quot;All ready, Mister Kythrian. Maji has made best spell, mhm!&quot;]](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[Velvadius nods to the smaller creature, then gazes down at your bound form. $npc[&quot;Excellent,&quot;] he says. This close to him, the smell of warm musk pervades your nostrils. Velvadius motions to Maji, who makes a series of arcane gestures.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[There&#39;s a **puff** of discharging Gloam, and then suddenly the world swirls around you.
$npc[&quot;We&#39;ll be watching,&quot;] you hear Velvadius say, sounding as if he&#39;s speaking through a tube.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; The world spins away...-&gt;test1]]]</tw-passagedata><tw-passagedata pid="9" name="test2-2" tags="" position="851,249" size="100,100">(text-colour: #333333)[####The Abyss]
$tsn[You look at the doors before the Nurk one by one, taking in the surreal vision of each as it stands unaided in the Abyss. The Nurk shifts back and forth from foot to foot uneasily, his noduled nose twitching rapidly.](set: $timer to 6000)

(after: $timer, 200)[=$tsn[The first door seems to be neat and orderly, with a precision to the sides clean enough to make a ruler from. Its grey surface is split vertically down the middle, looking as though it might slide open to either side upon your approach. As you approach it, you feel (link-reveal:&quot;calmer and more detached from your own thoughts&quot;)[(show: ?one)].](set: $timer to 8000)|one)[
$tsnGrey[You recall that you are in a test, and that this is not real. You feel a sense of pride in remembering your circumstances.]]

(after: time + $timer, 200)[=$tsn[The second door appears to be fashioned from wood, with gnarled and twisted knots along its surface and a fresh pine scent to it. The surface seems to be almost glistening with a dampness to it. As you approach it, you feel (link-reveal:&quot;refreshed and brimming with energy&quot;)[(show: ?two)].](set: $timer to 8000)|two)[
$tsnGrey[You&#39;ve never felt so alive! You feel like you could live forever.]]

(after: time + $timer, 200)[=$tsn[The third door looks as though it&#39;s crafted from metal. A strange scent emanates from it that leaves a subtle taste in your mouth, and it almost seems to be coated in a faint, oily sheen. The handle looks like it hasn&#39;t seen a sponge in a long time. As you approach it, you feel (link-reveal:&quot;a sense of smug revelry brewing in your belly&quot;)[(show: ?three)].](set: $timer to 8000)|three)[
$tsnGrey[You feel an energetic delight at what the City offers. Such indulgence, with so many depravities to sample upon your return!]]

(after: time + $timer, 200)[=$tsn[The fourth door is crafted from glass. You can see yourself and the Nurk reflected in it but, more than that, you can see *other* figures in its eerie reflections. You can see people from your past who have been treated unfairly or killed out of turn. As you approach it, you feel (link-reveal:&quot;a growing yearning to set things right, mixed with a wistful peace within&quot;)[(show: ?four)].](set: $timer to 8000)|four)[
$tsnGrey[You can&#39;t help but recall all the terrible things that have happened to people you know within the City. You feel resolute that when you return, your enemies will regret their choices.]]

(after: time + $timer, 200)[=$tsn[The last door appears to have been created by a child. The top is larger than the bottom, and the frame seems to be lopsided on the right. A spiral starts halfway up the frame but looks to have been forgotten before reaching the top, and the door itself has several handles, any one of which might be the true handle. As you approach it, you (link-reveal:&quot;find yourself wondering what a door even *is* if it doesn&#39;t lead anywhere&quot;)[(show: ?five)].](set: $timer to 8000)|five)[
$tsnGrey[Is it even a door? Is that really a Nurk, here, in the *Abyss* of all places? The more you look at it, the less certain you are about anything at all.]]

(after: time + $timer, 200)[=$tsn[The Nurk looks at you, then looks to the doors.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[$npc[&quot;Please,&quot;] he says.](set: $timer to 2000) (after: time + $timer, 200)[=$tsn[$npc[&quot;I want to get out of here, haha!&quot;]](set: $timer to 4000)
(after: time + $timer, 200)[=$tsn[Each time he laughs, he sounds a little more frantic and frayed. His mouth smiles in a manic grin, but his eyes look to be on the verge of tears.](set: $timer to 2000)
(after: time + $timer, 200)[=$tsn[You look back to the doors.

(link: &quot;&gt; You think he should open the orderly door.&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test3&quot;)]
(link: &quot;&gt; You think he should open the wooden door.&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test3&quot;)]
(link: &quot;&gt; You think he should open the metal door.&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test3&quot;)]
(link: &quot;&gt; You think he should open the glass door.&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test3&quot;)]
(link: &quot;&gt; You think he should open the strange door.&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test3&quot;)]]</tw-passagedata><tw-passagedata pid="10" name="test3" tags="" position="1002,98" size="100,100">|6&gt;[(text-colour: #333333)[####The Abyss]]
|1&gt;[$tsn[You motion to the Nurk, then point towards the (if: $choice is &quot;morph&quot;)[strange door with the many knobs](else-if: $choice is &quot;omn&quot;)[neat door with the seam down the middle](else-if: $choice is &quot;umbra&quot;)[glass door with its many reflections](else-if: $choice is &quot;byle&quot;)[metal door with its slick handle](else-if: $choice is &quot;viv&quot;)[wooden door with its fresh pine scent] and tell him to go through that one.]]

|2&gt;[(event: when time &gt; 6s)[$tsn[The Nurk looks at you uneasily, then holds up his little hands.]]]
|3&gt;[(event: when time &gt; 9s)[$tsn[$npc[&quot;I can&#39;t reach the handle!&quot;] he mourns.]]]
|4&gt;[(event: when time &gt; 12s)[$tsn[Though he doesn&#39;t ask, you can tell what he wants. Keeping your own feelings in check, you move forwards and open the door for him.]]]

|5&gt;[(event: when time &gt; 16s)[$tsn[You briefly see a dark void beyond before-]]]
(event: when time &gt; 18s)[(replace: ?1)[]](event: when time &gt; 18.2s)[(replace: ?2)[]](event: when time &gt; 18.4s)[(replace: ?3)[]](event: when time &gt; 18.6s)[(replace: ?4)[]](event: when time &gt; 18.8s)[(replace: ?5)[]](event: when time &gt; 19s)[(replace: ?6)[]](event: when time &gt; 19.2s)[(go-to:&quot;test3-2&quot;)]</tw-passagedata><tw-passagedata pid="11" name="test3-2" tags="" position="1002,245" size="100,100">(event: when time &gt; 3s)[(text-style: &quot;smear&quot;)[*H*(event: when time &gt; 3.1s)[*e*](event: when time &gt; 3.2s)[*l*](event: when time &gt; 3.3s)[*l*](event: when time &gt; 3.4s)[*o*] (event: when time &gt; 3.5s)[*t*](event: when time &gt; 3.6s)[*h*](event: when time &gt; 3.7s)[*e*](event: when time &gt; 3.8s)[*r*](event: when time &gt; 3.9s)[*e*](event: when time &gt; 4.0s)[*,*] (event: when time &gt; 4.3s)[*c*](event: when time &gt; 4.4s)[*h*](event: when time &gt; 4.5s)[*i*](event: when time &gt; 4.6s)[*l*](event: when time &gt; 4.7s)[*d*](event: when time &gt; 4.8s)[*.*]]]

(event: when time &gt; 7s)[$tsn[A voice comes to you from the dark.]]
(event: when time &gt; 10s)[$tsn[You find yourself standing in a space as black as night. Gone are all the doors and the Nurk you were speaking with.]]

(text-style: &quot;smear&quot;)[(event: when time &gt; 15s)[*B*](event: when time &gt; 15.1s)[*e*] (event: when time &gt; 15.2s)[*n*](event: when time &gt; 15.3s)[*o*](event: when time &gt; 15.4s)[*t*] (event: when time &gt; 15.5s)[*a*](event: when time &gt; 15.6s)[*f*](event: when time &gt; 15.7s)[*r*](event: when time &gt; 15.8s)[*a*](event: when time &gt; 15.9s)[*i*](event: when time &gt; 16s)[*d*](event: when time &gt; 16.1s)[*.*]]

(event: when time &gt; 19s)[$tsn[The voice seems to come from all around you and nowhere at once, like a half-remembered sigh summoned from the depths of memory.]]
(event: when time &gt; 24s)[$tsn[A wistful sadness clings to your heart.]]

(text-style: &quot;smear&quot;)[(event: when time &gt; 27.0s)[*M*](event: when time &gt; 27.1s)[*y*] (event: when time &gt; 27.2s)[*n*](event: when time &gt; 27.3s)[*a*](event: when time &gt; 27.4s)[*m*](event: when time &gt; 27.5s)[*e*] (event: when time &gt; 27.6s)[*i*](event: when time &gt; 27.7s)[*s*] (event: when time &gt; 27.8s)[*I*](event: when time &gt; 27.9s)[*l*](event: when time &gt; 28.0s)[*l*](event: when time &gt; 28.1s)[*a*](event: when time &gt; 28.2s)[*.*] (event: when time &gt; 30.0s)[*W*](event: when time &gt; 30.1s)[*h*](event: when time &gt; 30.2s)[*o*] (event: when time &gt; 30.3s)[*m*](event: when time &gt; 30.4s)[*i*](event: when time &gt; 30.5s)[*g*](event: when time &gt; 30.6s)[*h*](event: when time &gt; 30.7s)[*t*] (event: when time &gt; 30.8s)[*y*](event: when time &gt; 30.9s)[*o*](event: when time &gt; 31.0s)[*u*] (event: when time &gt; 31.1s)[*b*](event: when time &gt; 31.2s)[*e*](event: when time &gt; 31.3s)[*?*]]

(event: when time &gt; 32s)[$tsn[(link-reveal:&quot;&gt; Tell the voice your name.&quot;)[(set: $choice to &quot;name&quot;)(go-to: &quot;test3-3&quot;)]
(link-reveal:&quot;&gt; Remain silent.&quot;)[(set: $choice to &quot;silent&quot;)(go-to: &quot;test3-3&quot;)]]]</tw-passagedata><tw-passagedata pid="12" name="test3-3" tags="" position="1001,400" size="100,100">(if: $choice is &quot;name&quot;)[$tsn[You tell the voice your name.]](else:)[$tsn[You remain silent.]]

(event: when time &gt; 2s)[$tsn[A susurrus of heaving breaths surges and falls around you, as though the wind were attempting a chuckle.]]

(if: $choice is &quot;silent&quot;)[(text-style: &quot;smear&quot;)[(event: when time &gt; 6.0s)[*I*] (event: when time &gt; 6.1s)[*m*](event: when time &gt; 6.2s)[*e*](event: when time &gt; 6.3s)[*a*](event: when time &gt; 6.4s)[*n*] (event: when time &gt; 6.5s)[*n*](event: when time &gt; 6.6s)[*o*] (event: when time &gt; 6.7s)[*h*](event: when time &gt; 6.8s)[*a*](event: when time &gt; 6.9s)[*r*](event: when time &gt; 7.0s)[*m*](event: when time &gt; 7.1s)[*,*] (event: when time &gt; 7.2s)[*d*](event: when time &gt; 7.3s)[*e*](event: when time &gt; 7.4s)[*a*](event: when time &gt; 7.5s)[*r*](event: when time &gt; 7.6s)[*e*](event: when time &gt; 7.7s)[*s*](event: when time &gt; 7.8s)[*t*] (event: when time &gt; 7.9s)[*C*](event: when time &gt; 8.0s)[*i*](event: when time &gt; 8.1s)[*t*](event: when time &gt; 8.2s)[*i*](event: when time &gt; 8.3s)[*z*](event: when time &gt; 8.4s)[*e*](event: when time &gt; 8.5s)[*n*](event: when time &gt; 8.6s)[*.*]]](else:)[
(text-style: &quot;smear&quot;)[(event: when time &gt; 6.0s)[*T*](event: when time &gt; 6.1s)[*h*](event: when time &gt; 6.2s)[*a*](event: when time &gt; 6.3s)[*t*] (event: when time &gt; 6.4s)[*i*](event: when time &gt; 6.5s)[*s*] (event: when time &gt; 6.6s)[*a*] (event: when time &gt; 6.7s)[*f*](event: when time &gt; 6.8s)[*i*](event: when time &gt; 6.9s)[*n*](event: when time &gt; 7.0s)[*e*] (event: when time &gt; 7.1s)[*n*](event: when time &gt; 7.2s)[*a*](event: when time &gt; 7.3s)[*m*](event: when time &gt; 7.4s)[*e*](event: when time &gt; 7.5s)[*.*]]]
(text-style: &quot;smear&quot;)[(event: when time &gt; 10.0s)[*T*](event: when time &gt; 10.1s)[*e*](event: when time &gt; 10.2s)[*l*](event: when time &gt; 10.3s)[*l*] (event: when time &gt; 10.4s)[*m*](event: when time &gt; 10.5s)[*e*](event: when time &gt; 10.6s)[*,*] (event: when time &gt; 10.7s)[*w*](event: when time &gt; 10.8s)[*h*](event: when time &gt; 10.9s)[*a*](event: when time &gt; 11.0s)[*t*] (event: when time &gt; 11.1s)[*t*](event: when time &gt; 11.2s)[*h*](event: when time &gt; 11.3s)[*i*](event: when time &gt; 11.4s)[*n*](event: when time &gt; 11.5s)[*k*] (event: when time &gt; 11.6s)[*y*](event: when time &gt; 11.7s)[*o*](event: when time &gt; 11.8s)[*u*] (event: when time &gt; 11.9s)[*o*](event: when time &gt; 12.0s)[*f*] (event: when time &gt; 12.1s)[*o*](event: when time &gt; 12.2s)[*u*](event: when time &gt; 12.3s)[*r*] (event: when time &gt; 12.7s)[*f*](event: when time &gt; 12.8s)[*a*](event: when time &gt; 12.9s)[*i*](event: when time &gt; 13.0s)[*r*] (event: when time &gt; 13.4s)[*C*](event: when time &gt; 13.5s)[*i*](event: when time &gt; 13.6s)[*t*](event: when time &gt; 13.7s)[*y*](event: when time &gt; 13.8s)[*?*]]

(event: when time &gt; 15s)[$tsn[You feel the brush of a (link-reveal:&quot;hand&quot;)[(show: ?1)] upon your shoulder.]] |1)[$tsnGrey[By the time you turn your head, the ghostly touch has already faded.]]
(event: when time &gt; 17s)[$tsn[You consider your answer.

(link-reveal:&quot;&gt; It&#39;s fine just how it is.&quot;)[(set: $choice to &quot;fine&quot;)(go-to: &quot;test3-4&quot;)]
(link-reveal:&quot;&gt; It could do with some changes.&quot;)[(set: $choice to &quot;change&quot;)(go-to: &quot;test3-4&quot;)]]]</tw-passagedata><tw-passagedata pid="13" name="test3-4" tags="" position="1001,536" size="100,100">(text-style: &quot;smear&quot;)[(event: when time &gt; 1.0s)[*S*](event: when time &gt; 1.1s)[*o*] (event: when time &gt; 1.2s)[*t*](event: when time &gt; 1.3s)[*h*](event: when time &gt; 1.4s)[*e*](event: when time &gt; 1.5s)[*y*] (event: when time &gt; 1.6s)[*s*](event: when time &gt; 1.7s)[*a*](event: when time &gt; 1.8s)[*y*](event: when time &gt; 1.9s)[*.*](if: $choice is &quot;fine&quot;)[ (event: when time &gt; 3.0s)[*Y*](event: when time &gt; 3.1s)[*e*](event: when time &gt; 3.2s)[*t*](event: when time &gt; 3.3s)[*,*]] (event: when time &gt; 3.6s)[*I*] (event: when time &gt; 3.7s)[*c*](event: when time &gt; 3.8s)[*a*](event: when time &gt; 3.9s)[*n*](event: when time &gt; 4.0s)[*&#39;*](event: when time &gt; 4.1s)[*t*] (event: when time &gt; 4.2s)[*h*](event: when time &gt; 4.3s)[*e*](event: when time &gt; 4.4s)[*l*](event: when time &gt; 4.5s)[*p*] (event: when time &gt; 4.6s)[*b*](event: when time &gt; 4.7s)[*u*](event: when time &gt; 4.8s)[*t*] (event: when time &gt; 4.9s)[*w*](event: when time &gt; 5.0s)[*o*](event: when time &gt; 5.1s)[*n*](event: when time &gt; 5.2s)[*d*](event: when time &gt; 5.3s)[*e*](event: when time &gt; 5.4s)[*r*](event: when time &gt; 5.5s)[*,*] (event: when time &gt; 5.8s)[*w*](event: when time &gt; 5.9s)[*h*](event: when time &gt; 6.0s)[*a*](event: when time &gt; 6.1s)[*t*] (event: when time &gt; 6.2s)[*w*](event: when time &gt; 6.3s)[*o*](event: when time &gt; 6.4s)[*u*](event: when time &gt; 6.5s)[*l*](event: when time &gt; 6.6s)[*d*] (event: when time &gt; 6.7s)[*y*](event: when time &gt; 6.8s)[*o*](event: when time &gt; 6.9s)[*u*] (event: when time &gt; 7.0s)[*c*](event: when time &gt; 7.1s)[*h*](event: when time &gt; 7.2s)[*a*](event: when time &gt; 7.3s)[*n*](event: when time &gt; 7.4s)[*g*](event: when time &gt; 7.5s)[*e*] (event: when time &gt; 7.6s)[*a*](event: when time &gt; 7.7s)[*b*](event: when time &gt; 7.8s)[*o*](event: when time &gt; 7.9s)[*u*](event: when time &gt; 8.0s)[*t*] (event: when time &gt; 8.1s)[*i*](event: when time &gt; 8.2s)[*t*](event: when time &gt; 8.3s)[*,*] (event: when time &gt; 8.4s)[*h*](event: when time &gt; 8.5s)[*a*](event: when time &gt; 8.6s)[*d*] (event: when time &gt; 8.7s)[*y*](event: when time &gt; 8.8s)[*o*](event: when time &gt; 8.9s)[*u*] (event: when time &gt; 9.0s)[*t*](event: when time &gt; 9.1s)[*h*](event: when time &gt; 9.2s)[*e*] (event: when time &gt; 9.3s)[*c*](event: when time &gt; 9.4s)[*h*](event: when time &gt; 9.5s)[*a*](event: when time &gt; 9.6s)[*n*](event: when time &gt; 9.7s)[*c*](event: when time &gt; 9.8s)[*e*](event: when time &gt; 9.9s)[*?*]]

(event: when time &gt; 13s)[$tsn[You can feel a strange weight to the words that Illa speaks.]]
(event: when time &gt; 16s)[$tsn[Slowly, you measure your words, before telling her that you would wish...]]

(event: when time &gt; 18s)[$tsn[(link: &quot;&gt; ...for more pleasurable encounters in the City.&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test3-5&quot;)]]]
(event: when time &gt; 18.25s)[$tsn[(link: &quot;&gt; ...for it to be easier to understand what goes on in the City.&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test3-5&quot;)]]]
(event: when time &gt; 18.5s)[$tsn[(link: &quot;&gt; ...for the City to be more wild and exciting.&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test3-5&quot;)]]]
(event: when time &gt; 18.75s)[$tsn[(link: &quot;&gt; ...for other Citizens to be more accepting of different perspectives.&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test3-5&quot;)]]]</tw-passagedata><tw-passagedata pid="14" name="test3-5" tags="" position="1001,671" size="100,100">$tsn[Slowly, then, a ghostly form manifests before you. As if condensing from a thought, wispy body spun from gossamer milklight, Illa greets you with a whispered smile. When she speaks, her mouth scarcely moves and her voice seems still to come from all around you.]

(text-style: &quot;smear&quot;)[(event: when time &gt; 8.0s)[*I*](event: when time &gt; 8.1s)[*s*] (event: when time &gt; 8.2s)[*t*](event: when time &gt; 8.3s)[*h*](event: when time &gt; 8.4s)[*a*](event: when time &gt; 8.5s)[*t*] (event: when time &gt; 8.6s)[*s*](event: when time &gt; 8.7s)[*o*](event: when time &gt; 8.8s)[*?*]]

(event: when time &gt; 10s)[$tsn[Though you cannot see Illa&#39;s face beneath her midnight veil, you feel her gaze upon you still.]]

(text-style: &quot;smear&quot;)[(event: when time &gt; 14.0s)[*T*](event: when time &gt; 14.1s)[*h*](event: when time &gt; 14.2s)[*i*](event: when time &gt; 14.3s)[*s*](event: when time &gt; 14.4s)[*,*] (event: when time &gt; 14.7s)[*I*] (event: when time &gt; 14.8s)[*s*](event: when time &gt; 14.9s)[*h*](event: when time &gt; 15.0s)[*a*](event: when time &gt; 15.1s)[*l*](event: when time &gt; 15.2s)[*l*] (event: when time &gt; 15.3s)[*r*](event: when time &gt; 15.4s)[*e*](event: when time &gt; 15.5s)[*m*](event: when time &gt; 15.6s)[*e*](event: when time &gt; 15.7s)[*m*](event: when time &gt; 15.8s)[*b*](event: when time &gt; 15.9s)[*e*](event: when time &gt; 16.0s)[*r*](event: when time &gt; 16.1s)[*.*] (event: when time &gt; 16.5s)[*N*](event: when time &gt; 16.6s)[*o*](event: when time &gt; 16.7s)[*w*] (event: when time &gt; 16.8s)[*g*](event: when time &gt; 16.9s)[*o*](event: when time &gt; 17.0s)[*,*] (event: when time &gt; 17.3s)[*c*](event: when time &gt; 17.4s)[*h*](event: when time &gt; 17.5s)[*i*](event: when time &gt; 17.6s)[*l*](event: when time &gt; 17.7s)[*d*](event: when time &gt; 17.8s)[*.*]]

(event: when time &gt; 19s)[$tsn[Illa spreads her hands towards you.]]

(text-style: &quot;smear&quot;)[(event: when time &gt; 22.0s)[*T*](event: when time &gt; 22.1s)[*h*](event: when time &gt; 22.2s)[*e*] (event: when time &gt; 22.3s)[*C*](event: when time &gt; 22.4s)[*i*](event: when time &gt; 22.5s)[*t*](event: when time &gt; 22.6s)[*y*] (event: when time &gt; 22.7s)[*a*](event: when time &gt; 22.8s)[*w*](event: when time &gt; 22.9s)[*a*](event: when time &gt; 23.0s)[*i*](event: when time &gt; 23.1s)[*t*](event: when time &gt; 23.2s)[*s*](event: when time &gt; 23.3s)[*.*]]

(event: when time &gt; 26s)[$tsn[Though you barely move, Illa&#39;s will makes you feel like reality itself has suddenly turned upside down around you.]]
(event: when time &gt; 29s)[$tsn[[[&gt; The world whirls.-&gt;test4]]]]</tw-passagedata><tw-passagedata pid="15" name="test4" tags="" position="1152,98" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You suddenly find yourself stepping back onto the streets of the City, as though you had stepped (link-reveal:&quot;out of the Compass House&quot;)[(show: ?1)]. In the distance, the towering, nodular spire of House Viviria looms, its verdant surface almost seeming to breathe ever so slowly.]|1)[
$tsnGrey[You... You *are* still in the test, aren&#39;t you?]](set: $timer to 8000)

(after: $timer, 200)[=$tsn[A pair of greep waddle by, suckling at the occasional pile of refuse on the ground and dodging errant feet from the Citizens walking by without care or consideration for you.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[You shake your head, then start to make your way into the City streets. You ought to go and find something, you think.](set: $timer to 3000)
(after: time + $timer, 200)[=$tsn[You&#39;re not sure what, but that doesn&#39;t seem to matter so much.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[As you make your way through the gloomy streets, passing by (link-reveal: &quot;Council-sponsored advertisements&quot;)[(show: ?2)] for indulgent trinkets and services, you find yourself uncertain of what you&#39;re doing at all.](set: $timer to 6000)|2)[
$tsnGrey[Arcanograms and messages encouraging the most (link-reveal: &quot;excessive and impulsive&quot;)[(show: ?3)] purchases.]|3)[
$tsnGrey[*(t8n: &quot;dissolve&quot;)(seq-link: &quot;&#39;Buy your very own slave at Rist&#39;s Ravels!&#39;&quot;, &quot;&#39;Murder! Mayhem! Malfortinet&#39;s Marauding - for all your weaponry needs!&#39;&quot;, &quot;&#39;Need Gloam? Join Krutch&#39;s Whorehouse and earn up to 40% of your commission! Outsiders paid double.&#39;&quot;, &quot;&#39;Julpie&#39;s Jars - you never know what you&#39;re going to get!&#39;&quot;, &quot;&#39;Pfoff Pops: Succulent tenderlings stuffed to desperation with candied pfoff, served rare for your enjoyment.&#39;&quot;, &quot;&#39;Master your Mind! Defeat your Demons! Come to Labyrinthia in the Psylisium District for a low-cost examination!&#39;&quot;, &quot;&#39;The Council reminds all Citizens that indulgence is highly encouraged. Failure to comply will result in severe punishment.&#39;&quot;)*
...They all seem fairly similar.]]]

(after: time + $timer, 200)[=$tsn[Eventually you come to an intersection and nearly get run over by a Slyne in a carriage with grandiose wheels being hauled by two miggwitches. They bray and rear up at the last moment, and you quickly duck out of the way to the hissed curses of the Slyne.

[[Hurry onwards-&gt;test4-2]]]</tw-passagedata><tw-passagedata pid="16" name="test4-2" tags="" position="1152,248" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
(if: $charmed is true)[(set: $s to (text-colour: #ccffcc))](else:)[(set: $s to (text-colour: grey))](event: when time &gt; 1s)[(t8n: &quot;rumble&quot;)+(transition-time: 0.5s)[$npc[&quot;Hey!&quot;]]](set: $timer to 4000)

(after: $timer, 200)[=$tsn[A sudden call sounds out from behind you. You turn around to find yourself face-to-face with a grisly-looking krudge. Her shrewd eyes fix upon you, and for an instant you worry about what dire thing you&#39;ve done to earn her anger.](set: $timer to 7000)(after: time + $timer, 200)[=$tsn[Then, her face draws back and she offers you a faint smile.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Customer, eh?&quot;] she asks. You look down and see that the krudge is in fact standing behind a food stall with numerous edibles on display - ranging from scrumptious to stomach-turning. $npc[&quot;You buying?&quot;]](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[It&#39;s at that moment that you realise that you are *famished*. Your stomach grumbles unhappily, and the krudge laughs in response. You have a look at her food stall and decide that you&#39;ll buy something to sate your hunger.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[Alas, when you look at the prices attached, you realise that you only have enough for one serving. You take a close look at the foods to see what&#39;s on offer.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[There&#39;s a tray full of meat with a hotly spiced Cinderbean paste. You can see a warning symbol cautioning the level of heat contained within the dish.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You also see a (link-reveal: &quot;salad&quot;)[(show: ?1)] with a potent Blackwine dressing, seasoned with hints of other substances to make one feel solemn and reflective.](set: $timer to 7000)|1)[
$tsnGrey[Quite a nice salad, too - it hardly seems to be moving.]]

(after: time + $timer, 200)[=$tsn[Sitting towards the back, you can see a bowl full of gelatinous goo. A small placard marks it as solidified nectar, and a warning symbol lets you know that it might have some side effects beyond simple satiation.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[There&#39;s a dish on sale made from Hornsquat which supposedly enhances one&#39;s awareness. Perhaps if you ate that, you might have a clearer idea of what you&#39;re doing.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[There also appear to be several other dishes that don&#39;t stand out quite as well. Choosing is starting to be a hassle, and you realise you *could* always ask the krudge to simply give you whatever - it all ends up the same way, right?](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Ask for the Cinderbean meat&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test4-vorn&quot;)]
(link: &quot;&gt; Ask for the salad with the Blackwine dressing&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test4-umbra&quot;)]
(link: &quot;&gt; Ask for the gelatinous nectar&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test4-morph&quot;)]
(link: &quot;&gt; Ask for the Hornsquat fruit dish&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test4-psi&quot;)]
(link: &quot;&gt; Ask the krudge to choose for you&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test4-byle&quot;)]]</tw-passagedata><tw-passagedata pid="17" name="test4-psi" tags="" position="1151,398" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You order the Hornsquat and feel a flow of Gloam departing your EgoBracer. The krudge scoops up some food, setting it onto a plate of bone, then hands you the fruity dish.]

(event: when time &gt; 6s)[$tsn[You find a place to sit, then start to dig in to the food to quell your protesting stomach.]]

(event: when time &gt; 9s)[$tsn[With each bite, you feel a little calmer and more clear-headed.]]

(event: when time &gt; 12s)[$tsn[After several seconds, the world starts to feel a little more distant. The thrumming pulse of the City around you with its Citizens strutting to and fro and its carriages and scarabs and zeppelins drifting by quietens down, even as you feel somehow more aware of your surroundings.]]

(event: when time &gt; 20s)[$tsn[You feel aware of everything. The sounds of a nearby mage chattering with a Slyne cohort.]]
(event: when time &gt; 24s)[$tsn[The scent of two Nurks enjoying each other in a nearby alleyway.]]
(event: when time &gt; 28s)[$tsn[The sight of the great Spire in the centre of the city against the gloomy sky.]]
(event: when time &gt; 32s)[$tsn[(if: $pussy is true)[The feeling of a fat, heavy cock slowly pumping in and out of your cunt.](else:)[The feeling of a fat, heavy cock pumping slowly in and out of your ass.]]]

(if: $dick is true AND $pussy is false)[|1&gt;[(event: when time &gt; 38s)[$tsn[Slowly, the world fades away... or perhaps, fades *back into view*? Like a ghostly image superimposed upon the visage of Nodd, you find yourself sitting in the Compass House, with (if: $charmed is true)[your best friend ]Maji slowly stuffing his cock right into your aching ass, rocking his hips back and forwards as he slowly fucks you. At the same time, one of his arms is wrapped around your own cock, his muzzle wrapped around your cocktip and suckling on your dick. It feels so good! You can see the bulge of his own disproportionately large cock in your guts, and you realise that his claws are dancing slowly in front of your face.]]]

|2&gt;[(event: when time &gt; 52s)[$tsn[You blink slowly and feel a powerful wave of pleasure wrack your whole cock. You can feel the little creature in front of you jerking you off with everything he has as he repeatedly buries his own dick inside you. You try to groan, but all that comes out is a weak mumble from your lips as you feel a powerful jet of kobold precum erupt deep in your guts.]]]

|3&gt;[(event: when time &gt; 62s)[$tsn[$npc[&quot;Oh! Waking up? Mmnh...&quot;] the kobold groans, pulling his snout from your spit-shined cocktip and looking over at a pair of hourglasses.]] 
(event: when time &gt; 66s)[$tsn[$npc[&quot;Too early yet, yep, yep. Maji is not done with- ahh!- new friend, yet... Back you go,&quot;] the kobold urges. He pulls himself back until just the tip of his cock is wedged inside your painfully stretched ass, before his claw dances with an eerie green light - and suddenly you feel the world snap back to the City right as he *hilts* his monstrous cock inside you with a cry of bliss.]]]

(event: when time &gt; 76s)[$tsn[Suddenly you feel your cock twitch hard, and you erupt around him right there in the street, pumping gout after gout of thick, gooey cum across the ground. You still don&#39;t understand what made you so horny as to let a krudge fuck you right there in public, but it feels *so good* as you spurt in full view of everyone, clenching around him.]] 
(event: when time &gt; 80s)[(replace: ?1)[You groan out loud as the krudge beneath you squashes you down further into his lap, his monstrous cock skewering into your ass so deeply that a little bulge appears in your stomach. 

You&#39;re not sure who he is, but you recall how glad you were he was around to help you with your need after eating your meal, because, *City&#39;s Eyes*, you needed to be *fucked*. You realise that your hand is wrapped around your own cock and is slowly starting to pump along it as you get hard. Fuck, you&#39;re horny. Really, really, *really* horny.]] (event: when time &gt; 82s)[(replace: ?2)[You can see people watching you as you imagine humping into a tight, warm hole, pistoning your fist along the length of your dick with increasing urgency as your own gets reamed to the breaking point. You don&#39;t care that people can see you. In fact, you like it.

It feels like the krudge is showing you off as he sinks you down onto him again and again.]] (event: when time &gt; 84s)[(replace: ?3)[Faster and faster, you hump your hand like a wild animal as the krudge uses you, delighting in the way people watch you pleasuring yourself and the big insider. You&#39;re going to cum right in front of everyone. You feel the pleasure mounting to a dizzyingly blissful wall.]]
(event: when time &gt; 86s)[$tsn[The krudge fucks you for more than a bell before he finally finishes, erupting inside you with such force that your belly bloats. His roars are heard up and down the street as you&#39;re used. Eventually though, after literal chimes of spurting thick and custardy cum into you, even he calms down as his titanic dick softens up. You pant hard, trying to bring yourself to a calmer state as your afterglow sets in, your dick still dribbling slow oozes of spunk to the ground. You feel somehow... proud of your actions. Deep down, you realise that you kind of *do* have a bit of an exhibitionism kink, don&#39;t you? At least... you do now.

[[&gt; Mmf...-&gt;test5]]]]
](else-if: $dick is false AND $pussy is true)[|1&gt;[(event: when time &gt; 38s)[$tsn[Slowly, the world fades away... or perhaps, fades *back into view*? Like a ghostly image superimposed upon the visage of Nodd, you find yourself sitting in the Compass House, with (if: $charmed is true)[your best friend ]Maji slowly stuffing his cock right into your vulnerable pussy, rocking his hips back and forwards as he slowly fucks you. It feels so good! You can see the bulge of his disproportionately large cock in your passage, and you realise that his claws are dancing slowly in front of your face.]]]

|2&gt;[(event: when time &gt; 52s)[$tsn[You blink slowly and feel a powerful wave of pleasure wrack your body as what feels like a *flare* thickens inside of you. The kobold is packing an enormous package! You try to groan, but all that comes out is a weak mumble from your lips as you feel a powerful jet of precum erupt inside you.]]]

|3&gt;[(event: when time &gt; 62s)[$tsn[$npc[&quot;Oh! Waking up? Mmnh...&quot;] the kobold groans, looking over at a pair of hourglasses.]]
(event: when time &gt; 66s)[$tsn[$npc[&quot;Too early yet, yep, yep. Maji is not done with- ahh!- new friend, yet... Back you go,&quot;] the kobold urges. He pulls himself back until just the tip of his cock is wedged between your slick folds, before his claw dances with an eerie green light - and suddenly you feel the world snap back to the City right as he *hilts* his bitchbreaking cock inside you with a cry of bliss.]]]

(event: when time &gt; 76s)[$tsn[Suddenly you feel your pussy squeeze down around your digits, and you fall to your knees as you *squirt* right there in the street. You moan loudly as you pleasure yourself into a frenzy, digits squishing in and out of your cunt with wild abandon through your rolling climax. You still don&#39;t understand what made you so horny as to finger yourself right there in public, but it feels *so good* as you make a mess of yourself in full view of everyone.]]
(event: when time &gt; 80s)[(replace: ?1)[You realise that your fingers have slid down to your slit and started to rub and stroke your already wet folds. The sudden feeling felt so real, but passes quickly, leaving you simply aching for a real, fat *cock* to push inside you. Fuck, you&#39;re horny. Really, really, *really* horny.]] (event: when time &gt; 82s)[(replace: ?2)[You can see people watching you as you imagine a fat, flared, equine cock digging into your pussy with eager abandon as you start to finger yourself openly, plunging two digits into your wet folds without a care in the world. You don&#39;t care that people can see you. In fact, you like it.]] (event: when time &gt; 84s)[(replace: ?3)[Faster and faster, you pump your digits like a wild animal, delighting in the way people watch you pleasuring yourself. You&#39;re going to cum right in front of them. You feel the pleasure mounting to a dizzyingly blissful wall.]]
(event: when time &gt; 86s)[$tsn[You pant hard, trying to bring yourself to a calmer state as your afterglow sets in, your cunt still quivering and dripping your excitement to the ground. You feel somehow... proud of your actions. Deep down, you realise that you kind of *do* have a bit of an exhibitionism kink, don&#39;t you? At least... you do now.

[[&gt; Mmf...-&gt;test5]]]]
](else:)[|1&gt;[(event: when time &gt; 38s)[$tsn[Slowly, the world fades away... or perhaps, fades *back into view*? Like a ghostly image superimposed upon the visage of Nodd, you find yourself sitting in the Compass House, with (if: $charmed is true)[your best friend ]Maji slowly stuffing his cock right into your vulnerable pussy, rocking his hips back and forwards as he slowly fucks you. At the same time, one of his arms is wrapped around your own cock, his muzzle wrapped around your cocktip and suckling on your dick. It feels so good! You can see the bulge of his disproportionately large cock in your passage, and you realise that his claws are dancing slowly in front of your face.]]]

|2&gt;[(event: when time &gt; 52s)[$tsn[You blink slowly and feel a powerful wave of pleasure wrack your body as what feels like a *flare* thickens inside of you. You can feel the little creature in front of you jerking you off with everything he has as he repeatedly buries his own dick inside you. You try to groan, but all that comes out is a weak mumble from your lips as you feel a powerful jet of precum erupt inside you.]]]

|3&gt;[(event: when time &gt; 62s)[$tsn[$npc[&quot;Oh! Waking up? Mmnh...&quot;] the kobold groans, pulling his snout from your spit-shined cocktip and looking over at a pair of hourglasses.]]
(event: when time &gt; 66s)[$tsn[$npc[&quot;Too early yet, yep, yep. Maji is not done with- ahh!- new friend, yet... Back you go,&quot;] the kobold urges. He pulls himself back until just the tip of his cock is wedged between your slick folds, before his claw dances with an eerie green light - and suddenly you feel the world snap back to the City right as he *hilts* his bitchbreaking cock inside you with a cry of bliss.]]]

(event: when time &gt; 76s)[$tsn[Suddenly you feel your cock jerk in your grip and your pussy squeeze down around your digits, and you fall to your knees as you *squirt* right there in the street. You moan loudly as you pleasure yourself into a frenzy, one hand squishing in and out of your cunt with wild abandon through your rolling climax as your other desperately pumps your plump cock. You still don&#39;t understand what made you so horny as to touch yourself right there in public, but it feels *so good* as you make a mess of yourself in full view of everyone.]]
(event: when time &gt; 80s)[(replace: ?1)[You realise that your fingers have slid down to your slit and started to rub and stroke your already wet folds. The sudden feeling felt so real, but passes quickly, leaving you simply aching for a real, fat *cock* to push inside you. Fuck, you&#39;re horny. Really, really, *really* horny.]] (event: when time &gt; 82s)[(replace: ?2)[You can see people watching you as you imagine a fat, flared, equine cock digging into your pussy with eager abandon as you start to finger yourself openly, plunging two digits into your wet folds without a care in the world. You don&#39;t care that people can see you. In fact, you like it. You wrap your other hand around your cock with a giddy hiss of breath.]] (event: when time &gt; 84s)[(replace: ?3)[Faster and faster, you pump your cock and ride your digits like a wild animal, delighting in the way people watch you pleasuring yourself. You&#39;re going to cum right in front of them. You feel the pleasure mounting to a dizzyingly blissful wall.]]
(event: when time &gt; 86s)[$tsn[You pant hard, trying to bring yourself to a calmer state as your afterglow sets in, your cunt still quivering and dripping your excitement to the ground and your cock spurting occasional globs of spunk. You feel somehow... proud of your actions. Deep down, you realise that you kind of *do* have a bit of an exhibitionism kink, don&#39;t you? At least... you do now.

[[&gt; Mmf...-&gt;test5]]]]]</tw-passagedata><tw-passagedata pid="18" name="test5" tags="" position="1300,99" size="100,100">(text-colour: #D4FF54)[####The Surface - Lornia]
$tsn[You leave the street behind and make your way in from the Vivirian district. (if: $choice is &quot;byle&quot;)[Your steps feel sluggish under your new, heftier weight, but you manage.](else-if: $genderTF is true)[You feel weird with each and every step, the strangeness between your legs showing no sign of reverting. You may have to face that it&#39;s permanent until you find a mage or artifact to reverse it.](else:)[You still feel the lingering effects of your meal, but they seem to be fading for the moment.]](set: $timer to 6000)

(after: $timer, 200)[=$tsn[The sun is slowly setting, its ghostly light dimming towards what will eventually become the gloaming hours of the City. In the fading light, shapes and shadows start to move around in alleyways and behind shuttered windows, preparing for the rise of the nocturnal citizens and those who dwell in the dark.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[*It&#39;s nearly night by the time you realise that you&#39;ve been going in the wrong direction.*](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[You come to a stop and take stock of your surroundings.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[In the distance, you can see the edge of the City and what ought to be the Lornia gate. Dilapidated archways stretch overhead and doorways hang halfway open. Broken windows let fetid air billow inwards and out of downcast-looking buildings, as though the structures were sighing in mournful anticipation. Though a building being downcast sounds silly. *That* only happens in--](set: $timer to 10000)

(after: time + $timer, 200)[=$tsn[Oh, no.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[*[[The Pruning.-&gt;test5-2]]*]</tw-passagedata><tw-passagedata pid="19" name="test5-2" tags="" position="1300,247" size="100,100">(text-colour: #D4FF54)[####The Surface - Lornia]
(event: when time &gt; 0.5s)[(t8n: &quot;rumble&quot;)+(transition-time: 0.25s)[The Pruning is close at hand.]](set: $timer to 2000)
(after: $timer, 200)[=$tsn[Now that you&#39;re looking for the signs, they&#39;re everywhere.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[Devilmint hangs from each and every door. The streets in this area are deserted. A great pall of resignation hangs across the district.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[***The Council is coming.***](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You need somewhere to take shelter! A building would do! Yet, you need to choose a good one. Choosing a building that you dislike or, worse, that dislikes *you* would prevent you from forming a dwelling-owner bond. Without *that*, the building and all its occupants - including you - would be as good as Pruned.](set: $timer to 10000)

(after: time + $timer, 200)[=$tsn[You quickly look around for nearby chambers that might be ideal.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[There&#39;s a very plain building nearby. Its features are nondescript, and it seems about as normal as a building can be. One rectangular door, two windows - only one of them broken - and no signs of Petrids.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Only a little further away, you can see a building set behind an old, fenced off garden. It looks to have fallen quite into disrepair, but could perhaps be done up with some effort.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Off to your right, you see a building that seems pock-marked by Petrid limbs that have been left behind. You can see curious furniture inside a window that looks to have been fashioned after creatures.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[There&#39;s also a dwelling that looks like it might be missed by the impending Council destruction. You can see a doorway that leads *downwards* into a half-subterranean set of chambers.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[Then again, perhaps you could go for the defensible - off in the distance you can see a large, multi-storied building that seems to have a confusing network of cast-iron passages to deter would-be intruders. If you could get past that, you might well be safe, too.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Make for the plain dwelling&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(set: $dwelling to &quot;The Plain Chambers&quot;)(go-to:&quot;test5-3&quot;)]
(link: &quot;&gt; Make for the old dwelling&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(set: $dwelling to &quot;The Old Chambers&quot;)(go-to:&quot;test5-3&quot;)]
(link: &quot;&gt; Make for the furnished dwelling&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(set: $dwelling to &quot;The Furnished Chambers&quot;)(go-to:&quot;test5-3&quot;)]
(link: &quot;&gt; Make for the subterranean dwelling&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(set: $dwelling to &quot;The Underground Chambers&quot;)(go-to:&quot;test5-3&quot;)]
(link: &quot;&gt; Make for the defensible dwelling&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(set: $dwelling to &quot;The Defensible Chambers&quot;)(go-to:&quot;test5-3&quot;)]]</tw-passagedata><tw-passagedata pid="20" name="test5-3" tags="" position="1302,397" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(if: $choice is &quot;omn&quot;)[$tsn[You race towards the plain dwelling, secure in the knowledge that its regularity is something you could bond with.]
](else-if: $choice is &quot;viv&quot;)[$tsn[You race towards the old dwelling with the garden, knowing that any place still able to grow *something* surely could survive the Pruning.]
](else-if: $choice is &quot;byle&quot;)[$tsn[You race towards the submerged dwelling, confident that its position is at least somewhat secure.]
](else-if: $choice is &quot;morph&quot;)[$tsn[You race towards the dwelling with all the furniture in it. After all, any building that can spawn such lifelike furniture *and* a number of Petrid surely has a storied history and energy to it.]
](else-if: $choice is &quot;psi&quot;)[$tsn[You race towards the dwelling with the cast-iron fencing. Defense is surely the way to go, and a veritable maze of passages might just be enough to keep the notoriously whimsical Council out.]](set: $timer to 5000)

(after: $timer, 200)[=$tsn[You swiftly make your way inside, finding the door mercifully unlocked, then latch it behind you. You gaze around your new surroundings, taking in the visage of what was once a delightful young building.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[Honestly, it&#39;s surprisingly pleasant, all things considered. The ceiling is somewhat spacious, and you can see a fireplace set into the wall that you could stoke for warmth on cold Noddish nights. Though a thin film of greenish ichor drools down some of the walls, it&#39;s the *homely* type of ichor that speaks to a living home rather than a withered one.](set: $timer to 10000)

(after: time + $timer, 200)[=$tsn[Yes, these chambers ought to do nicely.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You move from room to room quickly, surveying the building for anything untoward or dangerous. You tentatively investigate one of the storerooms to check for chamberbugs or traps the former owner might have set.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[Unfortunately, while you&#39;re hunting, you hear something loud and threatening from behind you.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Of course.-&gt;test6]]]</tw-passagedata><tw-passagedata pid="21" name="test6" tags="" position="1452,99" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(event: when time &gt; 0.5s)[$tsn[With a terrifying (text-style: &quot;shudder&quot;)[crash], a *very* ambulant piano-like instrument thunders to life from across the room, lumbering towards you with a deceptive agility. Its lid bounces and crashes up and down with frightful force, and a cacophony of noise bellows forth from its midsection.]](set: $timer to 6000)

(after: $timer, 200)[=$tsn[It&#39;s clearly hostile.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[Thinking quickly, you cast your eyes across the room to look for anything you might defend yourself with! You need a weapon you might have a chance of using effectively.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[There looks to be a |1&gt;[flask] on a shelf with an arcanogram that means *growth* on it - you think it might be Thirsty Tendrils. You might be able to incapacitate the instrument with it!](set: $timer to 3000)(after: time + $timer, 200)[=(replace: ?1)[$tsn[~~flask~~ *disposable spell*]](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[Next to it is another flask with a more direct arcanogram label on it. *Void Whisper*. You might just be able to force the ambulant furniture to kill itself and spare you the hassle!](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You can see a halberd leaning against a stack of firewood. It looks like it might be unwieldy and difficult, but very effective if you can manage.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[There&#39;s a bucket of caustic-looking sludge on the floor near your feet. Perhaps you could melt the furniture?](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[Overhead hangs a large light fitting not unlike a chandelier. If you could bring it down on top of the instrument, it might damage it enough for you to slip by! There&#39;s a rope nearby holding the fitting up - you would need to sever it at just the right moment!](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[The discordant clanging and juddering is coming (text-style: &quot;smear&quot;)[closer] by the heartbeat though - you need to decide!](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Grab the growing spell!&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test6-2&quot;)]
(link: &quot;&gt; Grab the lethal spell!&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test6-2&quot;)]
(link: &quot;&gt; Grab the halberd!&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test6-2&quot;)]
(link: &quot;&gt; Grab the acid(?)!&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test6-2&quot;)]
(link: &quot;&gt; Cut the lights!&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test6-2&quot;)]]</tw-passagedata><tw-passagedata pid="22" name="test6-2" tags="" position="1454,250" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(if: $choice is &quot;byle&quot;)[$tsn[You grab the bucket, careful not to slosh any of the caustic muck on yourself, before hurling it at the ambulent instrument!](set: $timer to 5000)

(after: $timer, 200)[=$tsn[The slime hits your encroaching assailant, before immediately setting to work bubbling and boiling on its chitinous surface. Its lid flaps and a horrid, ear-splitting caterwaul of agony sounds out from its bulky body.](set: $timer to 6000)
](else-if: $choice is &quot;viv&quot;)[$tsn[You grab the flask and tear the stopper from the top, hurling it towards the ambulant instrument!](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Immediately, a tangle of enthusiastic tentacle-like appendages erupt from the floor and ensnare the instrument. They quickly set about latching onto the furniture and draining it of its vitality with remarkable efficiency. You aren&#39;t certain if the spell is normally meant to be lethal, but it quickly becomes apparent that it soon will be.](set: $timer to 7000)
](else-if: $choice is &quot;vorn&quot;)[$tsn[You grab the halberd and feel its weight, trying to gain a feel for it on the fly. Wielding it with two hands, you take aim--](set: $timer to 4000) (after: $timer, 200)[=$tsn[and *swing*!](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Miraculously, the blade cleaves true and delivers a wicked wound to the furniture. Blue-tinged blood sprays across the floor. You swing again and again as quickly as you can, leaving the bellowing instrument staggered in pain.](set: $timer to 5000)
](else-if: $choice is &quot;umbra&quot;)[$tsn[You grab the flask and tear the stopper from the top, hurling it towards the ambulant instrument!](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[A wave of greenish light suffuses the instrument. It (text-style: &quot;shudder&quot;)[wobbles], (text-style: &quot;rumble&quot;)[shudders], and then changes course to smash itself against the wall. Not once, not thrice, but six heavy, building-shaking impacts worth. Each one is more cacophonous and more violent than the last.](set: $timer to 6000)
](else-if: $choice is &quot;omn&quot;)[$tsn[You rush to the rope, watching as the ambulant furniture changes course to pursue you. You bite your tongue in anticipation over your timing, required to be near-perfect.](set: $timer to 4000)

(after: $timer, 200)[=$tsn[...Now!](set: $timer to 2000)
(after: time + $timer, 200)[=$tsn[You loosen the cord right on time and watch as the light fitting comes crashing down to break violently upon the instrument&#39;s body. It lets out a discordant wail of shock, before staggering under the sudden and violent impact. You can see blue-tinted fluids leaking from its cracked body and already know you&#39;ve succeeded.](set: $timer to 7000)]

(after: time + $timer, 200)[=$tsn[The instrument collapses shortly before your body, its stumpy limbs flailing weakly in its disharmonious death throes. The noise of its passing is almost as terrifying as the shrieks of its attack.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[It&#39;s only after its last note has creaked out from its broken body that you start to realise how quickly your heart has been beating.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You step around the body of the instrument and uneasily make your way out from the storage room, making your way back to the main chamber.](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Better than here.-&gt;test7]]]</tw-passagedata><tw-passagedata pid="23" name="test7" tags="" position="1600,101" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You step back into the main room and breathe a sigh of relief for having escaped the hostile instrument. You gaze across the room, then make your way to a chair in front of the fireplace.(set: $timer to 5000)]

(after: $timer, 200)[=$tsn[After giving the chair a couple of testing (link-reveal: &quot;prods&quot;)[(show: ?1)], you sit down in it. (if: $genderTF is true)[You still feel very weird with (if: $pussy is true)[so little](else:)[so much] between your legs, but you try to ignore it. ]The chair creaks a little in protest, but mercifully nothing happens.](set: $timer to 5000)|1)[
$tsnGrey[You can never be too careful, after all.]]

(after: time + $timer, 200)[=$tsn[It&#39;s while you&#39;re sitting there, though, that you hear a (text-style: &quot;smear&quot;)[thump] coming from the door.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[What, now?](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You hesitantly rise and make your way to a little window beside the door before peering out and into the darkness of the City beyond.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[Two (text-colour: red)[deep, red eyes] gaze back at you through the glass.](set: $timer to 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You jolt back in surprise but you already know that you&#39;ve been seen. (if: $dwelling is &quot;The Defensible Chambers&quot;)[You&#39;re not sure how someone got through the maze so quickly, but you hardly have time to think about it. ]Only a moment later you hear a scratching at the door, followed by an unsettling *click*.(set: $timer to it + 2000)](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You run to hide.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Before you&#39;ve gone three steps, the door is flung open as the creature stalks inside and, with lightning-fast movement, grabs you from behind and lifts you off of the ground with a single strong arm. In a flurry of motion you&#39;re spun around and brought face-to-face with a sinister figure in dark, Vulturewear robes.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[A lehlt stands there, his slender body predatory and sleek. While his pelt seems to be relatively glossy, the occasional speckling of warts and asymmetric snarls of fur hint at a lack of envy.](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; He seems to be sizing you up.-&gt;test7-2]]]</tw-passagedata><tw-passagedata pid="24" name="test7-2" tags="" position="1601,251" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You recoil from the lehlt as he examines you with the air of a cold-blooded predator. His salty breath washes across your face, and you see his muzzle twist into a smile.(set: $timer to 5000)]

(after: $timer, 200)[=(set: $timer to 0)$tsn[How did he get here? Is he from the Council? Someone undertaking the Pruning?](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Or is he just a passing Citizen? The *owner*?](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You&#39;re not sure which would be worse.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;You do know,&quot;] the lehlt says, his voice smooth and masculine. Somehow though, his intimidating visage and dark eyes leave you unable to think of anything but how vulnerable you are. $npc[&quot;Trespassing in other districts is punishable by *death*, yes?&quot;]](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He smiles.](set: $timer to it + 3000) (after: time + $timer, 200)[=(set: $timer to 0)$tsn[It isn&#39;t a kind smile.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Oh, pardon me,&quot;] he says then, his voice taking an apologetic, almost sympathetic note. $npc[&quot;I didn&#39;t mean to imply that it&#39;s *not* punishable by death here! But... since you caught my eye, I think I&#39;ll let *you* choose how you go out. Consider it a kindness within a valuable lesson.&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Your blood runs cold.-&gt;test7-3]]]</tw-passagedata><tw-passagedata pid="25" name="test7-3" tags="" position="1601,399" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[$npc[&quot;I could chop you up; I&#39;m quite good at it,&quot;] the lehlt muses. He gives you a sidelong look as he holds you in place. Slowly, he examines you like a piece of meat. $npc[&quot;Not the quickest way out, but certainly entertaining.&quot;]](set: $timer to 5s)

(after: $timer, 200)[=$tsn[$npc[&quot;Or I suppose, I do need someone to assist my floral friend.&quot;] He flashes you a wry smile. $npc[&quot;Are you a gardener, dear intruder, hmm?&quot;]](set: $timer to 6s)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Of course, I am a little famished at the moment.&quot;] He lifts a claw and taps on his goateed chin. $npc[&quot;Perhaps you fancy being a little smaller.&quot;] His dark eyes narrow into an almost sly gaze.](set: $timer to 6.5s)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Though I will say, all this talk of expunging you is working up *quite* the stiffness down below. Perhaps we could make your final moments more enjoyable, hmm?&quot;] He smirks and cups your chin with one hand.](set: $timer to 6s)

(after: time + $timer, 200)[=$tsn[$npc[&quot;Then again, you could refuse to make any choice. But, if you&#39;re going to piss on my offer,&quot;] he muses, arching one slightly patchy eyebrow, $npc[&quot;then I&#39;m going to piss on *you*.&quot;]](set: $timer to 6s)

(after: time + $timer, 200)[=$tsn[$npc[&quot;So,&quot;] the insider asks, giving you a brief and tight smile. He drags his tongue along his lips. $npc[&quot;What shall you do, little trespasser?&quot;]](set: $timer to 2s)

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Take the pain. You can handle pain.&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test7-umbra&quot;)]
(link: &quot;&gt; Gardening sounds like it wouldn&#39;t be the worst.&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test7-viv&quot;)]
(link: &quot;&gt; Ask him about what he means by *smaller*.&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test7-morph&quot;)]
(link: &quot;&gt; Going out with some pleasure sounds... better.&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test7-vorn&quot;)]
(link: &quot;&gt; Tell him to get lost in the Abyss.&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test7-byle&quot;)]]</tw-passagedata><tw-passagedata pid="26" name="test7-byle" tags="" position="1597,547" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You grimace, then tell the lehlt to get lost in the Abyss.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Oh, dear intruder. My **dear**, dear intruder,&quot;] he says, lips curling into a smirk.](set: $timer to it + 2000) (after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;You just have to do it the hard way, don&#39;t you?&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Fine,&quot;] he says. He drops you to the floor, spreading his legs to show off his heavy sheath and balls. They look partially wretched, (text-style: &quot;fidget&quot;)[wrinkled] and (text-style:&quot;fidget&quot;)[sagging]. Before you can say anything, his arm seizes you and wrenches you forwards. You find your face squashed against the swell of his sheath, and feel the press of something (text-style: &quot;shudder&quot;)[**wickedly sharp**] against the back of your neck.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[(text-style:&quot;blur&quot;)[You know a blade when you feel one.]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Taking the hint, you freeze. Your heart pounds in your chest, and you make certain not to make any sudden movements. Pressed so firmly against his sheath, every shallow breath becomes heady and leaves you feeling light-headed.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Good. Now hold still,&quot;] you hear, before the hand leaves your head. The blade, however, remains, ensuring you stay with your nose buried against his heated sheath.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You hear the (text-style:&quot;outline&quot;)[clink] of a disposable spell opening. ... *Then another.*](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Only moments later, you feel a strange, (text-style:&quot;smear&quot;)[(text-colour:orange)[cloying warmth]] start to suffuse your head.](set: $timer to it + 2000)
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;*That&#39;s it. Don&#39;t bother fighting, little piss-slut.*&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You groan and squeeze your eyes shut, the point of his blade threatening to pierce your neck if you move or struggle. Soon, you find that you&#39;re beginning to (if: $dick is true)[feel strangely hard$pussy[ and ]](if: $pussy is true)[feel surprisingly wet]. You feel almost paralysed as his cock starts to **thicken up** and push out from his sheath, squashing against your face.](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[It&#39;s greasy and slick, and you watch as he lowers one arm to adjust himself so that increasingly plump spire pushes against your lips. He smiles at you, then rocks his hips gently. You feel the slimy tip push just into your mouth. There&#39;s a strange, odd *captivation* with his cock, and you realise that one of his disposable spells has done something to your head.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Although he&#39;s abusing you, you almost... can&#39;t help but feel a *thrill* at having his dick in your mouth, now. Even knowing what&#39;s coming. *You can&#39;t help but feel a twinge of excitement.*](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;That&#39;s it,&quot;] the lehlt says. $npc[&quot;Mmm...&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Gulp.-&gt;test7-byle2]]]</tw-passagedata><tw-passagedata pid="27" name="test7-byle2" tags="" position="1598,650" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[$npc[(text-style:&quot;smear&quot;)[&quot;Aah~&quot;]]](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Suddenly, you feel a scaldingly hot torrent of acrid, watery fluid spray into your mouth. Your eyes bulge in surprise at the bitter, foul taste, but the lehlt&#39;s touch under your jaw takes your full attention.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Spill any, and I&#39;ll remove your tongue,&quot;] he says as casually as one might mention confiscating a toy. You seal your lips tightly around his spraying tip.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your mouth rapidly floods with eye-wateringly potent urine and, with no other option, you&#39;re forced to swallow.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You nearly retch, but manage to keep the bitter drink down even as your mouth fills back up in only moments. Your tastebuds (text-style:&quot;shudder&quot;)[bathe] in the insider&#39;s piss.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then, he touches your head again with something. You force your wincing eyes open to look at him.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He&#39;s holding (text-style:&quot;blur&quot;)[another two disposable spell canisters.]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;One for you, and one... for me,&quot;] he says as he unstoppers them.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Gloam erupts around you and you feel a sudden roiling in your stomach. Your body lurches, your mind clouds, and only a moment later you realise just how desperately *thirsty* you are. *You&#39;ve been hit by Appetize.*](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[At the same time, the second spell breaks upon the lehlt&#39;s body, and you see the effects settle in. You can&#39;t tell what it is, though.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You swiftly find yourself gulping down the hot and steaming contents of his bladder by the mouthful, your body desperate for *liquid*. You know it&#39;s a spell, but it doesn&#39;t stop you from pushing your mouth down all the way on his cock, taking as much of his fluids in as you can. You don&#39;t stop until he&#39;s done.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[...](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Until he&#39;s done.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[...](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...Until he&#39;s done?-&gt;test7-byle3]]]</tw-passagedata><tw-passagedata pid="28" name="test7-byle3" tags="" position="1597,753" size="100,100">(text-colour: #8DD800)[####$dwelling]
$tsn[$npc[&quot;Mmmm, realised, yet?&quot;] the lehlt asks as you feel your belly start to ache. He just keeps pissing into your mouth. Slowly, understanding starts to sink in even as you uncontrollably guzzle his stream. $npc[&quot;Mine was *Gush*. That first one was Engross. Right now you&#39;re quite addicted to my cock, little trespasser, and I doubt you&#39;re even *remotely* able to stop guzzling my (text-colour: yellow)[piss].&quot;]](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 0)$tsn[Gulp by gulp, mouthful by mouthful, your stomach slowly grows heavier and heavier with his urine. You can&#39;t stop yourself. Even as your belly bulges and starts to ache. Even as you start to feel ill.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[This is how you&#39;re going to go out.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Gulp...](set: $timer to it + 1500)(after: time + $timer, 200)[=(set: $timer to 0)$tsn[gulp...](set: $timer to it + 1500)(after: time + $timer, 200)[=(set: $timer to 0)$tsn[gulp...](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your vision blurs as you focus more on drinking than on breathing.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[The stench of piss fills your nostrils.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You gulp, though it hurts. (if: $dick is true)[Why are you still so hard?](else:)[Why are you still so wet?] You&#39;re practically *dripping*...](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Gulp...](set: $timer to it + 1500)(after: time + $timer, 200)[=(set: $timer to 0)$tsn[gulp...](set: $timer to it + 1500)(after: time + $timer, 200)[=(set: $timer to 0)$tsn[gulp...](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Finally, your body aching and sloshing with every little motion, his stream tapers off. He smiles, pats your face, and then gingerly pulls out from your lips.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;I suppose Gush wore off sooner than I thought,&quot;] he chuckles. He wipes his slender tip off on your face. You gasp for air, still thirsty, and give him a dazed look. $npc[&quot;What?&quot;] he asks.](set: $timer to it + 4000) (after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Oh, still need more, huh?&quot;]](set: $timer to it + 2000) (after: time + $timer, 200)[=(set: $timer to 0)$tsn[He pulls out one more vial. You look down at the flask urgently.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Alas, I&#39;m done with you, now.&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He pops open the vial in your direction with a puff of tealy Gloam.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[A blackness deeper than sleep engulfs you.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; ...-&gt;test8]]]</tw-passagedata><tw-passagedata pid="29" name="test8" tags="" position="2200,99" size="100,100">(after: 2s, 200)[=(set: $timer to 0)$tsn[Slowly, you awaken.](set: $timer to 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your lungs are burning.](set: $timer to 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You feel like you haven&#39;t slept in...](set: $timer to 2500) (after: time + $timer, 200)[=(set: $timer to 0)$tsn[*ever*.] (set: $timer to 2500)(after: time + $timer, 200)[=(set: $timer to 0)$tsn[At the same time, somehow you feel like you&#39;ve been comatose for a dozen phases.](set: $timer to 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[The sounds of (text-colour: navy)+(text-style: &quot;blur&quot;)[dripping water] ring quietly in your ears, and the cloying scent of something *alive* caresses your nostrils. You&#39;re (text-style: &quot;shudder&quot;)[shivering] a little bit, but you don&#39;t feel cold.](click: &quot;alive&quot;)[
$tsnGrey[It smells like something just before the rain...]](set: $timer to 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[It feels as though you&#39;re lying on a bench of some kind.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[[[&gt; Open your eyes-&gt;test8-2]]]</tw-passagedata><tw-passagedata pid="30" name="test4-morph" tags="" position="1153,518" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You order the solidified nectar and feel a flow of Gloam departing your EgoBracer. The krudge scoops up some food, setting it onto a plate of bone, then hands you the wobbling dish.](set: $timer to 6000)

(after: $timer, 200)[=$tsn[You find a place to sit, then start to dig in to the food to quell your protesting stomach.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[It tastes quite good, and sits surprisingly heavily in your stomach. You&#39;re reminded of Oggorus slime, only sweeter and less addictive.](set: $timer to 5000) (after: time + $timer, 200)[=$tsn[...You hope.](set: $timer to 3000)

(if: $dick is true AND $pussy is true)[(after: time + $timer, 200)[=$tsn[Suddenly, your stomach tightens. A wave of heat spreads through your belly, and you feel yourself starting to get hard. You look down at yourself and see your cock starting to fatten up right here in public. At the same time, your pussy tightens, and you feel a fluttering in your belly as your body warms from the bottom up.](set: $timer to 8000)

(after: time + $timer, 200)[=$tsn[But after several heart-pounding moments, the sensation passes again, leaving you simply aroused and panting. You feel like something very unusual almost happened, but something about your anatomy helped you avoid it...](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You shakily regain your composure, feeling a little more satiated, then begin to move on.

[[&gt; Much better-&gt;test5]]]
](else-if: $dick is true)[(after: time + $timer, 200)[=$tsn[Suddenly, your stomach tightens. A wave of heat spreads through your belly, and you feel yourself starting to get hard. You look down at yourself and see your cock starting to fatten up right here in public. Your prostate tightens hard, and you&#39;re wracked with a wave of pleasure that has your dick rising to the occasion in moments.](set: $timer to 9000)

(after: time + $timer, 200)[=$tsn[You groan as people start to notice your shaft twitching to full display, and you shakily reach down to try to cover yourself up. Before you can reach, though, you feel a painfully tight squeeze in your heavy maleness that leaves you stiffening in surprise.](set: $timer to 8000) (after: time + $timer, 200)[=$tsn[Then another.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[Then *another.*](set: $timer to 4000)(after: time + $timer, 200)[=(if: $balls is true)[

$tsn[You feel your balls pull tight, like you&#39;re about to cum, except the sensation only keeps growing. Your dick grows so tight that it aches, and your balls start to hurt. Then, all at once, you feel a strange **popping** sensation... and realise that you can no longer feel your balls!](set: $timer to 8000)](else:)[(set: $timer to 0)]

(after: time + $timer, 200)[=$tsn[As you look down, you see your cock starting to shrink down with each new body-tightening pulse, inches vanishing in heartbeats. You reach down and grab at your dick as if that might somehow save it from the sudden effects of what must surely be the gelatinous food brewing in your belly, but it&#39;s no use. The only thing you manage is to send tingling waves of sensual bliss through your groin.](set: $timer to 10000)

(after: time + $timer, 200)[=$tsn[You can&#39;t stop it. In seconds, you see your cock shrinking down to the base of your groin until only your tip remains, your urethra undergoing a surreal sensation of &#39;sliding&#39; down from it further back between your legs. A warm, tingling sensation builds up between your thighs that leaves you panting, before all of a sudden you feel it cave inwards.](set: $timer to 10000)

(after: time + $timer, 200)[=$tsn[You can&#39;t see it from this angle, but you can *feel* it as your new, sensitive labia makes itself known between your legs, with the remnants of your cock slipping inwards to form a new clitoris. As if on autopilot, your digits trace downwards and back, seeking out your lost orbs - and brushing against your warm vulva.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[The next several seconds are spent in discomfort as your insides rearrange themselves to make room for what you can only presume must be a womb and accompanying ovaries. The whole experience leaves you feeling oddly vulnerable and strangely...](set: $timer to 6000) (after: time + $timer, 200)[=$tsn[...Aroused.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You can feel a strange new heat between your thighs, and an odd tingling sensation in your lower belly that&#39;s equal parts uncomfortable, alien, and pleasurable. It takes you several seconds to regain your composure and draw your digits away.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[You spin to demand an explanation from the krudge, but are swiftly knocked out of the way by other Citizens suddenly surging forwards to buy some of what you had.
And you don&#39;t have enough Gloam for another helping! (set: $dick to false)(set: $pussy to true)(set: $genderTF to true)(set: $balls to false)

[[&gt; Oh...-&gt;test5]]]]
(else:)[(after: time + $timer, 200)[=$tsn[Suddenly, your stomach flutters. A wave of heat spreads through your belly, and you feel your vent start to tingle pleasurably. You bite your tongue gently as the sensation grows and grows into an increasingly unmanageable itch. In only a few seconds, you feel the slickness between your thighs that usually only comes after minutes of sensual warmup.](set: $timer to 9000)

(after: time + $timer, 200)[=$tsn[You groan as people start to notice your changing body language, and reach down to cover yourself up. As your hands move in front of your groin though, you feel *something* bump against your palm.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You gasp in surprise and look down to see your clit has stiffened to an unnatural degree, and looks quite a lot bigger, too! As you stare, transfixed, it grows even bigger still - seeming to get thicker and longer with each of your increasingly heavy heartbeats.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[It surges forwards and bumps against your palm again, sending a jolt of sheer pleasure through your body. Your knees wobble and you gasp in confusion. You can feel an odd *tightness* between your legs, too, and a gathering...](set: $timer to 5000) (after: time + $timer, 200)[=$tsn[...*weight*.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[All of a sudden, you feel a surreal sliding motion from between your folds, and suddenly there&#39;s a heft between your legs. You shuffle your weight from foot to foot and feel something *bounce* between them. Your eyes open in shock as you move your hand further back and feel... *balls*. A heavy, weighty sack that you can touch and *feel*. **Your** balls.](set: $timer to 8000)

(after: time + $timer, 200)[=$tsn[What&#39;s more, you can&#39;t feel your pussy anymore, and now that you look at it, your clit is looking an awful lot like...](set: $timer to 4000) (after: time + $timer, 200)[=$tsn[Like a *dick*.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[The next several seconds are spent in surprise and discomfort as your insides rearrange themselves to align with a more masculine configuration. The whole experience leaves you feeling oddly powerful and strangely...](set: $timer to 6000) (after: time + $timer, 200)[=$tsn[...Aroused.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[By the end, you find yourself the owner of a proud and pleasantly sizeable cock. It throbs and bounces between your legs with each heartbeat and leaves you panting, a little glistening dollop of moisture beading at the tip. It takes you several seconds to regain your composure and draw your grip away.](set: $timer to 8000)

(after: time + $timer, 200)[=$tsn[You spin to demand an explanation from the krudge, but are swiftly knocked out of the way by other Citizens suddenly surging forwards to buy some of what you had.
And you don&#39;t have enough Gloam for another helping! (set: $dick to true)(set: $pussy to false)(set: $genderTF to true)(set: $balls to true)

[[&gt; Oh...-&gt;test5]]]]</tw-passagedata><tw-passagedata pid="31" name="test4-vorn" tags="" position="1151,641" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You order the Cinderbean-spiced meat and feel a flow of Gloam departing your EgoBracer. The krudge scoops up some food, setting it onto a plate of bone, then hands you the steaming dish.](set: $timer to 6000)

(after: $timer, 200)[=$tsn[You find a place to sit, then start to dig in to the food to quell your protesting stomach.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[The taste leaves your eyes watering, and your stomach immediately starts to burn and feel potently hot. It hurts to eat, but the flavour - the texture - the *spice* is so good that it feels worth every bite.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[It&#39;s possibly the best meal you&#39;ve had for an entire (link-reveal: &quot;trisk&quot;)[(show: ?trisk)].]|trisk)[
$tsnGrey[Ten whole sleeps - no mean feat for a meal in the City.]](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[In the end, you&#39;re left with tears streaking your face and a stomach that feels as though it might rebel at any moment, but you&#39;ve eaten the entire plate. Was it all worth the pain of the spice?

[[&gt; ...Probably.-&gt;test5]]]</tw-passagedata><tw-passagedata pid="32" name="test4-byle" tags="" position="1151,756" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You tell the krudge to just give you anything and that you don&#39;t particularly care. She shrugs and scoops up some food as you feel a flow of Gloam departing your EgoBracer, setting some grey mush onto a plate of bone before handing you the steaming dish.](set: $timer to 6000)

(after: $timer, 200)[=$tsn[You find a place to sit, then start to dig in to the food to quell your protesting stomach.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[The taste isn&#39;t that good, but you don&#39;t particularly care. You scarf the meal down, feeling its weight settle in your belly.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[Not long after that, though, you feel your belly start to protest. You feel sweaty and heavy, and you find your heart starting to race as you sit there.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[You feel...](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[**Heavy.**](set: $timer to 2000)

(after: time + $timer, 200)[=$tsn[It&#39;s little wonder why, either, for as you look down you can see that your belly looks noticeably larger, as though you were a few months pregnant. It gurgles hungrily.](set: $timer to 5000) (after: time + $timer, 200)[=$tsn[You look back to your plate and see that, amazingly, the grey mush is still there, uneaten. But you just... Didn&#39;t you?](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You pick up the plate and resume eating, not stopping until the plate is empty. Your stomach groans in protest, and as you look down you feel the sluggish lethargy of gaining yet more weight. You can see your belly looks even larger, now, and your thighs feel that little bit fatter, squashing together where you sit.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[The plate remains full.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You eat.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[Your stomach bloats.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[You eat.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[Your cheeks swell.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[You eat.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[Your arms feel fat.](set: $timer to 3000) (after: time + $timer, 200)[=$tsn[You eat.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You eat.
Your waist looks flabby and soft.
You eat.
You feel yourself with another chin.
You eat.
**You eat.**
(text-style: &quot;smear&quot;)[**You eat.**]](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[Eventually, you can eat no more, and you pass out in a food-induced coma. Your body is heavy and thick and soft, and you easily take up two Citizens&#39; worth of seating.
By the time you wake up, the food shop is closed, and the plate is gone.
With a wobbly groan, you push yourself up from where you sat, taking a moment to adjust to your newfound weight, before looking around for where to go, next.

[[&gt; Where indeed...-&gt;test5]]]</tw-passagedata><tw-passagedata pid="33" name="test4-umbra" tags="" position="1148,865" size="100,100">(text-colour: #D4FF54)[####The Surface - Viviria District]
$tsn[You order the salad with the Blackwine dressing and feel a flow of Gloam departing your EgoBracer. The krudge dishes up the salad, setting it onto a plate of bone, then hands you the only slightly squirming meal.](set: $timer to 6000)

(after: $timer, 200)[=$tsn[You find a place to sit, then start to dig in to the food to quell your protesting stomach.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[The first bite feels bitter, but in a zesty way. It&#39;s not unpleasant at all, and you swiftly find yourself looking forward to each new bite.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[You find your thoughts drifting back to the nurk you met in the Abyss. You don&#39;t fully understand what happened with that, but you realise that the nurk wasn&#39;t with you when you met Illa in the darkness.](set: $timer to 7000)

(after: time + $timer, 200)[=$tsn[It occurs to you that the nurk may still be lost out there in the Abyss, unable to open any of the doors.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[The poor thing might even die.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Starvation, likely.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Some Abyssal beast, if they&#39;re lucky.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Never to see their friends again. The nurk had asked for *help*.](set: $timer to 4000)

(after: time + $timer, 200)[=$tsn[And now they would never get it.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You find yourself feeling profoundly saddened by it, and maybe even a little depressed. The atmosphere of the City feels a little more sombre, and you recall just how many unhappy endings are found in this place.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[You eventually push the salad aside, unable to finish the disheartening meal. You resolve that you should go and find some place else. Perhaps the nurk will resurrect when they die, alone, in the Abyss. Perhaps, if you wished, you could greet them in the Court of Resurrection.](set: $timer to 6000)

(after: time + $timer, 200)[=$tsn[Perhaps.

[[&gt; Move on-&gt;test5]]]</tw-passagedata><tw-passagedata pid="34" name="test7-viv" tags="" position="1486,550" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[$npc[&quot;Oh, *excellent*. I was wondering if I would have to go and fetch someone to keep my friend company today,&quot;] the lehlt exclaims. $npc[&quot;How nice of you to save me a hunt.&quot;] With a casual motion he hefts you up from the floor. Perhaps you should struggle, but you *did* choose this. Perhaps this &quot;(text-style: &quot;smear&quot;)[friend]&quot; might not be so bad...?](set: $timer to 9000)(set: $majiFlag to true)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Your thoughts are quickly answered as you are carried into an adjoining room. Before you is a large and ornate pot easily the size of the lehlt himself and, more menacingly, is the enormous plant within that seems to spill outwards in every direction. You see large petals billowing outwards with a pulsating, (text-colour:red)+(background:(gradient: 0, 0,#000000,0.5,(hsl:0,0.8039,0.5,0.4),1,#000000))[translucent red bulb] at the plant&#39;s centre like a stomach.](set: $timer to it + 9000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your eyes slowly lift from the base of the enormous plant and you see a thick, bulbous vine that puts you more in mind of a throat and neck than anything else. Green, phosphorescent lights glow along the thick stem in veinlike patterns. Patches of the stem seem translucent, and you can *see* something large and ovoid within, partially obscured by the red and membranous surface.](set: $timer to it + 9000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your captor takes a few steps forward and holds you up, and your eyes widen as you look yet higher and finally behold the large, green bulb that is slowly craning down towards you. In only a blink, the bulb tears itself in half, a horizontal split causing a widening chasm to appear like yawning jaws that stretch in preparation for a savoury meal. It almost feels like the plant is looking *hungrily* at you. The sight of sap flowing between its jaws like strands of saliva doesn&#39;t do much to push the thought from your mind.](set: $timer to it + 5000)

(after: time + $timer, 200)[=$tsn[[[&gt; *Gulp*...-&gt;test7-viv2]]]</tw-passagedata><tw-passagedata pid="35" name="test7-viv2" tags="" position="1483,654" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You get several seconds to gaze at the (text-style: &quot;smear&quot;)[wide-open jaws] before the plant (text-style: &quot;shudder&quot;)[snaps] forward and engulfs you, the plant-like mouth closing around your stomach. Gravity loses its hold on you as your body is flung upwards by the plant, sending you hurtling into the air above it. The flight lasts only for a moment before the jaws catch you again and your body is compressed against itself as the green bulb closes around you.](set: $timer to 10000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Thick, surprisingly warm walls clamp down on your sides, and you can feel the fibrous musculature grip around your body. Your face is squished against a warm, wet surface, and you feel an instinctual need to struggle before you become plant food.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You try to move but the walls fight against you, squashing your legs against your own chest in an awkward angle. You try to move your arms, but they are firmly pinned to your side. Your struggle seems to have alerted the plant though, and you suddenly feel the warm floral folds constrict against you.](set: $timer to it + 8000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You sink.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You feel a push around your waist and then another at your feet. It starts to feel as if your surroundings are rippling around your body and you can tell that your hide is being dragged along the plant&#39;s slick insides. Little by little, your surroundings take a (text-colour:#f07b7b)[redder and] (text-colour:red)[redder] hue as light filters in. For a precious moment you can see your ex-captor smiling at you, tinted by a gauzy red sheen. You try to shout for help, but your efforts are rewarded with warm slime suddenly pouring into your mouth. It tastes.... sweet?](set: $timer to it + 14000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[It doesn&#39;t take long before your entire body begins to feel hot. Something in the plant&#39;s gooey syrup starts making you feel... horny?](set: $timer to it + 5000) 
(if: $dick is true)[
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You realise that your dick is already out and throbbing, and having it rubbed against the plant&#39;s inner walls is enough to make you want to gasp in pleasure. Your shouts only cause more of the slime to enter your mouth, and the heat redoubles. Just having your crotch grinding against the soft texture is enough to push you towards the edge.](set: $timer to it + 9000)
](if: $pussy is true)[
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your cunt is already wet, and it feels as if prickling electricity is starting to course through your walls. You suddenly feel the plant&#39;s bumpy texture all too keenly whenever it bumps against your thighs or the small of your belly. Each prod and push of the alien texture against your body grows to be enough to draw forth shaky moans, each one rewarding you with another mouthful of the sweet nectar.](set: $timer to it + 9000)
]
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your limbs thrash and a wet slurping sound squelches out around you. Before you fully comprehend what&#39;s happening, you bump against an inner barrier and gooily sink through. It grows even more cramped, and you quickly feel your head being forced to bend awkwardly as your knees get pressed to either side of your head. Your feet press against the soft, warm, and wet inside of the plant, and you try to give it a kick. The plant walls remain unyielding though and you soon feel the walls contract around you, shrinking the space you remain in even further.](set: $timer to it + 5000)(set: $dwelling to &quot;Inside the Plant&quot;)

(after: time + $timer, 200)[=$tsn[[[&gt; *Squeeze.*-&gt;test7-viv3]]]</tw-passagedata><tw-passagedata pid="36" name="test7-viv3" tags="" position="1479,757" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[Trapped, immobilised, and thoroughly incapacitated, you finally start to notice that your body hasn&#39;t stopped growing hotter. You realise from your aching lungs that you haven&#39;t taken a breath since you were engulfed. The faint red light surrounding you allows you to get a brief look at your body, and you realise that it&#39;s not the plant that&#39;s contracting, but instead a cocoon-like surface that&#39;s thickening around you.](set: $timer to 9000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Slowly but surely, your little prison grows smaller and smaller, and your body is folded up as much as it can possibly go. Your limbs ache, yet you don&#39;t feel pain. Instead, you feel an unbearable, overwhelming pleasure. Perhaps a mercy, or perhaps to prevent victims from struggling, but the plant&#39;s innate sap feels like it&#39;s heightened your pleasure nerves. You try to whimper as the compression grows and, overwhelmingly, an orgasm hits you just as the sap finishes hardening around you and leaves you trapped in a seed-pod like shape.](set: $timer to it + 12000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your body is helplessly jerked around as gravity shifts once more, the plant moving you again. Unable to move, you feel the impacts through your shell as you are lifted up in rapid, erratic motions. Suddenly, red-tinted light bathes around you as you impact the floor. The world tumbles around you as your strange shell rolls, before you come to a stop as a cloven hoof steps on you and pins down the red seed-cocoon you are trapped inside.](set: $timer to it + 10000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You try to move to break free of the cocoon, but your limbs refuse to respond. The haze of pleasure refuses to leave, and your thoughts scramble with another surge of orgasmic fuzz as you see that your body is starting to liquify. *That explains why you suddenly feel as if there is more room inside your new home...* You feel like you should want to escape, that you should yell for the lehlt to tear open the cocoon while there&#39;s still time and set you free, but somehow the sense of fear is melting away with you. Before long, all that remains is a gentle, pulsating (text-style: &quot;smear&quot;)[bliss] as your body gets sent into another climax that makes your thoughts bubble away into your seed-pod.](set: $timer to it + 13000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You are lifted up, barely able to make out the lehlt&#39;s face through the red shell, and you can hear his muffled voice just barely reach you.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;What a nice little seed you make. Don&#39;t worry, you&#39;ll make a wonderful new plant, I am quite sure.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You feel your body being carried, the lehlt&#39;s steps sending a pleasant rocking, lulling motion through your seed.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[The last thing you see is yourself being turned around, straightened up, and placed snugly into a wide-brimmed flowerpot. The lehlt smiles down at you as your vision goes dark.](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;test8]]]</tw-passagedata><tw-passagedata pid="37" name="test7-umbra" tags="" position="1707,547" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You tell the lehlt that you can handle pain.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[The insider smiles again, before withdrawing a small phial from a pouch at his hip. He unstoppers it and the wand within (text-style:&quot;blur&quot;,&quot;fidget&quot;)[glows] for a moment.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Suddenly, half a dozen earthen vines erupt from the ground and wrap themselves around your limbs. (text-style: &quot;rumble&quot;,&quot;smear&quot;)[Ravaging Roots.]](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[With the force of a Kudzu vine, they hold you painfully tightly as the lehlt looks at his EgoBracer. You see the swirl of ethereal, tealish light within the eye of the device, before the insider smiles again and looks up at you.](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He starts withdrawing things from a bag upon his back and setting them up beside you in the main room. In mere moments, there&#39;s no less than seven tall contraptions surrounding you, each one with a hole in it.](set: $timer to it + 3000) (if: $pussy is true and $dick is false)[(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He also sets up what looks like a gun, or ballista of some kind.](set: $timer to it + 2000)]

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[They look uncomfortably like stockades.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Let&#39;s have some fun, then. I *love* a little violence,&quot;] the creature declares. His vine spell yanks you onto your back, still suspended in mid-air, before earthen tendrils start to wrench at your limbs and summarily force them into the holes one by one.](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[One for each arm.](set: $timer to it + 2000)
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[One for each leg.](set: $timer to it + 2000)
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[One for your *head*.](set: $timer to it + 2000)
(if: $dick is true)[(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Even your cock isn&#39;t spared, with a small wooden plate sliding down over it.](set: $timer to it + 3000)]

(if: $dick is false)[(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then, you feel the lehlt move the barrel-like contraption right up to your cunt, gently pushing the blunt tip just into your folds.] (set: $timer to it + 3000)](after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;There. Much better,&quot;] he says almost slyly. $npc[&quot;So, let&#39;s see.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He smiles that chilling, not-quite-centred smile again.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Little, little nurkling, running &#39;round the lane...&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He starts walking around your body. He touches your feet, then your wrists, as if making a game of it.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;...Hiding from the Council, skitter down the drain...&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He smiles at you as he touches your head, then keeps moving.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;...Don&#39;t you call your father, the worms are on his brain...&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He passes your arm.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;...Little, little nurkling, they&#39;ll break you with the pain.&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;test7-umbra2]]]</tw-passagedata><tw-passagedata pid="38" name="test7-umbra2" tags="" position="1706,650" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(event: when time &gt; 0.2s)[(t8n: &quot;rumble&quot;)+(transition-time: 0.2s)+(text-colour: red)+(text-style:&quot;smear&quot;)[CHOP.](set: $timer to 4000)]

(after: $timer, 200)[=(set: $timer to 0)$tsn[With a blur of motion, the creature swings a previously hidden blade with frightening precision and splitting agony carves itself into your left leg. All sensation from your knee downwards vanishes.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[A spray of blood decorates the floor as your limb hits the ground, and you scream.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Oh, come now, it&#39;s hardly *that* bad,&quot;] the lehlt says. He picks up your limb and holds it up, blood still dripping from the end of it. $tsn[&quot;Look,&quot;] he says, smiling at your limp limb. $tsn[&quot;The game&#39;s barely afoot!&quot;]](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He gives you a smile as you fight against the pain. When it becomes clear that you&#39;re not smiling back, he shrugs and drops the limb.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;If you don&#39;t stop howling, I&#39;ll give you something to howl about.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You bite back your shouts.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Oh, you know what, let&#39;s do it anyway.&quot;]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)(t8n: &quot;rumble&quot;)+(transition-time: 0.2s)+(text-colour: red)+(text-style:&quot;smear&quot;)[SCHINK!](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You feel the brief slicing sensation bite into your right arm, the impact making your very bone judder, before the razor-sharp blade cleaves your limb clean off in a new spray of blood.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You feel faint.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Dimly, you realise that you&#39;re screaming again.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Blood pounds in your ears.](set: $timer to it + 2000)

(if: $dick is true)[(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then you feel a burning, white-hot slice of agony caress your cock. You try to look down but can&#39;t see it. You know, though.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[That blade just cut your cock off, too.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Except, the brain-splitting pain lingers.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Realising that tears are pouring down your cheeks, you hear the lehlt give an apologetic $npc[&quot;Oops&quot;], before the razor sensation slices through the flesh of your dick again. The only sensation that remains is hot blood pooling in your crotch as you&#39;re emasculated.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Let&#39;s see,&quot;] the insider says. $npc[&quot;Leg, arm, dick... Hell, let&#39;s do one of each.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Before you can think through the pain enough to consider what that means, you see him standing above you. He smiles down at you, holding a dripping and bloody blade in one hand and the remains of your cock in his other.](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[(text-style: &quot;smear&quot;, &quot;fidget&quot;)[Then he brings the blade down upon your neck.]](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; ...-&gt;test8]]]](else:)[(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then you feel something poking between the folds of your cunt.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You stiffen up, trying to think through the haze of agony as *something* slides through the barrel of the object stretching your pussy open. It&#39;s too hard to be a dick, unless the lehlt&#39;s part Petrid below the belt.](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Nice and aligned... City&#39;s Eyes, I never get to use the spear,&quot;] the insider chuckles.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your blood runs cold.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then you feel a heavy (text-style: &quot;smear&quot;, &quot;rumble&quot;)[k-thunk] as the metal rod between your vulva skewers forwards with lethal force, piercing your vagina, intestines, liver, stomach, heart, throat, and skull.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[A lance of red-hot fire burns through your whole body, and pain overtakes every iota of your body as your circulation fails. Your vision blurs as blood backs up in your throat and innards, and you can&#39;t even find the strength to breathe. Or even to think.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You look up and see the lehlt standing over you. He says something, but your punctured brain can&#39;t process it properly.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You expire.](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;test8]]]]</tw-passagedata><tw-passagedata pid="39" name="test7-vorn" tags="" position="1870,548" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You feel your heart thumping hard in your chest as you consider your options. Eventually, you decide to take up his offer of going out on a more pleasurable note.](set: $timer to 4000)

(after: $timer, 200)[=$tsn[$npc[&quot;Mmh, *wonderful*,&quot;] the lehlt says. He grins a slightly warty grin, then drops you to the floor.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[You land heavily, only to feel him lift a hoof and kick you forwards. You&#39;re sent sprawling onto hands and knees.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[Immediately, you feel the slender touch of a blade slide in under your neck and you hold your breath. Did he trick you?](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[But then, you feel his breath against your ass. You feel his grip adjust your rump as that sharp blade warns you not to move.](set: $timer to 3000)

(if: $pussy is true)[(after: time + $timer, 200)[=$tsn[[[&gt; Hold still-&gt;test7-vornc]]]](else:)[(after: time + $timer, 200)[=$tsn[[[&gt; Hold still-&gt;test7-vornd]]]]</tw-passagedata><tw-passagedata pid="40" name="test7-vorn2" tags="" position="1866,774" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(if: $pussy is true)[(set: $timer to 1)$tsn[As he lines his dripping shaft up with your saliva-slathered pussy, you can&#39;t help but feel your heart thump in your chest. (if: $genderTF is true)[Especially knowing this will be the first time anything has truly explored your new assets. The thought is as terrifying as it is arousing to your new slit. (set: $timer to it + 3000)]His breath is hot against your neck as he starts to push inside.](set: $timer to it + 5000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[You gasp out as his thick spire sinks into your body, stretching your cunt wide in one slow, steady thrust. His veiny tip digs into your depths, and you feel the heat in his flesh as it pulses with life. Inside of you. You grit your teeth as you&#39;re given a few moments to get used to the swell of his cock, your squeezing walls kneading down around it. (if: $genderTF is true)[You&#39;ve never felt anything like it. You feel so full, and so sensitive...(set: $timer to it + 2000)]](set: $timer to it + 9000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[In... and out. The insider on your back starts slowly fucking you, his blade at your neck preventing you from ever pulling away. His cock digs deep into your passage as it grows increasingly sensitive while your body acclimatises.](set: $timer to 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[By the time his leathery, bloated balls press against you, you can&#39;t suppress a moan. You can feel it building with each body-shaking hump. If he doesn&#39;t slow down... you&#39;re going to cum.](set: $timer to 5000)
(after: time + $timer, 200)[=(set: $timer to 0)(if: $genderTF is true)[
$tsnGrey[Fuck... Can you get pregnant?](set: $timer to 3000)
]
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[His humps continue drilling into you, stretching you out, your body starting to tremble and quiver as his cock slams home. You can feel liquid warmth starting to drip into your cunt, and you fight to keep your senses under control. But finally, inevitably, with a powerful and hip-jarring *hump*, the lehlt buries his cock in you and you feel your body give out.](set: $timer to 8000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You cry out as you start to cum, your cunt clamping down around the fat cock inside you while it begins twitching warningly. As you gush the first splatter of your lust, you feel a powerful surge and feel an eruption of warmth spurting somewhere deep inside you. He moans loudly, clutching you tight as his balls pull taut and gouts of hot lehlt cum begin to splatter deep inside you. The throbbing is unmistakeable as he starts pumping gooey eruptions of cum straight against your cervix and leaving your legs wobbling.](set: $timer to 11000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He keeps cumming in you as your body clenches and relaxes, contracts and squeezes.](set: $timer to 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You&#39;re riding the high of (if: $genderTF is true)[your first female ]orgasm when you hear him growl possessively in your ear.](set: $timer to 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then there&#39;s a red hot slice, and your world goes black.](set: $timer to 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; ...-&gt;test8]]]
](else:)[$tsn[As he lines his dripping shaft up with your saliva-slathered ass, you can&#39;t help but feel your heart thump in your chest. His breath is hot against your neck as he starts to push inside.](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[You gasp out as his thick spire sinks into your body, stretching your hole wide in one slow, steady thrust. His veiny tip digs into your guts, and you feel the heat in his flesh as it pulses with life. Inside of you. You grit your teeth as you&#39;re given a few moments to get used to the swell of his cock, your squeezing ass kneading down around it. (if: $genderTF is true)[As you squeeze though, you feel his stiff crown nudge against a spot you&#39;ve never felt before. (set: $timer to it + 2000)]His cock thumps against your prostate and forces a sharp gasp from your lungs. Then, he starts to move.](set: $timer to it + 10000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[In... and out. The insider on your back starts slowly fucking you, his blade at your neck preventing you from ever pulling away. His cock digs deep into your hole as your body acclimatises.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[By the time his leathery, bloated balls press against you, you can&#39;t suppress a pained moan. You can feel it building with each body-shaking hump against your prostate. If he doesn&#39;t slow down... you&#39;re going to cum.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[His humps continue drilling into you, stretching you out, your body starting to tremble and quiver as his cock slams home. You can feel liquid warmth starting to drip into your ass, and you fight to keep your senses under control. But finally, inevitably, with a powerful and hip-jarring *hump*, the lehlt buries his cock in you and you feel your battered prostate give out.](set: $timer to it + 8000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You groan as you start to cum, your ass clamping down around the fat cock inside you while it begins twitching warningly. As your cock erupts its first thick, gooey spurt of cum, you feel a powerful surge and feel an eruption of warmth spurting somewhere deep inside you. (if: $genderTF is true)[You&#39;ve never felt anything like it as your cock *erupts*, and you almost see spots as you begin pumping rope after rope of new sperm across the floor.(set: $timer to it + 4000)]](set: $timer to it + 6000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He moans loudly, clutching you tight as his balls pull taut and gouts of hot lehlt cum begin to splatter deep inside you. The throbbing is unmistakable as he starts pumping gooey eruptions of cum deep into your insides and leaving your legs wobbling.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He keeps cumming in you as your body clenches and relaxes, contracts and squeezes.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You&#39;re riding the high of (if: $genderTF is true)[your first male ]orgasm when you hear him growl possessively in your ear.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then there&#39;s a red hot slice, and your world goes black.](set: $timer to it + 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; ...-&gt;test8]]]
]</tw-passagedata><tw-passagedata pid="41" name="test7-morph" tags="" position="2039,548" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You take a deep breath, then lift your head to the creature. Holding his red-eyed gaze, you ask about this talk of (text-style: &quot;subscript&quot;)[smaller.]](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[The lehlt flashes a smile, then lifts his eyebrows. $npc[&quot;Really?&quot;] he asks. $npc[&quot;*Delightful*.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[The insider pulls a small flask from his hip, one marked with a small arcanogram that reads *Reduce*. He withdraws the little wand from inside it and aims it at you with little regard.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[An eruption of tealish Gloam (text-colour:#29af8c)[**bursts**] around you, and the world seems to waver as if viewed through a (text-style:&quot;blur&quot;)[haze] of intense heat. The room warps and deforms, and the lehlt in front of you begins to *grow*.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You see him stretch taller and taller as the world around you enlarges. Of course, truly, you&#39;re shrinking - but to you it just looks like everything is getting somehow bigger. Your breathing comes faster, though, and you feel like you can almost feel your heart beating harder as your body reduces in size.](set: $timer to it + 8000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Your behooved assailant&#39;s grip changes as you shrink further and further, until eventually he holds you between two fingers. He dangles you in the air, watching you with his enormous, gleaming eyes.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Micros,&quot;] he muses. $npc[&quot;They are such fun. A slyne by the name of Sathrish Klisk introduced me to the delights of small folk during my ill-fated apprenticeship in House Umbrasia. But you know what I like most of all about micros?&quot;]](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You look at your gargantuan captor, then slowly shake your head. He laughs and his warm breath billows over you like a heated breeze. You can feel yourself swaying under the force of air. Then he lifts his eyebrows and brings you up close to his slightly wart-touched face.](set: $timer to it + 6000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Excellent snacks,&quot;] he says with a wink.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[He laughs heartily, head tilted back in delight. Then the world (text-style: &quot;buoy&quot;)[(text-style:&quot;shudder&quot;)[whirls]] as he throws you up into the air and *snatches* you out of it with a lunge of his jaws.](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; Aah!-&gt;test7-morph2]]]</tw-passagedata><tw-passagedata pid="42" name="test7-morph2" tags="" position="2036,654" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[You land on a pillowy, slippery tongue and immediately slide across slick flesh to bump into one of his sharp teeth. You shout out in fright and hold on to the ivory tooth for stability, looking over to see the cavernous, ribbed (text-style:&quot;outline&quot;)[passage] that is his throat. His uvula dangles ominously, marking the threshold beyond which there is no escape from a heated, dark slide into oblivion.](set: $timer to 9000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[You shout out for him to wait, but only succeed in gulping a mouthful of his saliva as his tongue glides along your body. You can feel him *tasting* you and you wriggle, trying to get away from the monstrous serpent that is his *tongue*. But then it pins you to the roof of his mouth, and you feel gravity shift once again.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[You try to struggle. You try to wriggle, but there&#39;s nothing to hold onto. Nothing to stop the sudden, saliva-slathered slide you find yourself on as you slip towards his throat.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[With an audible gulp he swallows you down, pulling you into his throat. You feel the tight musculature of his neck compressing around you, squashing you as you slide slickly down towards his belly. It&#39;s pitch black, warm, and clammy as you slide through his neck as nothing more than a bulge - a morsel being devoured.](set: $timer to it + 7000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[As you sink into his stomach, the tight, squeezing and acidic environment rapidly setting your hide to burning, you feel him thump his chest heartily.](set: $timer to it + 4000)
(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Not bad,&quot;] he says. $npc[&quot;Ought to tide me over until evening.&quot;]](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[In only minutes, your body dissolves into nutrients for your assailant, your consciousness lapsing for the last time.](set: $timer to it + 2000)

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;test8]]]</tw-passagedata><tw-passagedata pid="43" name="test7-vornc" tags="" position="1816,652" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
(set: $timer to 0)$tsn[Suddenly, you feel his snout nuzzle up against your cunt. You gasp, but his blade reminds you not to move. You&#39;re powerless as he starts to investigate and inspect your vulnerable pussy.(if: $genderTF is true)[ You&#39;ve never felt a touch like this, nor felt quite so vulnerable when you had a dick. It&#39;s a uniquely adrenaline-filling experience.(set: $timer to it + 3000)]](set: $timer to it + 4000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Suddenly you feel a wet and hot tongue pushing *into* your folds. Your eyes widen and you gasp as the lehlt starts to lick at your pussy, wriggling his tongue inside. (if: $genderTF is true)[Your eyes bulge at the alien sensation of being filled in a place so new to you. It feels strange and... good. (set: $timer to it + 2000)]Before you can so much as relax, you feel his teeth against your body.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[The lehlt slowly bites down on your crotch, his fangs digging into your body as his tongue slurps and violates your slit possessively. Though you cry out, there&#39;s nothing you can do but let it happen as he explores your deepest recesses. (if: $dick is true)[With each new slurp and lick, you feel your cock hardening as well.(set: $timer to it + 1000)]](set: $timer to it + 5000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[It feels like long, heart-pounding minutes of fear-touched pleasure marred by the pain of his teeth digging in a large bitemark around your groin before he slurps his tongue back out of you. The feeling of his weapon against your neck ensures you hardly move as he takes position on your back, his weight settling down against you.](set: $timer to 9000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Delicious,&quot;] his voice breathes from behind your head. You feel those same teeth dragging across the back of your neck.](set: $timer to 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then you feel it. A thick, warm presence against your inner thigh. Wet, solid, and pulsing slowly.](set: $timer to 2000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; Oh, fuck.-&gt;test7-vorn2]]]</tw-passagedata><tw-passagedata pid="44" name="test7-vornd" tags="" position="1923,653" size="100,100">(text-colour: #A9C0DB)[####$dwelling]
$tsn[Suddenly, you feel his snout nuzzle up against your ass. You gasp, but his blade reminds you not to move. You&#39;re powerless as he starts to investigate and inspect your vulnerable hole.](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 0)$tsn[Suddenly you feel a wet and hot tongue dragging against your ass. Your eyes widen and you gasp as the lehlt starts to lick at your rump, slathering it in gooey saliva. With each new slurp and lick, you feel your cock hardening. (if: $genderTF is true)[You&#39;ve never felt something so alien as the swelling between your legs, like a tightness you can&#39;t quite name. But it feels... *good*.(set: $timer to it + 3000)]](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[After several long, sloppy seconds, he finally draws away again. The feeling of his weapon against your neck ensures you hardly move as he takes position on your back, his weight settling down against you.](set: $timer to it + 4000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[$npc[&quot;Good,&quot;] his voice breathes from behind your head. You feel his teeth dragging across the back of your neck.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[Then you feel it. A thick, warm presence against your inner thigh. Wet, solid, and pulsing slowly.](set: $timer to it + 3000)

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[[[&gt; Oh, fuck.-&gt;test7-vorn2]]]</tw-passagedata><tw-passagedata pid="45" name="test8-2" tags="" position="2199,248" size="100,100">(set: $timer to 7000)&lt;center&gt;(after: 2s, 200)[(t8n: &quot;dissolve&quot;)+(transition-time: 2s)+(text-style: &quot;smear&quot;,&quot;buoy&quot;)+(text-color: green)[###*Welcome Back*]]&lt;/center&gt;

(after: $timer, 200)[=$tsn[The first thing that greets you is an arcanogram sign floating above your head.](set: $timer to 3000)

(after: time + $timer, 200)[=$tsn[As you look around, you find yourself lying in a darkened chamber deep within the bowels of some grisly building. You can tell by the (text-style: &quot;blur&quot;)[smell] that you&#39;re far from the &#39;fresh&#39; air of outside.](set: $timer to 5000)

(after: time + $timer, 200)[=$tsn[You&#39;ve been (text-style: &quot;smear&quot;, &quot;fidget&quot;)+(text-colour: red)[resurrected.]](set: $timer to 4000)

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You sit up and look down over yourself, investigating for signs of damage or distress. Have you come back in one piece? (if: $genderTF is true)[(set: $timer to it + 4000)Although you seem to be whole and healthy, your heart thumps a little harder as you notice that your (if: $pussy is true)[dick is still very much absent, with the soft cleft between your legs still all that remains](else:)[cunt is still gone, replaced by the weight of a plush pair of balls and their associated masculinity].(if: $breasts is true)[ At least you still have your breasts.] Though resurrection may restore damage done to your body, it appears that changes are off the table.](else:)[(set: $timer to it + 5000)You seem to be surprisingly healthy once again. There&#39;s no sign of wear or tear to your naked form.(if: $breasts is true)[ Even your breasts are unmarred.] A pleasant finding, given your understanding that resurrection often only restores fatal problems, not minor ones.]]

(after: time + $timer, 200)[=$tsn[(set: $timer to 2000)At least you weren&#39;t left with any persistent missing limbs.]

(after: time + $timer, 200)[=$tsn[(set: $timer to 3000)Hefting yourself off of the workbench you seem to have been laid out on, you take stock of the room around you.]

(after: time + $timer, 200)[=$tsn[There seems to be a glistening, strange slime on the floor. There&#39;s also a note, written in arcanogram. By the only door out of the room, you can see a series of tools.](click: &quot;slime&quot;)[(append: ?look)[

$tsnGrey[It seems to have pooled around the benchtop you were laying on. It&#39;s a little sticky and gross. Is it related to your revival...?]]](click: &quot;note&quot;)[(append: ?look)[

$tsnGrey[You pick up the note. 
$npc[Welcome back. Your body has been restored. It may take several sleeps for your mind to regain full function. Follow the corridor to the exit when you are ready. The tools provided may help you assess the state of your new body. The Council is not responsible for any loss of function.]]]](click: &quot;tools&quot;)[(append: ?look)[

$tsnGrey[There are a number of tools here that look very physical. You can see needles, some sort of fleshy stethoscope, a pouch of smelling salts, (if: $dick is true)[what looks like a very fuckable toy, ] and a slightly ridged dildo that occasionally throbs.](click: &quot;needles&quot;)[(append: ?look)[

$tsnGrey[You pick up one of the needles. They look to be quite sharp and a little like the spines of a slyne. As you touch one, you quickly ascertain that yes, your nerves are definitely working!]]](click: &quot;stethoscope&quot;)[(append: ?look)[

$tsnGrey[You pick up the stethoscope and put its ear-pieces to your ears. As you do, an eye in the middle of it opens up, a rectangular pupil affixing itself on you. Like a proboscis, its end flails and feels about before lightly pressing to your chest. Moments later, you realise that you can hear your heart beating.
You soon set the stethoscope back down.]]](click: &quot;smelling salts&quot;)[(append: ?look)[

$tsnGrey[You open the pouch of smelling salts and take a whiff. (text-style:&quot;rumble&quot;)[Eugh!] ...Your sense of smell is definitely working.]]](click: &quot;fuckable toy&quot;)[(append: ?look)[

$tsnGrey[You look at the squishy toy. The end of it looks very slick and wet, and you feel your cock gently throb to life. (if: $genderTF is true)[Seeing as you&#39;re alone, you soon bring your still new equipment to its soft, warm embrace, and spend several chimes exploring what it&#39;s like to experience orgasm with a cock.](else:)[Seeing as you&#39;re alone, you soon bring your dick to its soft, warm embrace and spend several chimes working out some pent up urges.] By the time you set the drooling toy down, you notice an eye on the end of the apparently living toy lolling in bliss.]]](click: &quot;ridged dildo&quot;)[(append: ?look)[

$tsnGrey[You look at the ridged, softly pulsating toy. You imagine it&#39;s to test out *all* the parts of your body. You pick it up and watch as it twitches and bobs in the air, as if somehow aware of what you&#39;re contemplating. Eventually, seeing as you&#39;re alone, you set the toy down and gingerly ease your bare ass against it. (if: $pussy is true)[(if: $genderTF is true)[You hesitate, heart beating fast as it occurs to you that you could ease it into your *cunt*. You&#39;re so unused to having a second hole there and the idea is somehow equal parts exhilarating and terrifying. Yet before you can fully decide, you feel the toy move suddenly.](else:)[You rock against it for several moments, toying with the consideration of which hole to sink down with, before you feel the toy move suddenly.]

With a slither of prehensility you didn&#39;t think possible, the toy slides forwards of its own volition and summarily **wedges** its fat crown into your cunt. You gasp in shock, your legs stumbling and your body falling - and your full weight sits down on the ridged cock. (if: $genderTF is true)[The feeling of having something so big squash inside your new cunt is overwhelming. ]Your mind locks up completely as the very real-feeling dick pulses excitedly, filling you out completely.

Before you fully realise it yourself, you&#39;re riding the ridged toy up and down with needy abandon, helping it plumb the depths of your $genderTF[new ]pussy. It takes you only chimes before you feel yourself thumping into the wall of climax, and as you gush and quiver around the length of the toy, your squeezing contractions are enough to set it off, too.

Before you can react, a fat, dense knot swells up inside your folds and locks the base of the toy to your spasming cunt. You grope at the base, but the knot is so full inside you that there&#39;s nothing you can do to pull it out as it unloads spurt after spurt into your depths, even putting a little bulge in your belly.](else:)[You simply sit there for a moment, letting yourself feel the throbs of the lifelike cock. Its fat crown squashes and teases the plush ring of your sphincter, and you can feel it beginning to ease you open. Slowly, with one last squeeze, you gently relax. You can&#39;t help but gasp as it squishes inside you, knocking past your prostate.

You spend several chimes riding the toy, bouncing up and down before suddenly a knot at the base swells up inside you. You gasp and stand straight up, but the toy comes with you, buried deep enough to put a bulge in your belly. You can&#39;t help but cry out as you feel it simulating orgasm inside your guts - and can&#39;t help but moan when you feel very real fluids starting to splurt out from around its base.]

It&#39;s several chimes before you&#39;re able to pull the toy back out and, as you do, a veritable gush of pearly slime oozes from between your legs. Sheepishly, you set the still eagerly-throbbing toy down and waddle away.]]]]]|look&gt;[]

$tsn[[[&gt; Move on-&gt;test8-3]]]</tw-passagedata><tw-passagedata pid="46" name="test8-3" tags="" position="2199,398" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[(set: $timer to 4000)You make your way down the corridor, passing by small alcoves in the grotesque walls that each seem to contain a small candle and effigy.]

(after: $timer, 200)[=$tsn[(set: $timer to 5000)Most of the effigies seem to be of insiders - nurks, oggori, slynes - but some of them seem to be of wildly different creatures you&#39;ve never seen before.]

(after: time + $timer, 200)[=$tsn[(set: $timer to 3000)You aren&#39;t certain what they mean.]

(after: time + $timer, 200)[=$tsn[(set: $timer to 3000)As you walk, you feel a strange lethargy start to overtake your limbs.]

(after: time + $timer, 200)[=$tsn[(set: $timer to 4000)You recall how much you&#39;ve been through, in this strange experience that supposedly will help you find your aligned House.]

(after: time + $timer, 200)[=$tsn[(set: $timer to 3000)Gently rubbing at your face, you happen to spy a small fountain set into the wall. The edge of it looks wonderfully elevated for sitting upon.](set: $isPet to false)

(after: time + $timer, 200)[=$tsn[[[&gt; Sit down for a few moments-&gt;test8-sit]]
[[&gt; Keep moving-&gt;test8-4]]]</tw-passagedata><tw-passagedata pid="47" name="test8-4" tags="" position="2198,547" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[You gingerly continue down the long and lonely corridor, passing by the numerous strange alcoves and their effigies.](set: $timer to 3000)

(after: $timer, 200)[=$tsn[(set: $timer to 4000)Eventually, you come to a room that seems to contain an exit of some form. Between you and it, however, stands a petrid at a table.](click: &quot;petrid&quot;)[

$tsnGrey[The petrid seems preoccupied with what appears to be paperwork. She stands quite tall, and her leathery head tentacles are draped over either shoulder. Though she wears a mask, you can see her eyes through latticework covers. She wears surprisingly modest clothing, but they do little to hide the swell of her bosom nor the plump bulge between her legs.]]

(after: time + $timer, 200)[=$tsn[[[&gt; Clear your throat-&gt;test8-5]]]</tw-passagedata><tw-passagedata pid="48" name="test8-5" tags="" position="2199,698" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[$npc[&quot;Hmm?&quot;]](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 4000)(t8n: &quot;fade-right&quot;)+(t8n-time: 2s)+(text-colour:white)[$npc[&quot;Oh! Welcome back,&quot;] she says, her face looking disinterested as she sizes you up.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;You took your time. I&#39;ll mark you as departed, and you can leave through *that* door,&quot;] she says, pointing towards a doorway towards the back of the room.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You hazily glance back to look for the exit, needing a couple of ticks to spy it. Then you give a slow nod of your head to show your understanding. $isPet[Why are your thoughts so slow? ]She watches you for a few moments, then gives a sigh.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[$npc[&quot;Don&#39;t look like that.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Confused, you turn to ask her like what and find her idly tugging on one of her head tendrils. You can see her chewing on her tongue a little. It can&#39;t be comfortable, but you recall that petrids can solidify parts of themselves.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[She sighs.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Don&#39;t mention this to anyone in the Courts proper, but... Over there,&quot;] she points to a small window on the right. You follow her finger, then hesitantly make your way across.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;You can take one thing. I hate sending people as badly spawn hazed as you out completely naked.&quot;] She grimaces. $npc[&quot;At least there aren&#39;t any predators prowling the exit this time of the trisk.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You gaze down into the alcove through the window and spy a box with assorted items. Some sort of lost and found? You&#39;re not sure that that makes sense, but you aren&#39;t going to question a free gift.]

(after: time + $timer, 200)[=$tsn[[[&gt; Examine the contents-&gt;test8-6]]]</tw-passagedata><tw-passagedata pid="49" name="test8-sit" tags="" position="2361,400" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[You ease yourself down onto the fountain edge and take your time to (text-style: &quot;blur&quot;)[relax].](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 3000)$tsn[It feels... surprisingly nice to simply (text-style: &quot;blur&quot;)[sit] and decompress.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[The trickling of the (text-colour: navy)[water] as it cascades from the fountain is very (text-style: &quot;blur&quot;)[calming]. You look over to it and see that it seems to be fashioned after a well-endowed nurk pissing into the pool.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Of course.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Gradually, you find yourself feeling heavy and warm. It&#39;s almost like, with a moment to rest, your body is suddenly remembering all the exertions you&#39;ve been through. Or perhaps this is what spawn haze feels like?](click: &quot;spawn haze&quot;)[

$tsnGrey[The name given to the hazy fog of the mind that clings to people after resurrection.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[Maybe you should just (text-style: &quot;blur&quot;)[sit] and (text-style: &quot;blur&quot;)[stay] and let it pass naturally.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Yet... somewhere, deep down, you can&#39;t help but feel that you *really ought* to be moving again. An unsettling feeling in the back of your mind seems to almost say that if you linger too long, it might interfere with your test results...]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You could always (text-style: &quot;blur&quot;)[beg] for another try if something went wrong, though, surely?]

(after: time + $timer, 200)[=$tsn[[[&gt; Listen to the itch and get moving again-&gt;test8-4]]
[[&gt; It&#39;s probably just spawn haze. ***Relax*** for a little longer.-&gt;test8-sit2]]]</tw-passagedata><tw-passagedata pid="50" name="test8-sit2" tags="" position="2360,550" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[You sit.](set: $timer to 3000)(set: $isPet to true)

(after: $timer, 200)[=(set: $timer to 3000)$tsn[Sitting is (text-style: &quot;blur&quot;)[good]. The water is calm, the corridor is warm. You feel content.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You feel (text-style: &quot;blur&quot;)[relaxed]. So (text-style: &quot;blur&quot;)[relaxed], it&#39;s like a little piece of heaven.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You feel your tail wagging gently as you rest your head against the fountain and (text-style: &quot;blur&quot;)[let go] of your worries.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You (text-style: &quot;blur&quot;)[let go] of your fears and uncertainties.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You (text-style: &quot;blur&quot;)[let go] of your hesitance and anxieties.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You... (text-style: &quot;blur&quot;)[***let go.***]]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Sleep comes gently.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsnGrey[(text-style: &quot;blur&quot;)[You have a dream that you&#39;re back in the Compass House. In the dream, you&#39;re happily nuzzling Maji&#39;s hand, while Velvadius pats your head affectionately. You feel so happy.]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsnGrey[(text-style: &quot;blur&quot;)[You&#39;re given a collar and a nametag, and get to listen to Maji&#39;s words a lot. Although he says many things, it&#39;s hard to understand any of it. Velvadius shows you off to people, and you feel *happy* when they like you.]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsnGrey[(text-style: &quot;blur&quot;)[Sometimes, Maji tells you to sit, and you do. Sometimes, Velvadius scritches beneath your jaw and your tongue hangs out delightedly. Maji feeds you and you *happily* eat. Sometimes Velvadius guides your nose to his crotch and you eagerly lick at his plump sheath.]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsnGrey[(text-style: &quot;blur&quot;)[When you&#39;re told to, you proudly you show off your (if: $pussy is true)[puffy cunt and ]plush ass for your owners, tail hiked high and a **happy** smile on your face.]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsnGrey[(text-style: &quot;blur&quot;)[You have **happy** playdates with other pets like sletchers and squalls, and you&#39;re praised often and deeply.]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsnGrey[(text-style: &quot;blur&quot;)[You can feel them training you, teaching you how to behave, ingraining good manners and reflexes into your dumb little head.]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsnGrey[(text-style: &quot;blur&quot;)[You&#39;re rewarded with a fat, plump spire that always sinks so deeply into you beneath your tail, and a dense and blunt slab of flesh that squeezes into your mouth. They fill you over and over until they flare inside and you feel warm and gooey and ***happy***.]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsnGrey[(text-style: &quot;blurrier&quot;)[It feels so good to obey. To serve. To be... a good pet.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsnGrey[(text-style: &quot;blurrier&quot;)[You almost don&#39;t want to wake up.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[(text-colour: #aaa)[(text-style: &quot;blur&quot;)[Wake up...]]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[**Wake up!**]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You startle awake and realise that you&#39;re still leaning against the nurk fountain, idly licking its slightly grimy cock.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You sit up and wipe your tongue, trying to shake clear the strange dream you had.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[As you stand up and move away from the fountain, you notice that all the candles in the alcoves have burnt down and gone out. Despite how long you&#39;ve seemingly napped, you don&#39;t feel much better rested.]

(after: time + $timer, 200)[=$tsn[[[&gt; Move on-&gt;test8-4]]]</tw-passagedata><tw-passagedata pid="51" name="test8-6" tags="" position="2198,848" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[You gaze into the box, noticing several dozen items of various degrees of usefulness and meaning. Most of them appear to be rubbish that could literally have been scraped from the ground outside.](set: $timer to 5000)

(after: $timer, 200)[=(set: $timer to 2500)$tsn[A few, however, look like they might be worth taking along.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You find a small ball that looks to be made of some kind of chitinous material. It&#39;s very warm to the touch, though, and feels almost comforting to hold. It could probably fend off even the coldest City chill.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Miraculously, you find a functioning EgoBracer! It looks a little shrivelled and starved and probably won&#39;t be able to do much, but it might have its compass function working well enough to get you somewhere in the City.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Among the items is also an apparently fully stocked medicine bag. Complete with spells like Living Salve and Purge, you would probably be able to heal quite a lot with the kit in your possession.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Beside the kit you find a rare and luminant lodestone. It attracts some of the metallic objects in the box, and as you hold it you feel calmer and more centred. It might help stave off the spawn haze.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[The only other item that seems like it might be worth taking is a container of what look to be fried couch potatoes. A little food can&#39;t go astray, surely, even if it is furniture testicles.] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Or perhaps especially.]

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Take the warm orb&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test8-7&quot;)]
(link: &quot;&gt; Take the EgoBracer&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test8-7&quot;)]
(link: &quot;&gt; Take the medicine bag&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test8-7&quot;)]
(link: &quot;&gt; Take the lodestone&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test8-7&quot;)]
(link: &quot;&gt; Take the couch potatoes&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test8-7&quot;)]]</tw-passagedata><tw-passagedata pid="52" name="test8-7" tags="" position="2197,973" size="100,100">(text-colour: #A9C0DB)[####The Court of Resurrection]
$tsn[You reach down and collect the (text-colour:magenta)[(if: $choice is &quot;vorn&quot;)[warm, glowing orb](else-if: $choice is &quot;omn&quot;)[EgoBracer](else-if: $choice is &quot;viv&quot;)[medicine bag](else-if: $choice is &quot;psi&quot;)[lodestone](else:)[container of couch potatoes]] and safely tuck your prize under your arm.](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 3000)$tsn[You walk back over to the petrid who gives you a nod.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Good. Be careful out there, now. If you die again...&quot;] she pauses for a few moments.] (after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Try to do it on fourth sleep. Otherwise, ask for Braja Plaza. You&#39;re a little cute and my dick agrees, so I wouldn&#39;t mind helping you out again.&quot;] She actually gives you a brief smile, then nods to the door. $npc[&quot;May the City speak your name.&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; Make your way out-&gt;test9]]]</tw-passagedata><tw-passagedata pid="53" name="test9" tags="" position="2594,99" size="100,100">(text-colour: #02d987)[####The City Center]
$tsn[You make your way out of the Court of Resurrection and into the City streets beyond. As you walk outside, however, you can&#39;t help but feel like something is...](set: $timer to 5000) (after: $timer, 200)[=(set: $timer to 4000)$tsn[(text-style: &quot;buoy&quot;)[odd.]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You can&#39;t quite put your finger on it, so you step out into the streets all the same. After thinking for a few moments about your situation, you realise that you aren&#39;t really sure where you&#39;re going.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[Striking out in a random direction, you start to mull over where it is that you ought to be.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[You&#39;re nearly run over by a scarab as it zooms past in front of you.] (after: time + $timer, 200)[=(set: $timer to 3500)$tsn[Moments later, the rider zooms past as well, scowling at you as his body hurtles through the empty air.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Perhaps you should go to Bespoken?] (after: time + $timer, 200)[=(set: $timer to 4000)$tsn[They make custom partners to indulge with. It would be a welcome distraction after everything that&#39;s gone on.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Wait...] (after: time + $timer, 200)[=(set: $timer to 4000)$tsn[Did that scarab&#39;s rider fly by *after* the scarab?] (after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You shake your head, feeling a little uneasy.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Perhaps the Beguiling Eye would be good to visit. Indulge in some relaxing voyeur glass experience and forget about all of this for a while.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[As you gaze to the empty sky, you consider the dim haze that seems to be clouding your each and every thought. Perhaps if you went to Pungent Unguents, they might have some potion or spell that could improve your thinking or your body. Help you shake off the spawn haze, or make you better able to fight off murderous lehlt?]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[...The empty sky...]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[The entire ***Canopy*** is missing!]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Everything above the first floor, other than the House spires, is gone! What&#39;s going on?]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Maybe a trip to the Court of Information would be in order. They surely know what&#39;s happening!]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Then again, if some disaster is afoot, it might be best to go to Black Ditch Couture. That lehlt looked like the type who might have sold your belongings on - perhaps you could reclaim them while you still can.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[(if: $choice is &quot;omn&quot;)[You consult your shoddy EgoBracer for its compass as you consider your options. ]In any event, you need to get moving. Something is very wrong with the City, and you don&#39;t want to stay in the streets.]

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Make for Pungent Unguents&quot;)[(set: $morph to it + 1)(set: $choice to &quot;morph&quot;)(go-to:&quot;test9-2&quot;)]
(link: &quot;&gt; Make for the Beguiling Eye&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test9-2&quot;)]
(link: &quot;&gt; Make for Bespoken&quot;)[(set: $vorn to it + 1)(set: $choice to &quot;vorn&quot;)(go-to:&quot;test9-2&quot;)]
(link: &quot;&gt; Make for the Court of Information&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test9-2&quot;)]
(link: &quot;&gt; Make for Black Ditch Couture&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test9-2&quot;)]]</tw-passagedata><tw-passagedata pid="54" name="test9-2" tags="" position="2593,250" size="100,100">(text-colour: #02d987)[####The City Center]
$tsn[You set out for (text-colour: red)[(if: $choice is &quot;vorn&quot;)[Bespoken](else-if: $choice is &quot;omn&quot;)[the Court of Information](else-if: $choice is &quot;morph&quot;)[Pungent Unguents](else-if: $choice is &quot;psi&quot;)[the Beguiling Eye](else:)[Black Ditch Couture]] immediately.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 3500)$tsn[You hurry through the City, noting with increasing alarm that there seems to be something new amiss with each passing moment.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[The streets are empty.] (after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Buildings are hollow when you gaze through their windows.] (after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Shops stand there with nothing to sell.] (after: time + $timer, 200)[=(set: $timer to 3500)$tsn[Soft words seem to filter through the air from no direction, hazy and incomprehensible.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[You rush down an alleyway, angling for your destination as the City slowly starts to disintegrate around you. As you come to an intersection, you stumble into a nurk who yelps as you tread on his tail, sending you sprawling onto the ground.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[By the time you get up, the nurk seems to have become a slyne that squawks at you with the voice of a queril, then slithers away on its undulating toes as an oggorus might.] (after: time + $timer, 200)[=(set: $timer to 2500)$tsn[*If said oggorus was made of nightmares.*]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[[[&gt; Just keep moving-&gt;test10]]]</tw-passagedata><tw-passagedata pid="55" name="test10" tags="" position="2789,100" size="100,100">(text-colour: #02d987)[####The City Collapsing]
$tsn[Your footsteps thunder along the City streets, splattering through puddles of refuse and decay, clacking upon tiles of ceramic and bone.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 8000)$tsn[Buildings fly lazily through the (text-style: &quot;outline&quot;)[empty, pitch-black sky] as kudzu vines parade along the alleyways like greep. You can hear murmuring whispers and noises, like some muted conversation you can&#39;t quite make out. They seem to come from everywhere, sounding like your head is underwater.]

(after: time + $timer, 200)[=(set: $timer to 1500)$tsn[You round a bend--]

(after: time + $timer, 200)[=(t8n: &quot;rumble&quot;)+(t8n-time: 0.5s)+(text-colour: red)[***THOCK!***]

(after: time + $timer, 200)[=(t8n: &quot;dissolve&quot;)+(t8n-time: 2s)[(text-style: &quot;sway&quot;)+(text-colour: grey)[***Thump***]](set: $timer to 5000)

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You look up blearily from the ground at the wall that shouldn&#39;t have been there.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Dimly, slowly, you sit back up amid the chaotic cacophony of strange, fading sounds.]

(after: time + $timer, 200)[=$tsn[[[&gt; Urgh...-&gt;test10-2]]]</tw-passagedata><tw-passagedata pid="56" name="test10-2" tags="" position="2789,250" size="100,100">(text-colour: #02d987)[####The City Collapsed]
$tsn[You sit up and find yourself in a plaza.](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[The only plaza.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Looking around, you can see that the City is gone. Blearily, your head begins to reconnect the pieces you should have recalled immediately.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[This isn&#39;t *really* the City, at all.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[It&#39;s the (text-color: #02d987)[**Compass House**], still.]

(after: time + $timer, 200)[=(set: $timer to 600)$tsn[And,] (after: time + $timer, 200)[=(set: $timer to 1200)$tsn[it seems,] (after: time + $timer, 200)[=(set: $timer to 4000)$tsn[it&#39;s nearly the end.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Thin facades of walls surround the plaza you find yourself in, but you can readily see that there&#39;s little of substance to them. Perhaps, at last, the spell that $charmed[your best friend, ]Maji cast is starting to wear off. $charmed[You really can&#39;t wait to see him again. Or Velvadius. ]Looking around the empty plaza, the only thing that seems to have any real substance at all, now, is...]

(after: time + $timer, 200)[=$tsn[(text-style: &quot;fidget&quot;)[[[[&gt; *The Wishing Sphincter*-&gt;test10-3]]]]]</tw-passagedata><tw-passagedata pid="57" name="test10-3" tags="" position="2789,400" size="100,100">(text-colour: #36162d)[####The Wishing Sphincter]
$tsn[It sits there, squat and spined. Almost as though ringed with teeth, the fabled Wishing Sphincter gently, wearily squeezes and relaxes before you.](set: $timer to 5000)

(after: $timer, 200)[=(set: $timer to 6500)$tsn[It seems to be the only thing left of the City, directly in the centre of this strange, remnant plaza. As you stand there, watching it, you notice a small creature hiding behind it.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Warily you approach the Sphincter and the hiding creature behind it, aware that this may be your last encounter with the spell that you&#39;ve been subjected to. When you draw close, the Sphincter undulates and then yawns a little wider only for its fleshy folds to squish together completely.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then the creature scuttles out from behind the Wishing Sphincter to approach you.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[Scuttle is an apt word, as well, for you swiftly realise that it&#39;s a Scuttlebag. It sidles its way up to you before the two eyes that look like buttons on its straps gaze up at you expectantly.](click: &quot;Scuttlebag&quot;)[

$tsnGrey[A small satchel-like creature with a relatively inert stomach it can store things in. Often used as living luggage to ferry small items around at their owners&#39; behest.]]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Cautiously, you open the bag to reveal its contents within.]

(after: time + $timer, 200)[=$tsn[[[&gt; Inspect the Scuttlebag-&gt;test10-4]]]</tw-passagedata><tw-passagedata pid="58" name="test10-4" tags="" position="2789,550" size="100,100">(text-colour: #36162d)[####The Wishing Sphincter]
$tsn[Inside the Scuttlebag you see three items, each one glowing softly. They look a little like marbles, or...](set: $timer to 3500) (after: $timer, 200)[=(set: $timer to 3500)$tsn[Perhaps eggs, or seeds.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You scoop the three of them up and begin to examine them each in turn.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[The first one seems to have a warm, almost manic glow to it. It seems to drip with the promise of *creation*. Unbridled, chaotic energy left to build and build as it desires. The creation of a new iteration of the City, perhaps? A new tangle of chaos.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[The second one seems to have an almost familiar glow to it, crackling with some familiar teal energy. It seems to ooze the promise of directing its creative energies, whispering that it could restore the City to the way that you knew it.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[The third seems to promise nothing outside of itself. Yet within it, as you gaze closely, you can see an almost snowglobe-like depiction of the entire City. A moment of frozen memory, kept within a gleaming, translucent orb. You feel that with this, you could almost affix this whole experience in your memory, to persist and last.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[The Wishing Sphincter suddenly yawns again, its greasy folds gaping wide to reveal the dark tunnel of its passage. You look back down to the Scuttlebag only to find it gone.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You have an itching sense that the Wishing Sphincter needs one of these little marbles.] (after: time + $timer, 200)[=(set: $timer to 2000)$tsn[These...] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[*wishes.*]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[But which should you feed to it?]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Should you feed *none* of them to it, and let the spell of the Compass House at last come to its natural, well-earned end?]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Or should you perhaps step into the slimy, yawning sphincter *yourself* and see where one last hole leads in this strange experience?]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You look to the yawning chasm of the sphincter, and then make your choice.]

(after: time + $timer, 200)[=$tsn[(link: &quot;&gt; Feed the Wishing Sphincter the new wish&quot;)[(set: $viv to it + 1)(set: $choice to &quot;viv&quot;)(go-to:&quot;test10-5&quot;)]
(link: &quot;&gt; Feed the Wishing Sphincter the old wish&quot;)[(set: $omn to it + 1)(set: $choice to &quot;omn&quot;)(go-to:&quot;test10-5&quot;)]
(link: &quot;&gt; Feed the Wishing Sphincter the wish to remember&quot;)[(set: $psi to it + 1)(set: $choice to &quot;psi&quot;)(go-to:&quot;test10-5&quot;)]
(link: &quot;&gt; Feed the Wishing Sphincter nothing&quot;)[(set: $umbra to it + 1)(set: $choice to &quot;umbra&quot;)(go-to:&quot;test10-5&quot;)]
(link: &quot;&gt; Feed yourself to the Wishing Sphincter&quot;)[(set: $byle to it + 1)(set: $choice to &quot;byle&quot;)(go-to:&quot;test10-5&quot;)]]</tw-passagedata><tw-passagedata pid="59" name="test10-5" tags="" position="2790,696" size="100,100">(text-colour: #36162d)[####The Wishing Sphincter]
(if: $choice is &quot;umbra&quot;)[$tsn[No.](set: $timer to 3500) 

(after: $timer, 200)[=(set: $timer to 3500)$tsn[It&#39;s time.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You can *feel* the end of the test.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[It&#39;s time to let it fade.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Quietly, you sit down beside the Wishing Sphincter and think back over everything that happened throughout the challenge you&#39;ve been through.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[It&#39;s been a wild adventure.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You close your eyes as you feel the world start to waver and tremble, and gradually your awareness begins to detach from your own body. Like drawing in a breath of fresh air, you feel almost like you&#39;re...]

(after: time + $timer, 200)[=$tsn[(if: $isPet is true)[[[Waking up.-&gt;petEnd1]]](else:)[[[Waking up.-&gt;end1]]]]
](else-if: $choice is &quot;byle&quot;)[$tsn[You step up to the Wishing Sphincter, discarding the three wishes the Scuttlebag gave you.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 3000)$tsn[You don&#39;t need a *marble* to feed the Wishing Sphincter.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[If it wants something to swallow, then you&#39;ve got just the thing already.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[You place one foot on the lip of the fleshy opening and feel as it undulates and contracts a little. It&#39;s grimy and greasy and almost makes you slip, but with some balancing you manage to step up onto the opening of the yawning hole.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You take a deep breath of fetid air, looking down at the folds of slimy muscle and the darkness within them.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Once you sink into it, there&#39;s no going back.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[But, by the City&#39;s Eyes, you&#39;re already at the end, aren&#39;t you? What&#39;s life without a little adventure.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You ease yourself into the yawning folds of the Wishing Sphincter and let it and gravity swallow you down.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[You slide into the slick, oddly warm contractions of the sphincter and watch the last of the world fade away from view as it squishes closed behind you. Its walls squeeze and slurp you down its gooey passage.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[You close your eyes as its greasy embrace overtakes you. Only, instead of a sense of sleep or of dying, you feel a strange and almost (text-style: &quot;outline&quot;)[airy] sensation. It&#39;s a little like you&#39;re floating into a vast, inky sea without up, without down, without even time.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[It&#39;s almost like...]

(after: time + $timer, 200)[=$tsn[(if: $isPet is true)[[[Waking up.-&gt;petEnd1]]](else:)[[[Waking up.-&gt;end1]]]]
](else-if: $choice is &quot;omn&quot;)[$tsn[You step up to the Wishing Sphincter, clutching the (text-colour: magenta)[old wish] in hand.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 5500)$tsn[The City of Nodd is a place you&#39;re not yet done exploring. Even if this is only part of a spell, you know how the City ought to be. You know how you want it to be. You know how to put things back correctly.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter yawns wide, and you carefully toss the (text-colour: magenta)[old wish] into its centre.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter contracts, noisily gulping down the glowing marble.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[At first, nothing happens.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[But then, after several ticks, you see the ground around the Wishing Sphincter begin to (text-colour: magenta)+(text-style: &quot;smear&quot;)[*glow*].]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[The glow grows stronger and stronger by the tick, and in only moments you start to feel a rumbling in the ground. Behind you, then, and all around you, you see six, enormous spires burst forth from the ground.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[They grow and they grow, stretching up to the infinite void of sky above you.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[***The six Houses.***]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Then, before you, you see the seventh begin to emerge from the ground behind the Wishing Sphincter. With a deafening and thunderous (text-style: &quot;rumble&quot;)[**boom**] of splitting ground and trembling momentum, the Council Spire begins to rise.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[All around you, the City begins to rebuild and restore itself. Yet as it does, you find yourself feeling more and more fatigued. Exhaustion washes over your body, and you find yourself sitting down. Then, you find yourself laying down.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Your consciousness begins to slip. Somehow, it doesn&#39;t feel like fading. Content in the knowledge that, right to the end, you were able to put things back to how they *should* be, you find yourself feeling almost like you&#39;re...]

(after: time + $timer, 200)[=$tsn[(if: $isPet is true)[[[Waking up.-&gt;petEnd1]]](else:)[[[Waking up.-&gt;end1]]]]
](else-if: $choice is &quot;viv&quot;)[$tsn[You step up to the Wishing Sphincter, clutching the (text-colour: cyan)[new wish] in hand.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 5500)$tsn[You don&#39;t know what this (text-colour: cyan)[new wish] will do. But you know that it will make something vast. Something wild and Noddish and chaotic and mad. You want the chaos to flourish.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter yawns wide, and you carefully toss the (text-colour: cyan)[new wish] into its centre.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter contracts, noisily gulping down the glowing marble.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[At first, nothing happens.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[But then, after several ticks, you see the ground around the Wishing Sphincter begin to (text-colour: cyan)+(text-style: &quot;smear&quot;)[*glow*].]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[The glow grows stronger and stronger by the tick, and in only moments you start to feel a chill in the ground. Beneath you, the plaza starts to become translucent like (text-style: &quot;outline&quot;)[glass].]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Beneath the ground, stretching down like some reflection in mirrored ocean, you see a tangle of buildings and spires start to grow.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[They sprawl and spread like roots, delving downwards beneath your feet, yet you can&#39;t shake the sensation that (text-style: &quot;smear&quot;)[**you&#39;re**] the one in the reflection, peering down and into the sky on the other side.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[On this side, the world begins to wither and fade. The Wishing Sphincter shrivels before you and crumbles, while the world beneath the glassy floor continues to thrive with newfound life.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[You aren&#39;t sure what&#39;s on the other side, but you know that it will be wild and chaotic like nothing you&#39;ve yet seen. And perhaps, just perhaps, another spell might one day let you explore that still-growing tangle.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[As the world fades away, your consciousness begins to slip. Somehow, it doesn&#39;t feel like fading. Content in the knowledge that you were able to grow something entirely new in the chaos, you find yourself feeling almost like you&#39;re...]

(after: time + $timer, 200)[=$tsn[(if: $isPet is true)[[[Waking up.-&gt;petEnd1]]](else:)[[[Waking up.-&gt;end1]]]]
](else:)[$tsn[You step up to the Wishing Sphincter, clutching the (text-colour: grey)[wish to remember] in hand.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[You&#39;ve experienced so much in this strange place. Here, at the end of it all, you most wish to remember your encounters.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter yawns wide, and you carefully toss the (text-colour: grey)[wish to remember] into its centre.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[The Wishing Sphincter contracts, noisily gulping down the glowing marble.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[At first, nothing happens.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[But then, after several ticks, you see the ground around the Wishing Sphincter begin to (text-colour: grey)+(text-style: &quot;smear&quot;)[*glow*].]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The glow grows stronger and stronger by the tick, and in only moments you see it spread out to the edges of the plaza.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[It spreads further and further, lighting up the horizons in less than a chime. Everything starts to seem (text-colour: grey)[silvery.]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[(text-colour: grey)[Soon, the whole world seems to echo this clean, clear shade that spread from the wish. It spreads upwards and into the sky, encompassing it entirely until you find yourself standing in a pale and silvery void.]]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsnGrey[The world starts to gleam and shimmer until you realise that you can see images on the horizon.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsnGrey[It takes time for you to make them out but, when you do, you find that all of them are strange recordings of yourself as you made your way through the spell.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsnGrey[Images of you as you spoke with the nurk.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsnGrey[As you met with Illa.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsnGrey[As you ate, and fought, and died.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsnGrey[It all takes shape before your eyes... before the whole world abruptly stops.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsnGrey[The world around you freezes, a snapshot of your time frozen in a crystalline memory. You find yourself paralysed inside of it, unable to move, unable to tear your vision away from the endless reflections of your time.]

(after: time + $timer, 200)[=(set: $timer to 12000)$tsnGrey[Yet, you find it hard to feel afraid. You wished for a memory, and you can feel your time here being etched into your consciousness even as it starts to fade. You can feel yourself growing distant, as though stretching through a tube away from this place. Somehow, it doesn&#39;t feel like fading. Content in the knowledge that you were able to hold onto this memory, you find yourself feeling almost like you&#39;re...]

(after: time + $timer, 200)[=$tsn[(if: $isPet is true)[[[Waking up.-&gt;petEnd1]]](else:)[[[Waking up.-&gt;end1]]]]
]</tw-passagedata><tw-passagedata pid="60" name="petEnd1" tags="" position="3711,314" size="100,100">{(set: $win to (max: $vorn, $psi, $viv, $umbra, $omn, $morph, $byle))
(if: $vorn is $win)[(set: $vornwin to true)](else-if: $psi is $win)[(set: $psiwin to true)](else-if: $viv is $win)[(set: $vivwin to true)]
(if: $umbra is $win)[(set: $umbrawin to true)](else-if: $morph is $win)[(set: $morphwin to true)](else-if: $omn is $win)[(set: $omnwin to true)](else:)[(set: $bylewin to true)]
}(text-colour: #02d987)[####A Dusty Basement]
$tsn[The sound of dripping water is the first thing you become aware of.](set: $timer to 4000) 

(after: $timer, 200)[=(set: $timer to 3000)$tsn[Your head feels groggy, and you feel a keen sense of lethargy in your limbs.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Blearily, you open your eyes.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[(text-style: &quot;smear&quot;)[**It&#39;s dark.**]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The scent of sex fills your nose, and you feel your belly flutter in a strange wave of excitement. (text-style: &quot;blurrier&quot;)+(text-colour: grey)[Obedient pet.]]

(after: time + $timer, 200)[=(set: $timer to 0)(if: $dick is true and $pussy is true)[(set: $timer to it + 5000)You feel your cock start to stiffen as your cunt grows damp, and you find yourself feeling a little confused about what has you feeling so charged.](else-if: $dick is true)[(if: $genderTF is true)[(set: $timer to it + 7500)You feel a strange tightness in your groin, and after only a few ticks, you feel something start to slide out from (text-style: &quot;fidget&quot;)[**between**] your legs. A feeling like you had in the Compass House trial. ***You have a dick?***](else:)[(set: $timer to it + 4000)You feel your dick slowly start to slide out and into the open, and find yourself confused about what has you feeling so charged.]](else:)[(if: $genderTF is true)[(set: $timer to it + 5500)You feel a strange emptiness- a wetness- a (text-colour: magenta)[*warmth*] between your legs. A feeling like you had in the Compass House trial. ***Your dick is (text-style: &quot;outline&quot;)[gone].***](else:)[(set: $timer to it + 5000)You feel your cunt growing damp and slick between your thighs, and find yourself confused about what has you feeling so charged.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[(if: $genderTF is true)[You gasp and jolt as you realise that somehow the effects in the Compass House trial have persisted.](else:)[You groan and try to let your eyes adjust to the darkness you find yourself in. Are you... naked? You reach down to feel around the floor.]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[(text-style: &quot;sway&quot;, &quot;smear&quot;)+(text-colour: grey)[*KCHINK*]]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Your limbs refuse to move.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Suddenly much more awake, you quickly realise several things.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[You&#39;re bound.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[You&#39;re on all fours. (text-style: &quot;blurrier&quot;)+(text-colour: grey)[Good animal.]]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[You&#39;re stark naked.]

(after: time + $timer, 200)[=(if: $genderTF is false)[(set: $timer to 0)](else:)[(set: $timer to 2000)$tsn[You&#39;ve got the wrong set of equipment between your legs.]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You feel your heart racing, and try to (text-style: &quot;smear&quot;)[relax] your speeding thoughts. Your ass aches quite a lot, but oddly in a *good* way? (text-style: &quot;blurrier&quot;)+(text-colour: grey)[Good pet.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You try to shake your head clear of the strange feelings plaguing it, but you can&#39;t quite bring your mind to (text-style: &quot;smear&quot;)[heel].]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[Idly, you realise that you&#39;re... *whimpering*? You force yourself to stop, then swallow. As you do, you become aware of the thick, solid bridle wrapped around your face, keeping your snout in a mostly-closed position.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[It&#39;s then that you hear the quiet creak-squelch of a door opening. (text-colour: #ffff99)+(text-style: &quot;smear&quot;)[Light] spills in across the room, revealing a set of stairs, a water and food bowl, a cushioned pet bed, and some toys.](click: &quot;set of stairs&quot;)[(append: ?hook1)[
$tsnGrey[As you gaze towards the stairs, you can see your way out - only now it&#39;s blocked by an imposing shadow.]
]](click: &quot;water and food bowl&quot;)[(append: ?hook1)[
$tsnGrey[You look towards the food and water bowl. They seem to have been eaten and drunk from on multiple occasions. (if: $vornwin is true)[They look to be red and spiny.](else-if: $psiwin is true)[They look to be purple, and the water has a rainbow sheen to it.](else-if: $vivwin is true)[They look to be quite floral, and you can see a worm squirming in the food bowl.](else-if: $omnwin is true)[They look to be plain and clean, almost devoid of feature.](else-if: $bylewin is true)[They look grimy and unwashed, the food bowl full of slop.](else-if: $umbrawin is true)[They look to be made of bone, the food bowl full of dust.](else-if: $morphwin is true)[They look to be made of some fleshy substance, and little tendrils wiggle lazily about in the air.]
]]](click: &quot;cushioned pet bed&quot;)[(append: ?hook1)[
(if: $vornwin is true)[$tsnGrey[There&#39;s a pet bed of some kind, though it looks spiny and uncomfortable.]
](else-if: $psiwin is true)[$tsnGrey[There&#39;s a pet bed of some kind, made of cushions with little, suspicious-looking pills scattered all around it.]
](else-if: $vivwin is true)[$tsnGrey[There&#39;s a pet bed of some kind, though it looks floral and almost... *living*.]
](else-if: $omnwin is true)[$tsnGrey[There&#39;s a pet bed of some kind, fitted with restraints.]
](else-if: $bylewin is true)[$tsnGrey[There&#39;s a pet bed of some kind, though it looks filthy and smelly.]
](else-if: $umbrawin is true)[$tsnGrey[There&#39;s a pet bed of some kind, though it looks drab and grey.]
](else-if: $morphwin is true)[$tsnGrey[There&#39;s a pet bed of some kind, seemingly warped and slowly undulating before your eyes as though alive.]
]]](click: &quot;toys&quot;)[(append: ?hook1)[
(if: $vornwin is true)[$tsnGrey[There are several toys laying around. They look to be a mixture of chew toys and dildos. They look worryingly used.]
](else-if: $psiwin is true)[$tsnGrey[There are several colourful toys laying around. Some of them look more like puzzles than anything else.]
](else-if: $vivwin is true)[$tsnGrey[There are several &#39;toys&#39; laying around - though all of them look to be the sorts of things that might come to life and start squirming at a moment&#39;s notice.]
](else-if: $omnwin is true)[$tsnGrey[There are several toys around, though all of them look to be intricate and functional.]
](else-if: $bylewin is true)[$tsnGrey[There are several toys laying around - dirty and slobbered on.]
](else-if: $umbrawin is true)[$tsnGrey[There are several toys laying around, though all of them look to be old, as though second-hand.]
](else-if: $morphwin is true)[$tsnGrey[There are several toys around, but by the time you&#39;ve finished looking at the third one the first one seems to have changed itself into something new.]
]]]|hook1&gt;[]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[In the light of the doorway, you see a **figure**.]

(after: time + $timer, 200)[=$tsn[(if: $vivwin is true)[[[&gt; Sit, and stay.-&gt;petEndViv]]](else-if: $vornwin is true)[[[&gt; Sit, and stay.-&gt;petEndVorn]]](else-if: $psiwin is true)[[[&gt; Sit, and stay.-&gt;petEndPsi]]](else-if: $morphwin is true)[[[&gt; Sit, and stay.-&gt;petEndMorph]]](else-if: $umbrawin is true)[[[&gt; Sit, and stay.-&gt;petEndUmbra]]](else-if: $omnwin is true)[[[&gt; Sit, and stay.-&gt;petEndOmn]]](else:)[[[&gt; Sit, and stay.-&gt;petEndByle]]]]</tw-passagedata><tw-passagedata pid="61" name="end1" tags="" position="3301,311" size="100,100">{(set: $wincount to 0)
(set: $win to (max: $vorn, $psi, $viv, $umbra, $omn, $morph, $byle))
(if: $vorn is $win)[(set: $vornwin to true)(set: $wincount to it + 1)]
(if: $psi is $win)[(set: $psiwin to true)(set: $wincount to it + 1)]
(if: $viv is $win)[(set: $vivwin to true)(set: $wincount to it + 1)]
(if: $umbra is $win)[(set: $umbrawin to true)(set: $wincount to it + 1)]
(if: $morph is $win)[(set: $morphwin to true)(set: $wincount to it + 1)]
(if: $omn is $win)[(set: $omnwin to true)(set: $wincount to it + 1)]
(if: $byle is $win)[(set: $bylewin to true)(set: $wincount to it + 1)]
}(after: 3s, 200)[=(t8n: &quot;dissolve&quot;)+(t8n-time: 6s)[(text-colour: #02d987)[####The Compass House]](set: $timer to 8000)
(after: $timer, 200)[=(set: $timer to 3500)$tsn[The sound of clinking crockery is the first thing you become aware of.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You open your eyes and shake clear a hazy sense of fatigue. Off to your right, you can see Velvadius sitting on an old chair as he sips at some sort of drink. Maji stands by a table with a pair of hourglasses on it, humming and tapping at them thoughtfully. (if: $charmed is true)[Seeing your *best friend* again makes you feel a little giddy.(set: $timer to it + 2000)]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[At some point, you&#39;ve lost your clothing,(set: $clothed to false) but you can see it neatly piled beside the chair. You look down at yourself. (if: $genderTF is true)[(set: $timer to it + 8000)(if: $pussy is true)[**Your dick is gone!** There&#39;s just a *gap* between your legs where once was your masculinity, and you can feel the same *warm sensitivity* now that you felt in the spell dream.](else:)[You&#39;ve... **got a dick!** Your spread legs frame a plump pair of balls and associated swell, and you can feel the strange presence of your heartbeat inside of it.] You jerk in surprise but swiftly find that you are in fact still restrained. The noise draws the attention of the two proprietors.](else:)[(set: $timer to it + 5000)You&#39;re still restrained with your limbs all securely buckled to the chair. You give a little tug to see if you can slide back out of one of them, but the noise draws the attention of the two proprietors.]]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[$npc[&quot;Ah,&quot;] Velvadius says, looking up from his drink.] (after: time + $timer, 200)[=(set: $timer to 2000)$tsn[$npc[&quot;You&#39;re awake.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 0)$tsn[(if: $genderTF is true)[(set: $timer to it + 8000)You ask what happened to your groin, and Velvadius lifts his chin in understanding.
$npc[&quot;Ooh, Maji is proud of that one!&quot;] comes a cheery voice from behind you, the kobold hurrying over. $npc[&quot;Changes in the spell happen for real! Maji thinks you look *great* with a (if: $pussy is true)[cunt. Very fuckable, yes, yes.](else:)[cock. Very squeezable, yes, yes.]&quot;] He grins brightly up at you. (if: $charmed is true)[(set: $timer to it + 3000)Hearing that your dearest friends like your new equipment is enough to make a flush of arousal shiver through your assets as you picture them helping you explore them.]](else:)[(set: $timer to it + 5000)You ask how long you were out for, and Velvadius stands up and stretches out gracefully. As he does, the blue form of his assistant hurries over.
$npc[&quot;Ooh, a few bells!&quot;] Maji chimes in merrily. $npc[&quot;Maji watched the whoooole thing.&quot;] (if: $charmed is true)[(set: $timer to it + 3000)You feel a flush of happiness knowing that your *dearest friends* were watching everything that happened.]]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[(if: $genderTF is true)[Before you can say anything more, Maji hums thoughtfully again.
$npc[&quot;If you don&#39;t wanna have those parts though, Maji can find a gooood discount for swapping back!&quot;]
You take a moment to process everything, then hesitantly nod your understanding.](else:)[You look at Velvadius and Maji, then slowly nod your understanding. You ask about your clothes, and Velvadius chuckles mirthfully as he pats your shoulder. Unhelpfully, that&#39;s all the answer you&#39;re given so, instead, you ask about getting the restraints off.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Here,&quot;] Velvadius says, taking a few moments to disengage your upper restraints as Maji sets to work on those around your legs.] (after: time + $timer, 200)[=(set: $timer to 2000)$tsn[In a few moments, you&#39;re free once again.]

(after: time + $timer, 200)[=$tsn[[[&gt; Get dressed first-&gt;end2]]
[[&gt; Stretch your tired legs-&gt;end3]]]</tw-passagedata><tw-passagedata pid="62" name="end2" tags="" position="3333,442" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You take a few moments to put your clothes on.](set: $timer to 3000)(set: $clothed to true)

(after: $timer, 200)[=(set: $timer to 2500)$tsn[You can see Velvadius and Maji watching you as you dress. $charmed[(set: $timer to it + 2000)Velvadius&#39; leering eyes feel kind of nice on you, and you almost reconsider dressing. (if: $eagerFuck &gt; 0)[(set: $timer to it + 2000)You can see that Velvadius is no more dressed than when you went under, and he again notes your eyes dipping to the immense weight between his legs. ]]Before long, you again feel more modestly garbed.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Feeling yourself again(if: $genderTF is true)[ - or at least, mostly yourself -] you relax, then...]

(after: time + $timer, 200)[=$tsn[[[&gt; Stand up-&gt;end3]]]</tw-passagedata><tw-passagedata pid="63" name="end3" tags="" position="3252,567" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You stand up from the chair and take a few moments to stretch your legs, walking around the room of the Compass House. (if: $clothed is false)[You can feel Velvadius&#39; eyes following your naked form around appreciatively.]](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[After a couple of chimes, you sit back down again - leaning forwards and out of the range of the restraints, *just in case* - before facing the two proprietors.](after: $timer, 200)[=(unless: $majiFlag is true)[(set: $timer to 0)](else:)[

(set: $timer to 8000)$tsn[Maji inches up to you antsily, a big smile on his snout.
$npc[&quot;Pssssssst,&quot;] he whispers. $npc[&quot;What did think of Maji&#39;s eggplant the lehlt fed you to? Maji made that one all by himself, no mister Velvadius input!&quot;] He hums happily to himself, before Velvadius motions for him to shoo.]]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;Now, then,&quot;] Velvadius says, snapping his fingers. The chair he normally sits upon scurries obediently over to him, and he eases himself down into it.] (after: time + $timer, 200)[=(set: $timer to 3500)$tsn[$npc[&quot;The moment we&#39;ve all been waiting for. Maji?&quot;] He extends a hand.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Maji hurries over with a box held in both his scaly arms, and he holds it up to the lehlt. Velvadius graciously takes the box, before gently tickling a warty ridge around a singular eye in the centre of it. The motion makes it croak and creak open.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[As the lid eases open, Velvadius looks at you. Then he smiles, withdrawing a small and silvery disc.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[$npc[&quot;You,&quot;] he intones dramatically. $npc[&quot;My dear patron, align well with...&quot;]]

(after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Vorn.&quot;] Velvadius smiles, then turns the crest around to reveal an image of a beating heart around a reddish stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/wS8A57R.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 4000)$tsn[$npc[&quot;House Vorn,&quot;] he explains, $npc[&quot;is the House of flesh, or the body, ruled by Mercian Vetch. Those who love pain often gravitate towards this House.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;But not only pain. House Vorn also gives home to those who adore pleasure. Those who want nothing more than to engage in hedonistic sex, orgies, and carnal ruts find happy homes in House Vorn.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;As do those who fixate on the body. Those who enjoy assets like,&quot;] he pauses and smiles, $npc[&quot;like mine often enjoy the domain of Vorn.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;House Vorn is for any who enjoy the physical. It is divided into the Indulgent Ones, who prize romance, emotions, and physical touch, and the Vibrant Ones who prize strength, showmanship, dramatism and pain.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 10000)$tsn[$npc[&quot;Those in House Vorn are often outgoing or emotional, enjoying love, hate, joy and sorrow to a deeper degree than their peers. Even when reserved, they tend to enjoy the sheer sensation of *feeling*, physical and emotional, and tend to possess a charisma that they may not always recognise.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 4500)$tsn[$npc[&quot;Their familiar is the sletcher, a beast who relies solely on sound, scent, and touch to navigate as it has no eyes.&quot;]]

](after: time + $timer, 200)[=(unless: $vornwin is true)[(set: $timer to 0)](else:)[(set: $timer to 3000)$tsn[Velvadius then hands you the crest of House Vorn.]](after: time + $timer, 200)[=(unless: $vornwin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Psilysium.&quot;] Velvadius arches his eyebrows, then reveals that the crest&#39;s other face bears an image of a many-eyed mouth swallowing a teal stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/3v1WzDg.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 6500)$tsn[$npc[&quot;House Psilysium is the House of Mind, ruled by Filo Rooke. Those who enjoy thinking, or altering or exploring the mind often find themselves drawn to this House.&quot;]]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;Members of House Psilysium are often captivated by puzzles, drugs, and mind-affecting spells and creatures. They are dreamers, prophets, philosophers and psychonauts of varying degrees.&quot;] Velvadius thinks for a moment, before offering a smile.]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;The House is divided into the Lucid Ones, who focus on seeking knowledge and understanding through thought, logic, or copious amounts of drugs - depending on who you ask, and the Vexed Ones, who focus on manipulating the consciousness of themselves or others.&quot;]]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;A Lucid One might yield captivating conversation, while a Vexed One may hypnotise you until your brain is a happy puddle pouring out of your (if: $pussy is true)[cunt](else:)[cock]. They take all kinds, really.&quot;] Velvadius chuckles, waving a hand.]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;Those of House Psilysium are often curious and inquisitive and bear a keen desire to *know*. They may be reserved or even cynical at times, but that tends to stem from the sheer breadth and care of thought they&#39;ve given to themselves and their world.&quot;]]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 4500)$tsn[$npc[&quot;Their familiar is the queril, a highly curious and mischievous bird with a pollen-like dust in its feathers that has hallucinogenic effects.&quot;]]

](after: time + $timer, 200)[=(unless: $psiwin is true)[(set: $timer to 0)](else:)[(set: $timer to 3000)$tsn[Velvadius nods, then hands you the crest of House Psilysium.]](after: time + $timer, 200)[=(unless: $psiwin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Viviria.&quot;] Velvadius leans forwards, rotating the crest in his hand to reveal a floral design with a greenish stone in the centre.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/Pv3SC2b.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;House Viviria is the House of Life, ruled by the Mothertoad - a monstrous mephitoad experiment gone wrong that grows and envelops any creature it can. Those who enjoy life and growth often align with this House.&quot;]]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;Those in House Viviria are often gardeners, beastkeepers, or those interested in true immortality. They are quite aligned with nature.&quot;] Velvadius nods to a small potted plant in the corner of the room.]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;The House is divided into two sects - the Verdant Ones, who focus on the wonder of life and often appear somewhat like druids or mystics in tune with nature, and the Hungry Ones, who focus on the spread and growth of life.&quot;]]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;While the Verdant Ones may give splendid advice on caring for your slumpkins or how to best ensure you bear healthy offspring, a Hungry One might be the type to hold you down and force you to join some grotesque hive as food or the hive&#39;s newest (if: $pussy is true)[mother](else:)[father].&quot;]]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;Those in House Viviria are often bright-eyed individuals - or collectives - and tend to enjoy connecting to others. Despite that, some of them can be quite reclusive and solitary. They often are strong leaders, and frequently have strong empathy for wild creatures.&quot;]]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 6500)$tsn[$npc[&quot;Their familiar is the mephitoad, which as I&#39;m sure you&#39;re aware,&quot;] Velvadius smiles, $npc[&quot;is a hermaphroditic creature that can live nearly anywhere and reproduce with ease.&quot;]]

](after: time + $timer, 200)[=(unless: $vivwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[Velvadius gently hands you the green-jeweled crest of House Viviria.]](after: time + $timer, 200)[=(unless: $vivwin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 6000)$tsn[$npc[&quot;House Umbrasia.&quot;] Velvadius leans back in his chair, turning the crest to reveal a triangular glyph above a crescent moon, the smoky gem in its centre fashioned to look like the pupil of a weeping eye.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/Scedn9h.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;House Umbrasia,&quot;] Velvadius says thoughtfully, $npc[&quot;is the House of Death, ruled by Illa Phasmere. Those who prize silence, the passage of time, justice, or death in general often are drawn to this House.&quot;]]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 9000)$tsn[$npc[&quot;Those who move in House Umbrasia tend to belong to one of two sects, being the Languid Ones or the Restless Ones. The Restless Ones are driven by justice and a sense of outgoing vengeance. They enact retribution on those who killed them or others.&quot;]]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;The Languid Ones focus more on healing and quietly making right the general wrongs of others. Almost all who find themselves in House Umbrasia are relatively self-sufficient,&quot;] Velvadius notes.]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 10000)$tsn[$npc[&quot;Those in House Umbrasia are often quiet and introverted, though it has its fair share of extroverts as well. They make good listeners and confidants, and often understand the innate sadness of living, for it must always pair with death.&quot;]]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 6500)$tsn[$npc[&quot;The familiar of House Umbrasia is the squall, a great and raptorial beast with hollow eyes whose cry is known for vanquishing one&#39;s fear of death.&quot;]]

](after: time + $timer, 200)[=(unless: $umbrawin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[Velvadius solemnly passes you the crest of House Umbrasia.]](after: time + $timer, 200)[=(unless: $umbrawin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Morphoria.&quot;] Velvadius nods and begins to turn the crest towards you, when suddenly Maji leaps up and snatches it from his hands.]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;Maji can do! Maji knows ***lots*** about Morphoria!&quot;] the kobold beams. You look down at him as his ears flop and he gives a snaggletoothed smile up at you. He shows you the crest, bearing two snakes biting their own tails around a purple stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/N9b5TjW.png&quot;&gt;&lt;/center&gt;](enchant: ?rb&#39;s chars, via (text-color:(hsl: pos * 40-120, 1, 0.5)))

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 9000)$tsn[$npc[&quot;Houuuuuuse |rb&gt;[(text-style: &quot;smear&quot;)[Morphoria]]! Morphoria is the house of *change*! The big ruler is Pnura who&#39;s *really* changey,&quot;] Maji declares. $npc[&quot;Pnura can be anyone. Even you. People who like Morphoria like change, and chaos, and chance, and all the C words.&quot;]]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;Sometimes, they&#39;re jesters. Sometimes, they&#39;re gamblers. Sometimes, they&#39;re just crazy. Maji is pretty sure they all have *huge* dic-&quot;] Velvadius smacks Maji&#39;s head lightly. The outsider huffs, then grumblingly moves on.]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 6000)$tsn[$npc[&quot;The House is split between the Mutable Ones and the Erratic Ones! The Mutable Ones twist fate and luck and also people. They&#39;re really open-minded and love connecting people!&quot;]]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;The Erratic Ones though, they go with the flow and let what happens happen. Maji is a Mutable One, *they&#39;re the best*, that&#39;s a Maji guarantee!&quot;] (if: $charmed is true)[You find yourself nodding in agreement.]]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;The familiar for House Morphoria iiiiis, tada!&quot;] Maji pulls a small, eyeless black snake with white insides out from one of the sleeves of his robe. A sudden, illusory puff of |rb&gt;[(text-style: &quot;smear&quot;)[sparkles]] erupt around him as a ghostly fanfare sounds out. $npc[&quot;The orolisk!&quot;]]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 10000)$tsn[$npc[&quot;The orolisk is a snake thing that looks kinda like Pnura but also not since Pnura can be anything. They change into stuff and then when people try to use it, poof! They turn *them* into the object forever. Whoops!&quot;] Maji grins, letting the orolisk slither across him. Before your eyes, it turns into a teacup, which Maji sets down with a scowl.]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 4000)$tsn[$npc[&quot;People in Morphoria are kinda playful and energetic, but can be really go-with-the-flow, too. They have good humour, and don&#39;t mind helping out.&quot;]]

](after: time + $timer, 200)[=(unless: $morphwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[Maji nods firmly, then hands you the crest of House Morphoria.]](after: time + $timer, 200)[=(unless: $morphwin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Omnillian.&quot;] Velvadius strokes the tuft of his goatee, before revealing the other side of the crest - a pair of hands clutching at a grey stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/WtUT4Zp.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;House Omnillian is the House of control, ruled by Quin Aven. Those who seek stability, knowledge, or predictability congregate around this House.&quot;]]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 9000)$tsn[$npc[&quot;Those of House Omnillian belong to one of two sects, of course, those being the Inspired Ones, or the Masterful Ones. Of those two, the Inspired Ones focus on creation and innovation - of spells, artifacts, or anything, really. They tend to be open-minded and quietly industrious.&quot;]]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;The Masterful Ones tend to focus on cataloguing, collecting, and problem-solving. They are often perfectionists, and the sect is home to some of the most artisanal lateral thinkers.&quot;]]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[$npc[&quot;The House doesn&#39;t have a familiar in quite the same way that the other Houses do, but House Omnillian is known for its *spooks*: little mechanical birds that meticulously observe anyone around them.&quot;]]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;Those in House Omnillian tend to be creative, focused when they want to be, and frequently brilliant in ways they often don&#39;t recognise. They can seem cold and unapproachable at times, but often harbour deep feelings of care for those close to them.&quot;]]

](after: time + $timer, 200)[=(unless: $omnwin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[Velvadius pauses thoughtfully for a moment, then extends his arm to hand you the crest of House Omnillian.]](after: time + $timer, 200)[=(unless: $omnwin is true and $wincount &gt; 1)[(set: $timer to 0)](else:)[

(set: $wincount to it - 1)(set: $timer to 3000)$tsn[Velvadius then holds up a finger. $npc[&quot;Your score, however, says that you in equal measure are suited to *another*, my dear patron.&quot;] He gives you a sly smile, then withdraws another crest from the box.]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;Not a House at all.&quot;] Velvadius arches his eyebrows, then reveals to you the other side of the crest - a grotesque depiction of ooze around a yellow stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/ps4CoNZ.png&quot;&gt;&lt;/center&gt;]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;The Cult of Byle,&quot;] he says. $npc[&quot;Byle is... a cult of filth and base indulgence. Those who crave increasingly depraved experiences often find home in Byle, but so too do those who enjoy shocking or disgusting others.&quot;]]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;Not much is known about the cult&#39;s inner workings save that Orpus Byle, the oggorus after whom it is named, has a slime that is potently addictive and deeply corruptive.&quot;]]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;Those who join Byle sometimes begin with a desire to indulge in milder things such as watersports, grime, or musk - but those who make their way to Byle&#39;s inner circles allegedly inevitably taste his slime. From there, the *itch* for worse and worse only grows.&quot;]]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[$npc[&quot;Still, those in Byle are sometimes softer spoken, choosing not to advertise their proclivities. They push the frontiers of indulgence, finding deeper and more intense ways to experience fetish and indulgence, and are often very open and exploratory individuals.&quot;]]

](after: time + $timer, 200)[=(unless: $bylewin is true)[(set: $timer to 0)](else:)[(set: $timer to 5000)$tsn[Velvadius hands the crest of the Cult of Byle across to you.]

]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[With a smile, Velvadius closes the box and then folds his hands together.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Now then, my dear patron, have you any more questions, or shall we close our little exploration here, hmm?&quot;] Velvadius&#39; eyes hold yours. Maji looks up at you from the side.]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="64" name="vorn" tags="" position="2889,886" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/wS8A57R.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;House Vorn,&quot;] he explains, $npc[&quot;is the House of flesh, or the body, ruled by Mercian Vetch. Those who love pain often gravitate towards this House.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;But not only pain. House Vorn also gives home to those who adore pleasure. Those who want nothing more than to engage in hedonistic sex, orgies, and carnal ruts find happy homes in House Vorn.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;As do those who fixate on the body. Those who enjoy assets like,&quot;] he pauses and smiles, $npc[&quot;like mine often enjoy the domain of Vorn.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;House Vorn is for any who enjoy the physical. It is divided into the Indulgent Ones, who prize romance, emotions, and physical touch, and the Vibrant Ones who prize strength, showmanship, dramatism and pain.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[$npc[&quot;Those in House Vorn are often outgoing or emotional, enjoying love, hate, joy and sorrow to a deeper degree than their peers. Even when reserved, they tend to enjoy the sheer sensation of *feeling*, physical and emotional, and tend to possess a charisma that they may not always recognise.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;Their familiar is the sletcher, a beast who relies solely on sound, scent, and touch to navigate as it has no eyes.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="65" name="viviria" tags="" position="2998,888" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/Pv3SC2b.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;House Viviria.&quot;] Velvadius leans forwards, rotating the crest in his hand to reveal a floral design with a greenish stone in the centre.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;House Viviria is the House of Life, ruled by the Mothertoad - a monstrous mephitoad experiment gone wrong that grows and envelops any creature it can. Those who enjoy life and growth often align with this House.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Those in House Viviria are often gardeners, beastkeepers, or those interested in true immortality. They are quite aligned with nature.&quot;] Velvadius nods to a small potted plant in the corner of the room.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The House is divided into two sects - the Verdant Ones, who focus on the wonder of life and often appear somewhat like druids or mystics in tune with nature, and the Hungry Ones, who focus on the spread and growth of life.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;While the Verdant Ones may give splendid advice on caring for your slumpkins or how to best ensure you bear healthy offspring, a Hungry One might be the type to hold you down and force you to join some grotesque hive as food or the hive&#39;s newest (if: $pussy is true)[mother](else:)[father].&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Those in House Viviria are often bright-eyed individuals - or collectives - and tend to enjoy connecting to others. Despite that, some of them can be quite reclusive and solitary. They often are strong leaders, and frequently have strong empathy for wild creatures.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[$npc[&quot;Their familiar is the mephitoad, which as I&#39;m sure you&#39;re aware,&quot;] Velvadius smiles, $npc[&quot;is a hermaphroditic creature that can live nearly anywhere and reproduce with ease.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="66" name="umbrasia" tags="" position="2941,775" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/Scedn9h.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;House Umbrasia.&quot;] Velvadius leans back in his chair, turning the crest to reveal a triangular glyph above a crescent moon, the smoky gem in its centre fashioned to look like the pupil of a weeping eye.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;House Umbrasia,&quot;] Velvadius says thoughtfully, $npc[&quot;is the House of Death, ruled by Illa Phasmere. Those who prize silence, the passage of time, justice, or death in general often are drawn to this House.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[$npc[&quot;Those who move in House Umbrasia tend to belong to one of two sects, being the Languid Ones or the Restless Ones. The Restless Ones are driven by justice and a sense of outgoing vengeance. They enact retribution on those who killed them or others.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The Languid Ones focus more on healing and quietly making right the general wrongs of others. Almost all who find themselves in House Umbrasia are relatively self-sufficient,&quot;] Velvadius notes.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[$npc[&quot;Those in House Umbrasia are often quiet and introverted, though it has its fair share of extroverts as well. They make good listeners and confidants, and often understand the innate sadness of living, for it must always pair with death.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[$npc[&quot;The familiar of House Umbrasia is the squall, a great and raptorial beast with hollow eyes whose cry is known for vanquishing one&#39;s fear of death.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="67" name="morphoria" tags="" position="3055,777" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;House Morphoria.&quot;] Velvadius nods and begins to turn the crest towards you, when suddenly Maji leaps up and snatches it from his hands.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Maji can do! Maji knows ***lots*** about Morphoria!&quot;] the kobold beams. You look down at him as his ears flop and he gives a snaggletoothed smile up at you. He shows you the crest, bearing two snakes biting their own tails around a purple stone.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/N9b5TjW.png&quot;&gt;&lt;/center&gt;](enchant: ?rb&#39;s chars, via (text-color:(hsl: pos * 40-120, 1, 0.5)))

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[$npc[&quot;Houuuuuuse |rb&gt;[(text-style: &quot;smear&quot;)[Morphoria]]! Morphoria is the house of *change*! The big ruler is Pnura who&#39;s *really* changey,&quot;] Maji declares. $npc[&quot;Pnura can be anyone. Even you. People who like Morphoria like change, and chaos, and chance, and all the C words.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Sometimes, they&#39;re jesters. Sometimes, they&#39;re gamblers. Sometimes, they&#39;re just crazy. Maji is pretty sure they all have *huge* dic-&quot;] Velvadius smacks Maji&#39;s head lightly. The outsider huffs, then grumblingly moves on.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;The House is split between the Mutable Ones and the Erratic Ones! The Mutable Ones twist fate and luck and also people. They&#39;re really open-minded and love connecting people!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The Erratic Ones though, they go with the flow and let what happens happen. Maji is a Mutable One, *they&#39;re the best*, that&#39;s a Maji guarantee!&quot;] (if: $charmed is true)[You find yourself nodding in agreement.]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;The familiar for House Morphoria iiiiis, tada!&quot;] Maji pulls a small, eyeless black snake with white insides out from one of the sleeves of his robe. A sudden, illusory puff of |rb&gt;[(text-style: &quot;smear&quot;)[sparkles]] erupt around him as a ghostly fanfare sounds out. $npc[&quot;The orolisk!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[$npc[&quot;The orolisk is a snake thing that looks kinda like Pnura but also not since Pnura can be anything. They change into stuff and then when people try to use it, poof! They turn *them* into the object forever. Whoops!&quot;] Maji grins, letting the orolisk slither across him. Before your eyes, it turns into a teacup, which Maji sets down with a scowl.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;People in Morphoria are kinda playful and energetic, but can be really go-with-the-flow, too. They have good humour, and don&#39;t mind helping out.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="68" name="omnillian" tags="" position="3108,887" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/WtUT4Zp.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;House Omnillian is the House of control, ruled by Quin Aven. Those who seek stability, knowledge, or predictability congregate around this House.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[$npc[&quot;Those of House Omnillian belong to one of two sects, of course, those being the Inspired Ones, or the Masterful Ones. Of those two, the Inspired Ones focus on creation and innovation - of spells, artifacts, or anything, really. They tend to be open-minded and quietly industrious.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The Masterful Ones tend to focus on cataloguing, collecting, and problem-solving. They are often perfectionists, and the sect is home to some of the most artisanal lateral thinkers.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The House doesn&#39;t have a familiar in quite the same way that the other Houses do, but House Omnillian is known for its *spooks*: little mechanical birds that meticulously observe anyone around them.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Those in House Omnillian tend to be creative, focused when they want to be, and frequently brilliant in ways they often don&#39;t recognise. They can seem cold and unapproachable at times, but often harbour deep feelings of care for those close to them.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="69" name="byle" tags="" position="3165,776" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/ps4CoNZ.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;The Cult of Byle,&quot;] he says. $npc[&quot;Byle is... a cult of filth and base indulgence. Those who crave increasingly depraved experiences often find home in Byle, but so too do those who enjoy shocking or disgusting others.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Not much is known about the cult&#39;s inner workings save that Orpus Byle, the oggorus after whom it is named, has a slime that is potently addictive and deeply corruptive.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Those who join Byle sometimes begin with a desire to indulge in milder things such as watersports, grime, or musk - but those who make their way to Byle&#39;s inner circles allegedly inevitably taste his slime. From there, the *itch* for worse and worse only grows.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Still, those in Byle are sometimes softer spoken, choosing not to advertise their proclivities. They push the frontiers of indulgence, finding deeper and more intense ways to experience fetish and indulgence, and are often very open and exploratory individuals.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="70" name="threesome" tags="" position="3563,705" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[Velvadius smiles.](set: $timer to 2000) (after: $timer, 200)[=(set: $timer to 2000)$tsn[Maji smiles.] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;(text-colour: green)[**Very**,]&quot;] Velvadius breathes huskily.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[In only moments, the dashing lehlt moves and has you in his arms, groping at your ass as he pushes you against one of the soft walls. (if: $clothed is true)[He tears your clothes back off your body, throwing them to the floor as his hands lift your legs up and wrap them around his waist.](else:)[With your frame still naked, there&#39;s nothing to stop him from lifting your legs up and wrapping them around his waist.]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[His breath is hot, and his gaze is intense as his fingers squeeze your cheeks and spread your bare ass.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Velvadius growls out a soft, $npc[&quot;Maji,&quot;] before the outsider moves to open a door. You find yourself being carried through it as Velvadius grinds the monstrous, plump swell of his sheath against your ass$pussy[ and cunt].]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[You find yourself in a more dwelling-like set of chambers, and Velvadius wastes no time in laying you down on a chitinous table. Your legs go up and over his shoulders as he shoves his slowly stiffening cock against your ass a little harder.]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[His breath comes heavily, and you can *smell* the (text-style: &quot;smear&quot;)[scents] of the lehlt&#39;s past encounters.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You look up at Velvadius to see the lehlt with a mask of *need* on his face. You don&#39;t think it&#39;s need for *you*, just raw...] (after: time + $timer, 200)[=(set: $timer to 1500)$tsn[pure...] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[***need***.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Before you can say anything, you feel two small, scaly hands grip your face.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[As Velvadius pulls back and then pushes his hips forwards, a sizeable ***weight*** smacking against your (if: $dick is false)[cunt](else:)[own thickening cock], you feel your head being tipped backwards.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You come face-to-crown with the fat, blunt swell of a jet black, pulsating slab of cock.] (after: time + $timer, 200)[=(set: $timer to 4000)$tsn[It *throbs* once, spurting a little dollop of musky, gooey precum that just gently kisses your chin.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;Shh,&quot;] Maji whispers as you see the fat swell of his scaly sack hanging between his legs, looking frightfully oversized for his small body.] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;It just wants a kiss.&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; Gulp.-&gt;threesome2]]]</tw-passagedata><tw-passagedata pid="71" name="end4" tags="" position="3333,1199" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You stand up and give a little bow to Maji and Velvadius.](set: $timer to 3000)

(after: $timer, 200)[=(set: $timer to 7000)$tsn[After having experienced all that you desire in the Compass House, you decide that it&#39;s time to make your way out. (if: $charmed is true)[You feel a little sad to leave your bestest friend behind, but something in the back of your mind says that your feelings for him will fade with a little time.](else:)[You think it will be good to be back out among the City streets again, especially now that you have a better idea of the Houses.]]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[(unless: $clothed is true)[You gather up your clothing so that you can put it back on later. ]Then, with one last look around the Compass House, you make your way to the door.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Byyyeee friend!&quot;] you hear Maji call out from behind you. You turn just in time to see Velvadius giving the outsider a solid smack. Maji pouts and crosses his arms as you open the toothy door.]

(after: time + $timer, 200)[=(set: $timer to 5500)$tsn[$npc[&quot;Honestly, Maji,&quot;] Velvadius says. $npc[&quot;If you weren&#39;t a one-person adoration army, I&#39;d tell you to find your own place. I&#39;m not even sure how you do it, since it isn&#39;t exactly envy.&quot;]
Maji grins up at Velvadius.
$npc[&quot;Maji keeps Velvadius looking gooood!&quot;]
$npc[&quot;(text-colour: green)[**Somehow.**]&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[Velvadius sighs, then rubs the kobold&#39;s head. The pair of them stand there and wave to you as you make your way out into the street, (unless: $clothed is true)[stark naked(if: $genderTF is true)[ and proudly displaying your new assets], ]setting out towards your next destination.]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="72" name="psilysium" tags="" position="3218,889" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about one of the other crests. Velvadius nods, then fishes the crest in question out from the box.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/3v1WzDg.png&quot;&gt;&lt;/center&gt;](set: $timer to 4000)

(after: $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;House Psilysium.&quot;] Velvadius arches his eyebrows, then reveals that the crest&#39;s other face bears an image of a many-eyed mouth swallowing a teal stone.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[$npc[&quot;House Psilysium is the House of Mind, ruled by Filo Rooke. Those who enjoy thinking, or altering or exploring the mind often find themselves drawn to this House.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Members of House Psilysium are often captivated by puzzles, drugs, and mind-affecting spells and creatures. They are dreamers, prophets, philosophers and psychonauts of varying degrees.&quot;] Velvadius thinks for a moment, before offering a smile.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;The House is divided into the Lucid Ones, who focus on seeking knowledge and understanding through thought, logic, or copious amounts of drugs - depending on who you ask, and the Vexed Ones, who focus on manipulating the consciousness of themselves or others.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;A Lucid One might yield captivating conversation, while a Vexed One may hypnotise you until your brain is a happy puddle pouring out of your (if: $pussy is true)[cunt](else:)[cock]. They take all kinds, really.&quot;] Velvadius chuckles, waving a hand.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Those of House Psilysium are often curious and inquisitive and bear a keen desire to *know*. They may be reserved or even cynical at times, but that tends to stem from the sheer breadth and care of thought they&#39;ve given to themselves and their world.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;Their familiar is the queril, a highly curious and mischievous bird with a pollen-like dust in its feathers that has hallucinogenic effects.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Then Velvadius sets the crest back into the box and looks at you again. $npc[&quot;Is there anything else you would like to ask?&quot;]]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
(unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="73" name="minorcults" tags="" position="2875,1122" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You ask about any other cults that Velvadius or Maji know of. The lehlt&#39;s eyes glint, and he opens another compartment in the box with a soft click.](set: $timer to 5000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;(text-colour: green)[**As a matter of fact,**]&quot;] the lehlt says smugly. $npc[&quot;I do.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Setting four crests down upon the lid of the box, Velvadius shows off crests quite distinct from those of the six Houses or the more established cult of Byle.

&lt;center&gt;&lt;img src=&quot;https://i.imgur.com/lTxXgvA.png&quot; width=&quot;25%&quot;&gt;&lt;img src=&quot;https://i.imgur.com/O35YPZZ.png&quot; width=&quot;25%&quot;&gt;&lt;img src=&quot;https://i.imgur.com/C2ZEQd6.png&quot; width=&quot;25%&quot;&gt;&lt;img src=&quot;https://i.imgur.com/TxoEVEP.png&quot; width=&quot;25%&quot;&gt;&lt;/center&gt;]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Velvadius points to the first, with the orange stone.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Gorgharia, the cult of Hunger,&quot;] he begins. $npc[&quot;Those who belong to this cult find satisfaction not merely in consuming, but in the purity of (text-colour: green)[**feeding**]. Those in Gorgharia often have an oral fixation, and some grow to be quite rotund.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;It is led by a kruggorus, though I don&#39;t know any more beyond that. Despite common presumptions, those who do the eating aren&#39;t always in control - and sometimes those whose greatest desire is to be themselves consumed are quite forceful.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;The cult is divided generally into those who wish to eat, and those who wish to feed themselves or others. Don&#39;t be misled, though,&quot;] Velvadius chuckles, $npc[&quot;often that being consumed (text-colour: green)[**is**] just food - albeit I hear it can be quite delicious food.&quot;]]



(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Velvadius points to the second crest, with a clear blue stone.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[$npc[&quot;Quelsh, the cult of Serenity. Those who seek cleanliness, abstinence, moderation or peace - all those things antithetical to our good City - are sometimes drawn towards the pristine and modest headquarters of Quelsh.&quot;] He nods gravely, as though speaking of a terrible danger.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Members of the cult of Quelsh support one another to forego the indulgent urges of the Council, and to endure the inevitable punishments that follow. The cult is lead by a rather neurotic nurk who is also probably the cleanest rodent in the City.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Quelsh is not against drugs or sex or general indulgence, by the way, they simply advocate (text-colour: green)[**moderation**] and (text-colour: green)[**consent**].&quot;]] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Velvadius shudders.]



(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Velvadius points to the third crest, then, with a pale yellow stone.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[$npc[&quot;Amyrnum, the cult of Aesthetic,&quot;] he muses. $npc[&quot;Those who value art, music, poetry, or simply the beauty in things may find themselves lured in by the grace of Amyrnum. It is of (text-colour: green)[**course**] led by a rather stern, silver lehlt who is, even I must grudgingly admit, more resplendent than yours truly.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;They are sometimes criticised for their shallowness, with members needing to meet a certain level of beauty to be granted admission - and being barred if something should disfigure them until they&#39;ve had the blemishes... (text-colour: green)[**corrected**].&quot;]]



(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Velvadius finally points to the last of the crests with an inky, black stone.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;This one has no formal name, I&#39;m afraid. Most I&#39;ve spoken with simply call it the cult of the Nameless, because that is what all of its members insist they are: nameless.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Members are invariably recognised by their black, latex appearance. As near as anyone can tell, most of them (text-colour: green)[**are**] in fact (text-colour: green)[**made**] from various forms of rubber, or transformed into it upon entering the cult&#39;s headquarters and casting off their identity.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;It is said that they employ a number of specialised spells, some of which influence the mind to help negate one&#39;s sense of identity. Upon leaving the cult&#39;s headquarters, it is believed that most &#39;take off&#39; their nameless form and return to normal, letting members lead (text-colour: green)[**seemingly**] normal lives otherwise.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[$npc[&quot;Those who crave rubber, belonging, conformity, or to be treated as one of many often hear the siren song of the cult of the Nameless. While no one knows who leads it, rumours (text-colour: green)[**abound**] should one seek them out.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Suddenly, Maji chimes up from the background. $npc[&quot;Maji hears that some people in it aren&#39;t rubber (text-colour: green)[**all**] the time, just when kinda &#39;on duty&#39;! Like employees!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 0500)$tsn[Velvadius sighs. $npc[&quot;Thank you, Maj--&quot;]]
(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;You&#39;re welcome!&quot;]]



(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[After giving you a few more moments to look at the crests, Velvadius collects the set and places them carefully back into the box.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Unfortunately, these cults aren&#39;t quite as well-recognised yet as Byle or the six Houses, so we have not incorporated them into our... process. I trust you understand,&quot;] Velvadius smiles diplomatically.]

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
](unless: $threesome is true)[(if: $charmed is true or $eagerFuck &gt; 1)[[[&gt; Ask if Velvadius was serious about a little worship...-&gt;threesome]]
]][[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="74" name="threesome2" tags="" position="3623,818" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You open your mouth to let the outsider&#39;s fat, equine cock squash past your lips. At the same time as you feel that plush, warm, slimy heat sinking into your jaws, you feel Velvadius&#39; hands on your thighs helping to spread them just a little bit.](set: $timer to 8000) 

(after: $timer, 200)[=(set: $timer to 7000)$tsn[You give a soft whimper as he lines his fat slab of lehlt cock up with your plush ass, grinding the fat crown against your sphincter. Without further ceremony, he starts to *push* his cock against you with the clear intent of fitting it inside.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Does Maji need to... loosen them with Gloam?&quot;] the kobold groans as he feels your first soft, testing suckle of his cock. He tastes bitter and warm, and as his fat slab pulses, you feel the first gooey dollop of precum pour into your cheeks.]

(after: time + $timer, 200)[=(unless: $breasts is true)[(set: $timer to 0)](else:)[(set: $timer to 7000)$tsn[As the kobold asks, he slides his hands forwards along your body before taking handfuls of your breasts. You feel him give your nipples soft, exploratory tweaks, before starting to *grope* them as he lets his cock explore your mouth.]

](after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Velvadius pulls back, letting your protesting ring of muscle relax for a moment, before he simply utters out the word $npc[&quot;No,&quot;] and (text-style: &quot;sway&quot;)[shoves] his hips forwards a few inches.]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[Your eyes bulge underneath Maji&#39;s cock as Velvadius&#39; bottle-thick crown somehow squashes into your ass, stretching you out eye-wateringly wide$breasts[ as Maji squeezes and fondles your heavy mounds].]

(after: time + $timer, 200)[=(set: $timer to 1500)$tsn[In,] (after: time + $timer, 200)[=(set: $timer to 2500)$tsn[and out.] (after: time + $timer, 200)[=(set: $timer to 1500)$tsn[In,] (after: time + $timer, 200)[=(set: $timer to 2500)$tsn[and out...]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Maji&#39;s slimy cock starts to fuck your face as the throb of Velvadius&#39; cock leaves your poor ass aching. You don&#39;t have long to wait though before the lehlt&#39;s fingers (if: $dick is true)[wrap themselves around your own cock, giving it a tight *squeeze*$pussy[ as one thumb finds your cleft further down].](else:)[find the $genderTF[new ] folds of your pussy, spreading them open and starting to rub at your exposed clit.]]

(after: time + $timer, 200)[=(if: $genderTF is false)[(set: $timer to 0)](else:)[(set: $timer to 9000)$tsn[$npc[&quot;Their body is just a little (text-colour: green)[**tense**] with this new equipment... But mmph. It&#39;s quite the improvement, don&#39;t you think?&quot;] Velvadius&#39; voice sounds amused, but you can&#39;t quite tell - from your vantage point with Maji&#39;s cock working its way towards the back of your throat, all you can see is the kobold&#39;s hefty, swinging sack.]]

(after: time + $timer, 200)[=(if: $genderTF is false)[(set: $timer to 0)](else:)[(set: $timer to 7500)$tsn[$npc[&quot;You&#39;ve only explored yourself within the spell, dear patron,&quot;] Velvadius croons as his fat cock throbs inside your ass. $npc[&quot;But fear not. Maji and I are going to make sure that you are (text-colour: green)[**intimately**] acquainted with your new anatomy in the real world.&quot;]]]

(after: time + $timer, 200)[=(set: $timer to 9500)$tsn[With Velvadius&#39; cock squashing its way inside your guts, stretching your poor ring to an obscene (text-style: &quot;outline&quot;)[O] shape, Maji sets into his own rhythm as Velvadius starts to $dick[jerk your helplessly hardening cock off$pussy[ and (set: $timer to it + 2000)]]$pussy[plunge two, thick fingers in and out of your quivering snatch].]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[With your legs around the lehlt&#39;s shoulders, there&#39;s nothing you can do to resist the mounting$genderTF[, alien] pleasure but moan into Maji&#39;s cock. The outsider stuffs inch after inch in and out of your face, spurting and slathering your tongue with goopy precum.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Hump by hump, you can feel Velvadius&#39; cock forcing its way deeper into your guts. Your brain can barely process how enormously *fat* the dick stretching you out feels. Every time his cock twitches, you feel like your guts are being straightened out around it.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[$npc[&quot;Aaah, by the City&#39;s eyes, you feel...]] (after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[...fucking (text-colour: green)[**perfect**],&quot;] Velvadius moans, the wet and sloppy sounds of flesh squishing through flesh starting to fill the air.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Maji&#39;s balls swing and sway before your face, and you can feel yourself starting to *drool* both from your lips and (if: $dick is true and $pussy is true)[both ]$pussy[around Velvadius&#39; fingers$dick[ and ]]$dick[your engorged cocktip in the lehlt&#39;s squeezing grip].]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[The bitter, salty taste of Maji&#39;s precum floods your mouth, his blunt flare thickening and shrinking threateningly every few thrusts. You can feel a gooey warmth in your ass each time Velvadius&#39; mammoth cock pulses$dick[ and squashes your prostate]. You feel like he&#39;s starting to shove into your *stomach*. $breasts[(set: $timer to it + 2000)Maji&#39;s hands don&#39;t leave your breasts alone, and you can feel your eyes starting to roll back in pleasure.]]

(after: time + $timer, 200)[=(set: $timer to 8500)$tsn[Maji hisses something soft out and uses one hand to rub at your belly, the blunt flare of his dick finally starting to knock and squash against the back of your throat. You nearly gag around it, but with only a few, forceful *humps*, you know that it&#39;s ***going*** to fit down your neck.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You feel a strange tingling in your belly as Maji spreads his legs, his tail curling forwards to help him really *buck* into your mouth.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Velvadius groans out as his obscene, heavy sack finally starts to pull a little tighter. $npc[&quot;Aah... dear p-patron... I&#39;m going to cum,&quot;] he moans. $npc[&quot;Such a lucky fuck you are... Getting to feel a lehlt of my stature-- mmn-- (text-colour: green)[**fill**] you...&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; *Mmmh!*-&gt;threesome2.5]]]</tw-passagedata><tw-passagedata pid="75" name="threesome3" tags="" position="3668,933" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[By the time Maji&#39;s flare has shrunk enough to pull back out from your throat, you&#39;re nearly passing out from lack of air. Velvadius&#39; equipment seems to have a similar design to it, but it takes *him* nearly five whole chimes before he can withdraw his fat, drooling cock from your ass.](set: $timer to 9000) 

(after: $timer, 200)[=(set: $timer to 10000)$tsn[In short order you&#39;re simply laying there, gasping for air, staring dazedly at Maji&#39;s dick as he leaves the black-fleshed beast resting against your face. You can feel a slow gush of sticky cum pouring back out from your gaped, unclosing ass, while Velvadius uses one hand to (if: $dick is true)[keep jerking you off idly](else:)[continue fingering your quivering cunt]$genderTF[, as if refusing to give your new equipment a break - intent on constantly reminding you of your new assets(set: $timer to it + 3000)].]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Eventually, he lets out a heavy breath.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Mmh. Time for a position swap,&quot;] he declares simply. You see Maji&#39;s tail immediately start to wag behind him.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[Hazily you manage to croak out the question of what he means. Velvadius just laughs lightly, as if you&#39;re patently endearing.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[$npc[&quot;Oh, dear patron mine,&quot;] he chortles. (if: $genderTF is true)[(set: $timer to it + 3000)$npc[&quot;You didn&#39;t think you were getting out of this without $dick[Maji taking a ride on your new cock, did you?]$pussy[feeling my cock painting the back of your new womb, did you?]]](else:)[(set: $timer to it + 7000)$npc[&quot;With equipment like my dear assistant and I have, you didn&#39;t think you were getting out of this with only (text-colour: green)[**one round**] did you? Besides,&quot;] the lehlt adds nonchalantly. $npc[&quot;$pussy[I&#39;m still having a round on your gorgeous little cunt$dick[, and ]]$dick[Maji won&#39;t be satisfied until he&#39;s good and done with your cock].&quot;]]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Velvadius stands up, looking down at you with a distinctly *predatory* gaze. $npc[(if: $genderTF is true)[&quot;By the time we&#39;re done with you, my dear patron, you&#39;ll have practically (text-colour: green)[**forgotten**] what it was even (text-colour: green)[**like**] to have a $pussy[dick]$dick[cunt].&quot;](else:)[&quot;By the time we&#39;re done with you, my dear patron, you&#39;ll barely be able to (text-colour: green)[**walk**].&quot;]]]

(after: time + $timer, 200)[=$tsn[[[&gt; Get fucked.-&gt;threesome4]]]</tw-passagedata><tw-passagedata pid="76" name="threesome4" tags="" position="3712,1042" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[You&#39;re flipped around on the table and summarily screwed over the edge of it, Velvadius reaming your ass doggy-style this time as Maji takes a few chimes to set some things up.](set: $timer to 6000) 

(after: $timer, 200)[=(set: $timer to 5000)$tsn[By the time Velvadius is pumping your guts full of gooey spunk again, the kobold is done, and you&#39;re picked up and held to Velvadius&#39; chest.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You&#39;re hauled across to a bedroom and fucked against a cabinet, being bounced against the lehlt&#39;s crotch for what feels like half a bell before he eventually climaxes for the third time of the evening, making a sticky mess of your insides.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Maji buries his snout between your legs and worships you with his mouth. (if: $dick is true and $pussy is true)[(set: $timer to it + 7500)He alternates between taking your cock into his mouth and slurping noisily on your dick, dragging his plush and slimy tongue across every available inch, and shoving his snout further down to start exploring your cunt with his tongue.](else-if: $dick is true)[(set: $timer to it + 6500)He spends his time taking your cock into his mouth and slurping noisily on your dick, dragging his plush and slimy tongue across every available inch of your sensitive flesh.$genderTF[(set: $timer to it + 10000) The sensation is overwhelming and strange, and you feel your mind blanking out as Maji pleasures your new organ while Velvadius tenderizes your prostate. With the sensations still so new and overwhelming, you quickly feel yourself thump into a tight knot of pleasure as your new cock starts pumping heavy gouts of cum down the kobold&#39;s throat.]](else:)[(set: $timer to it + 5000)He spends his time with his muzzle directly against your sopping snatch, dragging his tongue up and down your sensitive folds until he&#39;s satisfied with your desperate cries.$genderTF[(set: $timer to it + 8500) You feel so slippery and warm and wet on the *inside*, and with Velvadius&#39; cock buried in your ass so deeply, you&#39;re helpless to stop yourself as Maji&#39;s licking sends your new cunt into another wracking, gushing orgasm that leaves you cross-eyed.]]]

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[You feel Maji tugging at your body, and Velvadius walks you back to the main room, still impaled on his dick. (if: $dick is true)[(set: $timer to it + 5000)Velvadius lays down underneath you as Maji climbs on top and turns around, and in only a few moments you feel the kobold straddling your cock. $genderTF[(set: $timer to it + 2500)You have only a few moments to process the realisation that you&#39;re about to be *inside* someone before Maji starts to sit down. ](set: $timer to it + 8500)The kobold&#39;s body sinks slowly down onto your dick, enveloping your stiff flesh in tight warmth - and in only moments, you&#39;re howling his and Velvadius&#39; names as you&#39;re ridden and fucked until you cum hard$genderTF[ again, this time] inside the kobold&#39;s ass.](else:)[(set: $timer to it + 13000)Velvadius lays down underneath you and then slowly pulls out from your abused ass, before spinning you around onto your stomach. You lay chest to chest with him for a moment, before you feel Maji climb onto your back.
$npc[&quot;Let&#39;s put that cunt of yours to use$genderTF[ for real],&quot;] Velvadius whispers, before you feel Maji&#39;s fat flare squash up against your gaping ass. At the same time, the lehlt pushes his sloppy dick to your pussy, before giving you a deviant smile. $genderTF[(set: $timer to it + 5000)You&#39;re given only moments to process that you&#39;re about to be fucked in two holes at once, knowing there&#39;s no way out. Knowing you&#39;re going to lose control.]
(set: $timer to it + 7000)Velvadius and Maji both push into your holes at the same time. They alternate between fucking you slowly and roughly, and by the time you feel the lehlt losing control in the depths of your cunt, you&#39;re a quivering wreck with another three orgasms under your belt.]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[At some point, you&#39;re tipped upside down and held by the legs with Velvadius tonguefucking you sloppily as Maji lays beneath you, feeding his cock into your mouth every time the lehlt lowers you down.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You&#39;re fucked in more ways than you can count, in more positions than you can recall.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Eventually, after a dizzying and gut-wrenching ride on both Velvadius&#39; and Maji&#39;s cocks at the same time, both the mammoth dicks plugging up your broken, abused ass simultaneously, you fall face-first into the lehlt&#39;s bed.]

(after: time + $timer, 200)[=$tsn[[[&gt; Pass out-&gt;threesome5]]]</tw-passagedata><tw-passagedata pid="77" name="threesome5" tags="" position="3749,1154" size="100,100">(text-colour: #02d987)[####The Compass House]
$tsn[Some time later, you groggily awaken to find Velvadius&#39; arms wrapped sleepily around you.](set: $timer to 3500) 

(after: $timer, 200)[=(set: $timer to 3000)$tsn[Your everything hurts. Especially your ass.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[It takes you a few moments to realise that Velvadius&#39; cock is still wedged in your ass.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[Half a bell later, you&#39;re sitting back in the main room of the Compass House, cradling a cup of some cinderbean-based drink Maji brewed and with a towel underneath you to soak up some of the constant stream of mixed cum oozing from your hole$pussy[s].]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;My,&quot;] Velvadius croons, wrapping his robe around himself again.] (after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;You have my compliments, dear patron. You took my cock like an (text-colour: green)[**artisan**],&quot;] the lehlt smiles, satisfied.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Maji nods twice, sitting on a nearby stool with his legs dangling over the edge. He grins at you and pats the bulge in his robe. $npc[&quot;Welcome back (text-colour: green)[**aaaany**] time,&quot;] he declares proudly.]

(after: time + $timer, 200)[=(set: $timer to 8500)$tsn[Velvadius smirks, then nods his agreement. $npc[&quot;Indeed, hmmhm. But now,&quot;] the lehlt murmurs. $npc[&quot;With my needs out of the way, we (text-colour: green)[**were**] in the middle of something. Did you have any other questions before you made your way onwards again, hmm?&quot;]]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Velvadius looks at you plainly.](set: $threesome to true)

(after: time + $timer, 200)[=$tsn[(unless: $vornwin is true)[[[&gt; Tell me about House Vorn?-&gt;vorn]]
](else:)[[[&gt; Tell me about House Vorn again?-&gt;vorn]]
](unless: $psiwin is true)[[[&gt; Tell me about House Psilysium?-&gt;psilysium]]
](else:)[[[&gt; Tell me about House Psilysium again?-&gt;psilysium]]
](unless: $vivwin is true)[[[&gt; Tell me about House Viviria?-&gt;viviria]]
](else:)[[[&gt; Tell me about House Viviria again?-&gt;viviria]]
](unless: $umbrawin is true)[[[&gt; Tell me about House Umbrasia?-&gt;umbrasia]]
](else:)[[[&gt; Tell me about House Umbrasia again?-&gt;umbrasia]]
](unless: $morphwin is true)[[[&gt; Tell me about House Morphoria?-&gt;morphoria]]
](else:)[[[&gt; Tell me about House Morphoria again?-&gt;morphoria]]
](unless: $omnwin is true)[[[&gt; Tell me about House Omnillian?-&gt;omnillian]]
](else:)[[[&gt; Tell me about House Omnillian again?-&gt;omnillian]]
](unless: $bylewin is true)[[[&gt; Tell me about the Cult of Byle?-&gt;byle]]
](else:)[[[&gt; Tell me about the Cult of Byle again?-&gt;byle]]
][[&gt; Ask if there are any other Cults that Valvadius knows of-&gt;minorcults]]
[[&gt; Depart the Compass House-&gt;end4]]]</tw-passagedata><tw-passagedata pid="78" name="petEndViv" tags="" position="3910,634" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[The shadowy figure in the doorway shrinks down, resolving itself to be a... *nurk.*]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[A lowly little creature, barely three feet tall, doing its very best to look firm. You can see a pair of ruby-red eyes, one of which appears to be larger than the other, each focusing down on you.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[An obscenely hefty, warty package rests between the nurks legs, and you can see his oily dick already poking out with excitement.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Both the little creature&#39;s arms reach forward, and you feel your head being gripped. Your restraints bring your head to the perfect height for the nurk to inspect you as his dirty fingers dig into your jaws, spreading them as wide as your bridle allows.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Mmmm. Teeth look (text-colour: green)[**okay**]. Okay. Good, good. Tongue has nice colour. Nice colour. Yes. Mmmm. And no diseases! Perfect!&quot;] the little nurk gibbers excitedly, tilting your head to and fro.]

(after: time + $timer, 200)[=(set: $timer to 9500)$tsn[$npc[&quot;Yes yes, you will do good. Make good breeder,&quot;] The creature declares. You feel like objecting, but only bestial noises and muffled sounds manage to pass through the bridle. Your saliva splatters along the floor as you try to speak, unable to swallow properly around the bridle. You see the nurk tilt their entire body as he (text-style: &quot;expand&quot;)[peeks] beneath your legs.]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[$npc[&quot;Yes. I am Scritchy Handlescratch. Yes yes. Youll be coming with me. Since I paid for you last phase, Scritchy assumes youve been informed, yes? Good good. You will make a good pet, yes you will. Scritchy can tell. Lets mark you properly, yes?&quot;] The eager tones come out in a stream.]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[You feel your head being pushed down until your chin presses against the grimy floor beneath you, before thick, plush orbs come to rest on your face. The (text-style: &quot;smear&quot;, &quot;buoy&quot;)[scent] hits you like a stone wall, and you rapidly feel light headed from the warm, sweaty sack being squashed to and fro against your nose.] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[A heated weight presses down on your snout, and you go cross-eyed to see Scritchys cock rubbing between your eyes and leaving a wet trail on your head. Happily, he starts thrusting and grinding.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[In barely even seventeen ticks, you feel the nurk tense up as rope after rope of watery nurk cum suddenly washes across your face. His hefty balls **churn**, and you quickly find that what the creature lacks in size he apparently makes up for by being excessively **voluminous**.]

(after: time + $timer, 200)[=(set: $timer to 8500)$tsn[His hands clutch the sides of your face, and you feel the ropes of spunk painting you like a roadmap. Suddenly you feel him pull back before the thin, finger-thick cock is jabbed against your nostril and you feel the watery spunk begin to pump into your sinus.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You try to recoil, but his grip on you is surprisingly strong. You&#39;re forced to lay in place as he plants his scent as deep as he possibly can. Finishing up with one nostril in mere ticks, you feel your other nostril equally ravaged before he finishes up by ensuring that your bridled muzzle catches a mouthful of spunk to acquaint your tastebuds with your new owners taste as well.] 

(after: time + $timer, 200)[=$tsn[[[&gt; Swallow-&gt;petEndViv2]]]</tw-passagedata><tw-passagedata pid="79" name="petEndVorn" tags="" position="3967,531" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The figure resolves itself into a long, slender creature that strides towards you, elegant and measured steps bringing them closer.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[A large, almost caprine being peers down at you, and you can see a smirk building on their features. *A lehlt*, you realise. Their haughty demeanour is unmistakable, and the beautiful mane flows down their well-toned body, their horns perfectly accentuating their head as if wearing a natural crown.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[The red gems you can see studded on their sharp, black vulturewear indicates this lehlt to be a mage of House Vorn, if the piercings digging into their nipples and stomach and being held stretched to their own back by black leather straps was not enough to clue you in. (text-style: &quot;smear&quot;)[What have you gotten yourself into?]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[You try to move once more, as if to fight the bonds that keep your legs spread, but with your limbs all angled outwards and your neck held so low to the ground, it&#39;s almost impossible for you to build any leverage to escape.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[$npc[&quot;Hmmm... A bit on the smaller side, but I (text-colour: red)[suppose] I can work with you. I paid a large sum of Gloam for you after they caught you last phase, so youll behave for me, wont you?&quot;] the lehlt asks, and you have the distinct feeling that you are being appraised. *And found wanting*, at that.] 

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;We will have to improve you, of course. Youll be a wonderful piece of art, though. My prized sletcher has been looking for a new partner, and we need you to look the part.&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; What?-&gt;petEndVorn2]]]</tw-passagedata><tw-passagedata pid="80" name="petEndPsi" tags="" position="4177,530" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[The figure resolves itself into a towering, avian creature. A shade of blue-green meets you as curious, inquisitive eyes peer down at you from above. A scrutinising and appraising look envelops your form.]

(after: time + $timer, 200)[=(set: $timer to 13000)$tsn[The wattle hanging under their beak is both thick and impressive, green-dark bulbs blending somewhat with their already dark and feathery coat. With jerking motions, they tilt their head from side to side as if to capture you in more angles, before *leaning* in and placing their head so close to yours that those piercing eyes are only a fraction of an inch apart from your own.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;MMMmmm... Is it intelligent?&quot;] comes the first question out of the bird&#39;s beak. Sharp fangs line the inside of their beak and you see a thick, fan-tipped and trunk-like tail whip behind them as they reach forward to pat your back reassuringly.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Yes. That is a good little creature. Yes. Very good. Good little creature you are, arent you?&quot;]] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Their voice is cooing, the raspy sound carrying an uplifting, excited lilt. Rubbing a taloned hand along your face, you feel the tough appendage then move to caress your neck.]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[They seem to test your hide, as if trying to see how much strength they can exert before scratching you. Their curious expression never ceases for a moment as they slowly explore you, treating you like the most captivating of possessions.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;But we will have to make you shiny, much more so, yes. We cant have it look so sullen. Mmmm.&quot;] They look thoughtful.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;What colours to choose? So many colours. Gold? Yes.]] (after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[...No. Too gaudy. No. Mmmmm. Silver? Maybe. Definitively around the eyes. Maybe down the neck? It needs to be (text-colour: green)[**perfect**], yes. It must look its very best, yes it must!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The ravel seems to turn their attention to the rest of your body as if deciding how to decorate you. $npc[&quot;A little metal under the skin and it will look so lovely, yes it will! We will give it lots of dangling bits. It will make such (text-colour: green)[pretty] noises when it walks, yes it will.&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; ...-&gt;petEndPsi2]]] </tw-passagedata><tw-passagedata pid="81" name="petEndMorph" tags="" position="4017,634" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The figure draws closer until you&#39;re able to make out who it is that you&#39;re looking at.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[(if: $charmed is true)[Your best friend and](else:)[It&#39;s your] owner, Maji!]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Wait... owner?]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Your head feels like it&#39;s full of fuzz, and you try to give it a shake to clear it. You swiftly find that the bindings around your neck keep you looking straight ahead, though, and you&#39;re not even able to look away as Maji grins at you.]

(after: time + $timer, 200)[=(set: $timer to 5500)$tsn[$npc[&quot;Sooo,&quot;] the outsider chirps to you. $npc[&quot;Maji knows he sold you last phase to a reeeaally nice petrid, but after training you all phase, Maji thinks you&#39;re actually kind of a keeper.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[The kobold steps up to you, then starts patting your back. *All phase?* How long have you been under the Compass House&#39;s influence?]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[$npc[&quot;Especially since your test results came back for House Morphoria! The best House!&quot;] He grins, then runs his claws down your back as he walks towards your ass. $npc[&quot;Maji had to pay lots to get to keep you, but now you&#39;re not going anywhere, nope.&quot;]]

(after: time + $timer, 200)[=(unless: $genderTF is true)[(set: $timer to 0)](else:)[(set: $timer to 8000)$tsn[$npc[&quot;Especially since you went and got this real fun $pussy[cunt]$dick[cock] for Maji to play with,&quot;] he adds, (if: $pussy is true)[suddenly sinking two clawed fingers into your new snatch](else:)[wrapping a hand around your hanging dick and giving it a few idle pumps]. $npc[&quot;Maji is (text-colour: green)[**really**] gonna have fun using that from now on.&quot;]]]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[The kobold then moves his hand to your ass before letting his fingers wrap around the base of something in your hole. You tense up, but there&#39;s nothing you can do as the outsider begins to pull and tug and *ease* an unbearably, overwhelmingly ***fat*** plug out of your ass.]

(after: time + $timer, 200)[=(set: $timer to 5500)$tsn[You whine and tremble, starting to drool between your legs as your arousal spikes suddenly, before Maji simply lets go - and your ass (text-style: &quot;sway&quot;)[schlurps] the fat plug back home.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;And today is the day Maji gets to take you hooome!&quot;] he declares happily, walking around to your front. He grips your face and looks down at you, his purple eyes meeting your own.]

(after: time + $timer, 200)[=$tsn[[[&gt; Stare back-&gt;petEndMorph2]]]</tw-passagedata><tw-passagedata pid="82" name="petEndUmbra" tags="" position="4073,529" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[Once your eyes adjust to the light, you see the figure standing before you to be a surprisingly skinny, lithe creature. A slyne, you realise with some worry.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[The slender curve to its shoulder and lack of pauldron-like ornamentation indicates that a woman stands before you but, from what time you have spent in the City, you have learned that making assumptions is a quick way of getting you into awkward situations.]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Well, more awkward.]

(after: time + $timer, 200)[=(set: $timer to 13500)$tsn[Bright, green eyes peer down at you from above. $npc[&quot;There we go,&quot;] you hear the soft voice whisper. The raspy tone sounds softer than you expected as they reach down to pat your face. $npc[&quot;There we go, relax, little one. I am Hissati Rispil of the Languid Ones, and I will be taking care of you from now on, okay?&quot;] The voice whispers with an almost maternal tenderness to it.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[What does she mean? From now on?] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[What exactly has happened?]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[$npc[&quot;Dont worry, little one. You will be in good hands. I have purchased you, and you will be coming with me. I have been looking for a little company, you see. Dont worry, you wont be hurt,&quot;] the tender voice continues as her hand moves down to your neck, caressing you. There is a reluctance in her voice, but you can tell that her words are genuine.]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[$npc[&quot;I know Umbrasia doesnt have the best of reputations, and slynes even less so, but I hope I will be able to show you that it isn&#39;t all as some say. Umbrasia is the house of death, but death isn&#39;t bad. Sometimes, it just means... (text-colour: green)[change], in its own way. The start of something... new.&quot;] Her face draws into a soft smile, her eyes lifting to peer into the distance as if remembering an aging, fond memory.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Slowly, her attention returns to you. $npc[&quot;Even so, I hope that you will find a pleasant home with me.&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; Wait-&gt;petEndUmb2]]]</tw-passagedata><tw-passagedata pid="83" name="petEndOmn" tags="" position="4122,632" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[The towering figure descending the stairs threatens to block out what little light permeates into the room, and as they arrive you see that they are of colossal size - an impression only enhanced from your low viewpoint.]

(after: time + $timer, 200)[=(set: $timer to 13000)$tsn[A gentle green eye affixes itself on you. A krudge, you can tell. It seems that it has lost an eye somewhere, an ear appearing to have been halfway bitten off, and one of its legs is ghostly and translucent - a phantom limb replacement. Two rows of small breasts are the only things that hint that the krudge may be female, given the often masculine appearance of their race. Dressed in black, all-covering leather, a pair of goggles hang around their neck.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[They step up to you and you can tell that they are sizing you up. 
$npc[&quot;Hmm. Fascinating. Clearly sentient. But still made to behave like an animal.&quot;] A cool fascination betrays the otherwise stoic tone of the krudge&#39;s words. Going down to one knee, you see them snap their fingers at you as if to get your attention. You turn your head to try to follow their snap questioningly.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Good reflexes. Decent acuity. Mhhh. Yes, you will make a decent experiment,&quot;] the creature explains. You see them pulling out a notepad from a fold in their clothing. With a flourish of a stocky arm, you see them begin jotting down arcanogram notes.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Let&#39;s see here. Will a specimen break if subjected to enough mechanical conditioning? Are we able to overwrite the mind without the use of Gloam? Can we make someone truly think that they are genuinely a beast with assimilation training?&quot;]] 

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[The krudge seems to be speaking to themselves more than anything, writing down a list of tests that they  need to prepare. Once they finish their notes, their writing implements and notes are quickly stashed and they produce a small cylindrical rod.]

(after: time + $timer, 200)[=$tsn[[[&gt; Oh no.-&gt;petEndOmn2]]]</tw-passagedata><tw-passagedata pid="84" name="petEndByle" tags="" position="4225,634" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The shadowy figure in the door starts to descend the stairs.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 7500)$tsn[You try to heave your body up but realise that your neck is tied to the floor as well. Your legs refuse to move, spread as they are and tied to separate anchor points on the ground. You&#39;re left vulnerable and exposed, unable to hide yourself.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[An imposing and bulky oggorus heaves himself down the stairs slowly, eyes fixed on you.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[A sharp intake through your nose tells you that this oggorus is definitively a &quot;he&quot;. Large and dark-coloured, his glistening skin is primarily shades of midnight blue with his belly fading into a deeper purple colouration. Regal, fleshy bulbs highlight his puffed-up neck.]

(after: time + $timer, 200)[=(set: $timer to 9500)$tsn[Strikingly orange-red fluids trickle from his chest, and as soon as he slithers into your little chamber you feel the faintly addling sensation in your head starting to grow heavier. It appears this oggorus toxin is quick to evaporate, filling the air with a cloying, venomous scent.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[A slimy hand reaches forward, and you feel your head being patted. Slow, sensual strokes smooth down your head and cup your chin as a welcoming, toothy smile meets you from above.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[A rumbling voice breathes down, wafting across your face with a cloying heat. $npc[&quot;Yesss... You will do (text-colour: green)[**nicely**], wont you?&quot;]]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Dont worry, youll be a good pet for me. I paid good amounts of Gloam to that lehlt and his outsider for you last phase, after all.&quot;] The booming voice rumbles out in a hearty laughter.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[Lets see here, what do I have to work with...&quot;]]

(after: time + $timer, 200)[=(if: $dick is true)[(set: $timer to 16000)$tsn[The oggorus tail curls between your legs, and you feel the rough stinger (text-style: &quot;sway&quot;)[drag] across your sensitive dick, and as worried as you feel, your body betrays you. A warmth blooms across your body, and you feel yourself stiffening to full arousal in a matter of ticks.$genderTF[ Are dicks *meant* to be this sensitive?] 
$npc[&quot;Ah. How cute. Mmmm... Oh, well get you widened out. Maybe we can fit some eggs down there?&quot;] The ogg rumbles, and you feel your worry fight with your arousal as an unfamiliar part of your mind tells you what a heavenly experience that would be.$pussy[ Then, his tail moves again.

]]](else:)[(set: $timer to 0)](after: time + $timer, 200)[=(if: $pussy is true)[(set: $timer to 21000)$tsn[The oggorus tail$dick[ then] curls around a leg, and his rough stinger starts to trace along your sensitive cunt.$genderTF[ Oh, no. You&#39;re not used to having one of those, and his stinger makes your heart flutter.] You struggle and fail to stop a moan from drifting past your lips, and within a moment, you feel the stinger **sink** into your heated depths. Unable to fight it, something (text-colour: orange)[warm and gooey] pours inside you. What was a small heat becomes a burning inferno in your belly, and it takes all your strength not to collapse as a dose of lust-spiking venom is funneled directly into your body. $npc[&quot;Ah, yes. I will have (text-colour: green)[**a lot**] of fun with you.&quot;]]](else:)[(set: $timer to 0)]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[All the while, you can feel alien yet familiar words ringing in your head. Notions of obedience, of submission, and of rightness. You try to fight it, but you can feel yourself...] (after: time + $timer, 200)[=(set: $timer to 3000)$tsn[*losing*.]

(after: time + $timer, 200)[=$tsn[[[&gt; *Succumb*-&gt;petEndByle2]]]</tw-passagedata><tw-passagedata pid="85" name="threesome2.5" tags="" position="3771,868" size="100,100">(text-colour: #02d987)[####The Compass House]
(set: $timer to 8500)$tsn[Suddenly, Maji pulls back all the way until his flare is just gently wedged between your lips. You&#39;re given a singular moment to gasp in a breath of cock-tainted air before the kobold *thrusts* back home in one, long shove.]

(after: $timer, 200)[=(set: $timer to 3500)$tsn[His flare kisses the back of your throat and pushes-- *hard*.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You gulp, choke, gulp again.] (after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Then suddenly he *squelches* sloppily home at the same time as you feel his flare thicken and a potent gout of creamy, slimy precum squirts down your gullet.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Maji pushes harder. You watch, helplessly swallowing as his balls sink closer to your eyes - until the fat, scaly sack bumps against your face, Maji&#39;s sheath kissing up against your lips.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You feel a soft bump in your belly.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Bump!&quot;] Maji hisses out delightedly. You hear Velvadius gasp. 
$npc[&quot;Maji, what-&quot;
&quot;Maji used just a liiiittle Morphoria magic to straighten them out. Just a bit... so Maji and mister Velvadius can meet in the middle.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[As Maji tugs back and humps forwards again, you feel that bump again. Velvadius moans. *They&#39;ve met in the middle.*]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Between that realisation, and Velvadius&#39; magic fingers forcing (if: $dick is true)[stroke after stroke of pleasure into your jutting, rigid cock](else:)[wave after wave of pleasure squelching into your sopping cunt], you lose control.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[With a choked and muffled series of urgent moans around Maji&#39;s throbbing, sloppy cock, you *cum*. $dick[(set: $timer to it + 4000)Your cock starts pulsing and twitching desperately, fattening up in Velvadius&#39; grip as he jerks you off hard.$pussy[(set: $timer to it + 2000) At the same time, you feel your cunt clamp down around his thumb. ]]$pussy[(set: $timer to it + 6000)Your pussy squeezes down erratically, and your legs turn to jelly as you cum hard with Velvadius&#39; fingers pushing you into a sweeping, tingling climax you can&#39;t resist.]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[As you orgasm (if: $genderTF is true)[for the first time with your new equipment ]around Velvadius&#39; cock, your gaping, aching hole starts clamping down around him. You can&#39;t stop yourself as you (if: $dick is true)[spurt out a copious load](else:)[practically wet yourself with how hard you gush], and it takes only a few short, tight squeezes before Velvadius gasps loudly.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Maji I told you not-- to-- nhhaAAAh!&quot;] Velvadius voice cracks as you feel his cock stiffen so hard it almost hurts. He clutches your thigh desperately and then starts to hammer himself into your ass with reckless abandon.]

(after: time + $timer, 200)[=(set: $timer to 750)$tsn[Splrt- ](after: time + $timer, 200)[=(set: $timer to 750)$tsn[splrt- ](after: time + $timer, 200)[=(set: $timer to 750)$tsn[splrt- ](after: time + $timer, 200)[=(set: $timer to 750)$tsn[*splrt-* ](after: time + $timer, 200)[=(set: $timer to 750)$tsn[*splrt-* ](after: time + $timer, 200)[=(set: $timer to 1500)$tsn[(text-style: &quot;smear&quot;)[***splrt!***]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[You feel Velvadius&#39; dick pumping gout after gout of thick, custardy cockslobber deep into your ass, his every cock-fattening throb stretching you out a little more.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[As orgasm leaves you thrashing weakly, your mind blanking under the waves of tight, blissful **release**, you feel Maji&#39;s hands grip your shoulders. As if afraid of missing out on the occasion, the kobold starts to roughly fuck your throat as Velvadius cums in you, and it&#39;s all you can do not to pass out in carnal pleasure.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Humping needily at your face, it takes only a few ticks before Maji moans out as well and you get to watch as his scaly, blue sack pulls up beneath his tail.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[You can&#39;t taste it, but you can *feel* it as gooey, sticky slime starts to pump into your belly from both ends, Velvadius&#39; fingers keeping you locked in the spasming throes of your own climax.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You can feel your stomach bloating from the sheer output of *cum* being stuffed into you from both ends.]

(after: time + $timer, 200)[=$tsn[*[[&gt; Glrgl...-&gt;threesome3]]*]</tw-passagedata><tw-passagedata pid="86" name="petEndByle2" tags="" position="4225,784" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[His hands move upwards, and you feel one grip your jaws. Your heated body opens its mouth obediently for your new owner-](set: $timer to 4000) 

(after: $timer, 200)[=(set: $timer to 3000)$tsn[Wait.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[No...]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[This oggorus is **not** your owner.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Its the (text-colour: orange)[poison] speaking.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You realise that your tongue is hanging out, slowly being pinched between two fingers as the oggorus inspects you like an animal.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Nice jaw. Good stretch. Maybe I&#39;ll install you in my (text-colour: green)[**personal**] quarters. I&#39;m sure youll be able to handle my morning routine quite nicely.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[$npc[&quot;Dont worry, though. You will be well fed. Maybe Ill even treat you to some secondhand breakfast, haha!&quot;] The oggorus guffaws slobbily, patting your head. $npc[&quot;Well make Orpus himself proud, wont we, little one?&quot;] the slug rumbles.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[Just like that, he turns around and slithers slowly away. A hand is lifted and you see a gesture, and your mind somehow fills in the blanks.]

(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[(text-style: &quot;smear&quot;)[*Heel.*]] 
(after: time + $timer, 200)[=(set: $timer to 2000)$tsn[(text-style: &quot;smear&quot;)[*Come.*]] 
(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[(text-style: &quot;smear&quot;)[*Follow.*]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[You&#39;re so captivated by his silent command that it takes you several heartbeats to realise that his tail undid your bindings.]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[Without even having him pull on your leash, your increasingly toxin-addled mind sends your body crawling after the large oggorus.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[With a phase worth of conditioning and a heavy swamp of oggorus toxin swirling in your brain, all you can think is that *yes*. He will definitively have a nice home for you. Youll be happy with him. You dont need anyone pulling on your collar. **You already know your place.**]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="87" name="petEndViv2" tags="" position="3910,784" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[$npc[&quot;Aaahh... Yeah, thatll do it. Good pet! Now you wont forget that scent even if you want to, and youll always know who your owner is. Theres gonna be a lot of confusing scents where youre going, but now youll always be able to find me. Yes you will, yes you will.&quot;]](set: $timer to 8000) 

(after: $timer, 200)[=(set: $timer to 6000)$tsn[The nurk starts to skitter around you, unlatching your limbs from the floor. He stops momentarily to give your ass a *pat*, and a jolt rocks through your spine as you realise how much your ass ***aches***.] (after: $timer, 200)[=(set: $timer to 2000)$tsn[Are you...] (after: $timer, 200)[=(set: $timer to 3000)$tsn[plugged?]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;And well make sure (text-colour: green)[**this**] gets plenty of practice, too! That way you can take care of all the different creatures and bugs in breeding season!&quot;] he exclaims, before he grabs a hold of your leash.] 

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[The nurk&#39;s cum flows down the sides of your face, but your head swims with orders of obedience, and it&#39;s oddly hard to fight your new owner.] 

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[$npc[&quot;Be happy! Yes yes. Happy happy. Youll be a part of the finest breeding pens of Viviria. And with how much Gloam I paid for you, were gonna make sure you make lots and lots of offspring. Yes! Lots and lots. But I know youll be a worthy investment. Yes, you will.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[You try to fight it, but your thoughts remain (text-style: &quot;blur&quot;)[hazy]. You dont. (text-style: &quot;blur&quot;)[You shouldnt.] Ahh... Your ass aches, and from what the nurk told you, it&#39;s going to ache even more, soon.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[For now, you find that every time you think of fighting, your thoughts grow (text-style: &quot;blur&quot;)[hazier] (text-style: &quot;blurrier&quot;)[and hazier...] Your body has grown warm, and you feel your own legs tingle. You are... (text-style: &quot;blur&quot;)[happy]? You are going to have so many more playdates, now.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[(text-style: &quot;smear&quot;)[You cant wait.]]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="88" name="petEndPsi2" tags="" position="4286,425" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[A sense of urgency grips you, and you feel your worries climb. But... you are feeling (text-style: &quot;blur&quot;)[good]. You feel (text-style: &quot;blur&quot;)[happy] being on all fours and being inspected. Your thoughts are fuzzy and you can&#39;t quite make sense of them.](set: $timer to 8000) 

(after: $timer, 200)[=(set: $timer to 12000)$tsn[You notice that the ravel has lifted a slender Darkhaze pipe, taking deep breaths from it, holding it for several seconds, then *exhaling* a blueish mist out - and across your face. You feel the cinder-sweet odour tear into your nose. You cough momentarily as you realise that the cotton in your head has blossomed into a warm flower.](set: $tsn to (transition: &quot;dissolve&quot;) + (transition-time: 2s) + (text-colour: white)+(text-style: &quot;blur&quot;))

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[You feel as if something is twisting around inside you. Blinking slowly, you find that your eyes are less cooperative, blearly opening and closing as if harder to command. Colours start to swim and you see the ravel before you develop a faint aura, as if bright green lights are coming from within their frame.]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[Their features start to blend with your surroundings, yet you can swear that they&#39;re looking more and more monstrous by the moment. Their midnight-black feathers catch the gleam of light sifting in from behind.]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[$npc[&quot;Shhhh. Just let it in. It will help it relax,&quot;] comes their crooning voice, eager to help their new belonging into a better frame of mind. The worried sensations feel like they&#39;re being smothered in a blanket, and a dopey smile starts to curl around your face.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[You don&#39;t mind the bridle so much anymore. The inability to chew or close your jaws doesn&#39;t even occur to you, happy to stand there and drool onto the floor like you&#39;re supposed to. It feels like an extension of your mouth, as if it is perfectly natural to stand on all fours in front of the mysterious corvid.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[The blossoming heat inside your head slowly snakes its way down your spine and soon has your entire body wrapped in its tight embrace. Colours dance in front of your vision, and you feel yourself writhing against your bonds, a muffled moan escaping past your bridle.]
 
(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Oh, is it that eager? This is good. Relaxing is very important, and it will need to learn to relax, yes it will, yes it will. But it will learn,&quot;] you hear the ravel in front of you speak, and you can see as a thick, bulbous **knot** starts to slip out past their sheath. You see them leave your vision as they walk around you, and you hear the clacking of claws upon stone like the ticking of a clock; meticulous and constant, fading away as warmth is pressed against your rump.]

(after: time + $timer, 200)[=(set: $timer to 13000)$tsn[[[&gt; Relax...-&gt;petEndPsi3]]]</tw-passagedata><tw-passagedata pid="89" name="petEndPsi3" tags="" position="4398,354" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[(if: $pussy is true)[A heavy, thick pressure starts to push between your legs, and a rocking gyration makes itself known as the ravel starts to rock their hips back and forth. You try to turn your head, but your neck is tied in place, forcing you to continue staring straight ahead.(set: $timer to 7000)](else:)[(set: $timer to 11000)You feel two claws pressing against your rump, only for something to be grasped, then **pulled**. For a moment, your entire body lurches, and you feel thankful for the bonds keeping your legs tied to the floor. It feels as if your insides are being pulled out from your ass before a loud, audible (text-style: &quot;rumble&quot;)[***POP***] fills the room.]]

(after: $timer, 200)[=$tsn[(if: $pussy is true)[(set: $timer to 14000)With a firm **push** you feel their fleshy knot force your cunt open, and a heat surges inside you as the impossibly large lump makes its new home inside your snatch. With a single throb it feels as if the knot expands further, stretching your insides out, and you are given no time to think of **how** it managed to fit inside you as the overwhelming pleasure crashes over you. $genderTF[Dimly, you marvel at the alien sensations of having a pussy being filled, but your addled head is in no state to do much more than bask in the pleasure.(set: $timer to it + 4500)]](else:)[(set: $timer to 8000)A howl escapes your bridled mouth. 
$npc[&quot;Good, good. It will learn to stay plugged up when not in use. After all, it needs to be nice and loose for its new owner, yes?&quot;] the lilting voice sings back before the warm, heavy sensation returns.]]

(after: time + $timer, 200)[=$tsn[(if: $pussy is true)[(set: $timer to 10000)Your eyes widen as the pleasure crashes harder and harder through you, and it feels as if your quivering folds are melting under the rough, sensual treatment. $npc[&quot;Yes... Yes. Very good. It fits a little tightly, but we will work on that, yes we will. It will learn to keep its new owner nice and warm.&quot;]](else:)[(set: $timer to 3000)Wait, had you... been wearing a plug?]](after: time + $timer, 200)[=(if: $pussy is true)[(set: $timer to 0)](else:)[

(set: $timer to 3000)$tsn[That explains why your ass has been aching so. Just how big (text-style: &quot;sway&quot;)[was] that plug?]](after: time + $timer, 200)[=(if: $pussy is true)[(set: $timer to 0)](else:)[

(set: $timer to 15000)$tsn[The large, thick pressure pushes against your legs, and you feel the bird meticulously line themselves up until you feel that fat knot squashing against your poor ass. You try to turn your head but your neck is tied in place, forcing you to continue staring straight ahead, leaving you unable to even see what you are being subjected to. The pressure mounts harder and harder, before your muscles simply ***relax***. Your eyes bulge as the enormous length pops inside, stretching you further than you were ever intended to be stretched.]](after: time + $timer, 200)[=(if: $pussy is true)[(set: $timer to 0)](else:)[(set: $timer to 20000)

$tsn[As soon as the knot sinks in, several inches follow suit and it feels as if you are being punched in the gut. Even so, the pain soon fades away into an untold, overwhelming sensation of pleasure shortly after. With each throb, the knot feels as if it is getting larger and larger, each clamp of your drugged muscles driving it to expand further until it&#39;s consuming your senses entirely. Your tongue hangs out of your mouth as slovenly moans sift out past your bridle with each, heady thrust that batters your prostate.]]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[With a few rocking thrusts, you feel the ravel settle into a steady rhythm, bringing their full weight against you as inch after endless *inch* (text-style: &quot;buoy&quot;)[sinks] inside your body. Your chest and neck rest on the ground as you&#39;re made to moan helplessly into your bindings.] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Your ass is upturned like a beast in heat, and the ravel wastes no time in ensuring that they have explored every single part of you, clutching you to them as they sink themselves further and further inside you.] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Slow chimes grind away into what feels like an eternity, with each push forcing their bulbous crown deeper and deeper inside you. Your brain fails you, thoughts scatters like a hammer smashing against glass, and it becomes impossible to think of anything but the overwhelming sensation as the ravel breaks in their new toy.]

(after: time + $timer, 200)[=$tsn[[[&gt; Melt.-&gt;petEndPsi4]]] </tw-passagedata><tw-passagedata pid="90" name="petEndPsi4" tags="" position="4506,318" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[The ease at which their sickeningly large bulb *pops* out with another loud *squelch* is almost enough to make you worry, but worrying is the furthest thought from your mind.](set: $timer to 5000)

(after: $timer, 200)[=(set: $timer to 4000)$tsn[You can&#39;t help but feel how ***wide*** you&#39;ve been stretched, and how empty you now feel that your owner is no longer inside you.]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[Ah... But that&#39;s not bad. You feel so happy. You dont mind. You dont care. The world is swimming, and you are lost in a sea of hazy pleasure. Everything feels so good, as if your body is just a tiny part of you, while you yourself are a vessel of pleasure. Surely, with this ravel as your owner, youll learn to experience so many new things you never thought possible.](after: time + $timer, 200)[=(if: $pussy is true)[(set: $timer to 0000)](else:)[

(set: $timer to 7000)$tsn[It is with a gasp of reality that your body jolts, and you feel the ravel shove the plug back inside you. A wet, lewd slurp fills the air as your muscles accept the invader, inviting it back where you know it belongs.]]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[A reassuring pat on your flank later, you feel your bindings being undone. $npc[&quot;There we go. Mmmh, it liked that, yes? Good. Psylisium shall have another pet soon. It needs not worry, we will expand it in more ways than one.&quot;] The bird clucks, and a wicked grin crawls across its face.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[The ravel takes you by the leash and walks you out of the room. Your head is dazed, but your mind still drinks from the hazy pleasure that covers your entire world. The bridle still digs at your mouth and (if: $pussy is true)[a plug you only now hazily realise has been in your ass the whole time](else:)[the plug] makes your body jolt with each step you take, but you dont mind. It all feels so right. So normal. You cant wait for this ravel to take you home and play with you again, soon.]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="91" name="petEndVorn2" tags="" position="3886,209" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[$npc[&quot;We&#39;ll have to pull your skin back a little. I hope you don&#39;t mind a few piercings. Well...]](set: $timer to 3000) (after: $timer, 200)[=(set: $timer to 7500)$tsn[$npc[(text-colour: red)[A lot] of them. I am certain it will hurt delightfully much, but, well. You&#39;ll have to get used to it. Beauty always hurts,&quot;] the lehlt says sympathetically, their honeyed words making it clear that they care about you *in a very unique way.*]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[$npc[&quot;We&#39;ll get my very best flesh-shaper to work on that spine of yours. We&#39;ll make sure you find it comfortable to stay like this on a more permanent basis. Oh, and those eyes of yours will have to go, I&#39;m afraid. But I think we will keep your ears. I like knowing that you can hear me.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[$npc[&quot;Oh, and I will have to manually get you a nice set of sletcher spikes. I&#39;ll be placing those personally. We need you to be beautiful for all of the other males you will be courting when mine is off on shows,&quot;] the lehlt continues, watching your body twitch and squirm, delighting in regaling to you what fate has in store. You can tell they&#39;re toying with you and savouring each moment as it happens.]

(after: time + $timer, 200)[=$tsn[(if: $pussy is true)[(set: $timer to 15000)The lehlt leans down then, and you feel a hand stroke across your pussy. $npc[&quot;Hmm, yes. This looks good... A little used, perhaps - I should chide those shopkeepers - but good enough. Whatever you have taken in the past won&#39;t even begin to compare to how much we&#39;re going to stretch you out from now on. Your new mate is going to be (text-colour: red)[very] big, after all. We will have to install you with some fangs down below though. We don&#39;t want your new partner to go (text-colour: red)[wanting] now, do we?&quot;]](else:)[(set: $timer to 17000)The lehlt leans down then, and you feel a hand stroke across your dick. $npc[&quot;This will have to go, obviously. As much as I&#39;d like for you to keep it, I doubt my sletcher would take that much interest in you then. But, hmm... He (text-colour: red)[would] still be entertained by your rump, I am sure,&quot;] they continue, as if entertaining an idle hypothetical. $npc[&quot;Don&#39;t worry in any case, we will make sure that you get a nice set of teeth grafted along your folds. We want your new mate to enjoy you (text-colour: red)[fully] after all. We don&#39;t want him to have to (text-colour: red)[settle] for you.&quot;]]]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Next the lehlt moves behind you, and you feel them rake their claws along your ass. The sharp points dig against your supple hide and you feel as welts of stinging red are drawn across your rump, making you gasp through your bridle.] 

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Oh dear, sensitive are we? And what is (text-colour: red)[this], hmm? A little jeweled plug, just to show off? Your previous owners had good taste, I will give them that. Now let&#39;s see what were working with.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[You feel an intense pressure against your inner muscles. It only lasts for a moment, before an audible (text-style: &quot;smear&quot;, &quot;buoy&quot;)[**POP**] fills the air and you feel as if your guts have just been pulled out through your ass. Your lungs empty themselves in a loud yowl in response.]

(after: time + $timer, 200)[=(set: $timer to 12000)$tsn[$npc[&quot;Mmmh. Oh dear, its barely larger than my fist and you act like this? Your new partners knot is going to be much bigger than this. It appears we have to (text-colour: red)[train] you, too. I really should have haggled you down further.&quot;] The voice sounds mocking for a moment, only to return with a sweet tone. $npc[&quot;But dont worry, train you we will, and by the time my dear little sletcher has properly bred a few litters into you hell get this as a nice, secondary little hole to play with. You should thank me for even considering training you. I could decide to not prepare you for him at all, after all. Do you want that?&quot;]]

(after: time + $timer, 200)[=$tsn[[[&gt; *Mmph!*-&gt;petEndVorn3]]]</tw-passagedata><tw-passagedata pid="92" name="petEndVorn3" tags="" position="4011,210" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[You shudder to think about it. Why does this feel so strangely arousing to your body? You feel a hot sensation run across your hide, and you feel yourself responding more than you intend. You&#39;re about to be sold off as a pet! As lower than a pet. The mate to someone else&#39;s pet. And they&#39;re going to turn you into one, too? No longer being the person you were, reduced to sightless breeding stock.](set: $timer to 11000)

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[You are snapped out of your reverie as the pressure pushes back against your rump and, with a little bit of force, the plug (text-style: &quot;smear&quot;)[sinks] back in again as your muscles tighten up behind the fist-sized plug.]

(after: time + $timer, 200)[=(set: $timer to 9500)$tsn[$npc[&quot;There we go. Back in it goes. Were going to have to go over some ground rules now. The plug stays in, and it will only come out twice a day. So we will train you to take care of your business in mornings and evenings, understood? Good.&quot;] The lehlt starts, as if this is the most natural thing in the world.]

(after: time + $timer, 200)[=(set: $timer to 8000)$tsn[$npc[&quot;Oh, and you will be fed once a day, in the mornings. So dont oversleep, or youll have to go the day without any. We dont want you to get (text-style: &quot;smear&quot;)[fat] now. If you behave well, I might be more lenient, so make sure that you are on your best behaviour.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 7500)$tsn[The lehlt hums and you feel the bonds around your legs being undone. Before long your neck bindings are undone as well, and you feel your head being tugged along by a slender leash. The lehlt doesn&#39;t pull hard, as if testing your obedience.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[What are you even meant to do? You hesitate for a moment, until one shaky step leads into another. In moments, you&#39;re walking after the lehlt as they turn around to leave.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[$npc[&quot;Good little pet. See? You know where you belong. Dont worry, I have the perfect place waiting for you. You&#39;ll be right at home as part of my dear sletcher harem.&quot;]]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="93" name="petEndUmb2" tags="" position="4073,365" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[Without much more ado she kneels down next to you and you soon feel the bindings on your body being loosened.](set: $timer to 3000) 

(after: $timer, 200)[=(set: $timer to 9000)$tsn[$npc[&quot;There, there. That&#39;s the bindings off of you. Can you still stand?&quot;] she asks you. You test out your body. You rumble out a soft noise through your bridle, and slowly, surely, you try to stand up again. It feels almost alien, and it takes a couple of chimes before you are able to successfully stand.]

(after: time + $timer, 200)[=(set: $timer to 11000)$tsn[$npc[&quot;Here we go, dearie. Let me just help you with that,&quot;] she says, lifting her hands to gently fiddle with your bridle and easing it out from between your jaws. She pulls the drool-slicked bit from your mouth. $npc[&quot;There we go, there we go. Much better. Your jaws must be so sore. Dont speak.&quot;] You nod in turn to show your acknowledgement.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[There is a hesitance in her words, but eventually she opens her slender, reptilian jaws again. $npc[&quot;I said I would take care of you from now on, but... If you would rather be off, I understand.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Those words make you stop.]

(after: time + $timer, 200)[=(set: $timer to 12000)$tsn[A feeling of hesitance builds inside you, in turn. It is rare to find someone who is willing to free a helpless creature, trapped in such circumstances. Perhaps it&#39;s just the phase of conditioning you&#39;re beginning to realise you&#39;ve been through, but you feel unable to deny her outright. You shake your head at her, then move forward to wrap your arms around the lanky creature, giving the slyne an awkward hug.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You can feel some tension relieving itself from the slynes shoulders, and a faint smile breaks her sharp features.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;Thank you,&quot;] you hear her whisper.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end, rather than meet this soft-spoken slyne.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[When it becomes clear that your body isn&#39;t yet used to walking normally again, she offers you a shoulder to lean on. Taking up her offer, you let her help you as you leave the room together, step by step. Perhaps your new home wont be all bad...?]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="94" name="petEndOmn2" tags="" position="4122,781" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[$npc[&quot;You.&quot;] They speak to you again, angling their face to gaze down at you. $npc[&quot;Will you be a good pet and behave?&quot;] they ask you, leaving you with a moment to gather your composure. $npc[&quot;Bark once for yes,&quot;] they add after a few ticks, so that it becomes clear what their goal is.](set: $timer to 7000) 

(after: $timer, 200)[=(set: $timer to 2000)$tsn[You hesitate.]

(after: time + $timer, 200)[=(set: $timer to 9000)$tsn[You remember feeling so good. You remember feeling so *happy*. You remember showing off your $dick[stiff cock$pussy[ and ]]$pussy[wet snatch] almost proudly and making your owners so happy with you. You feel compelled to (text-style: &quot;smear&quot;)[obey], but your rationality holds you back. You know you shouldn&#39;t.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[The krudge lifts their silver device and you see it extend. Telescoping outwards, the rod becomes a longer cylinder, measuring four feet in length, ending in a two-pronged tip. They lower the device and you feel it push into your side.]

(after: time + $timer, 200)[=(set: $timer to 10000)$tsn[The following (text-style: &quot;rumble&quot;, &quot;outline&quot;)+(text-colour: yellow)[ZAP] is enough to make you yowl through your bridle, and you feel every muscle in your body tense up. If not for your legs being spread wide and tied to the ground, you would collapse where you stand. You open your jaw and bark out a gargled noise, making whatever noise you can manage through the shock.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[$npc[&quot;Good. I expect obedience, then. Let us see here. Room for improvement in the response time. Initial rejection of behaviour is expected. This falls within expected parameters. Let us repeat this test.&quot;] They repeat to themselves, then peer down at you again.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;Will you be a good pet and follow me home to the Omnillian citadel?&quot;]] 

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[You nod once, quickly, trying to give an answer.]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[Their expression remains unwavering, and they slowly lift the rod up to your side. You open your jaws and another bark erupts from your mouth- or whatever passes for a bark that your vocal cords can force out.]

(after: time + $timer, 200)[=(set: $timer to 13000)$tsn[$npc[&quot;Good,&quot;] comes the response from the large krudge. $npc[&quot;Quick to adapt. Initial response to pain is favourable. We will get proper intelligence and mood altering additives in your feed, and you will experience an increase of pleasure upon successfully obeying orders. You will see this can be quite pleasant once you get situated,&quot;] the krudge declares and moves to undo your bonds. Unclipping your neck and legs, they hold you gently by the leash.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Heel,&quot;] you hear the krudge say and you scamper over to their legs, sitting down next to their feet without needing further provocation. $npc[&quot;Good,&quot;] you hear their simple-worded response in turn. $npc[&quot;Now, walk.&quot;] They nod once towards the door and start to move. With a gulp, you start to follow as your instructor leads the way.]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="95" name="petEndMorph2" tags="" position="4017,784" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[$npc[&quot;Oh? Oh. Oh!&quot;] He grins at you. $npc[&quot;Your head finally came back! Wow. Maji was starting to think you wouldn&#39;t ever find your way back out. It&#39;s been a whole phase!&quot;]](set: $timer to 4500) 

(after: $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;Don&#39;t worry though, Maji kept your subconscious busy, putting all sorts of good training into it.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[He hums thoughtfully, then wags his tail as you see the front of his robes start to bulge. Your thoughts sink down immediately to an almost impulsive desire to bury your face between his legs.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Is this the training he mentioned...?]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[$npc[&quot;So this means that you get to experience Maji&#39;s masterful Morphorian magic! Lucky,&quot;] the outsider beams. Then he produces a canister of Gloam, holding it up.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;This,&quot;] he says, $npc[&quot;is gonna fuel the bestialize spell! We&#39;re gonna get you in proper animal position for always, yep, yep.&quot;]]

(after: time + $timer, 200)[=(set: $timer to 6000)$tsn[You feel a twinned wave of emotions sweep through your body. It&#39;s like there&#39;s two halves to your feelings now - and at least one is very much... *turned on* by the outsider&#39;s proposition.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[$npc[&quot;Maji (text-colour: green)[**was**] just gonna let it muddle up your mind so you could be Maji&#39;s animal proper, but if you juuust got back your thoughts, Maji will...&quot;] He trails off, then grins. $npc[&quot;Leave it to chance! Proper Morphoria style!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 2500)$tsn[Then he snaps his fingers, and before the worry can even build in your head you feel tealy energy engulf you.]

(after: time + $timer, 200)[=$tsn[[[&gt; Succumb-&gt;petEndMorph3]]]</tw-passagedata><tw-passagedata pid="96" name="petEndMorph3" tags="" position="4017,934" size="100,100">(text-colour: #02d987)[####A Dusty Basement]
$tsn[Your spine cracks.](set: $timer to 3000) 
(after: $timer, 200)[=(set: $timer to 3000)$tsn[Your arms twist and melt in shape.]
(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Your neck bends and contorts.]
(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[Your thumbs pull in, rendering your hands as useless paws.]
(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You feel your throat thickening, your voicebox warping into something more fitting an animal than someone who can talk. You know with dread certainty that you can&#39;t speak any more.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[You feel your body creaking and flowing under the guiding pressure of the magic as it reshapes your body into a permanently feral configuration.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[You feel a pressure fold softly, irresistibly around your thoughts, and can almost feel a (text-style: &quot;outline&quot;)[black pool] of **instinct** and **desire** flooding up to engulf you.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[...But it stops just short of enveloping your mind.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[After several moments, Maji snaps his fingers in front of your face.]

(after: time + $timer, 200)[=(set: $timer to 3000)$tsn[$npc[&quot;Hellooo? Still in there?&quot;] he asks.]

(after: time + $timer, 200)[=(set: $timer to 6500)$tsn[Panting from the ordeal of having your body forcibly altered and tweaked, still reeling from the understanding that you physically can&#39;t speak or stand up any more, it takes you several ticks to even focus your eyes on your owner.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[$npc[&quot;Oh, yep. That&#39;s great! Then Maji gets to have aaall the fun of training you up. Hmm. But what to change next...&quot;] The kobold trails off, before grinning again.]

(after: time + $timer, 200)[=(set: $timer to 5000)$tsn[He snaps his fingers and, with another discharge of Gloam, your bindings all undo themselves. You have a momentary, fleeting thought of running - but...]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[With your new, feral body, you know you can&#39;t even communicate for help. You&#39;d be (text-style: &quot;smear&quot;)[helpless] to the whims of the City.]

(after: time + $timer, 200)[=(set: $timer to 4500)$tsn[More importantly though is that, as Maji snaps his fingers and walks towards the door, you feel your body immediately responding of its own accord.]

(after: time + $timer, 200)[=(set: $timer to 11500)$tsn[$npc[&quot;Heel!&quot;] he says brightly. A flood of images rush back through your head, of being trained by him and Velvadius. Images you know were real, as your mind swam in the Maze Mind spell of the Compass House. The compulsion to (text-style: &quot;blur&quot;)[obey] is so strong that before you realise it, you&#39;re already padding over to his side.]

(after: time + $timer, 200)[=(set: $timer to 7000)$tsn[Perhaps if you hadn&#39;t sat for so long in that corridor in the Court of Resurrection, you might not have been caught in the addling trap of the Compass House and would have found a different end.] 

(after: time + $timer, 200)[=(set: $timer to 3500)$tsn[With a rub of your head, Maji grins and saunters out the door with his tail a-swaying.]

(after: time + $timer, 200)[=(set: $timer to 5500)$tsn[$npc[&quot;Let&#39;s go home. Then Maji wants to fuck you while he thinks about how to make you look (text-colour: green)[best], mmhm. And... Come!&quot;]]

(after: time + $timer, 200)[=(set: $timer to 4000)$tsn[With a thumping in your heart you can&#39;t quite shake, you follow your new owner out, now just an animal helpless to resist his corrupting draw to your new, domesticated life.]

(after: time + $timer, 200)[&lt;center&gt;(t8n: &quot;dissolve&quot;)+(t8n-time: 5s)+(text-colour: #02d987)+(text-style: &quot;smear&quot;)[###~End~]&lt;/center&gt;]</tw-passagedata><tw-passagedata pid="97" name="Untitled Passage" tags="header" position="171,44" size="100,100">(enchant: ?page&#39;s links, (text-colour: #b8eb02))</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(){
/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */var requirejs,require,define,root,factory;!function(e){var t,n,r,i,a={},o={},s={},c={},u=Object.prototype.hasOwnProperty,l=[].slice,p=/\.js$/;function f(e,t){return u.call(e,t)}function d(e,t){var n,r,i,a,o,c,u,l,f,d,h,y=t&&t.split("/"),m=s.map,g=m&&m["*"]||{};if(e){for(o=(e=e.split("/")).length-1,s.nodeIdCompat&&p.test(e[o])&&(e[o]=e[o].replace(p,"")),"."===e[0].charAt(0)&&y&&(e=y.slice(0,y.length-1).concat(e)),f=0;f<e.length;f++)if("."===(h=e[f]))e.splice(f,1),f-=1;else if(".."===h){if(0===f||1===f&&".."===e[2]||".."===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}if((y||g)&&m){for(f=(n=e.split("/")).length;f>0;f-=1){if(r=n.slice(0,f).join("/"),y)for(d=y.length;d>0;d-=1)if((i=m[y.slice(0,d).join("/")])&&(i=i[r])){a=i,c=f;break}if(a)break;!u&&g&&g[r]&&(u=g[r],l=f)}!a&&u&&(a=u,c=l),a&&(n.splice(0,c,a),e=n.join("/"))}return e}function h(t,r){return function(){var i=l.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),n.apply(e,i.concat([t,r]))}}function y(e){return function(t){a[e]=t}}function m(n){if(f(o,n)){var r=o[n];delete o[n],c[n]=!0,t.apply(e,r)}if(!f(a,n)&&!f(c,n))throw new Error("No "+n);return a[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function v(e){return e?g(e):[]}r=function(e,t){var n,r,i=g(e),a=i[0],o=t[1];return e=i[1],a&&(n=m(a=d(a,o))),a?e=n&&n.normalize?n.normalize(e,(r=o,function(e){return d(e,r)})):d(e,o):(a=(i=g(e=d(e,o)))[0],e=i[1],a&&(n=m(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:n}},i={require:function(e){return h(e)},exports:function(e){var t=a[e];return void 0!==t?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:function(e){return function(){return s&&s.config&&s.config[e]||{}}}(e)}}},t=function(t,n,s,u){var l,p,d,g,b,w,T,S=[],x=void 0===s?"undefined":_typeof(s);if(w=v(u=u||t),"undefined"===x||"function"===x){for(n=!n.length&&s.length?["require","exports","module"]:n,b=0;b<n.length;b+=1)if("require"===(p=(g=r(n[b],w)).f))S[b]=i.require(t);else if("exports"===p)S[b]=i.exports(t),T=!0;else if("module"===p)l=S[b]=i.module(t);else if(f(a,p)||f(o,p)||f(c,p))S[b]=m(p);else{if(!g.p)throw new Error(t+" missing "+p);g.p.load(g.n,h(u,!0),y(p),{}),S[b]=a[p]}d=s?s.apply(a[t],S):void 0,t&&(l&&l.exports!==e&&l.exports!==a[t]?a[t]=l.exports:d===e&&T||(a[t]=d))}else t&&(a[t]=s)},requirejs=require=n=function(a,o,c,u,l){if("string"==typeof a)return i[a]?i[a](o):m(r(a,v(o)).f);if(!a.splice){if((s=a).deps&&n(s.deps,s.callback),!o)return;o.splice?(a=o,o=c,c=null):a=e}return o=o||function(){},"function"==typeof c&&(c=u,u=l),u?t(e,a,o,c):setTimeout(function(){t(e,a,o,c)},4),n},n.config=function(e){return n(e)},requirejs._defined=a,(define=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),f(a,e)||f(o,e)||(o[e]=[e,t,n])}).amd={jQuery:!0}}(),define("almond",function(){}),
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
root=this,factory=function(){var e,t,n=Function.call.bind(Function.apply),r=Function.call.bind(Function.call),i=Array.isArray,a=Object.keys,o=function(e){try{return e(),!1}catch(e){return!0}},s=function(e){try{return e()}catch(e){return!1}},c=(e=o,function(){return!n(e,this,arguments)}),u=!!Object.defineProperty&&!o(function(){return Object.defineProperty({},"x",{get:function(){}})}),l="foo"===function(){}.name,p=Function.call.bind(Array.prototype.forEach),f=Function.call.bind(Array.prototype.reduce),d=Function.call.bind(Array.prototype.filter),h=Function.call.bind(Array.prototype.some),y=function(e,t,n,r){!r&&t in e||(u?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n}):e[t]=n)},m=function(e,t,n){p(a(t),function(r){var i=t[r];y(e,r,i,!!n)})},g=Function.call.bind(Object.prototype.toString),v="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===g(e)}:function(e){return"function"==typeof e},b=function(e,t,n){if(!u)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:n})},w=function(e,t,n){if(!u)throw new TypeError("getters require true ES5 support");var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return e[t]},set:function(n){e[t]=n}})},T=function(e,t,n){if(u){var r=Object.getOwnPropertyDescriptor(e,t);r.value=n,Object.defineProperty(e,t,r)}else e[t]=n},S=function(e,t,n){u?Object.defineProperty(e,t,n):"value"in n&&(e[t]=n.value)},x=function(e,t){t&&v(t.toString)&&y(e,"toString",t.toString.bind(t),!0)},k=Object.create||function(e,t){var n=function(){};n.prototype=e;var r=new n;return void 0!==t&&a(t).forEach(function(e){S(r,e,t[e])}),r},O=function(e,t){return!!Object.setPrototypeOf&&s(function(){var n=function t(n){var r=new e(n);return Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(n,e),n.prototype=k(e.prototype,{constructor:{value:n}}),t(n)})},j=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),A=j.isFinite,C=Function.call.bind(String.prototype.indexOf),E=Function.apply.bind(Array.prototype.indexOf),_=Function.call.bind(Array.prototype.concat),N=Function.call.bind(String.prototype.slice),P=Function.call.bind(Array.prototype.push),I=Function.apply.bind(Array.prototype.push),M=Function.call.bind(Array.prototype.shift),D=Math.max,R=Math.min,L=Math.floor,q=Math.abs,F=Math.exp,V=Math.log,H=Math.sqrt,z=Function.call.bind(Object.prototype.hasOwnProperty),$=function(){},B=j.Map,W=B&&B.prototype.delete,U=B&&B.prototype.get,G=B&&B.prototype.has,X=B&&B.prototype.set,Y=j.Symbol||{},J=Y.species||"@@species",K=Number.isNaN||function(e){return e!=e},Z=Number.isFinite||function(e){return"number"==typeof e&&A(e)},Q=v(Math.sign)?Math.sign:function(e){var t=Number(e);return 0===t?t:K(t)?t:t<0?-1:1},ee=function(e){var t=Number(e);return t<-1||K(t)?NaN:0===t||t===1/0?t:-1===t?-1/0:1+t-1==0?t:t*(V(1+t)/(1+t-1))},te=function(e){return"[object Arguments]"===g(e)},ne=te(arguments)?te:function(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==g(e)&&"[object Function]"===g(e.callee)},re=function(e){return null===e||"function"!=typeof e&&"object"!==(void 0===e?"undefined":_typeof(e))},ie=function(e){return"[object String]"===g(e)},ae=function(e){return"[object RegExp]"===g(e)},oe=function(e){return"function"==typeof j.Symbol&&"symbol"===(void 0===e?"undefined":_typeof(e))},se=function(e,t,n){var r=e[t];y(e,t,n,!0),x(e[t],r)},ce="function"==typeof Y&&"function"==typeof Y.for&&oe(Y()),ue=oe(Y.iterator)?Y.iterator:"_es6-shim iterator_";j.Set&&"function"==typeof(new j.Set)["@@iterator"]&&(ue="@@iterator"),j.Reflect||y(j,"Reflect",{},!0);var le,pe=j.Reflect,fe=String,de="undefined"!=typeof document&&document?document.all:null,he=null==de?function(e){return null==e}:function(e){return null==e&&e!==de},ye={Call:function(e,t){var r=arguments.length>2?arguments[2]:[];if(!ye.IsCallable(e))throw new TypeError(e+" is not a function");return n(e,t,r)},RequireObjectCoercible:function(e,t){if(he(e))throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&("function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))||e===de)},ToObject:function(e,t){return Object(ye.RequireObjectCoercible(e,t))},IsCallable:v,IsConstructor:function(e){return ye.IsCallable(e)},ToInt32:function(e){return ye.ToNumber(e)>>0},ToUint32:function(e){return ye.ToNumber(e)>>>0},ToNumber:function(e){if("[object Symbol]"===g(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(e){var t=ye.ToNumber(e);return K(t)?0:0!==t&&Z(t)?(t>0?1:-1)*L(q(t)):t},ToLength:function(e){var t=ye.ToInteger(e);return t<=0?0:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},IsIterable:function(e){return ye.TypeIsObject(e)&&(void 0!==e[ue]||ne(e))},GetIterator:function(e){if(ne(e))return new t(e,"value");var n=ye.GetMethod(e,ue);if(!ye.IsCallable(n))throw new TypeError("value is not an iterable");var r=ye.Call(n,e);if(!ye.TypeIsObject(r))throw new TypeError("bad iterator");return r},GetMethod:function(e,t){var n=ye.ToObject(e)[t];if(!he(n)){if(!ye.IsCallable(n))throw new TypeError("Method not callable: "+t);return n}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var n=ye.GetMethod(e,"return");if(void 0!==n){var r,i;try{r=ye.Call(n,e)}catch(e){i=e}if(!t){if(i)throw i;if(!ye.TypeIsObject(r))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ye.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(e){var t=ye.IteratorNext(e);return!ye.IteratorComplete(t)&&t},Construct:function(e,t,n,r){var i=void 0===n?e:n;if(!r&&pe.construct)return pe.construct(e,t,i);var a=i.prototype;ye.TypeIsObject(a)||(a=Object.prototype);var o=k(a),s=ye.Call(e,o,t);return ye.TypeIsObject(s)?s:o},SpeciesConstructor:function(e,t){var n=e.constructor;if(void 0===n)return t;if(!ye.TypeIsObject(n))throw new TypeError("Bad constructor");var r=n[J];if(he(r))return t;if(!ye.IsConstructor(r))throw new TypeError("Bad @@species");return r},CreateHTML:function(e,t,n,r){var i=ye.ToString(e),a="<"+t;""!==n&&(a+=" "+n+'="'+ye.ToString(r).replace(/"/g,"&quot;")+'"');return a+">"+i+"</"+t+">"},IsRegExp:function(e){if(!ye.TypeIsObject(e))return!1;var t=e[Y.match];return void 0!==t?!!t:ae(e)},ToString:function(e){return fe(e)}};if(u&&ce){var me=function(e){if(oe(Y[e]))return Y[e];var t=Y.for("Symbol."+e);return Object.defineProperty(Y,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!oe(Y.search)){var ge=me("search"),ve=String.prototype.search;y(RegExp.prototype,ge,function(e){return ye.Call(ve,e,[this])});se(String.prototype,"search",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,ge);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(ve,t,[ye.ToString(e)])})}if(!oe(Y.replace)){var be=me("replace"),we=String.prototype.replace;y(RegExp.prototype,be,function(e,t){return ye.Call(we,e,[this,t])});se(String.prototype,"replace",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,be);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(we,n,[ye.ToString(e),t])})}if(!oe(Y.split)){var Te=me("split"),Se=String.prototype.split;y(RegExp.prototype,Te,function(e,t){return ye.Call(Se,e,[this,t])});se(String.prototype,"split",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,Te);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(Se,n,[ye.ToString(e),t])})}var xe=oe(Y.match),ke=xe&&((le={})[Y.match]=function(){return 42},42!=="a".match(le));if(!xe||ke){var Oe=me("match"),je=String.prototype.match;y(RegExp.prototype,Oe,function(e){return ye.Call(je,e,[this])});se(String.prototype,"match",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,Oe);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(je,t,[ye.ToString(e)])})}}var Ae=function(e,t,n){x(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),u?p(Object.getOwnPropertyNames(e),function(r){r in $||n[r]||w(e,r,t)}):p(Object.keys(e),function(r){r in $||n[r]||(t[r]=e[r])}),t.prototype=e.prototype,T(e.prototype,"constructor",t)},Ce=function(){return this},Ee=function(e){u&&!z(e,J)&&b(e,J,Ce)},_e=function(e,t){var n=t||function(){return this};y(e,ue,n),!e[ue]&&oe(ue)&&(e[ue]=n)},Ne=function(e,t,n){if(function(e,t,n){u?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}(e,t,n),!ye.SameValue(e[t],n))throw new TypeError("property is nonconfigurable")},Pe=function(e,t,n,r){if(!ye.TypeIsObject(e))throw new TypeError("Constructor requires `new`: "+t.name);var i=t.prototype;ye.TypeIsObject(i)||(i=n);var a=k(i);for(var o in r)if(z(r,o)){var s=r[o];y(a,o,s,!0)}return a};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Ie=String.fromCodePoint;se(String,"fromCodePoint",function(e){return ye.Call(Ie,this,arguments)})}var Me={fromCodePoint:function(e){for(var t,n=[],r=0,i=arguments.length;r<i;r++){if(t=Number(arguments[r]),!ye.SameValue(t,ye.ToInteger(t))||t<0||t>1114111)throw new RangeError("Invalid code point "+t);t<65536?P(n,String.fromCharCode(t)):(t-=65536,P(n,String.fromCharCode(55296+(t>>10))),P(n,String.fromCharCode(t%1024+56320)))}return n.join("")},raw:function(e){var t=ye.ToObject(e,"bad callSite"),n=ye.ToObject(t.raw,"bad raw value"),r=n.length,i=ye.ToLength(r);if(i<=0)return"";for(var a,o,s,c,u=[],l=0;l<i&&(a=ye.ToString(l),s=ye.ToString(n[a]),P(u,s),!(l+1>=i));)o=l+1<arguments.length?arguments[l+1]:"",c=ye.ToString(o),P(u,c),l+=1;return u.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&se(String,"raw",Me.raw),m(String,Me);var De={repeat:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e);if(n<0||n>=1/0)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return function e(t,n){if(n<1)return"";if(n%2)return e(t,n-1)+t;var r=e(t,n/2);return r+r}(t,n)},startsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method "startsWith" with a regex');var n,r=ye.ToString(e);arguments.length>1&&(n=arguments[1]);var i=D(ye.ToInteger(n),0);return N(t,i,i+r.length)===r},endsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method "endsWith" with a regex');var n,r=ye.ToString(e),i=t.length;arguments.length>1&&(n=arguments[1]);var a=void 0===n?i:ye.ToInteger(n),o=R(D(a,0),i);return N(t,o-r.length,o)===r},includes:function(e){if(ye.IsRegExp(e))throw new TypeError('"includes" does not accept a RegExp');var t,n=ye.ToString(e);return arguments.length>1&&(t=arguments[1]),-1!==C(this,n,t)},codePointAt:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e),r=t.length;if(n>=0&&n<r){var i=t.charCodeAt(n);if(i<55296||i>56319||n+1===r)return i;var a=t.charCodeAt(n+1);return a<56320||a>57343?i:1024*(i-55296)+(a-56320)+65536}}};if(String.prototype.includes&&!1!=="a".includes("a",1/0)&&se(String.prototype,"includes",De.includes),String.prototype.startsWith&&String.prototype.endsWith){var Re=o(function(){return"/a/".startsWith(/a/)}),Le=s(function(){return!1==="abc".startsWith("a",1/0)});Re&&Le||(se(String.prototype,"startsWith",De.startsWith),se(String.prototype,"endsWith",De.endsWith))}ce&&(s(function(){var e=/a/;return e[Y.match]=!1,"/a/".startsWith(e)})||se(String.prototype,"startsWith",De.startsWith),s(function(){var e=/a/;return e[Y.match]=!1,"/a/".endsWith(e)})||se(String.prototype,"endsWith",De.endsWith),s(function(){var e=/a/;return e[Y.match]=!1,"/a/".includes(e)})||se(String.prototype,"includes",De.includes));m(String.prototype,De);var qe=["\t\n\v\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join(""),Fe=new RegExp("(^["+qe+"]+)|(["+qe+"]+$)","g"),Ve=function(){return ye.ToString(ye.RequireObjectCoercible(this)).replace(Fe,"")},He=["\x85","\u200b","\ufffe"].join(""),ze=new RegExp("["+He+"]","g"),$e=/^[-+]0x[0-9a-f]+$/i,Be=He.trim().length!==He.length;y(String.prototype,"trim",Ve,Be);var We=function(e){return{value:e,done:0===arguments.length}},Ue=function(e){ye.RequireObjectCoercible(e),this._s=ye.ToString(e),this._i=0};Ue.prototype.next=function(){var e=this._s,t=this._i;if(void 0===e||t>=e.length)return this._s=void 0,We();var n,r,i=e.charCodeAt(t);return r=i<55296||i>56319||t+1===e.length?1:(n=e.charCodeAt(t+1))<56320||n>57343?1:2,this._i=t+r,We(e.substr(t,r))},_e(Ue.prototype),_e(String.prototype,function(){return new Ue(this)});var Ge={from:function(e){var t,n,i,a,o,s,c=this;if(arguments.length>1&&(t=arguments[1]),void 0===t)n=!1;else{if(!ye.IsCallable(t))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2]),n=!0}if(void 0!==(ne(e)||ye.GetMethod(e,ue))){o=ye.IsConstructor(c)?Object(new c):[];var u,l,p=ye.GetIterator(e);for(s=0;!1!==(u=ye.IteratorStep(p));){l=u.value;try{n&&(l=void 0===i?t(l,s):r(t,i,l,s)),o[s]=l}catch(e){throw ye.IteratorClose(p,!0),e}s+=1}a=s}else{var f,d=ye.ToObject(e);for(a=ye.ToLength(d.length),o=ye.IsConstructor(c)?Object(new c(a)):new Array(a),s=0;s<a;++s)f=d[s],n&&(f=void 0===i?t(f,s):r(t,i,f,s)),Ne(o,s,f)}return o.length=a,o},of:function(){for(var e=arguments.length,t=this,n=i(t)||!ye.IsCallable(t)?new Array(e):ye.Construct(t,[e]),r=0;r<e;++r)Ne(n,r,arguments[r]);return n.length=e,n}};m(Array,Ge),Ee(Array),m((t=function(e,t){this.i=0,this.array=e,this.kind=t}).prototype,{next:function(){var e=this.i,n=this.array;if(!(this instanceof t))throw new TypeError("Not an ArrayIterator");if(void 0!==n)for(var r=ye.ToLength(n.length);e<r;e++){var i,a=this.kind;return"key"===a?i=e:"value"===a?i=n[e]:"entry"===a&&(i=[e,n[e]]),this.i=e+1,We(i)}return this.array=void 0,We()}}),_e(t.prototype),Array.of===Ge.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||se(Array,"of",Ge.of);var Xe={copyWithin:function(e,t){var n,r=ye.ToObject(this),i=ye.ToLength(r.length),a=ye.ToInteger(e),o=ye.ToInteger(t),s=a<0?D(i+a,0):R(a,i),c=o<0?D(i+o,0):R(o,i);arguments.length>2&&(n=arguments[2]);var u=void 0===n?i:ye.ToInteger(n),l=u<0?D(i+u,0):R(u,i),p=R(l-c,i-s),f=1;for(c<s&&s<c+p&&(f=-1,c+=p-1,s+=p-1);p>0;)c in r?r[s]=r[c]:delete r[s],c+=f,s+=f,p-=1;return r},fill:function(e){var t,n;arguments.length>1&&(t=arguments[1]),arguments.length>2&&(n=arguments[2]);var r=ye.ToObject(this),i=ye.ToLength(r.length);t=ye.ToInteger(void 0===t?0:t);for(var a=(n=ye.ToInteger(void 0===n?i:n))<0?i+n:n,o=t<0?D(i+t,0):R(t,i);o<i&&o<a;++o)r[o]=e;return r},find:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");for(var i,a=arguments.length>1?arguments[1]:null,o=0;o<n;o++)if(i=t[o],a){if(r(e,a,i,o,t))return i}else if(e(i,o,t))return i},findIndex:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var i=arguments.length>1?arguments[1]:null,a=0;a<n;a++)if(i){if(r(e,i,t[a],a,t))return a}else if(e(t[a],a,t))return a;return-1},keys:function(){return new t(this,"key")},values:function(){return new t(this,"value")},entries:function(){return new t(this,"entry")}};if(Array.prototype.keys&&!ye.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ye.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ue]&&(m(Array.prototype,{values:Array.prototype[ue]}),oe(Y.unscopables)&&(Array.prototype[Y.unscopables].values=!0)),l&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Ye=Array.prototype.values;se(Array.prototype,"values",function(){return ye.Call(Ye,this,arguments)}),y(Array.prototype,ue,Array.prototype.values,!0)}m(Array.prototype,Xe),1/[!0].indexOf(!0,-0)<0&&y(Array.prototype,"indexOf",function(e){var t=E(this,arguments);return 0===t&&1/t<0?0:t},!0),_e(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&_e(Object.getPrototypeOf([].values()));var Je,Ke=s(function(){return 0===Array.from({length:-1}).length}),Ze=1===(Je=Array.from([0].entries())).length&&i(Je[0])&&0===Je[0][0]&&0===Je[0][1];if(Ke&&Ze||se(Array,"from",Ge.from),!s(function(){return Array.from([0],void 0)})){var Qe=Array.from;se(Array,"from",function(e){return arguments.length>1&&void 0!==arguments[1]?ye.Call(Qe,this,arguments):r(Qe,this,e)})}var et=-(Math.pow(2,32)-1),tt=function(e,t){var n={length:et};return n[t?(n.length>>>0)-1:0]=!0,s(function(){return r(e,n,function(){throw new RangeError("should not reach here")},[]),!0})};if(!tt(Array.prototype.forEach)){var nt=Array.prototype.forEach;se(Array.prototype,"forEach",function(e){return ye.Call(nt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.map)){var rt=Array.prototype.map;se(Array.prototype,"map",function(e){return ye.Call(rt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.filter)){var it=Array.prototype.filter;se(Array.prototype,"filter",function(e){return ye.Call(it,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.some)){var at=Array.prototype.some;se(Array.prototype,"some",function(e){return ye.Call(at,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.every)){var ot=Array.prototype.every;se(Array.prototype,"every",function(e){return ye.Call(ot,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduce)){var st=Array.prototype.reduce;se(Array.prototype,"reduce",function(e){return ye.Call(st,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduceRight,!0)){var ct=Array.prototype.reduceRight;se(Array.prototype,"reduceRight",function(e){return ye.Call(ct,this.length>=0?this:[],arguments)})}var ut=8!==Number("0o10"),lt=2!==Number("0b10"),pt=h(He,function(e){return 0===Number(e+0+e)});if(ut||lt||pt){var ft=Number,dt=/^0b[01]+$/i,ht=/^0o[0-7]+$/i,yt=dt.test.bind(dt),mt=ht.test.bind(ht),gt=ze.test.bind(ze),vt=$e.test.bind($e),bt=function(){var e=function(t){var n;"string"==typeof(n=arguments.length>0?re(t)?t:function(e){var t;if("function"==typeof e.valueOf&&(t=e.valueOf(),re(t)))return t;if("function"==typeof e.toString&&(t=e.toString(),re(t)))return t;throw new TypeError("No default value")}(t):0)&&(n=ye.Call(Ve,n),yt(n)?n=parseInt(N(n,2),2):mt(n)?n=parseInt(N(n,2),8):(gt(n)||vt(n))&&(n=NaN));var r=this,i=s(function(){return ft.prototype.valueOf.call(r),!0});return r instanceof e&&!i?new ft(n):ft(n)};return e}();Ae(ft,bt,{}),m(bt,{NaN:ft.NaN,MAX_VALUE:ft.MAX_VALUE,MIN_VALUE:ft.MIN_VALUE,NEGATIVE_INFINITY:ft.NEGATIVE_INFINITY,POSITIVE_INFINITY:ft.POSITIVE_INFINITY}),Number=bt,T(j,"Number",bt)}var wt=Math.pow(2,53)-1;m(Number,{MAX_SAFE_INTEGER:wt,MIN_SAFE_INTEGER:-wt,EPSILON:2.220446049250313e-16,parseInt:j.parseInt,parseFloat:j.parseFloat,isFinite:Z,isInteger:function(e){return Z(e)&&ye.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&q(e)<=Number.MAX_SAFE_INTEGER},isNaN:K}),y(Number,"parseInt",j.parseInt,Number.parseInt!==j.parseInt),1===[,1].find(function(){return!0})&&se(Array.prototype,"find",Xe.find),0!==[,1].findIndex(function(){return!0})&&se(Array.prototype,"findIndex",Xe.findIndex);var Tt,St,xt,kt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),Ot=function(e,t){u&&kt(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},jt=function(){for(var e=Number(this),t=arguments.length,n=t-e,r=new Array(n<0?0:n),i=e;i<t;++i)r[i-e]=arguments[i];return r},At=function(e){return function(t,n){return t[n]=e[n],t}},Ct=function(e,t){var n,r=a(Object(t));return ye.IsCallable(Object.getOwnPropertySymbols)&&(n=d(Object.getOwnPropertySymbols(Object(t)),kt(t))),f(_(r,n||[]),At(t),e)},Et={assign:function(e,t){var n=ye.ToObject(e,"Cannot convert undefined or null to object");return f(ye.Call(jt,1,arguments),Ct,n)},is:function(e,t){return ye.SameValue(e,t)}};if(Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}()&&se(Object,"assign",Et.assign),m(Object,Et),u){var _t={setPrototypeOf:function(e,t){var n,i=function(e,t){return function(e,t){if(!ye.TypeIsObject(e))throw new TypeError("cannot set prototype on a non-object");if(null!==t&&!ye.TypeIsObject(t))throw new TypeError("can only set prototype to an object or null"+t)}(e,t),r(n,e,t),e};try{n=e.getOwnPropertyDescriptor(e.prototype,"__proto__").set,r(n,{},null)}catch(t){if(e.prototype!=={}.__proto__)return;n=function(e){this.__proto__=e},i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object)};m(Object,_t)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&(Tt=Object.create(null),St=Object.getPrototypeOf,xt=Object.setPrototypeOf,Object.getPrototypeOf=function(e){var t=St(e);return t===Tt?null:t},Object.setPrototypeOf=function(e,t){return xt(e,null===t?Tt:t)},Object.setPrototypeOf.polyfill=!1),!!o(function(){return Object.keys("foo")})){var Nt=Object.keys;se(Object,"keys",function(e){return Nt(ye.ToObject(e))}),a=Object.keys}if(o(function(){return Object.keys(/a/g)})){var Pt=Object.keys;se(Object,"keys",function(e){if(ae(e)){var t=[];for(var n in e)z(e,n)&&P(t,n);return t}return Pt(e)}),a=Object.keys}if(Object.getOwnPropertyNames&&!!o(function(){return Object.getOwnPropertyNames("foo")})){var It="object"===("undefined"==typeof window?"undefined":_typeof(window))?Object.getOwnPropertyNames(window):[],Mt=Object.getOwnPropertyNames;se(Object,"getOwnPropertyNames",function(e){var t=ye.ToObject(e);if("[object Window]"===g(t))try{return Mt(t)}catch(e){return _([],It)}return Mt(t)})}if(Object.getOwnPropertyDescriptor&&!!o(function(){return Object.getOwnPropertyDescriptor("foo","bar")})){var Dt=Object.getOwnPropertyDescriptor;se(Object,"getOwnPropertyDescriptor",function(e,t){return Dt(ye.ToObject(e),t)})}if(Object.seal&&!!o(function(){return Object.seal("foo")})){var Rt=Object.seal;se(Object,"seal",function(e){return ye.TypeIsObject(e)?Rt(e):e})}if(Object.isSealed&&!!o(function(){return Object.isSealed("foo")})){var Lt=Object.isSealed;se(Object,"isSealed",function(e){return!ye.TypeIsObject(e)||Lt(e)})}if(Object.freeze&&!!o(function(){return Object.freeze("foo")})){var qt=Object.freeze;se(Object,"freeze",function(e){return ye.TypeIsObject(e)?qt(e):e})}if(Object.isFrozen&&!!o(function(){return Object.isFrozen("foo")})){var Ft=Object.isFrozen;se(Object,"isFrozen",function(e){return!ye.TypeIsObject(e)||Ft(e)})}if(Object.preventExtensions&&!!o(function(){return Object.preventExtensions("foo")})){var Vt=Object.preventExtensions;se(Object,"preventExtensions",function(e){return ye.TypeIsObject(e)?Vt(e):e})}if(Object.isExtensible&&!!o(function(){return Object.isExtensible("foo")})){var Ht=Object.isExtensible;se(Object,"isExtensible",function(e){return!!ye.TypeIsObject(e)&&Ht(e)})}if(Object.getPrototypeOf&&!!o(function(){return Object.getPrototypeOf("foo")})){var zt=Object.getPrototypeOf;se(Object,"getPrototypeOf",function(e){return zt(ye.ToObject(e))})}var $t,Bt=u&&(($t=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags"))&&ye.IsCallable($t.get));if(u&&!Bt){b(RegExp.prototype,"flags",function(){if(!ye.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e})}var Wt,Ut=u&&s(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),Gt=ce&&u&&((Wt=/./)[Y.match]=!1,RegExp(Wt)===Wt),Xt=s(function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})}),Yt=Xt&&s(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});if(!Xt||!Yt){var Jt=RegExp.prototype.toString;y(RegExp.prototype,"toString",function(){var e=ye.RequireObjectCoercible(this);return ae(e)?r(Jt,e):"/"+fe(e.source)+"/"+fe(e.flags)},!0),x(RegExp.prototype.toString,Jt)}if(u&&(!Ut||Gt)){var Kt=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Zt=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},Qt=ye.IsCallable(Zt.get)?Zt.get:function(){return this.source},en=RegExp,tn=function e(t,n){var r=ye.IsRegExp(t);return this instanceof e||!r||void 0!==n||t.constructor!==e?ae(t)?new e(ye.Call(Qt,t),void 0===n?ye.Call(Kt,t):n):(r&&(t.source,void 0===n&&t.flags),new en(t,n)):t};Ae(en,tn,{$input:!0}),RegExp=tn,T(j,"RegExp",tn)}if(u){var nn={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};p(a(nn),function(e){e in RegExp&&!(nn[e]in RegExp)&&b(RegExp,nn[e],function(){return RegExp[e]})})}Ee(RegExp);var rn=1/Number.EPSILON,an=Math.pow(2,-23),on=Math.pow(2,127)*(2-an),sn=Math.pow(2,-126),cn=Math.E,un=Math.LOG2E,ln=Math.LOG10E,pn=Number.prototype.clz;delete Number.prototype.clz;var fn={acosh:function(e){var t=Number(e);if(K(t)||e<1)return NaN;if(1===t)return 0;if(t===1/0)return t;var n=1/(t*t);if(t<2)return ee(t-1+H(1-n)*t);var r=t/2;return ee(r+H(1-n)*r-1)+1/un},asinh:function(e){var t=Number(e);if(0===t||!A(t))return t;var n=q(t),r=n*n,i=Q(t);return n<1?i*ee(n+r/(H(r+1)+1)):i*(ee(n/2+H(1+1/r)*n/2-1)+1/un)},atanh:function(e){var t=Number(e);if(0===t)return t;if(-1===t)return-1/0;if(1===t)return 1/0;if(K(t)||t<-1||t>1)return NaN;var n=q(t);return Q(t)*ee(2*n/(1-n))/2},cbrt:function(e){var t=Number(e);if(0===t)return t;var n,r=t<0;return r&&(t=-t),n=t===1/0?1/0:(t/((n=F(V(t)/3))*n)+2*n)/3,r?-n:n},clz32:function(e){var t=Number(e),n=ye.ToUint32(t);return 0===n?32:pn?ye.Call(pn,n):31-L(V(n+.5)*un)},cosh:function(e){var t=Number(e);if(0===t)return 1;if(K(t))return NaN;if(!A(t))return 1/0;var n=F(q(t)-1);return(n+1/(n*cn*cn))*(cn/2)},expm1:function(e){var t=Number(e);if(t===-1/0)return-1;if(!A(t)||0===t)return t;if(q(t)>.5)return F(t)-1;for(var n=t,r=0,i=1;r+n!==r;)r+=n,n*=t/(i+=1);return r},hypot:function(e,t){for(var n=0,r=0,i=0;i<arguments.length;++i){var a=q(Number(arguments[i]));r<a?(n*=r/a*(r/a),n+=1,r=a):n+=a>0?a/r*(a/r):a}return r===1/0?1/0:r*H(n)},log2:function(e){return V(e)*un},log10:function(e){return V(e)*ln},log1p:ee,sign:Q,sinh:function(e){var t=Number(e);if(!A(t)||0===t)return t;var n=q(t);if(n<1){var r=Math.expm1(n);return Q(t)*r*(1+1/(r+1))/2}var i=F(n-1);return Q(t)*(i-1/(i*cn*cn))*(cn/2)},tanh:function(e){var t=Number(e);return K(t)||0===t?t:t>=20?1:t<=-20?-1:(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function(e){var t=Number(e);return t<0?-L(-t):L(t)},imul:function(e,t){var n=ye.ToUint32(e),r=ye.ToUint32(t),i=65535&n,a=65535&r;return i*a+((n>>>16&65535)*a+i*(r>>>16&65535)<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||t===1/0||t===-1/0||K(t))return t;var n=Q(t),r=q(t);if(r<sn)return n*(r/sn/an+rn-rn)*sn*an;var i=(1+an/Number.EPSILON)*r,a=i-(i-r);return a>on||K(a)?n*(1/0):n*a}},dn=function(e,t,n){return q(1-e/t)/Number.EPSILON<(n||8)};m(Math,fn),y(Math,"sinh",fn.sinh,Math.sinh(710)===1/0),y(Math,"cosh",fn.cosh,Math.cosh(710)===1/0),y(Math,"log1p",fn.log1p,-1e-17!==Math.log1p(-1e-17)),y(Math,"asinh",fn.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),y(Math,"asinh",fn.asinh,Math.asinh(1e300)===1/0),y(Math,"atanh",fn.atanh,0===Math.atanh(1e-300)),y(Math,"tanh",fn.tanh,-2e-17!==Math.tanh(-2e-17)),y(Math,"acosh",fn.acosh,Math.acosh(Number.MAX_VALUE)===1/0),y(Math,"acosh",fn.acosh,!dn(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON))),y(Math,"cbrt",fn.cbrt,!dn(Math.cbrt(1e-300),1e-100)),y(Math,"sinh",fn.sinh,-2e-17!==Math.sinh(-2e-17));var hn=Math.expm1(10);y(Math,"expm1",fn.expm1,hn>22025.465794806718||hn<22025.465794806718);var yn=Math.round,mn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),gn=[rn+1,2*rn-1].every(function(e){return Math.round(e)===e});y(Math,"round",function(e){var t=L(e);return e-t<.5?t:-1===t?-0:t+1},!mn||!gn),x(Math.round,yn);var vn=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=fn.imul,x(Math.imul,vn)),2!==Math.imul.length&&se(Math,"imul",function(e,t){return ye.Call(vn,Math,arguments)});var bn,wn,Tn=function(){var e=j.setTimeout;if("function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))){ye.IsPromise=function(e){return!!ye.TypeIsObject(e)&&void 0!==e._promise};var t,n=function(e){if(!ye.IsConstructor(e))throw new TypeError("Bad promise constructor");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new e(function(e,n){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=n}),!ye.IsCallable(t.resolve)||!ye.IsCallable(t.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&ye.IsCallable(window.postMessage)&&(t=function(){var e=[];return window.addEventListener("message",function(t){if(t.source===window&&"zero-timeout-message"===t.data){if(t.stopPropagation(),0===e.length)return;M(e)()}},!0),function(t){P(e,t),window.postMessage("zero-timeout-message","*")}});var i,a,o,s,c,u=ye.IsCallable(j.setImmediate)?j.setImmediate:"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick?process.nextTick:(i=j.Promise,(a=i&&i.resolve&&i.resolve())&&function(e){return a.then(e)}||(ye.IsCallable(t)?t():function(t){e(t,0)})),l=function(e){return e},p=function(e){throw e},f={},d=function(e,t,n){u(function(){h(e,t,n)})},h=function(e,t,n){var r,i;if(t===f)return e(n);try{r=e(n),i=t.resolve}catch(e){r=e,i=t.reject}i(r)},y=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.fulfillReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var i=1,a=0;i<r;i++,a+=3)d(n[a+0],n[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;n.result=t,n.state=1,n.reactionLength=0},g=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.rejectReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var i=1,a=0;i<r;i++,a+=3)d(n[a+1],n[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;n.result=t,n.state=2,n.reactionLength=0},v=function(e){var t=!1;return{resolve:function(n){var r;if(!t){if(t=!0,n===e)return g(e,new TypeError("Self resolution"));if(!ye.TypeIsObject(n))return y(e,n);try{r=n.then}catch(t){return g(e,t)}if(!ye.IsCallable(r))return y(e,n);u(function(){w(e,n,r)})}},reject:function(n){if(!t)return t=!0,g(e,n)}}},b=function(e,t,n,i){e===s?r(e,t,n,i,f):r(e,t,n,i)},w=function(e,t,n){var r=v(e),i=r.resolve,a=r.reject;try{b(n,t,i,a)}catch(e){a(e)}},T=c=function(e){if(!(this instanceof c))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!ye.IsCallable(e))throw new TypeError("not a valid resolver");var t=Pe(this,c,o,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),n=v(t),r=n.reject;try{e(n.resolve,r)}catch(e){r(e)}return t};o=T.prototype;var S=function(e,t,n,r){var i=!1;return function(a){i||(i=!0,t[e]=a,0==--r.count&&(0,n.resolve)(t))}};return m(T,{all:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Promise is not object");var r,i,a=new n(t);try{return function(e,t,n){for(var r,i,a=e.iterator,o=[],s={count:1},c=0;;){try{if(!1===(r=ye.IteratorStep(a))){e.done=!0;break}i=r.value}catch(t){throw e.done=!0,t}o[c]=void 0;var u=t.resolve(i),l=S(c,o,n,s);s.count+=1,b(u.then,u,l,n.reject),c+=1}0==--s.count&&(0,n.resolve)(o);return n.promise}(i={iterator:r=ye.GetIterator(e),done:!1},t,a)}catch(e){var o=e;if(i&&!i.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,a.reject)(o),a.promise}},race:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Promise is not object");var r,i,a=new n(t);try{return function(e,t,n){for(var r,i,a,o=e.iterator;;){try{if(!1===(r=ye.IteratorStep(o))){e.done=!0;break}i=r.value}catch(t){throw e.done=!0,t}a=t.resolve(i),b(a.then,a,n.resolve,n.reject)}return n.promise}(i={iterator:r=ye.GetIterator(e),done:!1},t,a)}catch(e){var o=e;if(i&&!i.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,a.reject)(o),a.promise}},reject:function(e){if(!ye.TypeIsObject(this))throw new TypeError("Bad promise constructor");var t=new n(this);return(0,t.reject)(e),t.promise},resolve:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Bad promise constructor");if(ye.IsPromise(e)&&e.constructor===t)return e;var r=new n(t);return(0,r.resolve)(e),r.promise}}),m(o,{catch:function(e){return this.then(null,e)},then:function(e,t){if(!ye.IsPromise(this))throw new TypeError("not a promise");var r,i=ye.SpeciesConstructor(this,T);r=arguments.length>2&&arguments[2]===f&&i===T?f:new n(i);var a,o=ye.IsCallable(e)?e:l,s=ye.IsCallable(t)?t:p,c=this._promise;if(0===c.state){if(0===c.reactionLength)c.fulfillReactionHandler0=o,c.rejectReactionHandler0=s,c.reactionCapability0=r;else{var u=3*(c.reactionLength-1);c[u+0]=o,c[u+1]=s,c[u+2]=r}c.reactionLength+=1}else if(1===c.state)a=c.result,d(o,r,a);else{if(2!==c.state)throw new TypeError("unexpected Promise state");a=c.result,d(s,r,a)}return r.promise}}),f=new n(T),s=o.then,T}}();if(j.Promise&&(delete j.Promise.accept,delete j.Promise.defer,delete j.Promise.prototype.chain),"function"==typeof Tn){m(j,{Promise:Tn});var Sn=O(j.Promise,function(e){return e.resolve(42).then(function(){})instanceof e}),xn=!o(function(){return j.Promise.reject(42).then(null,5).then(null,$)}),kn=o(function(){return j.Promise.call(3,$)}),On=function(e){var t=e.resolve(5);t.constructor={};var n=e.resolve(t);try{n.then(null,$).then(null,$)}catch(e){return!0}return t===n}(j.Promise),jn=u&&(bn=0,wn=Object.defineProperty({},"then",{get:function(){bn+=1}}),Promise.resolve(wn),1===bn),An=function e(t){var n=new Promise(t);t(3,function(){}),this.then=n.then,this.constructor=e};An.prototype=Promise.prototype,An.all=Promise.all;var Cn=s(function(){return!!An.all([1,2])});if(Sn&&xn&&kn&&!On&&jn&&!Cn||(Promise=Tn,se(j,"Promise",Tn)),1!==Promise.all.length){var En=Promise.all;se(Promise,"all",function(e){return ye.Call(En,this,arguments)})}if(1!==Promise.race.length){var _n=Promise.race;se(Promise,"race",function(e){return ye.Call(_n,this,arguments)})}if(1!==Promise.resolve.length){var Nn=Promise.resolve;se(Promise,"resolve",function(e){return ye.Call(Nn,this,arguments)})}if(1!==Promise.reject.length){var Pn=Promise.reject;se(Promise,"reject",function(e){return ye.Call(Pn,this,arguments)})}Ot(Promise,"all"),Ot(Promise,"race"),Ot(Promise,"resolve"),Ot(Promise,"reject"),Ee(Promise)}var In,Mn,Dn=function(e){var t=a(f(e,function(e,t){return e[t]=!0,e},{}));return e.join(":")===t.join(":")},Rn=Dn(["z","a","bb"]),Ln=Dn(["z",1,"a","3",2]);if(u){var qn=function(e,t){return t||Rn?he(e)?"^"+ye.ToString(e):"string"==typeof e?"$"+e:"number"==typeof e?Ln?e:"n"+e:"boolean"==typeof e?"b"+e:null:null},Fn=function(){return Object.create?Object.create(null):{}},Vn=function(e,t,n){if(i(n)||ie(n))p(n,function(e){if(!ye.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");t.set(e[0],e[1])});else if(n instanceof e)r(e.prototype.forEach,n,function(e,n){t.set(n,e)});else{var a,o;if(!he(n)){if(o=t.set,!ye.IsCallable(o))throw new TypeError("bad map");a=ye.GetIterator(n)}if(void 0!==a)for(;;){var s=ye.IteratorStep(a);if(!1===s)break;var c=s.value;try{if(!ye.TypeIsObject(c))throw new TypeError("Iterator value "+c+" is not an entry object");r(o,t,c[0],c[1])}catch(e){throw ye.IteratorClose(a,!0),e}}}},Hn=function(e,t,n){if(i(n)||ie(n))p(n,function(e){t.add(e)});else if(n instanceof e)r(e.prototype.forEach,n,function(e){t.add(e)});else{var a,o;if(!he(n)){if(o=t.add,!ye.IsCallable(o))throw new TypeError("bad set");a=ye.GetIterator(n)}if(void 0!==a)for(;;){var s=ye.IteratorStep(a);if(!1===s)break;var c=s.value;try{r(o,t,c)}catch(e){throw ye.IteratorClose(a,!0),e}}}},zn={Map:function(){var e={},t=function(e,t){this.key=e,this.value=t,this.next=null,this.prev=null};t.prototype.isRemoved=function(){return this.key===e};var n,i=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return!!e._es6map}(e))throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ye.ToString(e))},a=function(e,t){i(e,"[[MapIterator]]"),this.head=e._head,this.i=this.head,this.kind=t};_e(a.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError("Not a MapIterator");var e,t=this.i,n=this.kind,r=this.head;if(void 0===this.i)return We();for(;t.isRemoved()&&t!==r;)t=t.prev;for(;t.next!==r;)if(!(t=t.next).isRemoved())return e="key"===n?t.key:"value"===n?t.value:[t.key,t.value],this.i=t,We(e);return this.i=void 0,We()}});var o=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var r=Pe(this,e,n,{_es6map:!0,_head:null,_map:B?new B:null,_size:0,_storage:Fn()}),i=new t(null,null);return i.next=i.prev=i,r._head=i,arguments.length>0&&Vn(e,r,arguments[0]),r};return b(n=o.prototype,"size",function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size}),m(n,{get:function(e){var t;i(this,"get");var n=qn(e,!0);if(null!==n)return(t=this._storage[n])?t.value:void 0;if(this._map)return(t=U.call(this._map,e))?t.value:void 0;for(var r=this._head,a=r;(a=a.next)!==r;)if(ye.SameValueZero(a.key,e))return a.value},has:function(e){i(this,"has");var t=qn(e,!0);if(null!==t)return void 0!==this._storage[t];if(this._map)return G.call(this._map,e);for(var n=this._head,r=n;(r=r.next)!==n;)if(ye.SameValueZero(r.key,e))return!0;return!1},set:function(e,n){i(this,"set");var r,a=this._head,o=a,s=qn(e,!0);if(null!==s){if(void 0!==this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new t(e,n),o=a.prev}else this._map&&(G.call(this._map,e)?U.call(this._map,e).value=n:(r=new t(e,n),X.call(this._map,e,r),o=a.prev));for(;(o=o.next)!==a;)if(ye.SameValueZero(o.key,e))return o.value=n,this;return r=r||new t(e,n),ye.SameValue(-0,e)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(t){i(this,"delete");var n=this._head,r=n,a=qn(t,!0);if(null!==a){if(void 0===this._storage[a])return!1;r=this._storage[a].prev,delete this._storage[a]}else if(this._map){if(!G.call(this._map,t))return!1;r=U.call(this._map,t).prev,W.call(this._map,t)}for(;(r=r.next)!==n;)if(ye.SameValueZero(r.key,t))return r.key=e,r.value=e,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){i(this,"clear"),this._map=B?new B:null,this._size=0,this._storage=Fn();for(var t=this._head,n=t,r=n.next;(n=r)!==t;)n.key=e,n.value=e,r=n.next,n.next=n.prev=t;t.next=t.prev=t},keys:function(){return i(this,"keys"),new a(this,"key")},values:function(){return i(this,"values"),new a(this,"value")},entries:function(){return i(this,"entries"),new a(this,"key+value")},forEach:function(e){i(this,"forEach");for(var t=arguments.length>1?arguments[1]:null,n=this.entries(),a=n.next();!a.done;a=n.next())t?r(e,t,a.value[1],a.value[0],this):e(a.value[1],a.value[0],this)}}),_e(n,n.entries),o}(),Set:function(){var e,t=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return e._es6set&&void 0!==e._storage}(e))throw new TypeError("Set.prototype."+t+" called on incompatible receiver "+ye.ToString(e))},n=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var n=Pe(this,t,e,{_es6set:!0,"[[SetData]]":null,_storage:Fn()});if(!n._es6set)throw new TypeError("bad set");return arguments.length>0&&Hn(t,n,arguments[0]),n};e=n.prototype;var i=function(e){if(!e["[[SetData]]"]){var t=new zn.Map;e["[[SetData]]"]=t,p(a(e._storage),function(e){var n=function(e){var t=e;if("^null"===t)return null;if("^undefined"!==t){var n=t.charAt(0);return"$"===n?N(t,1):"n"===n?+N(t,1):"b"===n?"btrue"===t:+t}}(e);t.set(n,n)}),e["[[SetData]]"]=t}e._storage=null};b(n.prototype,"size",function(){return t(this,"size"),this._storage?a(this._storage).length:(i(this),this["[[SetData]]"].size)}),m(n.prototype,{has:function(e){var n;return t(this,"has"),this._storage&&null!==(n=qn(e))?!!this._storage[n]:(i(this),this["[[SetData]]"].has(e))},add:function(e){var n;return t(this,"add"),this._storage&&null!==(n=qn(e))?(this._storage[n]=!0,this):(i(this),this["[[SetData]]"].set(e,e),this)},delete:function(e){var n;if(t(this,"delete"),this._storage&&null!==(n=qn(e))){var r=z(this._storage,n);return delete this._storage[n]&&r}return i(this),this["[[SetData]]"].delete(e)},clear:function(){t(this,"clear"),this._storage&&(this._storage=Fn()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return t(this,"values"),i(this),new o(this["[[SetData]]"].values())},entries:function(){return t(this,"entries"),i(this),new o(this["[[SetData]]"].entries())},forEach:function(e){t(this,"forEach");var n=arguments.length>1?arguments[1]:null,a=this;i(a),this["[[SetData]]"].forEach(function(t,i){n?r(e,n,i,i,a):e(i,i,a)})}}),y(n.prototype,"keys",n.prototype.values,!0),_e(n.prototype,n.prototype.values);var o=function(e){this.it=e};return o.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError("Not a SetIterator");return this.it.next()}},_e(o.prototype),n}()};if(j.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(j.Set=zn.Set),j.Map||j.Set){s(function(){return 2===new Map([[1,2]]).get(1)})||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new B;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,j.Map.prototype),t},j.Map.prototype=k(B.prototype),y(j.Map.prototype,"constructor",j.Map,!0),x(j.Map,B));var $n=new Map,Bn=((Mn=new Map([[1,0],[2,0],[3,0],[4,0]])).set(-0,Mn),Mn.get(0)===Mn&&Mn.get(-0)===Mn&&Mn.has(0)&&Mn.has(-0)),Wn=$n.set(1,2)===$n;Bn&&Wn||se(Map.prototype,"set",function(e,t){return r(X,this,0===e?0:e,t),this}),Bn||(m(Map.prototype,{get:function(e){return r(U,this,0===e?0:e)},has:function(e){return r(G,this,0===e?0:e)}},!0),x(Map.prototype.get,U),x(Map.prototype.has,G));var Un=new Set,Gn=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&((In=Un).delete(0),In.add(-0),!In.has(0)),Xn=Un.add(1)===Un;if(!Gn||!Xn){var Yn=Set.prototype.add;Set.prototype.add=function(e){return r(Yn,this,0===e?0:e),this},x(Set.prototype.add,Yn)}if(!Gn){var Jn=Set.prototype.has;Set.prototype.has=function(e){return r(Jn,this,0===e?0:e)},x(Set.prototype.has,Jn);var Kn=Set.prototype.delete;Set.prototype.delete=function(e){return r(Kn,this,0===e?0:e)},x(Set.prototype.delete,Kn)}var Zn=O(j.Map,function(e){var t=new e([]);return t.set(42,42),t instanceof e}),Qn=Object.setPrototypeOf&&!Zn,er=function(){try{return!(j.Map()instanceof j.Map)}catch(e){return e instanceof TypeError}}();0===j.Map.length&&!Qn&&er||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new B;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Map.prototype=B.prototype,y(j.Map.prototype,"constructor",j.Map,!0),x(j.Map,B));var tr=O(j.Set,function(e){var t=new e([]);return t.add(42,42),t instanceof e}),nr=Object.setPrototypeOf&&!tr,rr=function(){try{return!(j.Set()instanceof j.Set)}catch(e){return e instanceof TypeError}}();if(0!==j.Set.length||nr||!rr){var ir=j.Set;j.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');var t=new ir;return arguments.length>0&&Hn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Set.prototype=ir.prototype,y(j.Set.prototype,"constructor",j.Set,!0),x(j.Set,ir)}var ar=new j.Map,or=!s(function(){return ar.keys().next().done});if(("function"!=typeof j.Map.prototype.clear||0!==(new j.Set).size||0!==ar.size||"function"!=typeof j.Map.prototype.keys||"function"!=typeof j.Set.prototype.keys||"function"!=typeof j.Map.prototype.forEach||"function"!=typeof j.Set.prototype.forEach||c(j.Map)||c(j.Set)||"function"!=typeof ar.keys().next||or||!Zn)&&m(j,{Map:zn.Map,Set:zn.Set},!0),j.Set.prototype.keys!==j.Set.prototype.values&&y(j.Set.prototype,"keys",j.Set.prototype.values,!0),_e(Object.getPrototypeOf((new j.Map).keys())),_e(Object.getPrototypeOf((new j.Set).keys())),l&&"has"!==j.Set.prototype.has.name){var sr=j.Set.prototype.has;se(j.Set.prototype,"has",function(e){return r(sr,this,e)})}}m(j,zn),Ee(j.Map),Ee(j.Set)}var cr=function(e){if(!ye.TypeIsObject(e))throw new TypeError("target must be an object")},ur={apply:function(){return ye.Call(ye.Call,null,arguments)},construct:function(e,t){if(!ye.IsConstructor(e))throw new TypeError("First argument must be a constructor.");var n=arguments.length>2?arguments[2]:e;if(!ye.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return ye.Construct(e,t,n,"internal")},deleteProperty:function(e,t){if(cr(e),u){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1}return delete e[t]},has:function(e,t){return cr(e),t in e}};Object.getOwnPropertyNames&&Object.assign(ur,{ownKeys:function(e){cr(e);var t=Object.getOwnPropertyNames(e);return ye.IsCallable(Object.getOwnPropertySymbols)&&I(t,Object.getOwnPropertySymbols(e)),t}});var lr=function(e){return!o(e)};if(Object.preventExtensions&&Object.assign(ur,{isExtensible:function(e){return cr(e),Object.isExtensible(e)},preventExtensions:function(e){return cr(e),lr(function(){return Object.preventExtensions(e)})}}),u){var pr=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(!r){var i=Object.getPrototypeOf(e);if(null===i)return;return pr(i,t,n)}return"value"in r?r.value:r.get?ye.Call(r.get,n):void 0},fr=function(e,t,n,i){var a=Object.getOwnPropertyDescriptor(e,t);if(!a){var o=Object.getPrototypeOf(e);if(null!==o)return fr(o,t,n,i);a={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return"value"in a?!!a.writable&&(!!ye.TypeIsObject(i)&&(Object.getOwnPropertyDescriptor(i,t)?pe.defineProperty(i,t,{value:n}):pe.defineProperty(i,t,{value:n,writable:!0,enumerable:!0,configurable:!0}))):!!a.set&&(r(a.set,i,n),!0)};Object.assign(ur,{defineProperty:function(e,t,n){return cr(e),lr(function(){return Object.defineProperty(e,t,n)})},getOwnPropertyDescriptor:function(e,t){return cr(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){cr(e);var n=arguments.length>2?arguments[2]:e;return pr(e,t,n)},set:function(e,t,n){cr(e);var r=arguments.length>3?arguments[3]:e;return fr(e,t,n,r)}})}if(Object.getPrototypeOf){var dr=Object.getPrototypeOf;ur.getPrototypeOf=function(e){return cr(e),dr(e)}}if(Object.setPrototypeOf&&ur.getPrototypeOf){Object.assign(ur,{setPrototypeOf:function(e,t){if(cr(e),null!==t&&!ye.TypeIsObject(t))throw new TypeError("proto must be an object or null");return t===pe.getPrototypeOf(e)||!(pe.isExtensible&&!pe.isExtensible(e))&&(!function(e,t){for(var n=t;n;){if(e===n)return!0;n=ur.getPrototypeOf(n)}return!1}(e,t)&&(Object.setPrototypeOf(e,t),!0))}})}Object.keys(ur).forEach(function(e){!function(e,t){ye.IsCallable(j.Reflect[e])?s(function(){return j.Reflect[e](1),j.Reflect[e](NaN),j.Reflect[e](!0),!0})&&se(j.Reflect,e,t):y(j.Reflect,e,t)}(e,ur[e])});var hr=j.Reflect.getPrototypeOf;if(l&&hr&&"getPrototypeOf"!==hr.name&&se(j.Reflect,"getPrototypeOf",function(e){return r(hr,j.Reflect,e)}),j.Reflect.setPrototypeOf&&s(function(){return j.Reflect.setPrototypeOf(1,{}),!0})&&se(j.Reflect,"setPrototypeOf",ur.setPrototypeOf),j.Reflect.defineProperty&&(s(function(){var e=!j.Reflect.defineProperty(1,"test",{value:1}),t="function"!=typeof Object.preventExtensions||!j.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})||se(j.Reflect,"defineProperty",ur.defineProperty)),j.Reflect.construct&&(s(function(){var e=function(){};return j.Reflect.construct(function(){},[],e)instanceof e})||se(j.Reflect,"construct",ur.construct)),"Invalid Date"!==String(new Date(NaN))){var yr=Date.prototype.toString;se(Date.prototype,"toString",function(){var e=+this;return e!=e?"Invalid Date":ye.Call(yr,this)})}var mr={anchor:function(e){return ye.CreateHTML(this,"a","name",e)},big:function(){return ye.CreateHTML(this,"big","","")},blink:function(){return ye.CreateHTML(this,"blink","","")},bold:function(){return ye.CreateHTML(this,"b","","")},fixed:function(){return ye.CreateHTML(this,"tt","","")},fontcolor:function(e){return ye.CreateHTML(this,"font","color",e)},fontsize:function(e){return ye.CreateHTML(this,"font","size",e)},italics:function(){return ye.CreateHTML(this,"i","","")},link:function(e){return ye.CreateHTML(this,"a","href",e)},small:function(){return ye.CreateHTML(this,"small","","")},strike:function(){return ye.CreateHTML(this,"strike","","")},sub:function(){return ye.CreateHTML(this,"sub","","")},sup:function(){return ye.CreateHTML(this,"sup","","")}};p(Object.keys(mr),function(e){var t=String.prototype[e],n=!1;if(ye.IsCallable(t)){var i=r(t,"",' " '),a=_([],i.match(/"/g)).length;n=i!==i.toLowerCase()||a>2}else n=!0;n&&se(String.prototype,e,mr[e])});var gr=function(){if(!ce)return!1;var e="object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if(void 0!==e(Y()))return!0;if("[null]"!==e([Y()]))return!0;var t={a:Y()};return t[Y()]=!0,"{}"!==e(t)}(),vr=s(function(){return!ce||"{}"===JSON.stringify(Object(Y()))&&"[{}]"===JSON.stringify([Object(Y())])});if(gr||!vr){var br=JSON.stringify;se(JSON,"stringify",function(e){if("symbol"!==(void 0===e?"undefined":_typeof(e))){var t;arguments.length>1&&(t=arguments[1]);var n=[e];if(i(t))n.push(t);else{var a=ye.IsCallable(t)?t:null;n.push(function(e,t){var n=a?r(a,this,e,t):t;if("symbol"!==(void 0===n?"undefined":_typeof(n)))return oe(n)?At({})(n):n})}return arguments.length>2&&n.push(arguments[2]),br.apply(this,n)}})}return j},"function"==typeof define&&define.amd?define("es6-shim",factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=factory():root.returnExports=factory(),function(e,t){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){var n=[],r=Object.getPrototypeOf,i=n.slice,a=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},o=n.push,s=n.indexOf,c={},u=c.toString,l=c.hasOwnProperty,p=l.toString,f=p.call(Object),d={},h=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},m=e.document,g={type:!0,src:!0,nonce:!0,noModule:!0};function v(e,t,n){var r,i,a=(n=n||m).createElement("script");if(a.text=e,t)for(r in g)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&a.setAttribute(r,i);n.head.appendChild(a).parentNode.removeChild(a)}function b(e){return null==e?e+"":"object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e?c[u.call(e)]||"object":void 0===e?"undefined":_typeof(e)}var w=function e(t,n){return new e.fn.init(t,n)};function T(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!h(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:"3.5.1",constructor:w,length:0,toArray:function(){return i.call(this)},get:function(e){return null==e?i.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(i.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(w.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,a,o=arguments[0]||{},s=1,c=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[s]||{},s++),"object"===(void 0===o?"undefined":_typeof(o))||h(o)||(o={}),s===c&&(o=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(u&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(n=o[t],a=i&&!Array.isArray(n)?[]:i||w.isPlainObject(n)?n:{},i=!1,o[t]=w.extend(u,a,r)):void 0!==r&&(o[t]=r));return o},w.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==u.call(e))&&(!(t=r(e))||"function"==typeof(n=l.call(t,"constructor")&&t.constructor)&&p.call(n)===f)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){v(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?w.merge(n,"string"==typeof e?[e]:e):o.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,a=e.length,o=!n;i<a;i++)!t(e[i],i)!==o&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(T(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a(s)},guid:1,support:d}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var S=function(e){var t,n,r,i,a,o,s,c,u,l,p,f,d,h,y,m,g,v,b,w="sizzle"+1*new Date,T=e.document,S=0,x=0,k=ce(),O=ce(),j=ce(),A=ce(),C=function(e,t){return e===t&&(p=!0),0},E={}.hasOwnProperty,_=[],N=_.pop,P=_.push,I=_.push,M=_.slice,D=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",q="(?:\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\["+L+"*("+q+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+L+"*\\]",V=":("+q+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",H=new RegExp(L+"+","g"),z=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),$=new RegExp("^"+L+"*,"+L+"*"),B=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),W=new RegExp(L+"|>"),U=new RegExp(V),G=new RegExp("^"+q+"$"),X={ID:new RegExp("^#("+q+")"),CLASS:new RegExp("^\\.("+q+")"),TAG:new RegExp("^("+q+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+V),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=function(){f()},oe=we(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{I.apply(_=M.call(T.childNodes),T.childNodes),_[T.childNodes.length].nodeType}catch(e){I={apply:_.length?function(e,t){P.apply(e,M.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,i){var a,s,u,l,p,h,g,v=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&(f(t),t=t||d,y)){if(11!==T&&(p=Q.exec(e)))if(a=p[1]){if(9===T){if(!(u=t.getElementById(a)))return r;if(u.id===a)return r.push(u),r}else if(v&&(u=v.getElementById(a))&&b(t,u)&&u.id===a)return r.push(u),r}else{if(p[2])return I.apply(r,t.getElementsByTagName(e)),r;if((a=p[3])&&n.getElementsByClassName&&t.getElementsByClassName)return I.apply(r,t.getElementsByClassName(a)),r}if(n.qsa&&!A[e+" "]&&(!m||!m.test(e))&&(1!==T||"object"!==t.nodeName.toLowerCase())){if(g=e,v=t,1===T&&(W.test(e)||B.test(e))){for((v=ee.test(e)&&ge(t.parentNode)||t)===t&&n.scope||((l=t.getAttribute("id"))?l=l.replace(re,ie):t.setAttribute("id",l=w)),s=(h=o(e)).length;s--;)h[s]=(l?"#"+l:":scope")+" "+be(h[s]);g=h.join(",")}try{return I.apply(r,v.querySelectorAll(g)),r}catch(t){A(e,!0)}finally{l===w&&t.removeAttribute("id")}}}return c(e.replace(z,"$1"),t,r,i)}function ce(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function ue(e){return e[w]=!0,e}function le(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function fe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ue(function(t){return t=+t,ue(function(n,r){for(var i,a=e([],n.length,t),o=a.length;o--;)n[i=a[o]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},a=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},f=se.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:T;return o!=d&&9===o.nodeType&&o.documentElement?(h=(d=o).documentElement,y=!a(d),T!=d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",ae,!1):i.attachEvent&&i.attachEvent("onunload",ae)),n.scope=le(function(e){return h.appendChild(e).appendChild(d.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),n.attributes=le(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=le(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Z.test(d.getElementsByClassName),n.getById=le(function(e){return h.appendChild(e).id=w,!d.getElementsByName||!d.getElementsByName(w).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,i,a=t.getElementById(e);if(a){if((n=a.getAttributeNode("id"))&&n.value===e)return[a];for(i=t.getElementsByName(e),r=0;a=i[r++];)if((n=a.getAttributeNode("id"))&&n.value===e)return[a]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,a=t.getElementsByTagName(e);if("*"===e){for(;n=a[i++];)1===n.nodeType&&r.push(n);return r}return a},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},g=[],m=[],(n.qsa=Z.test(d.querySelectorAll))&&(le(function(e){var t;h.appendChild(e).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+L+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+L+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),(t=d.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+L+"*name"+L+"*="+L+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")}),le(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+L+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Z.test(v=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&le(function(e){n.disconnectedMatch=v.call(e,"*"),v.call(e,"[s!='']:x"),g.push("!=",V)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Z.test(h.compareDocumentPosition),b=t||Z.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return p=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==T&&b(T,e)?-1:t==d||t.ownerDocument==T&&b(T,t)?1:l?D(l,e)-D(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return p=!0,0;var n,r=0,i=e.parentNode,a=t.parentNode,o=[e],s=[t];if(!i||!a)return e==d?-1:t==d?1:i?-1:a?1:l?D(l,e)-D(l,t):0;if(i===a)return fe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;o[r]===s[r];)r++;return r?fe(o[r],s[r]):o[r]==T?-1:s[r]==T?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(f(e),n.matchesSelector&&y&&!A[t+" "]&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=v.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){A(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&f(e),b(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&f(e);var i=r.attrHandle[t.toLowerCase()],a=i&&E.call(r.attrHandle,t.toLowerCase())?i(e,t,!y):void 0;return void 0!==a?a:n.attributes||!y?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],i=0,a=0;if(p=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(C),p){for(;t=e[a++];)t===e[a]&&(i=r.push(a));for(;i--;)e.splice(r[i],1)}return l=null,e},i=se.getText=function(e){var t,n="",r=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=se.selectors={cacheLength:50,createPseudo:ue,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&U.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|"+L+")"+e+"("+L+"|$)"))&&k(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=se.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(H," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var a="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,l,p,f,d,h,y=a!==o?"nextSibling":"previousSibling",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),v=!c&&!s,b=!1;if(m){if(a){for(;y;){for(f=t;f=f[y];)if(s?f.nodeName.toLowerCase()===g:1===f.nodeType)return!1;h=y="only"===e&&!h&&"nextSibling"}return!0}if(h=[o?m.firstChild:m.lastChild],o&&v){for(b=(d=(u=(l=(p=(f=m)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1])&&u[2],f=d&&m.childNodes[d];f=++d&&f&&f[y]||(b=d=0)||h.pop();)if(1===f.nodeType&&++b&&f===t){l[e]=[S,d,b];break}}else if(v&&(b=d=(u=(l=(p=(f=t)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1]),!1===b)for(;(f=++d&&f&&f[y]||(b=d=0)||h.pop())&&((s?f.nodeName.toLowerCase()!==g:1!==f.nodeType)||!++b||(v&&((l=(p=f[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]=[S,b]),f!==t)););return(b-=i)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ue(function(e,n){for(var r,a=i(e,t),o=a.length;o--;)e[r=D(e,a[o])]=!(n[r]=a[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ue(function(e){var t=[],n=[],r=s(e.replace(z,"$1"));return r[w]?ue(function(e,t,n,i){for(var a,o=r(e,null,i,[]),s=e.length;s--;)(a=o[s])&&(e[s]=!(t[s]=a))}):function(e,i,a){return t[0]=e,r(t,null,a,n),t[0]=null,!n.pop()}}),has:ue(function(e){return function(t){return se(e,t).length>0}}),contains:ue(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}}),lang:ue(function(e){return G.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me(function(){return[0]}),last:me(function(e,t){return[t-1]}),eq:me(function(e,t,n){return[n<0?n+t:n]}),even:me(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:me(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:me(function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e}),gt:me(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function ve(){}function be(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function we(e,t,n){var r=t.dir,i=t.next,a=i||r,o=n&&"parentNode"===a,s=x++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var u,l,p,f=[S,s];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(l=(p=t[w]||(t[w]={}))[t.uniqueID]||(p[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=l[a])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(l[a]=f,f[2]=e(t,n,c))return!0}return!1}}function Te(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Se(e,t,n,r,i){for(var a,o=[],s=0,c=e.length,u=null!=t;s<c;s++)(a=e[s])&&(n&&!n(a,r,i)||(o.push(a),u&&t.push(s)));return o}function xe(e,t,n,r,i,a){return r&&!r[w]&&(r=xe(r)),i&&!i[w]&&(i=xe(i,a)),ue(function(a,o,s,c){var u,l,p,f=[],d=[],h=o.length,y=a||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),m=!e||!a&&t?y:Se(y,f,e,s,c),g=n?i||(a?e:h||r)?[]:o:m;if(n&&n(m,g,s,c),r)for(u=Se(g,d),r(u,[],s,c),l=u.length;l--;)(p=u[l])&&(g[d[l]]=!(m[d[l]]=p));if(a){if(i||e){if(i){for(u=[],l=g.length;l--;)(p=g[l])&&u.push(m[l]=p);i(null,g=[],u,c)}for(l=g.length;l--;)(p=g[l])&&(u=i?D(a,p):f[l])>-1&&(a[u]=!(o[u]=p))}}else g=Se(g===o?g.splice(h,g.length):g),i?i(null,o,g,c):I.apply(o,g)})}function ke(e){for(var t,n,i,a=e.length,o=r.relative[e[0].type],s=o||r.relative[" "],c=o?1:0,l=we(function(e){return e===t},s,!0),p=we(function(e){return D(t,e)>-1},s,!0),f=[function(e,n,r){var i=!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):p(e,n,r));return t=null,i}];c<a;c++)if(n=r.relative[e[c].type])f=[we(Te(f),n)];else{if((n=r.filter[e[c].type].apply(null,e[c].matches))[w]){for(i=++c;i<a&&!r.relative[e[i].type];i++);return xe(c>1&&Te(f),c>1&&be(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(z,"$1"),n,c<i&&ke(e.slice(c,i)),i<a&&ke(e=e.slice(i)),i<a&&be(e))}f.push(n)}return Te(f)}return ve.prototype=r.filters=r.pseudos,r.setFilters=new ve,o=se.tokenize=function(e,t){var n,i,a,o,s,c,u,l=O[e+" "];if(l)return t?0:l.slice(0);for(s=e,c=[],u=r.preFilter;s;){for(o in n&&!(i=$.exec(s))||(i&&(s=s.slice(i[0].length)||s),c.push(a=[])),n=!1,(i=B.exec(s))&&(n=i.shift(),a.push({value:n,type:i[0].replace(z," ")}),s=s.slice(n.length)),r.filter)!(i=X[o].exec(s))||u[o]&&!(i=u[o](i))||(n=i.shift(),a.push({value:n,type:o,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):O(e,c).slice(0)},s=se.compile=function(e,t){var n,i=[],a=[],s=j[e+" "];if(!s){for(t||(t=o(e)),n=t.length;n--;)(s=ke(t[n]))[w]?i.push(s):a.push(s);(s=j(e,function(e,t){var n=t.length>0,i=e.length>0,a=function(a,o,s,c,l){var p,h,m,g=0,v="0",b=a&&[],w=[],T=u,x=a||i&&r.find.TAG("*",l),k=S+=null==T?1:Math.random()||.1,O=x.length;for(l&&(u=o==d||o||l);v!==O&&null!=(p=x[v]);v++){if(i&&p){for(h=0,o||p.ownerDocument==d||(f(p),s=!y);m=e[h++];)if(m(p,o||d,s)){c.push(p);break}l&&(S=k)}n&&((p=!m&&p)&&g--,a&&b.push(p))}if(g+=v,n&&v!==g){for(h=0;m=t[h++];)m(b,w,o,s);if(a){if(g>0)for(;v--;)b[v]||w[v]||(w[v]=N.call(c));w=Se(w)}I.apply(c,w),l&&!a&&w.length>0&&g+t.length>1&&se.uniqueSort(c)}return l&&(S=k,u=T),b};return n?ue(a):a}(a,i))).selector=e}return s},c=se.select=function(e,t,n,i){var a,c,u,l,p,f="function"==typeof e&&e,d=!i&&o(e=f.selector||e);if(n=n||[],1===d.length){if((c=d[0]=d[0].slice(0)).length>2&&"ID"===(u=c[0]).type&&9===t.nodeType&&y&&r.relative[c[1].type]){if(!(t=(r.find.ID(u.matches[0].replace(te,ne),t)||[])[0]))return n;f&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(a=X.needsContext.test(e)?0:c.length;a--&&(u=c[a],!r.relative[l=u.type]);)if((p=r.find[l])&&(i=p(u.matches[0].replace(te,ne),ee.test(c[0].type)&&ge(t.parentNode)||t))){if(c.splice(a,1),!(e=i.length&&be(c)))return I.apply(n,i),n;break}}return(f||s(e,d))(i,t,!y,n,!t||ee.test(e)&&ge(t.parentNode)||t),n},n.sortStable=w.split("").sort(C).join("")===w,n.detectDuplicates=!!p,f(),n.sortDetached=le(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),le(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||pe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&le(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||pe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),le(function(e){return null==e.getAttribute("disabled")})||pe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(e);w.find=S,w.expr=S.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=S.uniqueSort,w.text=S.getText,w.isXMLDoc=S.isXML,w.contains=S.contains,w.escapeSelector=S.escape;var x=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},k=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},O=w.expr.match.needsContext;function j(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function C(e,t,n){return h(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return s.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(C(this,e||[],!1))},not:function(e){return this.pushStack(C(this,e||[],!0))},is:function(e){return!!C(this,"string"==typeof e&&O.test(e)?w(e):e||[],!1).length}});var E,_=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||E,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:_.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),A.test(r[1])&&w.isPlainObject(t))for(r in t)h(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=m.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):h(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,E=w(m);var N=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function I(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,a=[],o="string"!=typeof e&&w(e);if(!O.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){a.push(n);break}return this.pushStack(a.length>1?w.uniqueSort(a):a)},index:function(e){return e?"string"==typeof e?s.call(w(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x(e,"parentNode")},parentsUntil:function(e,t,n){return x(e,"parentNode",n)},next:function(e){return I(e,"nextSibling")},prev:function(e){return I(e,"previousSibling")},nextAll:function(e){return x(e,"nextSibling")},prevAll:function(e){return x(e,"previousSibling")},nextUntil:function(e,t,n){return x(e,"nextSibling",n)},prevUntil:function(e,t,n){return x(e,"previousSibling",n)},siblings:function(e){return k((e.parentNode||{}).firstChild,e)},children:function(e){return k(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(j(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(P[e]||w.uniqueSort(i),N.test(e)&&i.reverse()),this.pushStack(i)}});var M=/[^\x20\t\r\n\f]+/g;function D(e){return e}function R(e){throw e}function L(e,t,n,r){var i;try{e&&h(i=e.promise)?i.call(e).done(t).fail(n):e&&h(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}(e):w.extend({},e);var t,n,r,i,a=[],o=[],s=-1,c=function(){for(i=i||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<a.length;)!1===a[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=a.length,n=!1);e.memory||(n=!1),t=!1,i&&(a=n?[]:"")},u={add:function(){return a&&(n&&!t&&(s=a.length-1,o.push(n)),function t(n){w.each(n,function(n,r){h(r)?e.unique&&u.has(r)||a.push(r):r&&r.length&&"string"!==b(r)&&t(r)})}(arguments),n&&!t&&c()),this},remove:function(){return w.each(arguments,function(e,t){for(var n;(n=w.inArray(t,a,n))>-1;)a.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return i=o=[],a=n="",this},disabled:function(){return!a},lock:function(){return i=o=[],n||t||(a=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},w.extend({Deferred:function(t){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=h(e[r[4]])&&e[r[4]];a[r[1]](function(){var e=i&&i.apply(this,arguments);e&&h(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var a=0;function o(t,n,r,i){return function(){var s=this,c=arguments,u=function(){var e,u;if(!(t<a)){if((e=r.apply(s,c))===n.promise())throw new TypeError("Thenable self-resolution");u=e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)&&e.then,h(u)?i?u.call(e,o(a,n,D,i),o(a,n,R,i)):(a++,u.call(e,o(a,n,D,i),o(a,n,R,i),o(a,n,D,n.notifyWith))):(r!==D&&(s=void 0,c=[e]),(i||n.resolveWith)(s,c))}},l=i?u:function(){try{u()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,l.stackTrace),t+1>=a&&(r!==R&&(s=void 0,c=[e]),n.rejectWith(s,c))}};t?l():(w.Deferred.getStackHook&&(l.stackTrace=w.Deferred.getStackHook()),e.setTimeout(l))}}return w.Deferred(function(e){n[0][3].add(o(0,e,h(i)?i:D,e.notifyWith)),n[1][3].add(o(0,e,h(t)?t:D)),n[2][3].add(o(0,e,h(r)?r:R))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},a={};return w.each(n,function(e,t){var o=t[2],s=t[5];i[t[1]]=o.add,s&&o.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),o.add(t[3].fire),a[t[0]]=function(){return a[t[0]+"With"](this===a?void 0:this,arguments),this},a[t[0]+"With"]=o.fireWith}),i.promise(a),t&&t.call(a,a),a},when:function(e){var t=arguments.length,n=t,r=Array(n),a=i.call(arguments),o=w.Deferred(),s=function(e){return function(n){r[e]=this,a[e]=arguments.length>1?i.call(arguments):n,--t||o.resolveWith(r,a)}};if(t<=1&&(L(e,o.done(s(n)).resolve,o.reject,!t),"pending"===o.state()||h(a[n]&&a[n].then)))return o.then();for(;n--;)L(a[n],s(n),o.reject);return o.promise()}});var q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&q.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var F=w.Deferred();function V(){m.removeEventListener("DOMContentLoaded",V),e.removeEventListener("load",V),w.ready()}w.fn.ready=function(e){return F.then(e).catch(function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(m,[w]))}}),w.ready.then=F.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(w.ready):(m.addEventListener("DOMContentLoaded",V),e.addEventListener("load",V));var H=function e(t,n,r,i,a,o,s){var c=0,u=t.length,l=null==r;if("object"===b(r))for(c in a=!0,r)e(t,n,c,r[c],!0,o,s);else if(void 0!==i&&(a=!0,h(i)||(s=!0),l&&(s?(n.call(t,i),n=null):(l=n,n=function(e,t,n){return l.call(w(e),n)})),n))for(;c<u;c++)n(t[c],r,s?i:i.call(t[c],c,n(t[c],r)));return a?t:l?n.call(t):u?n(t[0],r):o},z=/^-ms-/,$=/-([a-z])/g;function B(e,t){return t.toUpperCase()}function W(e){return e.replace(z,"ms-").replace($,B)}var U=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=w.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},U(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[W(t)]=n;else for(r in t)i[W(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][W(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(W):(t=W(t))in r?[t]:t.match(M)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var X=new G,Y=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:J.test(e)?JSON.parse(e):e)}(n)}catch(e){}Y.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return Y.hasData(e)||X.hasData(e)},data:function(e,t,n){return Y.access(e,t,n)},removeData:function(e,t){Y.remove(e,t)},_data:function(e,t,n){return X.access(e,t,n)},_removeData:function(e,t){X.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,a=this[0],o=a&&a.attributes;if(void 0===e){if(this.length&&(i=Y.get(a),1===a.nodeType&&!X.get(a,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf("data-")&&(r=W(r.slice(5)),Z(a,r,i[r]));X.set(a,"hasDataAttrs",!0)}return i}return"object"===(void 0===e?"undefined":_typeof(e))?this.each(function(){Y.set(this,e)}):H(this,function(t){var n;if(a&&void 0===t)return void 0!==(n=Y.get(a,e))?n:void 0!==(n=Z(a,e))?n:void 0;this.each(function(){Y.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Y.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=X.get(e,t),n&&(!r||Array.isArray(n)?r=X.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),a=w._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete a.stop,i.call(e,function(){w.dequeue(e,t)},a)),!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return X.get(e,n)||X.access(e,n,{empty:w.Callbacks("once memory").add(function(){X.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),a=this,o=this.length,s=function(){--r||i.resolveWith(a,[a])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=X.get(a[o],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ee=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),te=["Top","Right","Bottom","Left"],ne=m.documentElement,re=function(e){return w.contains(e.ownerDocument,e)},ie={composed:!0};ne.getRootNode&&(re=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(ie)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&re(e)&&"none"===w.css(e,"display")};function oe(e,t,n,r){var i,a,o=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},c=s(),u=n&&n[3]||(w.cssNumber[t]?"":"px"),l=e.nodeType&&(w.cssNumber[t]||"px"!==u&&+c)&&ee.exec(w.css(e,t));if(l&&l[3]!==u){for(c/=2,u=u||l[3],l=+c||1;o--;)w.style(e,t,l+u),(1-a)*(1-(a=s()/c||.5))<=0&&(o=0),l/=a;l*=2,w.style(e,t,l+u),n=n||[]}return n&&(l=+l||+c||0,i=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=i)),i}var se={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,i=se[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),se[r]=i,i)}function ue(e,t){for(var n,r,i=[],a=0,o=e.length;a<o;a++)(r=e[a]).style&&(n=r.style.display,t?("none"===n&&(i[a]=X.get(r,"display")||null,i[a]||(r.style.display="")),""===r.style.display&&ae(r)&&(i[a]=ce(r))):"none"!==n&&(i[a]="none",X.set(r,"display",n)));for(a=0;a<o;a++)null!=i[a]&&(e[a].style.display=i[a]);return e}w.fn.extend({show:function(){return ue(this,!0)},hide:function(){return ue(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var le,pe,fe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;le=m.createDocumentFragment().appendChild(m.createElement("div")),(pe=m.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),le.appendChild(pe),d.checkClone=le.cloneNode(!0).cloneNode(!0).lastChild.checked,le.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!le.cloneNode(!0).lastChild.defaultValue,le.innerHTML="<option></option>",d.option=!!le.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function me(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&j(e,t)?w.merge([e],n):n}function ge(e,t){for(var n=0,r=e.length;n<r;n++)X.set(e[n],"globalEval",!t||X.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,d.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var ve=/<|&#?\w+;/;function be(e,t,n,r,i){for(var a,o,s,c,u,l,p=t.createDocumentFragment(),f=[],d=0,h=e.length;d<h;d++)if((a=e[d])||0===a)if("object"===b(a))w.merge(f,a.nodeType?[a]:a);else if(ve.test(a)){for(o=o||p.appendChild(t.createElement("div")),s=(de.exec(a)||["",""])[1].toLowerCase(),c=ye[s]||ye._default,o.innerHTML=c[1]+w.htmlPrefilter(a)+c[2],l=c[0];l--;)o=o.lastChild;w.merge(f,o.childNodes),(o=p.firstChild).textContent=""}else f.push(t.createTextNode(a));for(p.textContent="",d=0;a=f[d++];)if(r&&w.inArray(a,r)>-1)i&&i.push(a);else if(u=re(a),o=me(p.appendChild(a),"script"),u&&ge(o),n)for(l=0;a=o[l++];)he.test(a.type||"")&&n.push(a);return p}var we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\.(.+)|)/;function xe(){return!0}function ke(){return!1}function Oe(e,t){return e===function(){try{return m.activeElement}catch(e){}}()==("focus"===t)}function je(e,t,n,r,i,a){var o,s;if("object"===(void 0===t?"undefined":_typeof(t))){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)je(e,s,n,r,t[s],a);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ke;else if(!i)return e;return 1===a&&(o=i,(i=function(e){return w().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}function Ae(e,t,n){n?(X.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var r,a,o=X.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=i.call(arguments),X.set(this,t,o),r=n(this,t),this[t](),o!==(a=X.get(this,t))||r?X.set(this,t,!1):a={},o!==a)return e.stopImmediatePropagation(),e.preventDefault(),a.value}else o.length&&(X.set(this,t,{value:w.event.trigger(w.extend(o[0],w.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,t)&&w.event.add(e,t,xe)}w.event={global:{},add:function(e,t,n,r,i){var a,o,s,c,u,l,p,f,d,h,y,m=X.get(e);if(U(e))for(n.handler&&(n=(a=n).handler,i=a.selector),i&&w.find.matchesSelector(ne,i),n.guid||(n.guid=w.guid++),(c=m.events)||(c=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(M)||[""]).length;u--;)d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||"").split(".").sort(),d&&(p=w.event.special[d]||{},d=(i?p.delegateType:p.bindType)||d,p=w.event.special[d]||{},l=w.extend({type:d,origType:y,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(".")},a),(f=c[d])||((f=c[d]=[]).delegateCount=0,p.setup&&!1!==p.setup.call(e,r,h,o)||e.addEventListener&&e.addEventListener(d,o)),p.add&&(p.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?f.splice(f.delegateCount++,0,l):f.push(l),w.event.global[d]=!0)},remove:function(e,t,n,r,i){var a,o,s,c,u,l,p,f,d,h,y,m=X.hasData(e)&&X.get(e);if(m&&(c=m.events)){for(u=(t=(t||"").match(M)||[""]).length;u--;)if(d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||"").split(".").sort(),d){for(p=w.event.special[d]||{},f=c[d=(r?p.delegateType:p.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=f.length;a--;)l=f[a],!i&&y!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(f.splice(a,1),l.selector&&f.delegateCount--,p.remove&&p.remove.call(e,l));o&&!f.length&&(p.teardown&&!1!==p.teardown.call(e,h,m.handle)||w.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)w.event.remove(e,d+t[u],n,r,!0);w.isEmptyObject(c)&&X.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,a,o,s=new Array(arguments.length),c=w.event.fix(e),u=(X.get(this,"events")||Object.create(null))[c.type]||[],l=w.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,c)){for(o=w.event.handlers.call(this,c,u),t=0;(i=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=i.elem,n=0;(a=i.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==a.namespace&&!c.rnamespace.test(a.namespace)||(c.handleObj=a,c.data=a.data,void 0!==(r=((w.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,i,a,o,s=[],c=t.delegateCount,u=e.target;if(c&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(a=[],o={},n=0;n<c;n++)void 0===o[i=(r=t[n]).selector+" "]&&(o[i]=r.needsContext?w(i,this).index(u)>-1:w.find(i,this,null,[u]).length),o[i]&&a.push(r);a.length&&s.push({elem:u,handlers:a})}return u=this,c<t.length&&s.push({elem:u,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:h(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,"input")&&Ae(t,"click",xe),!1},trigger:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return fe.test(t.type)&&t.click&&j(t,"input")&&X.get(t,"click")||j(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?xe:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=xe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=xe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=xe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},function(e,t){w.event.special[e]={setup:function(){return Ae(this,e,Oe),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}}),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||w.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return je(this,e,t,n,r)},one:function(e,t,n,r){return je(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===(void 0===e?"undefined":_typeof(e))){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ce=/<script|<style|<link/i,Ee=/checked\s*(?:[^=]|=\s*.checked.)/i,_e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ne(e,t){return j(e,"table")&&j(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ie(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(e,t){var n,r,i,a,o,s;if(1===t.nodeType){if(X.hasData(e)&&(s=X.get(e).events))for(i in X.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)w.event.add(t,i,s[i][n]);Y.hasData(e)&&(a=Y.access(e),o=w.extend({},a),Y.set(t,o))}}function De(e,t,n,r){t=a(t);var i,o,s,c,u,l,p=0,f=e.length,y=f-1,m=t[0],g=h(m);if(g||f>1&&"string"==typeof m&&!d.checkClone&&Ee.test(m))return e.each(function(i){var a=e.eq(i);g&&(t[0]=m.call(this,i,a.html())),De(a,t,n,r)});if(f&&(o=(i=be(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(c=(s=w.map(me(i,"script"),Pe)).length;p<f;p++)u=i,p!==y&&(u=w.clone(u,!0,!0),c&&w.merge(s,me(u,"script"))),n.call(e[p],u,p);if(c)for(l=s[s.length-1].ownerDocument,w.map(s,Ie),p=0;p<c;p++)u=s[p],he.test(u.type||"")&&!X.access(u,"globalEval")&&w.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?w._evalUrl&&!u.noModule&&w._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):v(u.textContent.replace(_e,""),u,l))}return e}function Re(e,t,n){for(var r,i=t?w.filter(t,e):e,a=0;null!=(r=i[a]);a++)n||1!==r.nodeType||w.cleanData(me(r)),r.parentNode&&(n&&re(r)&&ge(me(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,a,o,s,c,u,l=e.cloneNode(!0),p=re(e);if(!(d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(o=me(l),r=0,i=(a=me(e)).length;r<i;r++)s=a[r],c=o[r],void 0,"input"===(u=c.nodeName.toLowerCase())&&fe.test(s.type)?c.checked=s.checked:"input"!==u&&"textarea"!==u||(c.defaultValue=s.defaultValue);if(t)if(n)for(a=a||me(e),o=o||me(l),r=0,i=a.length;r<i;r++)Me(a[r],o[r]);else Me(e,l);return(o=me(l,"script")).length>0&&ge(o,!p&&me(e,"script")),l},cleanData:function(e){for(var t,n,r,i=w.event.special,a=0;void 0!==(n=e[a]);a++)if(U(n)){if(t=n[X.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[X.expando]=void 0}n[Y.expando]&&(n[Y.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return H(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return De(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ne(this,e).appendChild(e)})},prepend:function(){return De(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ne(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(me(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return H(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ce.test(e)&&!ye[(de.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return De(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(me(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),a=i.length-1,s=0;s<=a;s++)n=s===a?this:this.clone(!0),w(i[s])[t](n),o.apply(r,n.get());return this.pushStack(r)}});var Le=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),qe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Fe=function(e,t,n){var r,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=a[i];return r},Ve=new RegExp(te.join("|"),"i");function He(e,t,n){var r,i,a,o,s=e.style;return(n=n||qe(e))&&(""!==(o=n.getPropertyValue(t)||n[t])||re(e)||(o=w.style(e,t)),!d.pixelBoxStyles()&&Le.test(o)&&Ve.test(t)&&(r=s.width,i=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=r,s.minWidth=i,s.maxWidth=a)),void 0!==o?o+"":o}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ne.appendChild(u).appendChild(l);var t=e.getComputedStyle(l);r="1%"!==t.top,c=12===n(t.marginLeft),l.style.right="60%",o=36===n(t.right),i=36===n(t.width),l.style.position="absolute",a=12===n(l.offsetWidth/3),ne.removeChild(u),l=null}}function n(e){return Math.round(parseFloat(e))}var r,i,a,o,s,c,u=m.createElement("div"),l=m.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===l.style.backgroundClip,w.extend(d,{boxSizingReliable:function(){return t(),i},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),a},reliableTrDimensions:function(){var t,n,r,i;return null==s&&(t=m.createElement("table"),n=m.createElement("tr"),r=m.createElement("div"),t.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",ne.appendChild(t).appendChild(n).appendChild(r),i=e.getComputedStyle(n),s=parseInt(i.height)>3,ne.removeChild(t)),s}}))}();var $e=["Webkit","Moz","ms"],Be=m.createElement("div").style,We={};function Ue(e){var t=w.cssProps[e]||We[e];return t||(e in Be?e:We[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=$e.length;n--;)if((e=$e[n]+t)in Be)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ye={position:"absolute",visibility:"hidden",display:"block"},Je={letterSpacing:"0",fontWeight:"400"};function Ke(e,t,n){var r=ee.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ze(e,t,n,r,i,a){var o="width"===t?1:0,s=0,c=0;if(n===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(c+=w.css(e,n+te[o],!0,i)),r?("content"===n&&(c-=w.css(e,"padding"+te[o],!0,i)),"margin"!==n&&(c-=w.css(e,"border"+te[o]+"Width",!0,i))):(c+=w.css(e,"padding"+te[o],!0,i),"padding"!==n?c+=w.css(e,"border"+te[o]+"Width",!0,i):s+=w.css(e,"border"+te[o]+"Width",!0,i));return!r&&a>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-a-c-s-.5))||0),c}function Qe(e,t,n){var r=qe(e),i=(!d.boxSizingReliable()||n)&&"border-box"===w.css(e,"boxSizing",!1,r),a=i,o=He(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Le.test(o)){if(!n)return o;o="auto"}return(!d.boxSizingReliable()&&i||!d.reliableTrDimensions()&&j(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===w.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===w.css(e,"boxSizing",!1,r),(a=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+Ze(e,t,n||(i?"border":"content"),a,r,o)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=He(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,a,o,s=W(t),c=Xe.test(t),u=e.style;if(c||(t=Ue(s)),o=w.cssHooks[t]||w.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:u[t];"string"===(a=void 0===n?"undefined":_typeof(n))&&(i=ee.exec(n))&&i[1]&&(n=oe(e,t,i),a="number"),null!=n&&n==n&&("number"!==a||c||(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),d.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,r))||(c?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,r){var i,a,o,s=W(t);return Xe.test(t)||(t=Ue(s)),(o=w.cssHooks[t]||w.cssHooks[s])&&"get"in o&&(i=o.get(e,!0,n)),void 0===i&&(i=He(e,t,r)),"normal"===i&&t in Je&&(i=Je[t]),""===n||n?(a=parseFloat(i),!0===n||isFinite(a)?a||0:i):i}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!Ge.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Qe(e,t,r):Fe(e,Ye,function(){return Qe(e,t,r)})},set:function(e,n,r){var i,a=qe(e),o=!d.scrollboxSize()&&"absolute"===a.position,s=(o||r)&&"border-box"===w.css(e,"boxSizing",!1,a),c=r?Ze(e,t,r,s,a):0;return s&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(a[t])-Ze(e,t,"border",!1,a)-.5)),c&&(i=ee.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Ke(0,n,c)}}}),w.cssHooks.marginLeft=ze(d.reliableMarginLeft,function(e,t){if(t)return(parseFloat(He(e,"marginLeft"))||e.getBoundingClientRect().left-Fe(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},a="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+te[r]+t]=a[r]||a[r-2]||a[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return H(this,function(e,t,n){var r,i,a={},o=0;if(Array.isArray(t)){for(r=qe(e),i=t.length;o<i;o++)a[t[o]]=w.css(e,t[o],!1,r);return a}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}}),w.Tween=et,et.prototype={constructor:et,init:function(e,t,n,r,i,a){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=a||(w.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}},et.prototype.init.prototype=et.prototype,et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Ue(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},et.propHooks.scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=et.prototype.init,w.fx.step={};var tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function at(){nt&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,w.fx.interval),w.fx.tick())}function ot(){return e.setTimeout(function(){tt=void 0}),tt=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=te[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,n){for(var r,i=(ut.tweeners[t]||[]).concat(ut.tweeners["*"]),a=0,o=i.length;a<o;a++)if(r=i[a].call(n,t,e))return r}function ut(e,t,n){var r,i,a=0,o=ut.prefilters.length,s=w.Deferred().always(function(){delete c.elem}),c=function(){if(i)return!1;for(var t=tt||ot(),n=Math.max(0,u.startTime+u.duration-t),r=1-(n/u.duration||0),a=0,o=u.tweens.length;a<o;a++)u.tweens[a].run(r);return s.notifyWith(e,[u,r,n]),r<1&&o?n:(o||s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:tt||ot(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)u.tweens[n].run(1);return t?(s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u,t])):s.rejectWith(e,[u,t]),this}}),l=u.props;for(!function(e,t){var n,r,i,a,o;for(n in e)if(i=t[r=W(n)],a=e[n],Array.isArray(a)&&(i=a[1],a=e[n]=a[0]),n!==r&&(e[r]=a,delete e[n]),(o=w.cssHooks[r])&&"expand"in o)for(n in a=o.expand(a),delete e[r],a)n in e||(e[n]=a[n],t[n]=i);else t[r]=i}(l,u.opts.specialEasing);a<o;a++)if(r=ut.prefilters[a].call(u,e,l,u.opts))return h(r.stop)&&(w._queueHooks(u.elem,u.opts.queue).stop=r.stop.bind(r)),r;return w.map(l,ct,u),h(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),w.fx.timer(w.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u}w.Animation=w.extend(ut,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return oe(n.elem,e,ee.exec(t),n),n}]},tweener:function(e,t){h(e)?(t=e,e=["*"]):e=e.match(M);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ut.tweeners[n]=ut.tweeners[n]||[],ut.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,a,o,s,c,u,l,p="width"in t||"height"in t,f=this,d={},h=e.style,y=e.nodeType&&ae(e),m=X.get(e,"fxshow");for(r in n.queue||(null==(o=w._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,w.queue(e,"fx").length||o.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],a=a||"toggle"===i,i===(y?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;y=!0}d[r]=m&&m[r]||w.style(e,r)}if((c=!w.isEmptyObject(t))||!w.isEmptyObject(d))for(r in p&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(u=m&&m.display)&&(u=X.get(e,"display")),"none"===(l=w.css(e,"display"))&&(u?l=u:(ue([e],!0),u=e.style.display||u,l=w.css(e,"display"),ue([e]))),("inline"===l||"inline-block"===l&&null!=u)&&"none"===w.css(e,"float")&&(c||(f.done(function(){h.display=u}),null==u&&(l=h.display,u="none"===l?"":l)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",f.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),c=!1,d)c||(m?"hidden"in m&&(y=m.hidden):m=X.access(e,"fxshow",{display:u}),a&&(m.hidden=!y),y&&ue([e],!0),f.done(function(){for(r in y||ue([e]),X.remove(e,"fxshow"),d)w.style(e,r,d[r])})),c=ct(y?m[r]:0,r,f),r in m||(m[r]=c.start,y&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?ut.prefilters.unshift(e):ut.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"===(void 0===e?"undefined":_typeof(e))?w.extend({},e):{complete:n||!n&&t||h(e)&&e,duration:e,easing:n&&t||t&&!h(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){h(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),a=w.speed(t,n,r),o=function(){var t=ut(this,w.extend({},e),a);(i||X.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||!1===a.queue?this.each(o):this.queue(a.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",a=w.timers,o=X.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&it.test(i)&&r(o[i]);for(i=a.length;i--;)a[i].elem!==this||null!=e&&a[i].queue!==e||(a[i].anim.stop(n),t=!1,a.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=X.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],a=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(st(t,!0),e,r,i)}}),w.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),tt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){nt||(nt=!0,at())},w.fx.stop=function(){nt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx&&w.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=m.createElement("input"),t=m.createElement("select").appendChild(m.createElement("option"));e.type="checkbox",d.checkOn=""!==e.value,d.optSelected=t.selected,(e=m.createElement("input")).value="t",e.type="radio",d.radioValue="t"===e.value}();var lt,pt=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return H(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?w.prop(e,t,n):(1===a&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?lt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&"radio"===t&&j(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(M);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),lt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=pt[t]||w.find.attr;pt[t]=function(e,t,r){var i,a,o=t.toLowerCase();return r||(a=pt[o],pt[o]=i,i=null!=n(e,t,r)?o:null,pt[o]=a),i}});var ft=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(M)||[]).join(" ")}function yt(e){return e.getAttribute&&e.getAttribute("class")||""}function mt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(M)||[]}w.fn.extend({prop:function(e,t){return H(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):ft.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.fn.extend({addClass:function(e){var t,n,r,i,a,o,s,c=0;if(h(e))return this.each(function(t){w(this).addClass(e.call(this,t,yt(this)))});if((t=mt(e)).length)for(;n=this[c++];)if(i=yt(n),r=1===n.nodeType&&" "+ht(i)+" "){for(o=0;a=t[o++];)r.indexOf(" "+a+" ")<0&&(r+=a+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,a,o,s,c=0;if(h(e))return this.each(function(t){w(this).removeClass(e.call(this,t,yt(this)))});if(!arguments.length)return this.attr("class","");if((t=mt(e)).length)for(;n=this[c++];)if(i=yt(n),r=1===n.nodeType&&" "+ht(i)+" "){for(o=0;a=t[o++];)for(;r.indexOf(" "+a+" ")>-1;)r=r.replace(" "+a+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=void 0===e?"undefined":_typeof(e),r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):h(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,yt(this),t),t)}):this.each(function(){var t,i,a,o;if(r)for(i=0,a=w(this),o=mt(e);t=o[i++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else void 0!==e&&"boolean"!==n||((t=yt(this))&&X.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":X.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+ht(yt(n))+" ").indexOf(t)>-1)return!0;return!1}});var gt=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=h(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(gt,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:ht(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,a=e.selectedIndex,o="select-one"===e.type,s=o?null:[],c=o?a+1:i.length;for(r=a<0?c:o?a:0;r<c;r++)if(((n=i[r]).selected||r===a)&&!n.disabled&&(!n.parentNode.disabled||!j(n.parentNode,"optgroup"))){if(t=w(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,a=w.makeArray(t),o=i.length;o--;)((r=i[o]).selected=w.inArray(w.valHooks.option.get(r),a)>-1)&&(n=!0);return n||(e.selectedIndex=-1),a}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},d.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),d.focusin="onfocusin"in e;var vt=/^(?:focusinfocus|focusoutblur)$/,bt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,r,i){var a,o,s,c,u,p,f,d,g=[r||m],v=l.call(t,"type")?t.type:t,b=l.call(t,"namespace")?t.namespace.split("."):[];if(o=d=s=r=r||m,3!==r.nodeType&&8!==r.nodeType&&!vt.test(v+w.event.triggered)&&(v.indexOf(".")>-1&&(v=(b=v.split(".")).shift(),b.sort()),u=v.indexOf(":")<0&&"on"+v,(t=t[w.expando]?t:new w.Event(v,"object"===(void 0===t?"undefined":_typeof(t))&&t)).isTrigger=i?2:3,t.namespace=b.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:w.makeArray(n,[t]),f=w.event.special[v]||{},i||!f.trigger||!1!==f.trigger.apply(r,n))){if(!i&&!f.noBubble&&!y(r)){for(c=f.delegateType||v,vt.test(c+v)||(o=o.parentNode);o;o=o.parentNode)g.push(o),s=o;s===(r.ownerDocument||m)&&g.push(s.defaultView||s.parentWindow||e)}for(a=0;(o=g[a++])&&!t.isPropagationStopped();)d=o,t.type=a>1?c:f.bindType||v,(p=(X.get(o,"events")||Object.create(null))[t.type]&&X.get(o,"handle"))&&p.apply(o,n),(p=u&&o[u])&&p.apply&&U(o)&&(t.result=p.apply(o,n),!1===t.result&&t.preventDefault());return t.type=v,i||t.isDefaultPrevented()||f._default&&!1!==f._default.apply(g.pop(),n)||!U(r)||u&&h(r[v])&&!y(r)&&((s=r[u])&&(r[u]=null),w.event.triggered=v,t.isPropagationStopped()&&d.addEventListener(v,bt),r[v](),t.isPropagationStopped()&&d.removeEventListener(v,bt),w.event.triggered=void 0,s&&(r[u]=s)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),d.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=X.access(r,t);i||r.addEventListener(e,n,!0),X.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=X.access(r,t)-1;i?X.access(r,t,i):(r.removeEventListener(e,n,!0),X.remove(r,t))}}});var wt=e.location,Tt={guid:Date.now()},St=/\?/;w.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+t),n};var xt=/\[\]$/,kt=/\r?\n/g,Ot=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function At(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||xt.test(e)?r(e,i):At(e+"["+("object"===(void 0===i?"undefined":_typeof(i))&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==b(t))r(e,t);else for(i in t)At(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=h(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&jt.test(this.nodeName)&&!Ot.test(e)&&(this.checked||!fe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var Ct=/%20/g,Et=/#.*$/,_t=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:GET|HEAD)$/,It=/^\/\//,Mt={},Dt={},Rt="*/".concat("*"),Lt=m.createElement("a");function qt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,a=t.toLowerCase().match(M)||[];if(h(n))for(;r=a[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Ft(e,t,n,r){var i={},a=e===Dt;function o(s){var c;return i[s]=!0,w.each(e[s]||[],function(e,s){var u=s(t,n,r);return"string"!=typeof u||a||i[u]?a?!(c=u):void 0:(t.dataTypes.unshift(u),o(u),!1)}),c}return o(t.dataTypes[0])||!i["*"]&&o("*")}function Vt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Lt.href=wt.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,w.ajaxSettings),t):Vt(w.ajaxSettings,e)},ajaxPrefilter:qt(Mt),ajaxTransport:qt(Dt),ajax:function(t,n){"object"===(void 0===t?"undefined":_typeof(t))&&(n=t,t=void 0),n=n||{};var r,i,a,o,s,c,u,l,p,f,d=w.ajaxSetup({},n),h=d.context||d,y=d.context&&(h.nodeType||h.jquery)?w(h):w.event,g=w.Deferred(),v=w.Callbacks("once memory"),b=d.statusCode||{},T={},S={},x="canceled",k={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=Nt.exec(a);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?a:null},setRequestHeader:function(e,t){return null==u&&(e=S[e.toLowerCase()]=S[e.toLowerCase()]||e,T[e]=t),this},overrideMimeType:function(e){return null==u&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)k.always(e[k.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||x;return r&&r.abort(t),O(0,t),this}};if(g.promise(k),d.url=((t||d.url||wt.href)+"").replace(It,wt.protocol+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(M)||[""],null==d.crossDomain){c=m.createElement("a");try{c.href=d.url,c.href=c.href,d.crossDomain=Lt.protocol+"//"+Lt.host!=c.protocol+"//"+c.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=w.param(d.data,d.traditional)),Ft(Mt,d,n,k),u)return k;for(p in(l=w.event&&d.global)&&0==w.active++&&w.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Pt.test(d.type),i=d.url.replace(Et,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Ct,"+")):(f=d.url.slice(i.length),d.data&&(d.processData||"string"==typeof d.data)&&(i+=(St.test(i)?"&":"?")+d.data,delete d.data),!1===d.cache&&(i=i.replace(_t,"$1"),f=(St.test(i)?"&":"?")+"_="+Tt.guid+++f),d.url=i+f),d.ifModified&&(w.lastModified[i]&&k.setRequestHeader("If-Modified-Since",w.lastModified[i]),w.etag[i]&&k.setRequestHeader("If-None-Match",w.etag[i])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&k.setRequestHeader("Content-Type",d.contentType),k.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Rt+"; q=0.01":""):d.accepts["*"]),d.headers)k.setRequestHeader(p,d.headers[p]);if(d.beforeSend&&(!1===d.beforeSend.call(h,k,d)||u))return k.abort();if(x="abort",v.add(d.complete),k.done(d.success),k.fail(d.error),r=Ft(Dt,d,n,k)){if(k.readyState=1,l&&y.trigger("ajaxSend",[k,d]),u)return k;d.async&&d.timeout>0&&(s=e.setTimeout(function(){k.abort("timeout")},d.timeout));try{u=!1,r.send(T,O)}catch(e){if(u)throw e;O(-1,e)}}else O(-1,"No Transport");function O(t,n,o,c){var p,f,m,T,S,x=n;u||(u=!0,s&&e.clearTimeout(s),r=void 0,a=c||"",k.readyState=t>0?4:0,p=t>=200&&t<300||304===t,o&&(T=function(e,t,n){for(var r,i,a,o,s=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){c.unshift(i);break}if(c[0]in n)a=c[0];else{for(i in n){if(!c[0]||e.converters[i+" "+c[0]]){a=i;break}o||(o=i)}a=a||o}if(a)return a!==c[0]&&c.unshift(a),n[a]}(d,k,o)),!p&&w.inArray("script",d.dataTypes)>-1&&(d.converters["text script"]=function(){}),T=function(e,t,n,r){var i,a,o,s,c,u={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(a=l.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=a,a=l.shift())if("*"===a)a=c;else if("*"!==c&&c!==a){if(!(o=u[c+" "+a]||u["* "+a]))for(i in u)if((s=i.split(" "))[1]===a&&(o=u[c+" "+s[0]]||u["* "+s[0]])){!0===o?o=u[i]:!0!==u[i]&&(a=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+c+" to "+a}}}return{state:"success",data:t}}(d,T,k,p),p?(d.ifModified&&((S=k.getResponseHeader("Last-Modified"))&&(w.lastModified[i]=S),(S=k.getResponseHeader("etag"))&&(w.etag[i]=S)),204===t||"HEAD"===d.type?x="nocontent":304===t?x="notmodified":(x=T.state,f=T.data,p=!(m=T.error))):(m=x,!t&&x||(x="error",t<0&&(t=0))),k.status=t,k.statusText=(n||x)+"",p?g.resolveWith(h,[f,x,k]):g.rejectWith(h,[k,x,m]),k.statusCode(b),b=void 0,l&&y.trigger(p?"ajaxSuccess":"ajaxError",[k,d,p?f:m]),v.fireWith(h,[k,x]),l&&(y.trigger("ajaxComplete",[k,d]),--w.active||w.event.trigger("ajaxStop")))}return k},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,i){return h(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),w._evalUrl=function(e,t,n){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){w.globalEval(e,t,n)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(h(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return h(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Ht={0:200,1223:204},zt=w.ajaxSettings.xhr();d.cors=!!zt&&"withCredentials"in zt,d.ajax=zt=!!zt,w.ajaxTransport(function(t){var n,r;if(d.cors||zt&&!t.crossDomain)return{send:function(i,a){var o,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)s[o]=t.xhrFields[o];for(o in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(o,i[o]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?a(0,"error"):a(s.status,s.statusText):a(Ht[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=w("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),m.head.appendChild(t[0])},abort:function(){n&&n()}}});var $t,Bt=[],Wt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Bt.pop()||w.expando+"_"+Tt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(t,n,r){var i,a,o,s=!1!==t.jsonp&&(Wt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Wt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=h(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Wt,"$1"+i):!1!==t.jsonp&&(t.url+=(St.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||w.error(i+" was not called"),o[0]},t.dataTypes[0]="json",a=e[i],e[i]=function(){o=arguments},r.always(function(){void 0===a?w(e).removeProp(i):e[i]=a,t[i]&&(t.jsonpCallback=n.jsonpCallback,Bt.push(i)),o&&h(a)&&a(o[0]),o=a=void 0}),"script"}),d.createHTMLDocument=(($t=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===$t.childNodes.length),w.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(d.createHTMLDocument?((r=(t=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,t.head.appendChild(r)):t=m),a=!n&&[],(i=A.exec(e))?[t.createElement(i[1])]:(i=be([e],t,a),a&&a.length&&w(a).remove(),w.merge([],i.childNodes)));var r,i,a},w.fn.load=function(e,t,n){var r,i,a,o=this,s=e.indexOf(" ");return s>-1&&(r=ht(e.slice(s)),e=e.slice(0,s)),h(t)?(n=t,t=void 0):t&&"object"===(void 0===t?"undefined":_typeof(t))&&(i="POST"),o.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){a=arguments,o.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){o.each(function(){n.apply(this,a||[e.responseText,t,e])})}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,a,o,s,c,u=w.css(e,"position"),l=w(e),p={};"static"===u&&(e.style.position="relative"),s=l.offset(),a=w.css(e,"top"),c=w.css(e,"left"),("absolute"===u||"fixed"===u)&&(a+c).indexOf("auto")>-1?(o=(r=l.position()).top,i=r.left):(o=parseFloat(a)||0,i=parseFloat(c)||0),h(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+o),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):("number"==typeof p.top&&(p.top+="px"),"number"==typeof p.left&&(p.left+="px"),l.css(p))}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||ne})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return H(this,function(e,r,i){var a;if(y(e)?a=e:9===e.nodeType&&(a=e.defaultView),void 0===i)return a?a[t]:e[r];a?a.scrollTo(n?a.pageXOffset:i,n?i:a.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=ze(d.pixelPosition,function(e,n){if(n)return n=He(e,t),Le.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(i,a){var o=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===a?"margin":"border");return H(this,function(t,n,i){var a;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,o?i:void 0,o)}})}),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});var Ut=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.proxy=function(e,t){var n,r,a;if("string"==typeof t&&(n=e[t],t=e,e=n),h(e))return r=i.call(arguments,2),(a=function(){return e.apply(t||this,r.concat(i.call(arguments)))}).guid=e.guid=e.guid||w.guid++,a},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=j,w.isFunction=h,w.isWindow=y,w.camelCase=W,w.type=b,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?"":(e+"").replace(Ut,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var Gt=e.jQuery,Xt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Xt),t&&e.jQuery===w&&(e.jQuery=Gt),w},void 0===t&&(e.jQuery=e.$=w),w}),define("jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]instanceof Text?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return e instanceof Text&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){return this.filter(e).add(this.find(e))}})}),function(){var e=void 0,t={};function n(){for(var e=0;e<arguments.length;e++)for(var t in arguments[e])this[t]=arguments[e][t]}function r(e,t){e.childAt=e.childAt||{};for(var n=t.start;n<t.end;n+=1)e.childAt[n]=t}function i(e,t,n,r){return!(e.canFollow&&!(e.canFollow.indexOf(n&&n.type)>-1)||e.cannotFollow&&(-1!==e.cannotFollow.indexOf(n&&n.type)||e.cannotFollow.indexOf("text")>-1&&r)||e.peek&&e.peek.toLowerCase()!==t.slice(0,e.peek.length).toLowerCase())}function a(e){for(var n=e.innerText,r=[],a=0,s=a,c=n.length,u=null;a<c;){for(var l=n.slice(a),p=(r.length?r[0]:e).innerMode,f=0,d=p.length;f<d;f+=1){var h=t[p[f]];if(i(h,l,u,s<a)&&h.pattern.test(l)){var y=h.pattern.exec(l),m=h.fn(y),g=!1,v=0;if(m.matches){for(;v<r.length;v+=1){var b=r[v].type;if(b in m.matches){g=!0;break}0===b.indexOf("verbatim")&&(b="verbatimOpener"),m.cannotCross&&m.cannotCross.indexOf(b)>-1&&(v=r.length-1)}if(v>=r.length&&!m.isFront)continue}s<a&&e.addChild({type:"text",text:n.slice(s,a),innerMode:p}),s=a+=(u=e.addChild(m)).text.length,g&&(o(e,u,r[v]),r=r.slice(v+1)),u.isFrontToken()&&r.unshift(u);break}}f===d&&(a+=1,null===u&&(u={type:"text"}))}for(s<a&&e.addChild({type:"text",text:n.slice(s,a),innerMode:(r.length?r[0]:e).innerMode});r.length>0;)r.shift().demote();return e}function o(e,t,n){var i=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,i-(a+1)),t.children.forEach(function(e){r(t,e)}),t.type=t.matches[n.type],t.innerText="";for(var o=0,s=t.children.length;o<s;o++)t.innerText+=t.children[o].text;t.start=n.start,t.text=n.text+t.innerText+t.text,Object.keys(n).forEach(function(e){Object.hasOwnProperty.call(t,e)||(t[e]=n[e])}),t.isFront&&(t.isFront=!1),e.children.splice(a,1),r(e,t)}n.prototype={constructor:n,addChild:function(e){var t=this.lastChildEnd(),i=new n({start:t,end:e.text&&t+e.text.length,children:[]},e);return i.innerText&&a(i),this.children.push(i),r(this,i),i},firstChild:function(){return this.children&&this.children[0]||null},lastChild:function(){return this.children&&this.children[this.children.length-1]||null},lastChildEnd:function(){var e=this.lastChild();return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.childAt)return this.childAt[e]&&this.childAt[e].tokenAt(e)||this;if(this.children.length)for(var t=0;t<this.children.length;t+=1){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];if(this.childAt)return(this.childAt[e]&&this.childAt[e].pathAt(e)||[]).concat(this);var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1){var r=this.children[n].pathAt(e);if(r.length){t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(t,n){return t||(e>=n.start&&e<n.end?n:null)},null):this},everyLeaf:function(e){return this.children&&0!==this.children.length?this.children.reduce(function(t,n){return t&&n.everyLeaf(e)},!0):!!e(this)},isWhitespace:function(){return this.everyLeaf(function(e){return"whitespace"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return"matches"in this},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&this.children.length>0&&(e+="["+this.children+"]"),e}},e={lex:function(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start";return a(new n({type:"root",start:r||0,end:t.length,text:t,innerText:t,children:[],childAt:{},innerMode:e.modes[i]}))},rules:t,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("lexer",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=e):this.TwineLexer=e}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e;function t(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))?(Object.keys(e).forEach(function(n){e[n]=t(e[n])}),e):(e+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function n(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=n("?:"),i=n("?!"),a=n("?="),o="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=o.replace("*","+"),c="\\b",u="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",l=u.replace("\\-",""),p=r("\\n","$"),f=o+"(\\*+)"+s,d=o+"((?:0\\.)+)"+s,h=o+"-{3,}"+o+p,y=o+"(==+>|<=+|=+><=+|<==+>)"+o+p,m=o+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+o+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(t).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+i("\\]"))+"+)"},v=l+"*"+l.replace("\\w","a-zA-Z")+l+"*",b="\\$("+v+")",w="_("+v+")",T="'s"+s+"("+v+")",S="("+v+")"+s+"of"+c+i("it\\b"),x="'s"+s,k=r("it","time","visits?","exits?","pos")+c,O="its"+s+"("+v+")",j="its"+s,A="("+v+")"+s+"of"+s+"it"+c,C="of\\b"+s+"it"+c,E={opener:"\\(",name:"("+r("\\$","_")+"?"+u+"+):"+i("\\/"),closer:"\\)"},_=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),N="[a-zA-Z][\\w\\-]*",P="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",I="\\|("+u+"+)(>|\\))",M="(<|\\()("+u+"+)\\|",D="\\b(\\d+(?:\\.\\d+)?(?:[eE][+\\-]?\\d+)?)"+i("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:u,anyLetterStrict:l,whitespace:s,escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",commentFront:"\x3c!--",commentBack:"--\x3e",tag:"<\\/?"+N+P+">",tagPeek:"<",scriptStyleTag:"<("+r("script","style","textarea")+")"+P+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:y,column:m,bulleted:f,numbered:d,strikeOpener:t("~~"),italicOpener:t("//"),boldOpener:t("''"),supOpener:t("^^"),strongFront:t("**"),strongBack:t("**"),emFront:t("*"),emBack:t("*"),verbatimOpener:"`+",collapsedFront:"{",collapsedBack:"}",hookAppendedFront:"\\["+i("=+"),hookPrependedFront:I+"\\["+i("=+"),hookFront:"\\["+i("=+"),hookBack:"\\]"+i(M),hookAppendedBack:"\\]"+M,unclosedHook:"\\[=+",unclosedHookPrepended:I+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,passageLinkPeek:"[[",legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,legacyLinkPeek:"[[",simpleLink:g.opener+g.legacyText+g.closer,simpleLinkPeek:"[[",macroFront:E.opener+a(E.name),macroFrontPeek:"(",macroName:E.name,groupingFront:"\\("+i(E.name),groupingFrontPeek:"(",groupingBack:"\\)",twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",twine1MacroPeek:"<<",validPropertyName:v,property:T,propertyPeek:"'s",belongingProperty:S,possessiveOperator:x,belongingOperator:"of\\b",belongingOperatorPeek:"of",itsOperator:j,itsOperatorPeek:"its",belongingItOperator:C,belongingItOperatorPeek:"of",variable:b,variablePeek:"$",tempVariable:w,tempVariablePeek:"_",hookName:"\\?("+u+"+)\\b",hookNamePeek:"?",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+i("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:D,boolean:r("true","false")+c,identifier:k,itsProperty:O,itsPropertyPeek:"its",belongingItProperty:A,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+i(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+i(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+o+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:t("+")+i("="),subtraction:t("-")+i("=","type"),multiplication:t("*")+i("="),division:r("/","%")+i("="),comma:",",spread:"\\.\\.\\."+i("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:t("-type")+c,incorrectOperator:_},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e=void 0;Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var t=Object.keys,n=Object.assign;function r(r){return Object.freeze({lex:function(r){function i(e){return e=e||"innerText",function(t){var n=t.reduceRight(function(e,t,n){return e||(n?t:"")},""),r={};return r[e]=n,r}}function a(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var o=Object.bind(0,null);function s(e,t){return Object.keys(t).forEach(function(n){var r=t[n].fn;t[n].fn=function(t){var i=r(t);return i.text||(i.text=t[0]),i.type||(i.type=n),i.innerMode||(i.innerMode=e),i}}),t}var c=[],u=[],l=[],p=s(c,{hr:{fn:o},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf("><");return~r?25===(t=Math.round(r/(n.length-2)*50))&&(t="center"):"<"===n[0]&&">"===n.slice(-1)?t="justify":n.indexOf(">")>-1?t="right":n.indexOf("<")>-1&&(t="left"),{align:t}}},column:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf("|");return r&&r<n.length-1?t="center":"|"===n[0]&&"|"===n.slice(-1)?t="none":r===n.length-1?t="right":r||(t="left"),{column:t,width:/\|+/.exec(n)[0].length,marginLeft:/^=*/.exec(n)[0].length,marginRight:/=*$/.exec(n)[0].length}}}});t(p).forEach(function(e){p[e].canFollow=[null,"br","hr","bulleted","numbered","heading","align","column","escapedLine"],p[e].cannotFollow=["text"]});var f=s(c,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:a("boldOpener","bold")},italicOpener:{fn:a("italicOpener","italic")},strikeOpener:{fn:a("strikeOpener","strike")},supOpener:{fn:a("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:o},tag:{fn:o},url:{fn:o},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:o},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var t=e[0].length,n={};return n["verbatim"+t]="verbatim",{type:"verbatim"+t,isFront:!0,matches:n}}},unclosedCollapsed:{fn:o},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:o},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:c}}},br:{fn:o}}),d=n(s(u,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",r=e[3]||"";return{type:"twineLink",innerText:n?r:t,passage:t?r:n,innerMode:c}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:c}}},variable:{cannotFollow:["macroFront"],fn:i("name")},tempVariable:{cannotFollow:["macroFront"],fn:i("name")}}),{hookFront:f.hookFront,hookBack:f.hookBack}),h=s(u,n({macroName:{canFollow:["macroFront"],fn:i("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:i("name"),canFollow:["variable","hookName","property","tempVariable","colour","itsProperty","belongingItProperty","macro","grouping","string","datatype","hook","boolean","number"]},possessiveOperator:{fn:o},itsProperty:{cannotFollow:["text"],fn:i("name")},itsOperator:{cannotFollow:["text"],fn:o},belongingItProperty:{cannotFollow:["text"],fn:i("name")},belongingItOperator:{cannotFollow:["text"],fn:o},belongingProperty:{cannotFollow:["text"],fn:i("name")},belongingOperator:{cannotFollow:["text"],fn:o},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:l}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:l}}},hookName:{fn:i("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollow:["text"],fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollow:["text"],fn:function(e){var t=e[0].toLowerCase(),n={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return{colour:Object.hasOwnProperty.call(n,t)?"#"+n[t]:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:e[1].indexOf("not")>-1}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:i("name"),cannotFollow:["text"]},whitespace:{fn:o,cannotFollow:"text"},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollow:"text"}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:o,cannotFollow:["text"]},e},{}),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:o},e},{}))),y=s(l,{singleStringCloser:h.singleStringOpener,doubleStringCloser:h.doubleStringOpener,escapedStringChar:h.escapedStringChar});c.push.apply(c,_toConsumableArray(t(p)).concat(_toConsumableArray(t(d)),_toConsumableArray(t(f)))),u.push.apply(u,_toConsumableArray(t(d)).concat(_toConsumableArray(t(h)))),l.push.apply(l,_toConsumableArray(t(y)));var m=n({},p,f,d,h,y);t(m).forEach(function(t){var n=e[t];m[t].pattern="string"!=typeof n?n:RegExp("^(?:"+n+")","i"),e[t+"Peek"]&&(m[t].peek=e[t+"Peek"])}),n(r.rules,m);var g=r.modes;return g.start=g.markup=c,g.macro=u,g.string=l,r}(r).lex,Patterns:e})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(e=require("./patterns"),module.exports=r(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(t,n){return e=n,r(t)}):this&&this.loaded&&this.modules?(e=this.modules.Patterns,this.modules.Markup=r(this.modules.Lexer)):(e=this.Patterns,this.TwineMarkup=r(this.TwineLexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),define("utils/polyfills",[],function(){var e=Array.prototype;"function"!=typeof e.includes&&(e.includes=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(t)&&Number.isFinite(n)&&void 0!==t)return e.indexOf.call(this,t,n)>-1;var r=Object(this),i=parseInt(r.length);if(i<=0)return!1;for(var a=n>=0?n:Math.max(0,i+n);a<i;){if(Object.is(t,r[a]))return!0;a+=1}return!1}),!window.Symbol&&(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils",["jquery","markup","utils/polyfills"],function(e){var t=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),r="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),i=["audio"],a=[function(e){return t(e)!==t(e).toLowerCase()},function(e){return t(e)!==t(e).toUpperCase()},function(e){return t(e).toLowerCase()!==t(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,n,r){return e===r[n-1]+1&&e===r[n+1]-1?"-":t(e)}).join("").replace(/\-+/g,"-")+"]"}),o=_slicedToArray(a,3),s=o[0],c=o[1],u=o[2];function l(e){return"instant"===e?0:800}var p=void 0,f=[],d={},h=0,y={},m=0,g={},v=void 0;function b(e,t,n,r,i){var a=null,o=0,s=t+n;function c(n){1&e[0].compareDocumentPosition(document)&&(s=0),a&&(s-=n-a,o+=n-a),a=n,r>0&&h+m>0&&(s-=r,e.css("animation-delay",(v.cssTimeUnit(e.css("animation-delay"))||0)-r+"ms")),s<=0?i(o):requestAnimationFrame(c),s<=t&&e.css("visibility","")}s?requestAnimationFrame(c):c()}return e(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,r=e.type.includes("down"),i=t?d:y,a=t&&v.insensitiveName(t)||n;i[a]&&!r?t?h=Math.max(h-1,0):m=Math.max(m-1,0):!i[a]&&r&&(t?h+=1:m+=1),i[a]=r}).on("mousemove",function(e){var t=e.pageX,n=e.pageY;g.x=t,g.y=n}),v={lockProperty:function(e,t,n){var r=Object.create({configurable:0,writable:0});return n&&(r.value=n),Object.defineProperty(e,t,r),e},permutations:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=t.length,i=[[].concat(t)],a=Array(r).fill(0),o=1,s=void 0,c=void 0;o<r;)a[o]<o?(s=o%2&&a[o],c=t[o],t[o]=t[s],t[s]=c,++a[o],o=1,i.push([].concat(t))):(a[o]=0,++o);return i},shuffled:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t,n){var r=Math.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[])},matMul:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a;if(r.length>0)return(a=v).matMul.apply(a,[v.matMul(e,t)].concat(r));if(!t)return e;for(var o=[],s=0;s<e.length;s++){o[s]=[];for(var c=0;c<t[0].length;c++){for(var u=0,l=0;l<e[0].length;l++)u+=e[s][l]*t[l][c];o[s][c]=u}}return o},cssTimeUnit:function(e){return"ms"===(e=e.toLowerCase()).slice(-2)?+e.slice(0,-2)||0:"s"===e.slice(-1)&&1e3*+e.slice(0,-1)||0},nth:function(e){var t=(+e+"").slice(-1);return e+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")},plural:function(e,t){return e+" "+t+(e>1?"s":"")},andList:function(e){return 1===e.length?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:s,anyLowercase:c,anyCasedLetter:u,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},allKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return d[e]})},someKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return d[e]})},buttonsDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return y[e]})},anyInputDown:function(){return h+m>0},mouseCoords:g,parentColours:function(e){for(var t={colour:null,backgroundColour:null},n=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent()){if(!t.backgroundColour){var r=e.css("background-color");r.match(n)||(t.backgroundColour=r)}if(!t.colour){var i=e.css("color");i.match(n)||(t.colour=i)}if(t.colour&&t.backgroundColour)return t}return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){return!!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))||!n.includes(e.tagName.toLowerCase())&&!/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style"))&&(!!r.includes(e.tagName.toLowerCase())||(t.push(e),!0))})&&t.every(function(e){return window.getComputedStyle(e).display.includes("inline")})},transitionReplace:function(t,n,r){var i=t.closest("tw-hook");i.length>0&&(t=i);var a=e("<tw-transition-container>").css("position","relative");a.insertBefore(t.first());var o=void 0;n&&(o=e("<tw-transition-container>").appendTo(a),n.appendTo(o));var s=e("<tw-transition-container>").css("position","absolute").prependTo(a);t.detach().appendTo(s),v.transitionOut(s,r),n&&v.transitionIn(o,r,function(){o.unwrap().children().first().unwrap()})},transitionOut:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||l(t),(e.length>1||!v.childrenProbablyInline(e)||!["tw-hook","tw-passage","tw-expression"].includes(e.tag()))&&(e=e.wrapAll("<tw-transition-container>").parent()),o&&e.css("transform-origin",o),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":n+"ms","animation-delay":r-a+"ms"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),b(e,n,r-a,i,function(){e.remove()}))},transitionIn:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;if(0!==t.length){r=r||l(n);var u=t.length>1||!v.childrenProbablyInline(t)||!["tw-hook","tw-passage","tw-expression"].includes(t.tag());u&&(t=t.wrapAll("<tw-transition-container>").parent()),c&&t.css("transform-origin",c),t.attr("data-t8n",n).addClass("transition-in").css(Object.assign({"animation-duration":r+"ms","animation-delay":a-s+"ms"},a-s?{visibility:"hidden"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(t)?t.css("display","inline"):t.parent().is("tw-backdrop,tw-story")||t[0].setAttribute("style",t[0].getAttribute("style")+"display:block !important;width:100%")}),b(t,r,a-s,o,function(n){var r=0===t.filter(i.join(",")).length;u&&r?(t.find("tw-transition-container").each(function(t,r){(r=e(r)).css("animation-delay",v.cssTimeUnit(r.css("animation-delay")||0)-n+"ms")}),t.contents().unwrap()):t.removeClass("transition-in").removeAttr("data-t8n")})}},debounce:function(e){var t=void 0,n=void 0,r=0,i=function i(){Date.now()-r>300?(t=0,e.apply(void 0,_toConsumableArray(n))):t=requestAnimationFrame(i)};return function(){r=Date.now(),n=arguments,t&&cancelAnimationFrame(t),t=requestAnimationFrame(i)}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},assertMustHave:function(e,t){if(window.console)for(var n=0;n<t.length;n+=1)t[n]in e||console.error("Assertion failed: object lacks property "+t[n])},assertOnlyHas:function(e,t){if(window.console)for(var n in e)t.includes(n)||console.error("Assertion failed: object had unexpected property '"+n+"'!")},onStartup:function(e){f?f.push(e):e()},get storyElement(){return p}},e(function(){p=e("tw-story"),f.forEach(function(e){return e()}),f=null}),Object.freeze(v)}),define("utils/naturalsort",[],function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:String;return function(n,r){var i,a,o,s,c=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,p=/^0/,f=t(n).trim(),d=t(r).trim(),h=f.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),y=d.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(f.match(l))||1!==h.length&&f.match(u)&&Date.parse(f),g=parseInt(d.match(l))||m&&d.match(u)&&Date.parse(d)||null;if(e&&window.Intl&&window.Intl.Collator&&(o=window.Intl.Collator(e)),g){if(m<g)return-1;if(m>g)return 1}for(var v=0,b=Math.max(h.length,y.length);v<b;v++){if(i=!(h[v]||"").match(p)&&parseFloat(h[v])||h[v]||0,a=!(y[v]||"").match(p)&&parseFloat(y[v])||y[v]||0,isNaN(i)!==isNaN(a))return isNaN(i)?1:-1;if((void 0===i?"undefined":_typeof(i))!==(void 0===a?"undefined":_typeof(a)))i+="",a+="";else if("string"==typeof i&&o&&0!==(s=o.compare(i,a)))return s;if(i<a)return-1;if(i>a)return 1}return 0}}}),define("twinescript/compiler",["utils"],function(e){var t=e.impossible,n=JSON.stringify;function r(e,t){for(var n=0;n<e.length;n+=1)if(t.includes(e[n].type))return n;return NaN}function i(e,t){var n=[];return e.length?([["error"],["comma"],["to","into"],["where","when","via"],["making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink"],["macro"],["grouping"]]["most"===t?"reverse":"valueOf"]().some(function(t){var i=void 0;if(i=t.rightAssociative?r(e,t.rightAssociative):function(e,t){return e.length-1-r.apply(void 0,[[].concat(_toConsumableArray(e)).reverse(),t])}(e,t),!Number.isNaN(i)&&i>-1)return n=[e[i],i],!0}),n):n}function a(e){if("inequality"===e.type){var t=e.operator;return e.negate?{">":"<=","<":">=",">=":"<","<=":">"}[t]:t}return e.type}function o(e){var t=a(e);return{">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"}[t]||t}var s=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"];return function e(r){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=c.isVarRef,l=c.isTypedVar,p=c.whitespaceError,f=c.elidedComparison,d=c.testNeedsRight,h="Operations.Identifiers.it";if(!(r=[].concat(r)).length)return u&&p?"TwineError.create('operation',"+n(p)+")":"";var y=void 0;if(1===r.length){var m=(y=r[0]).type;if("identifier"===m)return u?"VarRef.create(Operations.Identifiers,"+n(y.text)+")":"Operations.Identifiers."+y.text.toLowerCase()+" ";if("variable"===m||"tempVariable"===m){var g="VarRef.create("+("tempVariable"===m?"section.stackTop.tempV":"State.v")+"ariables,"+n(y.name)+")"+(u||l?"":".get()");return l?"TypedVar.create(Datatype.create('any'),"+g+")":g}if("hookName"===m)return"HookSet.create({type:'name', data:'"+y.name+"'}) ";if("string"===m)return y.text.replace(/\n/g,"\\n");if("hook"===m)return"CodeHook.create("+n(y.text.slice(1,-1))+","+n(y.html||"")+")";if("colour"===m)return"Colour.create("+n(y.colour)+")";if("datatype"===m)return"Datatype.create("+n(y.name)+")";if("blockedValue"===m)return"section.blockedValue()";if("root"===m)return e(y.children);if("whitespace"===m&&u&&p)return"TwineError.create('operation',"+n(p)+")"}var v,b=i(r,"least"),w=_slicedToArray(b,2);y=w[0],v=w[1];var T=(y||{}).type,S=r.slice(0,v),x=r.slice(v+1),k=function(e,t){return{isVarRef:!0,isTypedVar:t,whitespaceError:"I need usable data to be on the "+e+' of "'+y.text+'".'}},O="must",j="mustn't",A="may",C=void 0,E=void 0,_="",N="",P="",I=O,M=O,D=!1;if(T)if("comma"===T)N=",",M=A;else if("spread"===T)_="Operations.makeSpreader(",P=")",I=A;else if("bind"===T)_="VarBind.create(",E=e(x,k("right")),P=(y.text.startsWith("2")?",'two way'":"")+")",I=j;else if("to"===T)_="Operations.makeAssignmentRequest(Operations.setIt(",E=e(x,k("right")),N="),",C=e(S,k("left",!0)),P=",'to')";else if("into"===T)_="Operations.makeAssignmentRequest(",E=e(S,k("left")),N=",Operations.setIt(",C=e(x,k("right",!0)),P="),'into')";else if("typeSignature"===T)_="TypedVar.create(",N=",",E=e(x,k("right")),P=")",l=!1;else if("where"===T||"when"===T||"via"===T)_="Lambda.create(",C=e(S,{isVarRef:!0,whitespaceError:null}).trim()||"undefined",N=","+n(y.type)+",",E=n(e(x)),P=","+n(r.map(function(e){return e.text}).join(""))+")";else if("making"===T||"each"===T)"each"===T?(_="Lambda.create(",E=e(x,k("right")).trim(),P=",'where','true',"+n(r.map(function(e){return e.text}).join(""))+")",I=A):(_="Lambda.create(",C=e(S,{isVarRef:!0,whitespaceError:null}).trim()||"undefined",N=","+n(y.type)+",",E=e(x,k("right")).trim(),P=","+n(r.map(function(e){return e.text}).join(""))+")");else if("augmentedAssign"===T)_="Operations.makeAssignmentRequest(",C=e(S,k("left")),N=",",E="Operations["+n(y.operator)+"]("+e(S)+","+e(x)+")",P=","+n(y.operator)+")";else if("and"===T||"or"===T){var R=function e(t){var n=i(t,"least"),r=_slicedToArray(n,2),a=r[0],o=r[1];if(a)return s.includes(a.type)?a:["and","or"].includes(a.type)?e(t.slice(0,o))||e(t.slice(o+1)):void 0},L=R(S),q=R(x),F="TwineError.create('operation', 'This use of \"is not\" and \""+T+"\" is grammatically ambiguous','Maybe try rewriting this as \"__ is not __ "+T+" __ is not __\"') ";if(_="Operations."+T+"(",N=",",P=")",f===y.type)_=P="",C=e(S,{isVarRef:u,elidedComparison:f}).trim(),E=e(x,{elidedComparison:f}).trim();else if(L&&!q){var V=L,H=n(a(V));if("isNot"===V.type||"isNotA"===V.type||"untypifies"===V.type)return F;E="Operations.elidedComparisonOperator("+n(y.type)+","+H+","+e(x,{elidedComparison:T})+")"}else if(!L&&q){var z=q,$=r.indexOf(z),B=n(o(z));if("isNot"===z.type||"isNotA"===z.type||"untypifies"===z.type)return F;E="Operations.elidedComparisonOperator("+n(y.type)+","+B+","+e(S,{elidedComparison:T})+")",C=e([].concat(_toConsumableArray(r.slice($+1)),[Object.assign(Object.create(z),_defineProperty({},"inequality"===z.type?"operator":"type",o(z)))],_toConsumableArray(r.slice(v+1,$))))}u=!1}else if(s.includes(T))D=!0,u=!1,_="Operations["+n(a(y))+"](",N=",",P=")";else if("addition"===T||"subtraction"===T){if(!e(S,{testNeedsRight:!0}).trim())return y.type={addition:"positive",subtraction:"negative"}[T],e(r,{isVarRef:u,whitespaceError:p,elidedComparison:f,testNeedsRight:d});u=!1,_="Operations["+n(y.text)+"](",N=",",P=")"}else if("multiplication"===T||"division"===T)u=!1,_="Operations["+n(y.text)+"](",N=",",P=")";else if("positive"===T||"negative"===T)u=!1,C="negative"===T?"-1":"1",_="Operations['*'](",N=",",P=")";else if("not"===T)_="Operations.not(",E=e(x),P=")",I=A;else if("belongingProperty"===T)_="VarRef.create(",E=e(x,k("right")),P=","+n(y.name)+")"+(u?"":".get()"),I=A;else if("belongingOperator"===T||"belongingItOperator"===T)C=y.type.includes("It")?h:e(x,k("right")),E=e(S),_="VarRef.create(",N=",{computed:true,value:",P="})"+(u?"":".get()");else if("property"===T)_="VarRef.create(",C=e(S,k("left")),P=","+n(y.name)+")"+(u?"":".get()"),M=A;else if("itsProperty"===T||"belongingItProperty"===T)_="VarRef.create(",C=h,P=","+n(y.name)+")"+(u?"":".get()"),I=M=A;else if("possessiveOperator"===T||"itsOperator"===T)y.type.includes("it")&&(C=h,I=A),_="VarRef.create(",N=",{computed:true,value:",P="})"+(u?"":".get()"),l=!1;else if("twineLink"===T)N='Macros.run("link-goto", [section,'+n(y.innerText)+","+n(y.passage)+"])",I=M=j;else if("macro"===T){var W=y.children[0],U="$"===W.text[0]||"_"===W.text[0];"macroName"===W.type||U||t("Compiler.compile","macro token had no macroName child token"),N="Macros.run"+(U?"Custom":"")+"("+(U?"VarRef.create("+("_"===W.text[0]?"section.stackTop.tempV":"State.v")+"ariables,"+n(W.text.trim().slice(1,-1))+").get()":'"'+y.name+'"')+", [section,"+e(y.children.slice(1),{isTypedVar:l})+"])",I=M=j}else if("grouping"===T)N="("+e(y.children,{isVarRef:u})+")",I=M=j;else if("error"===T)return"TwineError.create('syntax',"+n(y.message)+(y.explanation?", "+n(y.explanation):"")+")";return v>-1?(C=(C||e(S,{isVarRef:u,isTypedVar:l})).trim(),E=(E||e(x)).trim(),D&&!C&&(C=h),I===O&&!C||M===O&&!E?d&&M&&!E?"":"TwineError.create('operation','I need usable code to be "+(I===O?"left ":"")+(I===O&&M===O?"and ":"")+(M===O?"right ":"")+'of "'+y.text+"\"')":I===j&&C||M===j&&E?"TwineError.create('operation','There can't be code to the "+(I===j?"left ":"")+(I===j&&M===j?"or ":"")+(M===j?"right ":"")+'of "'+y.text+"\"')":_+C+N+E+P):1===r.length?(("value"in r[0]?r[0].value:r[0].text)+"").trim()||" ":r.reduce(function(t,n){return t+e(n,{isVarRef:u,isTypedVar:l})},"")}}),define("internaltypes/twineerror",["jquery","utils"],function(e,t){var n=t.impossible,r=t.escape;e(document.documentElement).on("click","tw-folddown",function(t){var n=t.target;for((n=e(n)).toggleClass("open");n&&!n.next().length;)n=n.parent();n&&n.next().toggle()});var i={syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",javascript:"This error message was reported by your browser's Javascript engine. I don't understand it either, but it usually means that an expression was badly written.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true."},a={error:[],warning:[]},o={create:function(e,t,r,a){return t&&"string"==typeof t||n("TwineError.create","has a bad message string"),r||e in i||n("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:r,source:void 0,innerDOM:a,appendTitleText:!1})},fromError:function(e){return o.create("javascript","\u2615 "+e.message)},containsError:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e||(t instanceof Error?t:o.isPrototypeOf(t)?t:!!Array.isArray(t)&&o.containsError.apply(o,_toConsumableArray(t)))},!1)},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(n){var o=this;n=n||this.source||"";var s=e("<tw-error class='"+("javascript"===this.type?"javascript ":"")+(this.warning?"warning":"error")+"' title='"+r(n)+"'>"+r(this.message+(this.appendTitleText?" "+n:""))+"</tw-error>"),c=e("<tw-error-explanation>").text(this.explanation||i[this.type]).hide(),u=e("<tw-folddown tabindex=0>");return this.innerDOM&&e("<tw-open-button>").on("click",function(){var n=e("<tw-backdrop><tw-dialog></tw-backdrop>");n.find("tw-dialog").prepend(o.innerDOM,e("<tw-link tabindex=0>OK</tw-link>").on("click",function(){o.innerDOM.detach(),n.remove()}).wrap("<tw-dialog-links>").parent()),t.storyElement.prepend(n)}).appendTo(s),s.append(u).append(c),s.data("TwineError",this),a.error.forEach(function(e){return e(o,n)}),s},on:function(e,t){if(e in a)return"function"!=typeof t||a[e].includes(t)||a[e].push(t),o;n("TwineError.on","invalid event name")}};return o}),define("renderer",["utils","markup","twinescript/compiler","internaltypes/twineerror"],function(e,t,n,r){var i=e.escape,a=e.impossible,o=e.insensitiveName,s=void 0;function c(e,t){return"<"+t+">"+e+"</"+t+">"}function u(e,t){var n=s.render(e.children);return n&&c(n,t)}var l,p,f="text-align: center; max-width:50%; ",d=RegExp(t.Patterns.macroFront+t.Patterns.macroName,"ig");return s={options:{debug:!1,blockerMacros:[],metadataMacros:[]},preprocess:function(e){var i=s.options.metadataMacros;if(!(e.match(d)||[]).some(function(e){return i.some(function(t){return o(e.slice(1,-1))===t})}))return{};var a=!1,c={};return t.lex(e).children.forEach(function e(t){if("macro"===t.type){if(i.some(function(e){return t.name===e})){if(r.isPrototypeOf(c[t.name]))return;if(a)return void(c[t.name]=r.create("syntax","The ("+t.name+":) macro can't appear after non-metadata macros."));if(c[t.name])return void(c[t.name]=r.create("syntax","There is more than one ("+t.name+":) macro."));c[t.name]={code:n(t),source:t.text}}else a=!0;t.children.forEach(function e(t){"macro"===t.type&&i.some(function(e){return t.name===e})?c[t.name]=r.create("syntax","The ("+t.name+":) macro can't be inside another macro."):t.children.forEach(e)})}else t.children.forEach(e)}),c},exec:(l=void 0,p=void 0,function(e){return"string"!=typeof e?(a("Renderer.exec","source was not a string, but "+(void 0===e?"undefined":_typeof(e))),""):e===l?p:(l=e,p=s.render(t.lex(e).children))}),render:function e(a){var l="",p=[];if(!a)return l;for(var d=a.length,h=0;h<d;h+=1){var y=a[h];switch(y.type){case"error":l+=r.create("syntax",y.message,y.explanation).render(i(y.text))[0].outerHTML;break;case"numbered":case"bulleted":var m="numbered"===y.type?"ol":"ul";l+="<"+m+">";for(var g=1;h<d&&a[h];){if("br"===a[h].type){if(l+="</li>",!a[h+1]||a[h+1].type!==y.type)break}else a[h].type===y.type?(l+=("<"+m+">").repeat(Math.max(0,a[h].depth-g)),l+=("</"+m+">").repeat(Math.max(0,g-a[h].depth)),l+="<li>",g=a[h].depth):l+=e([a[h]]);h+=1}l+=("</"+m+">").repeat(g+1);break;case"align":for(;y&&"align"===y.type;){var v=y.align,b=h+=1;if("left"===v){h-=1;break}for(;h<d&&a[h]&&"align"!==a[h].type;)h+=1;var w=e(a.slice(b,h)),T="";switch(v){case"center":T+=f+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":T+="text-align: "+v+";";break;default:+v&&(T+=f+"margin-left: "+v+"%;")}l+="<tw-align "+(T?'style="'+T+'"':"")+">"+w+"</tw-align>\n",y=a[h]}break;case"column":for(var S=[];y&&"column"===y.type;){var x=y.column,k=h+=1;if("none"===x){h-=1;break}for(;h<d&&a[h]&&"column"!==a[h].type;)h+=1;S.push({text:y.text,type:x,body:e(a.slice(k,h)),width:y.width,marginLeft:y.marginLeft,marginRight:y.marginRight}),y=a[h]}S.length&&function(){var e=S.reduce(function(e,t){return e+t.width},0);l+="<tw-columns>"+S.map(function(t){return"<tw-column type="+t.type+'  style="width:'+t.width/e*100+"%; margin-left: "+t.marginLeft+"em; margin-right: "+t.marginRight+'em;">'+t.body+"</tw-column>\n"}).join("")+"</tw-columns>"}();break;case"heading":for(l+="<h"+y.depth+">";++h<d&&a[h];){if("br"===a[h].type){l+="</h"+y.depth+">";break}l+=e([a[h]])}break;case"br":if(!p.length||/td|th/.test(p[0])){l+="<br>";for(var O=a[h+1];O&&("br"===O.type||"tag"===O.type&&/^<br\b/i.test(O.text));)l+="<tw-consecutive-br"+("tag"===O.type?" data-raw":"")+"></tw-consecutive-br>",O=a[(h+=1)+1]}break;case"hr":l+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":l+='<a class="link" href="'+i(y.text)+'">'+y.text+"</a>";break;case"scriptStyleTag":case"tag":var j=y.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th)\b/.test(j)&&p[y.text.startsWith("</")?"shift":"unshift"](j),l+=y.text.startsWith("</")?y.text:y.text.replace(/>$/," data-raw>");break;case"sub":case"sup":case"strong":case"em":l+=u(y,y.type);break;case"strike":l+=u(y,"s");break;case"bold":l+=u(y,"b");break;case"italic":l+=u(y,"i");break;case"twineLink":var A=_slicedToArray(t.lex("(link-goto:"+JSON.stringify(y.innerText)+","+JSON.stringify(y.passage)+")").children,1)[0];l+='<tw-expression type="macro" name="link-goto"'+(s.options.debug?' title="'+i(y.text)+'"':"")+' js="'+i(n(A))+'"></tw-expression>';break;case"hook":l+="<tw-hook "+(y.hidden?"hidden ":"")+(y.name?'name="'+o(y.name)+'"':"")+(s.options.debug&&y.name?' title="Hook: ?'+y.name+'"':"")+' source="'+i(y.innerText)+'"></tw-hook>';break;case"unclosedHook":return l+="<tw-hook "+(y.hidden?"hidden ":"")+(y.name?'name="'+o(y.name)+'"':"")+'source="'+i(a.slice(h+1,d).map(function(e){return e.text}).join(""))+'"></tw-hook>';case"verbatim":l+=c(i(y.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":l+=u(y,"tw-collapsed");break;case"unclosedCollapsed":return l+="<tw-collapsed>"+e(a.slice(h+1,d))+"</tw-collapsed>";case"variable":case"tempVariable":case"macro":var C=function(){var t=[],a=[];if("macro"===y.type&&function n(r){"string"!==r.type&&"hook"!==r.type&&r.children.every(n);var i=r.firstChild();if("macro"===r.type&&i&&"macroName"===i.type&&s.options.blockerMacros.includes(o(i.text.slice(0,-1))))t.push(r);else if("hook"===r.type){if(!r.everyLeaf(function(e){return"error"!==e.type||(a.push(e),!1)}))return!1;r.html=e(r.children)}return!0}(y),a.length)return{v:r.create("syntax","This code hook's markup contained "+a.length+" error"+(a.length?"s":"")+":<br>\u2014"+a.map(function(e){return e.message}).join("<br>\u2014")).render(i(y.text))[0].outerHTML};var c=t.length&&t.map(function(e){var t=n(e);return e.type="blockedValue",t});l+='<tw-expression type="'+y.type+'" name="'+i(y.name||y.text)+'"'+(s.options.debug?' title="'+i(y.text)+'"':"")+(t.length?' blockers="'+i(JSON.stringify(c))+'"':"")+' js="'+i(n(y))+'"></tw-expression>',t.forEach(function(e){return e.type="macro"})}();if("object"===(void 0===C?"undefined":_typeof(C)))return C.v;break;default:l+=y.children&&y.children.length?e(y.children):y.text}}return l}},Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","renderer","internaltypes/twineerror"],function(e,t,n,r,i,a){var o=n.unescape,s=n.onStartup,c=Object.assign;function u(e){var t=o(e.html()),n=i.preprocess(t);return c(new Map([["source",t],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",e.attr("name")]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:n})}var l=c(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(e){var n=t("en",function(e){return e.get("name")}),r=[];return this.forEach(function(t){var n=t instanceof Map&&t.get("tags");Array.isArray(n)&&n.includes(e)&&r.push(t)}),r.sort(n)},getStorylets:function(e,n){var r=n?n.filter(e,[].concat(_toConsumableArray(l.values()))):[].concat(_toConsumableArray(l.values()));if(a.containsError(r))return r;var i=[],o=-1/0,s=r.reduce(function(t,n){if(t)return t;var r=n.get("storylet");if(r){var s=e.speculate(r,n.get("name"),"a (storylet:) macro");if(a.containsError(s))return s.message="There's an error in the storylet passage \""+n.get("name")+'":\n'+s.message,s.source=r.TwineScript_ToSource(),s;if(s){var c=n.get("exclusivity");o=Math.max(o,"number"==typeof c?c:0),i.push(n)}}},void 0);if(s)return s;var c=t("en");return i.filter(function(e){var t=e.get("exclusivity");return(t="number"==typeof t?t:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:c(e.get("name"),t.get("name"))})},allStorylets:function(){return[].concat(_toConsumableArray(l.values())).filter(function(e){return e.get("storylet")})},loadMetadata:function(e){var t=[];return l.forEach(function(n){n.metadata&&Object.keys(n.metadata).forEach(function(r){if(a.containsError(n.metadata[r]))t.push(n.metadata[r]);else{var i=n.metadata[r],o=i.code,s=i.source,c=e.speculate(o,n.get("name"),"a ("+r+":) macro"),u='In "'+n.get("name")+'":\n';if(a.containsError(c))return c.message=u+c.message,c.source=s,void t.push(c);c instanceof Map?c.forEach(function(e,t){return l(t,e)}):l(r,c)}function l(e,r){n.has(e)?t.push(a.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):n.set(e,r)}}),n.metadata=void 0}),t},hasValid:function(e){var t=this.get(e);return t&&t instanceof Map&&t.has("source")},create:u});return s(function(){Array.from(e("tw-storydata > tw-passagedata")).forEach(function(t){t=e(t),l.set(t.attr("name"),new u(t))})}),l}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(e,t,n,r){var i=t.impossible,a=t.nth,o=t.insensitiveName,s=t.permutations,c=r.validPropertyName,u="object",l="boolean",p="string",f="number",d="function";function h(e){return!!e&&((void 0===e?"undefined":_typeof(e))===u||(void 0===e?"undefined":_typeof(e))===d)}function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function m(e){return Array.isArray(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":(void 0===e?"undefined":_typeof(e))===p?p:e&&(void 0===e?"undefined":_typeof(e))===u?u:""}function g(e){if(!h(e))return e;if(_typeof(e.TwineScript_Clone)===d)return e.TwineScript_Clone();if(Array.isArray(e))return[].concat(_toConsumableArray(e));if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if((void 0===e?"undefined":_typeof(e))===d)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}return i("OperationUtils.clone","The value "+e+" cannot be cloned!"),e}function v(e){return h(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:Array.isArray(e)?"an array":e instanceof Map?"a datamap":e instanceof Set?"a dataset":(void 0===e?"undefined":_typeof(e))===l?"the boolean value '"+e+"'":(void 0===e?"undefined":_typeof(e))===p||(void 0===e?"undefined":_typeof(e))===f?"the "+(void 0===e?"undefined":_typeof(e))+" "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is"}function b(e,t){return(void 0===e?"undefined":_typeof(e))!==u&&(void 0===t?"undefined":_typeof(t))!==u?e===t:Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(function(e,n){return b(t[n],e)}):e instanceof Map&&t instanceof Map?b(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?b([].concat(_toConsumableArray(e)),[].concat(_toConsumableArray(t))):e&&_typeof(e.TwineScript_is)===d?e.TwineScript_is(t):e&&(void 0===e?"undefined":_typeof(e))===u&&t&&(void 0===t?"undefined":_typeof(t))===u&&y(e)&&y(t)?b(Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]}),Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]})):Object.is(e,t)}return Object.freeze({isObject:h,isPureObject:y,singleTypeCheck:function e(t,n){if(null===n)return void 0===t;var r=void 0===t?"undefined":_typeof(t);if((void 0===n?"undefined":_typeof(n))!==d&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern)return n.innerType.some(function(n){return e(t,n)});if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")==="where"in t&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(o(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?r===p:n===Boolean?r===l:n===parseInt?r===f&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?r===f&&!Number.isNaN(t):n===Array?Array.isArray(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))},isValidDatamapName:function(e,t){if(e instanceof Map||i("isValidDatamapName","called with non-Map"),n.containsError(t))return t;if((void 0===t?"undefined":_typeof(t))!==p&&(void 0===t?"undefined":_typeof(t))!==f)return n.create("property","Only strings and numbers can be used as data names for "+v(e)+", not "+v(t)+".");var r=(void 0===t?"undefined":_typeof(t))===p?+t:""+t;return!(!Number.isNaN(r)&&e.has(r))||n.create("property","You mustn't use both "+v(t)+" and "+v(r)+" as data names in the same datamap.")},collectionType:m,isSequential:function(e){return(void 0===e?"undefined":_typeof(e))===p||Array.isArray(e)||_typeof(e.hooks)===d},unstorableValue:function e(t){return t&&t.TwineScript_Unstorable&&t||Array.isArray(t)&&t.find(e)||t instanceof Map&&[].concat(_toConsumableArray(t.values())).find(e)||t instanceof Set&&[].concat(_toConsumableArray(t)).find(e)},clone:g,objectName:v,typeName:function e(t){var n=y(t);if(n&&t.innerType)return t.typeName?t.typeName:"insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(Array.isArray(t.innerType)||i("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType);if(n&&t.pattern&&"range"===t.pattern){if(t.name)return t.name;var r=t.min,a=t.max;return"a"+(r>0?" positive":"")+(t.integer?" whole":"")+" number"+(0===r?" between 0 and "+a:a<1/0?" up to "+a:"")}return t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":h(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:v(t)},typeID:function(e){var t=void 0===e?"undefined":_typeof(e);return[l,p,f].includes(t)?t:Array.isArray(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:function t(r,o){return n.containsError(r)&&i("toSource","received a TwineError"),_typeof(r.TwineScript_ToSource)===d?r.TwineScript_ToSource():y(r)&&"first"in r&&"last"in r?(r.first<0?(-1!==r.first?a(-r.first):"")+"last":a(r.first+1))+"to"+(r.last<0?(-1!==r.last?a(-r.last):"")+"last":a(r.last+1)):Array.isArray(r)?"(a:"+("property"===o?r.map(function(e){return e+(e>0)}):r).map(t)+")":r instanceof Map?"(dm:"+Array.from(r.entries()).sort(function(t,n){return[t[0],n[0]].sort(e("en"))[0]===t[0]?-1:1}).map(function(e){return e.map(t)})+")":r instanceof Set?"(ds:"+Array.from(r).sort(e("en")).map(t)+")":(void 0===r?"undefined":_typeof(r))===f&&"property"===o?r<0?-1===r?"last":a(-r)+"last":a(r+1):(void 0===r?"undefined":_typeof(r))===p&&"property"===o?RegExp(c).test(r)?r:"("+JSON.stringify(r)+")":JSON.stringify(r)},is:b,contains:function(e,t){if(e||""===e){if((void 0===e?"undefined":_typeof(e))===p)return(void 0===t?"undefined":_typeof(t))!==p?n.create("operation",v(e)+" can only contain strings, not "+v(t)+"."):e.includes(t);if(Array.isArray(e))return e.some(function(e){return b(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return b(e,t)})}return n.create("operation",v(e)+" cannot contain any values, let alone "+v(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===d?t.TwineScript_IsTypeOf(e):n.create("operation",'"is a" should only be used to compare type names, not '+v(t)+".")},matches:function e(t,r){var i=!1;if(t&&_typeof(t.TwineScript_IsTypeOf)===d){var a=t.TwineScript_IsTypeOf(r);if(n.containsError(a))return a;i|=a}if(r&&_typeof(r.TwineScript_IsTypeOf)===d){var o=r.TwineScript_IsTypeOf(t);if(n.containsError(o))return o;i|=o}if(i)return!0;if(Array.isArray(t)&&Array.isArray(r)){for(var c=0,u=0,l=!0;l&&c<t.length&&u<r.length;){var p=t[c],f=r[u];if(p.rest){for(;u<r.length&&e(p,f);)f=r[u+=1];c+=1}else if(f.rest){for(;c<t.length&&e(p,f);)p=t[c+=1];u+=1}else e(p,f)?(c+=1,u+=1):l=!1}return l&&c>=t.length&&u>=r.length}return t instanceof Map&&r instanceof Map?e(Array.from(t.entries()).sort(),Array.from(r.entries()).sort()):t instanceof Set&&r instanceof Set?(t=[].concat(_toConsumableArray(t)),s.apply(void 0,_toConsumableArray(r)).some(function(n){return e(t,n)})):b(t,r)},subset:function e(t,r,i){if(!r||!i)return n.create("macrocall","The sub"+m(t)+" index value must not be "+(r&&i)+".");var a=(void 0===t?"undefined":_typeof(t))===p;if(a&&(t=Array.from(t)),r<0&&(r=Math.max(0,t.length+r+1)),i<0&&(i=Math.max(0,t.length+i+1)),r>i)return e(arguments[0],i,r);var o=t.slice(r>0?r-1:r,i).map(g);return a?o.join(""):o},range:function e(t,n){if(t>n)return e(n,t);var r=[t];for(n-=t;n-- >0;)r.push(++t);return r},printBuiltinValue:function e(t){return n.containsError(t)?t:t&&_typeof(t.TwineScript_Print)===d?t.TwineScript_Print():t instanceof Map?(t=Array.from(t.entries()),n.containsError(t)?t:t.reduce(function(t,n){var r=_slicedToArray(n,2),i=r[0],a=r[1];return t+"<tr><td>`"+e(i)+"`</td><td>`"+e(a)+"`</td></tr>"},"<table class=datamap>")+"</table>"):t instanceof Set?Array.from(t.values()).map(e)+"":Array.isArray(t)?t.map(e)+"":t&&_typeof(t.jquery)===p?t:h(t)?n.create("unimplemented","I don't know how to print this value yet."):t+""},unique:function(e,t,n){return!n.slice(t+1).some(function(t){return b(e,t)})}})}),define("utils/renderutils",["jquery","utils","renderer"],function(e,t,n){var r=RegExp(t.realWhitespace+"+"),i=RegExp(t.realWhitespace+"+","g");function a(e,t,n){var r=e.textContent.length;if(!(t>=r)){var i=void 0,a=[i=0===t?e:e.splitText(t)];return n&&(n<=0&&(n=r-n),n<r&&a.push(i.splitText(n-t))),a}}var o,s=(o=void 0,function(){if(void 0!==o)return o;var t=e("<p>");return t[0].normalize?(t.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),o=1===t.contents().length):o=!1});var c="tw-collapsed,[collapsing=true]";var u=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.section,a=r.parent,o=void 0===a?t.storyElement:a,s=r.cd,c=r.message,u=void 0===c?"":c,l=r.defaultValue,p=r.buttons,f=void 0===p?[{name:"OK",confirm:!0,callback:Object}]:p,d=e("<tw-backdrop><tw-dialog>"+(l||""===l?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(f.length?f.reduce(function(e,t,n){var r=t.name;return e+"<tw-link style='margin:0 "+(n===f.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+r+"</tw-link>"},""):"<tw-link tabindex=0>"+f[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>"),h=d.find("tw-dialog");if(o.append(d),i){i.renderInto(u,h,Object.assign({},s,{append:"prepend"}));var y=s&&s.transition&&d.find("tw-dialog > tw-transition-container");y&&y.length&&y.appendTo(d).append(h.prepend(y.contents().detach()))}else h.prepend(n.exec(u));if(l){var m=d.find("input").last();m.val(l).on("keypress",function(e){13===e.which&&(d.remove(),f.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return m.focus()},100)}return f.reverse().forEach(function(t,n){e(d.find("tw-link").get(-n-1)).on("click",function(){d.remove(),t.callback()})}),d},realWhitespace:r,textNodeToChars:function(e){var t=[].concat(_toConsumableArray(e.textContent));return 1===t.length?[e]:t.reduce(function(e,t){return t.match(r)&&e.length&&e[e.length-1].match(r)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(t,n){var r=e;return n.length<e.textContent.length&&(e=e.splitText(n.length)),t.concat(r)},[])},findTextInNodes:function e(t,n){var r=[],i="",o=[];if(!t.length||!n)return o;for(;t.length>0;){r.push(t[0]),i+=t[0].textContent,t.shift();var s=i.indexOf(n);if(s>-1){for(var c,u=i.length-(s+n.length);s>=r[0].textContent.length;)s-=r[0].textContent.length,r.shift();if(1===r.length){var l=a(r[0],s,s+n.length);o.push(l[0]),l[1]&&t.unshift(l[1]);break}o.push(a(r[0],s,r[0].length)[0]),(c=o).push.apply(c,_toConsumableArray(r.slice(1,-1)));var p=a(r[r.length-1],0,r[r.length-1].textContent.length-u);o.push(p[0]),p[1]&&t.unshift(p[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(t){function n(t){return 0===e(this||t).parentsUntil(c).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var r=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;var i=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 4&t&&!(8&t)});return(i=i[i.length-1])||e(r)}(t);e(r).parents(c).length||(r=null);var a=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;var i=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 2&t&&!(8&t)})[0];return i||e(r)}(t);e(a).parents(c).length||(a=null);var o="br:not([data-raw]),tw-consecutive-br:not([data-raw])";t.find(o).filter(n).replaceWith(document.createTextNode(" "));var u=(t=e(t.get().map(function(t){return e(t).filter(n).is(o)?e(document.createTextNode(" ")).replaceAll(t)[0]:t}))).textNodes(),l=0;u.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(i," ")," "!==t.textContent[0]||e&&e.textContent&&!(e.textContent.search(/\s$/)>-1)||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},r),[].concat(_toConsumableArray(u)).reverse().every(function(e){return!!n(e)&&(e.textContent.match(/^\s*$/)?(l+=e.textContent.length,e.textContent="",!0):(e.textContent=e.textContent.replace(/\s+$/,function(e){return l+=e.length,""}),!1))}),l>0&&a&&(u[u.length-1].textContent+=" "),t[0]&&s()&&t[0].normalize()},geomStringRegExp:u,geomParse:function(e){var t=e.length,n=u.exec(e)||[],r=_slicedToArray(n,3),i=r[0],a=r[1],o=r[2];return i?{marginLeft:a.length/t*100,size:o.length/t*100}:{marginLeft:0,size:0}}})}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(e,t,n,r){var i=n.textNodeToChars,a=n.realWhitespace,o=n.findTextInNodes,s=r.toSource;function c(n){var r=n.dom,s=e();this.next&&(s=s.add(c.call(this.next,n)));var u=function(t,n){if(Array.isArray(n))return n.reduce(function(e,n){return e.add(t.get(n))},e());if(n&&"object"===(void 0===n?"undefined":_typeof(n))&&"first"in n&&"last"in n){var r=n.first,o=n.last,s=t.length;r<0&&(r+=s),o<0&&(o+=s);for(var c=[t.get(r)];r!==o;)r+=Math.sign(o-r),c.push(t.get(r));return e(c)}if("string"==typeof n){if("chars"===n){var u=[],l=!0,p=!1,f=void 0;try{for(var d,h=t.textNodes(":not(tw-error, tw-error *)")[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=!0,g=!1,v=void 0;try{for(var b,w=i(y)[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var T=b.value;T.textContent.match(a)||u.push(T)}}catch(e){g=!0,v=e}finally{try{!m&&w.return&&w.return()}finally{if(g)throw v}}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return e(u)}if("links"===n)return t.findAndFilter("tw-link, .enchantment-link");if("visited"===n)return t.findAndFilter("tw-link.visited");if("lines"===n){var S=t.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),x=[[]];return t.textNodes(":not(tw-error, tw-error *):not(tw-sidebar, tw-sidebar *)").forEach(function(e){S.length&&2&e.compareDocumentPosition(S[0])&&(S.shift(),x.push([])),x[x.length-1]=x[x.length-1].concat(e)}),x=x.map(function(t){return t.map(function(n){for(var r=n.parentNode;e(r).textNodes().every(function(e){return t.includes(e)})&&!t.every(function(t){return e(r).has(t).length});){r=(n=r).parentNode}return n})}),e(x.map(function(t){return e(t).wrapAll("<tw-pseudo-hook>").parent()[0]}))}}return e(t.get(n))};if(this.selector){var l=void 0;if("string"===this.selector.type)l=function(t,n){var r=o(n.textNodes(),t),i=e();return r.forEach(function(t){i=i.add(e(t).wrapAll("<tw-pseudo-hook>").parent())}),i}(this.selector.data,r);else{if("base"===this.selector.type)return s.add(u(c.call(this.selector.data,n),this.property));var p=function(e){var n='tw-hook[name="'+(e=t.insensitiveName(e).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+e+'"]';return n+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[e]||""}(this.selector.data);l=r.findAndFilter(p).add(r.parentsUntil(t.storyElement.parent())).filter(p)}s=this.property?s.add(u(l,this.property)):s.add(l)}return s}function u(e){if(!e)return[];var n=e.selector,r=e.property,i=e.next;return[JSON.stringify(["base"===n.type?u(n.data):t.insensitiveName(n.data),r])].concat(_toConsumableArray(u(i))).sort()}var l=Object.freeze({forEach:function(t,n){var r=c.call(this,t).each(function(t){n(e(this),t)});return t.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),r},hooks:function(e){return c.call(this,e)},get TwineScript_ObjectName(){return this.property||this.next?"a complex hook name":"?"+this.selector.data+" (a hook name)"},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",n=this.selector,r=n.type,i=n.data;return"name"===r?i.match(RegExp("^"+t.anyRealLetter+"+$"))?e+="?"+i:e+="(hooks-named:"+JSON.stringify(i)+")":"string"===r?e+=JSON.stringify(i):"base"===r&&(e+=i.TwineScript_ToSource()+"'s "+s(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return u(this)+""==u(e)+""},TwineScript_GetProperty:function(e){return l.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return l.create(this.selector,this.property,this.next)},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||l),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return l.isPrototypeOf(e)||"string"==typeof e||t.impossible("HookSet.from() was given a non-HookSet non-string."),l.isPrototypeOf(e)?e:l.create({type:"string",data:e})}});return l}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset"],function(e,t,n,r){var i=t.assertOnlyHas,a=t.impossible,o=t.transitionIn,s=n.exec,c=Object.assign,u=Object.keys,l=Object.create,p=Object.seal,f=function(e){return e.split(/\n/g).reduce(function(e,t,n,r){var i=r.length;return e.concat(document.createTextNode(t),n!==i-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])},d=void 0,h={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,functions:null,section:null,timestamp:0,summary:function(){var e=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","functions","enablers"].filter(function(t){return e.hasOwnProperty(t)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",u(this.loopVars).length&&"loopVars",u(this.data).length&&"data"].filter(Boolean))},create:function(e,t){var n=c(l(this),{attr:[].concat(this.attr||[]),styles:[].concat(this.styles||[]),loopVars:this.loopVars||{},data:this.data||{}},e);return t&&t.run(n),n},update:function(){var e=this,t=this.section,n=this.newTargets,i=this.transition,a=this.transitionDeferred,s=this.append,c=this.target;"function"==typeof c&&(c=c());var l=function(t){if(Array.isArray(e.styles)&&e.styles.length>0){var n=e.styles.reduce(function(e,t){return u(t).forEach(function(n){var r=t[n];e[+("function"==typeof r)][n]=r}),e},[{},{}]),r=_slicedToArray(n,2),i=r[0],a=r[1];t.css(i),setTimeout(function(){return t.css(a)})}e.attr&&e.attr.forEach(function(e){return t.attr(e)}),e.data&&t.data(e.data)};if(Array.isArray(n)&&n.length&&(c=n.map(function(e){return e.target})),[].concat(c).forEach(function(e){r.isPrototypeOf(e)?e.forEach(t,l):l(e)}),i&&!a&&!s){var p=c,f=void 0;do{!(f=p.data("timestamp"))&&(p=p.parent())}while(!f&&p.length);o(c,i,this.transitionTime,this.transitionDelay,this.transitionSkip,f?Date.now()-f:0,this.transitionOrigin)}},render:function(){var t=this,n=this.source,u=this.transition,l=this.transitionTime,p=this.transitionDeferred,y=this.enabled,m=this.enablers,g=this.data,v=this.section,b=this.newTargets,w=this.functions,T=this.appendSource,S=this.target,x=this.target,k=this.append;if("function"==typeof S&&(S=S()),i(this,d),!k)return a("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),e();if(m&&m.length){var O=m[0],j=O.descriptor,A=O.changer,C=j.render();if(A){var E=h.create({section:v,target:C});A.run(E),E.update()}return C}if(!y||void 0!==S.attr("hidden"))return h.create({target:S,data:c({},g,{originalSource:n,hidden:!0})}).update(),e();if(Array.isArray(b)&&b.length&&(S=b),!S)return a("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),e();var _=e();if([].concat(S).filter(function(e){return!e.jquery}).map(function(e){var t=k,n=void 0;if(e.target&&e.append){var r=e;t=r.append,n=r.before,e=e.target}return{elements:e.hooks(v,x).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(x[0]))}),append:t}},[]).forEach(function(n){var r=n.elements,i=n.append;r.each(function(n,r){r=e(r),_=_.add(t.create({target:r,append:i,newTargets:null}).render()),r.filter("tw-pseudo-hook").contents().unwrap()})}),_.length||Array.isArray(S)||r.isPrototypeOf(S))return _;if(!(k in S)){if("replace"!==k)return a("ChangeDescriptor.render","The target doesn't have a '"+k+"' method."),e();S[0]instanceof Text?k="replaceWith":(S.empty(),k="append")}return S[0]instanceof Text&&("append"===k&&(k="after"),"prepend"===k&&(k="before")),_=e(n&&(this.verbatim?f(n):e.parseHTML(s(n),document,!0))),Array.isArray(T)&&T.forEach(function(n){var r=n.source,i=n.append,a=e(t.verbatim?f(r):e.parseHTML(s(r),document,!0));_="append"===i?_.add(a):"prepend"===i?a.add(_):a}),S[k](_.length?_:void 0),S.data("timestamp",Date.now()),this.update(),u&&!p&&o("replace"===k?S:_,u,l,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),w&&w.forEach(function(e){return e(S)}),_}};return d=u(h),p(h)}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var i=e.impossible,a=t.is,o=t.toSource,s={},c={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(o))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Array.isArray(t)||i("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,TwineScript_ObjectName:"a ("+e+":) changer"})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){if(c.isPrototypeOf(e))return this.macroName===e.macroName&&a(this.params,e.params)&&a(this.next,e.next)},TwineScript_Clone:function(){return this.create(this.macroName,this.params,this.next)},run:function(e){var t=s[this.macroName].apply(s,[e].concat(_toConsumableArray(this.params)));if(r.containsError(t))return t;this.next&&this.next.run(e)},register:function(e,t){s[e]=t}};return Object.freeze(c)}),define("state",["utils","passages","datatypes/changercommand","internaltypes/twineerror","utils/operationutils","markup","twinescript/compiler"],function(e,t,n,r,i,a,o){var s=e.impossible,c=i.objectName,u=i.toSource,l=a.lex,p=Object.assign,f=Object.create,d=["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}),h=p(f(null),{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:f(null),TwineScript_VariableStore:!0,TwineScript_MockVisits:null}),y={passage:"",variables:h,create:function(e,t){var n=f(y);return n.passage=e||"",n.variables=p(f(this.variables),t),n}},m=[],g=-1,v=y.create(),b=void 0,w={forward:[],back:[],load:[]},T=void 0;function S(e){v=(m[g]||y).create(e),function(){if(T.hasSessionStorage){var e=T.serialise();if("string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){return}}}()}return T=p({get passage(){return v.passage},get variables(){return v.variables},get pastLength(){return g},get futureLength(){return m.length-1-g},get mockVisits(){return v.variables.TwineScript_MockVisits||[]},set mockVisits(e){v.variables.TwineScript_MockVisits=e},passageNameVisited:function(e){var n=0;if(!t.get(e))return 0;for(var r=0;r<=g;r++)n+=+(e===m[r].passage);return n},passageNameLastVisited:function(e){if(!t.get(e))return 1/0;if(e===v.passage)return 0;for(var n=g;n>0;n--)if(m[n].passage===e)return g-n+1;return 1/0},pastPassageNames:function(){for(var e=[],t=g-1;t>=0;t--)e.unshift(m[t].passage);return e},timelinePassageNames:function(){return m.map(function(e){return e.passage})},play:function(e){v||s("State.play","present is undefined!"),v.passage=e,m=m.slice(0,g+1).concat(v),g+=1,S(e),w.forward.forEach(function(t){return t(e)})},rewind:function(e){var t=1,n=!1;if(e)if("string"==typeof e){if((t=this.passageNameLastVisited(e))===1/0)return}else"number"==typeof e&&(t=e);for(;t>0&&g>0;t--)n=!0,g-=1;return n&&(S(m[g].passage),w.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);t>0&&m.length>0;t--)n=!0,g+=1;return n&&(S(m[g].passage),w.forward.forEach(function(e){return e(m[g].passage,"fastForward")})),n},on:function(e,t){if(e in w)return"function"!=typeof t||w[e].includes(t)||w[e].push(t),T;s("State.on","invalid event name")},reset:function(){m=[],g=-1,v=y.create(),b=void 0,w.load.forEach(function(e){return e(m)})},hasStorage:d[0],hasSessionStorage:d[1]},function(){function e(e,t){Object.keys(t).forEach(function(n){return!n.startsWith("TwineScript_")&&(t[n]=e.eval(o(l(t[n],0,"macro"))))})}return{serialise:function(){var e=m.slice(0,g+1),t=e.map(function(e){return Object.keys(e.variables).filter(function(t){return e.variables[t]&&(n=e.variables[t],i=void 0===n?"undefined":_typeof(n),!(!r.containsError(n)&&("function"==typeof n.TwineScript_ToSource||Array.isArray(n)||n instanceof Map||n instanceof Set||"string"===i||"number"===i||"boolean"===i||Object.isPrototypeOf.call(h.TwineScript_TypeDefs,n))));var n,i}).map(function(t){return[t,e.variables[t]]})});if(b||(b=t.reduce(function(e,t,n){var r=_slicedToArray(t,2),i=r[0],a=r[1];return e||i&&[i,a,n+1]},void 0)),b){var n=_slicedToArray(b,3),i=n[0],a=n[1],o=n[2];return r.create("saving","The variable $"+i+" holds "+c(a)+" (which is, or contains, a complex data value) on turn "+o+"; the game can no longer be saved.")}try{return JSON.stringify(e,function(e,t){return this.TwineScript_VariableStore?"TwineScript_TypeDefs"===e?Object.keys(t).reduce(function(e,n){return e[n]=u(t[n]),e},{}):u(t):t})}catch(e){return!1}},deserialise:function(n,r){var i,a=void 0,o=h,s="The save data is unintelligible.";try{a=JSON.parse(r)}catch(e){return Error(s)}return Array.isArray(a)?(i=(a=a.map(function(r){if("object"!==(void 0===r?"undefined":_typeof(r))||!r.hasOwnProperty("passage")||!r.hasOwnProperty("variables"))return Error(s);if(!t.hasValid(r.passage))return Error("The data refers to a passage named '"+r.passage+"', but it isn't in this story.");if(r.variables=p(f(o),r.variables),Object.hasOwnProperty.call(r.variables,"TwineScript_TypeDefs")){var i=r.variables.TwineScript_TypeDefs=p(f(o.TwineScript_TypeDefs),r.variables.TwineScript_TypeDefs);try{e(n,i)}catch(e){return Error(s)}}try{e(n,r.variables)}catch(e){return Error(s)}return o=r.variables,p(f(y),r)})).find(function(e){return e instanceof Error}))?i:(m=a,w.load.forEach(function(e){return e(m)}),g=m.length-1,S(m[g].passage),!0):Error(s)}}}()),Object.seal(y),Object.freeze(T)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(e,t,n,r,i){var a=n.impossible,o=n.andList,s=n.nth,c=r.is,u=r.isObject,l=r.toSource,p=r.isSequential,f=r.objectName,d=r.typeName,h=r.clone,y=r.isValidDatamapName,m=r.subset,g=r.collectionType,v=r.unstorableValue,b=r.matches,w=void 0,T=0,S={set:[],delete:[]};function x(e,n){var r=void 0;if(e instanceof Map&&(r=t.containsError(y(e,n))))return r;if(p(e)){var a=void 0,s="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.) or slices ('1stTo2ndlast', '3rdTo5th'), ",c="You can't access the '0th' or '0thlast' position of "+f(e)+".";if("number"==typeof n){if(0===n)return t.create("property","You can't access elements at position 0 of "+f(e)+".","Only positive and negative position values exist.");n>0&&(n-=1)}else if("string"==typeof n&&(a=/^(\d+)(?:st|[nr]d|th)last$/i.exec(n))){if("0"===a[1])return t.create("property",c);n=-a[1]}else if("string"==typeof n&&(a=/^(\d+)(?:st|[nr]d|th)$/i.exec(n))){if("0"===a[1])return t.create("property",c);n=a[1]-1}else if("string"==typeof n&&(a=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(n))){var u=_slicedToArray(a,5),l=u[1],d=void 0===l?0:l,h=u[2],m=u[3],g=void 0===m?0:m;n={last:g=u[4]?-g:g-1,first:d=h?-d:d-1}}else if("last"===n)n=-1;else if("random"===n){if(!e.length)return t.create("property","I can't get a random value from "+f(e)+", because it's empty");n=Math.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(n))return t.create("property",s+o(i.TwineScript_Properties.map(function(e){return"'"+e+"'"}))+" of "+f(e)+", not "+f(n)+".");if(!["length","any","all","start","end","random"].includes(n)&&!i.isPrototypeOf(e))return t.create("property",s+"'length', 'any', 'all', 'start', 'end', and 'random' of "+f(e)+", not "+f(n)+".")}}else if(e instanceof Set){if(!["length","any","all"].includes(n))return t.create("property","You can only get the 'length', 'any' and 'all' of "+f(e)+".","To check contained values, use the 'contains' operator.");"length"===n&&(n="size")}else{if(Array.isArray(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(n))return t.create("property","You can only get the "+o(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))+" of "+f(e)+", not "+f(n)+".");if("number"==typeof e||"boolean"==typeof e)return t.create("property","You can't get data values from "+f(e)+".")}return n}function k(e,t){return t-0<0&&Math.abs(t)<=e.length?e.length+(t-0):t}function O(e,t){if(void 0===e)return e;if(e instanceof Map||w.isPrototypeOf(e))return e.get(t);if("any"===t||"all"===t||"start"===t||"end"===t)return function(e,t){var n="'"+t+"' value"+("any"===t?"":"s")+" of ";return{determiner:t,array:[].concat(_toConsumableArray(e)),string:"string"==typeof e&&e,TwineScript_ObjectName:n+f(e),TwineScript_TypeName:n+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}}}(e,t);if("string"==typeof e&&(e=[].concat(_toConsumableArray(e))),p(e)&&Number.isFinite(t)&&(t=k(e,t)),e.TwineScript_GetProperty)return e.TwineScript_GetProperty(t);var n=e[t];return"function"!=typeof n?n:void 0}function j(e){if(e.computed){var t=e.value;return w.isPrototypeOf(t)&&(t=t.get()),"string"==typeof t?"('"+t+"')":"("+t+")"}return"number"==typeof e?s(e):"'"+e+"'"}function A(n,r,a){if(n.TwineScript_VariableStore){if(n.TwineScript_TypeDefs&&r in n.TwineScript_TypeDefs){var o=n.TwineScript_TypeDefs[r];if("const"===o.name){if(void 0!==n[r])return t.create("operation","I can't alter "+(n===e.variables?"$":"_")+r+" because it's been restricted to a constant value.","This variable can't be changed for the rest of the story.")}else if(!b(o,a))return t.create("operation","I can't set "+(n===e.variables?"$":"_")+r+" to "+d(a)+" because it's been restricted to "+l(o)+"-type data.","You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return Array.isArray(r)?r.map(function(e){return A(n,e)}):n instanceof Map?"string"==typeof r||t.create("operation",f(n)+" can only have string data names, not "+f(r)+"."):p(n)?["length","random","any","all","start","end"].includes(r)?t.create("operation","I can't forcibly alter the '"+r+"' of "+f(n)+".","start"===r||"end"===r?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+r+"'.":void 0):+r==(0|r)||t.create("property",f(n)+" can only have position keys ('3rd', '1st', (5), etc.), not "+j(r)+"."):n.TwineScript_Identifiers&&r in n?t.create("keyword","I can't alter the value of the '"+r+"' identifier.","You can only alter data in variables and hooks, not fixed identifiers."):t.create("operation","I can't modify "+f(n),n instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":i.isPrototypeOf(n)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function C(e,t,n){var r=t;e instanceof Map?e.set(t,n):(p(e)&&(t=k(e,t)),e.TwineScript_Set?e.TwineScript_Set(t):e[t]=n),S.set.forEach(function(t){return t(e,r,n)})}function E(e,t){var n=t;p(e)&&(t=k(e,t)),Array.isArray(e)&&/^(?:[1-9]\d*|0)$/.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):delete e[t],S.delete.forEach(function(t){return t(e,n)})}function _(e){return Object.assign(Object.create(w),{error:e})}function N(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;if(r&&"object"===(void 0===r?"undefined":_typeof(r))&&"last"in r&&"first"in r){if(i.isPrototypeOf(n))return n.TwineScript_GetProperty(r);var s=r.first,c=r.last;return m(n,s+(s>=0),c+(c>=0))}if(Array.isArray(r))return i.isPrototypeOf(n)?n.TwineScript_GetProperty(r):r.map(function(e){return N(n,e,e)})["string"==typeof n?"join":"valueOf"]("");var u=O(n,r);if(void 0===u){if(n===e.variables)return T;if(n.TwineScript_VariableStore)return t.create("property","There isn't a temp variable named _"+a+" in this place.","Temp variables only exist inside the same passage and hook in which they're (set:).");if(Array.isArray(n)&&"number"==typeof r)return t.create("property","This array of "+(n.length+1)+" elements doesn't have a "+j(a)+" element.",n.length?"It contains: "+o(n.map(f))+".":"The array is empty.");var l=Array.from("function"==typeof n.keys&&n.keys());return t.create("property","I can't find a "+j(a)+" data name in "+f(n),n instanceof Map&&l.length?"Its names include: "+o(l)+".":void 0)}return u}function P(e,n){var r=this,i=this.compiledPropertyChain.reduce(function(e,t){var n=void 0;return n=0===e.length?r.object:N.apply(void 0,_toConsumableArray(e[e.length-1])),e.push([n,t])&&e},[]).reduceRight(e,n);return t.containsError(i)?i:void 0}return w=Object.freeze({get:function(){return this.error?this.error:N(this.deepestObject,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},set:function(n){var r=this;return this.error?this.error:!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?P.call(this,function(n,i,a){var o,s=_slicedToArray(i,2),c=s[0],l=s[1];if(o=t.containsError(n,c,l)||t.containsError(A(c,l,n)))return o;var d;if(d=v(n))return t.create("operation",f(n)+" can't be stored"+(g(n)?" because it holds "+f(d)+".":""));if(a>0)c=h(c);else if(c.TwineScript_VariableStore&&c!==e.variables){for(var y=c;y.TwineScript_VariableStore&&!y.hasOwnProperty(l);)y=Object.getPrototypeOf(y);y.TwineScript_VariableStore&&(c=y)}if("string"==typeof c){if("string"!=typeof n)return t.create("datatype","I can't put this non-string value, "+f(n)+", in a string.");if(n.length!==(Array.isArray(l)?l.length:1))return t.create("datatype",f(n)+"is not the right length to fit into this string location.");c=[].concat(_toConsumableArray(c));var m=[].concat(_toConsumableArray(n));[].concat(l).forEach(function(e){0+e<0&&(e=c.length+(0+e)),c=[].concat(_toConsumableArray(c.slice(0,e)),[m.shift()],_toConsumableArray(c.slice(e+1)))}),c=c.join("")}else u(c)&&(void 0!==n.TwineScript_KnownName&&(n.TwineScript_KnownName=r.TwineScript_ObjectName),Array.isArray(l)&&p(n)?("string"==typeof n&&(n=[].concat(_toConsumableArray(n))),l.map(function(e,t){return[e,n[t]]}).forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C(c,n,r)})):C(c,l,n));return c},n):t.create("macrocall","I can't (set:) "+f(this)+", if the "+(f(this.object).match(/ (.+$)/)||["","value"])[1]+" isn't stored in a variable.","Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return this.error?this.error:P.call(this,function(e,n,r){var i,a=_slicedToArray(n,2),o=a[0],s=a[1];if(i=t.containsError(e,o,s)||t.containsError(A(o,s)))return i;if(r>0&&(o=h(o)),null===e){var c="string"==typeof o;c&&(o=[].concat(_toConsumableArray(o))),Array.isArray(s)?(p(o)&&(s=[].concat(_toConsumableArray(new Set(s)))).sort(function(e,t){return k(o,t)-k(o,e)}),s.forEach(function(e){return E(o,e)})):E(o,s),c&&(o=o.join(""))}else C(o,s,e);return o},null)},defineType:function(e){var n=this.object,r=this.compiledPropertyChain;if(!n||!n.TwineScript_VariableStore||1!==r.length||!n.TwineScript_TypeDefs)return t.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.");var i=r[0];Object.hasOwnProperty.call(n,"TwineScript_TypeDefs")||(n.TwineScript_TypeDefs=Object.create(n.TwineScript_TypeDefs));var a=n.TwineScript_TypeDefs,o=a[i];if(o&&!c(o,e))return t.create("operation","I can't redefine the type of "+f(this)+" to "+(e.TwineScript_ObjectName||d(e))+", as it is already "+(o.TwineScript_ObjectName||d(o))+".");a[i]=e,"const"===e.name&&(n[i]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,n){var r=void 0;if(r=t.containsError(e))return _(r);n=[].concat(n),w.isPrototypeOf(e)&&(n=e.propertyChain.concat(n),e=e.object);var i=function(e,n){return{compiledPropertyChain:n.reduce(function(r,i,a){var o;return i.computed&&(i=i.value),w.isPrototypeOf(i)&&(i=i.get()),i=Array.isArray(i)?i.map(function(t){return x(e,t)}):x(e,i),(o=t.containsError(r,i))?o:(a<n.length-1&&(e=N(e,i)),r.push(i),r)},[]),deepestObject:e}}(e,n),a=i.compiledPropertyChain,o=i.deepestObject;return(r=t.containsError(a,o))?_(r):Object.assign(Object.create(w),{object:e,propertyChain:n,compiledPropertyChain:a,deepestObject:o})},TwineScript_ToSource:function(){var t=this,n=function(e,n){return!n&&t.object.TwineScript_VariableStore?e:j(e)};return(this.object===e.variables?"$":this.object.TwineScript_VariableStore?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?n(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,r){return e+"'s "+n(t,r)}))},get TwineScript_ObjectName(){return this.TwineScript_ToSource()+(this.object.TwineScript_VariableStoreName?" in "+this.object.TwineScript_VariableStoreName:"")},on:function(e,t){if(e in S)return"function"!=typeof t||S[e].includes(t)||S[e].push(t),w;a("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:!0,TwineScript_TypeDefs:Object.create(null)})}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return r}),define("datatypes/custommacro",["jquery","utils/operationutils","internaltypes/changedescriptor","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,i,a,o){var s=t.objectName,c=t.matches,u=Object.assign,l=Object.create,p=function(t){return function(c){for(var p=arguments.length,f=Array(p>1?p-1:0),d=1;d<p;d++)f[d-1]=arguments[d];t.called+=1;var h=t.varNames,y=t.params,m=t.body,g=u(l(i),{TwineScript_VariableStoreName:t.TwineScript_ObjectName+" call #"+t.called,TwineScript_TypeDefs:l(null)}),v=[],b=0;f.forEach(function(e,t){var n=h[b];g.TwineScript_TypeDefs[n]=y[b].datatype.rest?y[b].datatype.create("array"):y[b].datatype;var i=r.create(g,n);if(y[b].datatype.rest){var a=(g[n]||[]).concat(e);if(t<f.length-1)return void(g[n]=a);i.set(a)}else i.set(e),b+=1;v.push(o.create(s(i)+" is now "+s(g[n])))}),f.length&&(b+=1),y[b]&&y[b].datatype.rest&&(r.create(g,h[b]).set([]),g.TwineScript_TypeDefs[name]=y[b].datatype.create("array"));var w=void 0,T=e("<p>").append(m.html);c.stack.unshift({tempVariables:g,dom:T,output:function(e){w=e}}),c.execute(),c.stackTop.blocked&&c.stack.shift();var S,x,k=T.find("tw-error");return k.length?(T.prepend(v.map(function(e){return e.render()}),"<br>"),a.create("propagated",k.length+" error"+(k.length>1?"s":"")+" occurred when running "+t.TwineScript_ObjectName+".",void 0,T)):void 0===w?a.create("custommacro",t.TwineScript_ObjectName+" didn't output any data or hooks using (output:) or (output-data:)."):n.isPrototypeOf(w)?(S=w,x=u({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},TwineScript_Attach:function(e){return e.run(S),x},TwineScript_Run:function(){return S}})):w}},f=Object.freeze({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",get TwineScript_ObjectName(){return this.TwineScript_KnownName?"the "+this.TwineScript_KnownName+" macro":"a custom macro"},TwineScript_GetProperty:function(e){if("params"===e)return[].concat(_toConsumableArray(this.params))},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){return u(l(f),this)},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},create:function(e,t){var n=u(l(this),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(e){var t=void 0;return t=e.datatype.toTypeSignatureObject?e.datatype.toTypeSignatureObject({rest:e.rest}):{pattern:"range",range:function(t){return c(e.datatype,t)}},e.rest?{pattern:"zero or more",innerType:t}:t}),body:t,TwineScript_KnownName:""});return n.fn=p(n),n}});return f}),define("datatypes/lambda",["utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r){var i=e.objectName,a=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:a,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(a),this)},create:function(e,o,s,c){var u=void 0;function l(e){var r=e&&e.varRef?e.varRef:e;return void 0===r||r&&n.isPrototypeOf(r)&&t.isPrototypeOf(r.object)&&1===r.propertyChain.length}if("making"===o&&!l(s))return r.create("syntax","I need a temp variable, or typed temp variable, to the right of '"+o+"', not "+i(s)+".");if(r.containsError(e))return e;if(a.isPrototypeOf(e)){if("when"===o||"when"in e)return r.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+o+"'.");if(o in e&&("where"!==o||"true"!==e[o]))return r.create("syntax","This lambda has two '"+o+"' clauses.");u=e}else{if("when"===o&&void 0!==e)return r.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!l(e))return r.create("syntax","This lambda needs to start with a single temp variable, or typed temp variable, not "+i(e)+".");(u=Object.create(this)).loop=e||""}return u.source=c.trim(),u[o]=s,u.making&&u.making.getName()===(u.loop&&u.loop.getName())?r.create("syntax","This lambda has two variables named '"+u.loop.getName()+"'.","Lambdas should have all-unique parameter names."):u},apply:function(e,n){var i=n.loop,a=n.pos,o=n.making,s=n.ignoreVia,c=n.tempVariables;function u(e,t){if(e)if("datatype"in e&&"varRef"in e){var n=e.varRef.create(c,e.varRef.propertyChain);n.defineType(e.datatype);var i=n.set(t);if(r.containsError(i))return i}else c[e.getName()]=t}c=c||Object.create(e.stack.length?e.stackTop.tempVariables:t);var l=u(this.loop,i)||u(this.making,o);if(r.containsError(l))return l;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:c,lambdaPos:this.when?void 0:a}));var p=e.eval("Operations");!i||this.making||this.when?p.initialiseIt(r.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName)):p.initialiseIt(i);var f=!s&&this.via,d=e.eval("where"in this||"when"in this?"Operations.where("+(this.where||this.when)+","+(f||"true")+",null)":f||"true");return e.stack.shift(),d},filter:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=void 0,o=t.reduce(function(t,o,s){if(a=r.containsError(t))return a;var c=n.apply(e,{loop:o,pos:s+1,ignoreVia:!0,tempVariables:i});return(a=r.containsError(c))?a:t.concat(c?[o]:[])},[]);return(a=r.containsError(o))?a:o}});return a}),define("datatypes/codehook",["internaltypes/twineerror","renderer"],function(e,t){var n=t.exec;return Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return"["+this.source+"]"},create:function(t,r){r||(r=n(t));var i=e.containsError(r);return i||Object.assign(Object.create(this),{source:t,html:r})}})}),define("datatypes/colour",["jquery","utils"],function(e,t){var n=t.matMul,r=Math.max,i=Math.min,a=Math.sin,o=Math.cos,s=Math.pow,c=Math.round,u=Math.floor,l=Math.atan2,p=Math.cbrt,f=Math.sqrt,d=Math.PI,h=Object.assign,y=Object.create,m=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,g=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,v=y(null);function b(e){var t=e.r,n=e.g,a=e.b,o=e.a,s=r(t/=255,n/=255,a/=255),u=i(t,n,a),l=(s+u)/2,p=s-u;if(s===u)return{h:0,s:0,l:l};var f=void 0;switch(s){case t:f=(n-a)/p+(n<a?6:0);break;case n:f=(a-t)/p+2;break;case a:f=(t-n)/p+4}return{h:f=c(60*f),s:l>.5?p/(2-s-u):p/(s+u),l:l,a:o}}var w=[.96422,1,.82521],T=24389/27,S=216/24389,x=function(e){return e.map(function(e){return[e]})},k=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,r=e.c,i=e.h,c=e.a;t*=100;var u=[];u[1]=(t+16)/116,u[0]=r*o(i*d/180)/500+u[1],u[2]=u[1]-r*a(i*d/180)/200;var l=[s(u[0],3)>S?s(u[0],3):(116*u[0]-16)/T,t>T*S?s((t+16)/116,3):t/T,s(u[2],3)>S?s(u[2],3):(116*u[2]-16)/T].map(function(e,t){return e*w[t]}),p=k(n([[.9555766,-.0230393,.0631636],[-.0282895,1.0099416,.0210077],[.0122982,-.020483,1.3299098]],n([[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],x(l)))).map(function(e){return 255*e}),f=_slicedToArray(p,3);return{r:f[0],g:f[1],b:f[2],a:c}}function j(e){var t=O(e);return[t.r,t.g,t.b].every(function(e){return e>=0&&e<=255})}var A=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),n=e.toRGBA();return A.create({r:Math.min(Math.round(.6*(t.r+n.r)),255),g:Math.min(Math.round(.6*(t.g+n.g)),255),b:Math.min(Math.round(.6*(t.b+n.b)),255),a:(t.a+n.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){if(!A.isPrototypeOf(e))return!1;if(e.lcha&&this.lcha)return e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a;var t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA();return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"},toHSLA:function(){return b(this.toRGBA())},toRGBA:function(){return this.lch?O(function(e){if(j(e))return e;var t=(e=h({},e)).c,n=0;for(e.c/=2;t-n>1e-5;)j(e)?n=e.c:t=e.c,e.c=(t+n)/2;return e}(h({},this.lch,{a:this.a}))):this},toLCHA:function(){return this.lch?h({},this.lch):(t=(e=this).r,r=e.g,i=e.b,a=e.a,o=k(n([[1.0478112,.0228866,-.050127],[.0295424,.9904844,-.0170491],[-.0092345,.0150436,.7521316]],n([[.4124564,.3575761,.1804375],[.2126729,.7151522,.072175],[.0193339,.119192,.9503041]],x([t/255,r/255,i/255])))).map(function(e,t){return e/w[t]}).map(function(e){return e>S?p(e):(T*e+16)/116}),c=[116*o[1]-16,500*(o[0]-o[1]),200*(o[1]-o[2])],u=180*l(c[2],c[1])/d,{l:c[0]/100,c:f(s(c[1],2)+s(c[2],2)),h:u>=0?u:u+360,a:a});var e,t,r,i,a,o,c,u},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,t.a=this.a,A.create(t)},TwineScript_GetProperty:function(e){if("lch"===e){var t=this.toLCHA();return new Map([["l",t.l],["c",t.c],["h",t.h]])}var n=this.toRGBA();return"h"===e||"s"===e||"l"===e?b(n)[e]:"r"===e||"g"===e||"b"===e||"a"===e?n[e]:void 0},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){var e=!this.lch&&b(this);if(e&&!e.h&&!e.s){if(1===e.l)return"white";if(0===e.l)return"black"}return"("+(this.lch?"lch":"hsl")+":"+(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l])+(1!==this.a?","+this.a:"")+")"},create:function(t){return"string"==typeof t?this.create((A.isHexString(t)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(m,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(t){if(t in v)return v[t];var n=e("<p>").css("background-color",t).css("background-color");return n="transparent"===n?{r:0,g:0,b:0,a:0}:n.startsWith("rgb")?n.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},v[t]=n,n})(t)):!("h"in t&&"s"in t&&"l"in t)||"r"in t||"g"in t||"b"in t?("a"in t&&"number"==typeof t.a||(t.a=1),h(y(this),"h"in t&&"c"in t&&!("s"in t)&&"l"in t?{a:t.a,lch:{l:t.l,c:t.c,h:t.h}}:t)):this.create(function(e){var t=e.h,n=e.s,r=e.l,i=e.a;if(0===n){var a=u(255*r);return{r:a,g:a,b:a}}var o=r<.5?r*(1+n):r+n-r*n,s=2*r-o;function c(e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+6*(o-s)*e:e<.5?o:e<2/3?s+(o-s)*(2/3-e)*6:s}return{r:u(255*c((t/=360)+1/3)),g:u(255*c(t)),b:u(255*c(t-1/3)),a:i}}(t))},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(m)||e.slice(1).match(g))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+\s*,\s*\d+%?\s*,\s*\d+%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return A}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var t=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,n){var r=e.colour,i=e.stop;return t.stops[n].stop===i&&t.stops[n].colour.TwineScript_is(r)})},TwineScript_Clone:function(){return n.create(this.angle,[].concat(_toConsumableArray(this.stops)))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(e){return n.create(this.angle,this.stops.map(function(t){return{colour:t.colour,stop:t.stop*e}}))},toLinearGradientString:function(){var e=this;return(this.repeating?"repeating-":"")+"linear-gradient("+this.angle+"deg, "+this.stops.reduce(function(t,n){var r=n.colour,i=n.stop;return t+r.toRGBAString()+" "+i*(e.repeating?1:100)+(e.repeating?"px,":"%,")},"").slice(0,-1)+")"}});return n}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s){var c=e.realWhitespace,u=e.anyRealLetter,l=e.anyCasedLetter,p=e.anyNewline,f=t.objectName,d=Object.assign,h=Object.seal,y=Object.keys,m=Math.floor,g=Math.abs,v=void 0,b=void 0,w={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return w.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e={pattern:"range",range:v[this.name]};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":e;var n=Object.create(this);return n.name=e,n.rest=t,n},from:function(e){var t=y(b).find(function(t){return b[t](e)});return t?w.create(t):s.create("datatype",f(e)+" doesn't correspond to a datatype value.")}};return b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return w.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return i.isPrototypeOf(e)},lambda:function(e){return a.isPrototypeOf(e)},macro:function(e){return o.isPrototypeOf(e)},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},v=d({},b,{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e)&&!e.length},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+c+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},any:function(){return!0},const:function(){return!0}}),h(w)}),define("datatypes/typedvar",["utils/operationutils","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r){var i=e.typeName,a=e.matches,o=e.toSource,s=e.unstorableValue,c=Object.freeze,u=Object.assign,l=Object.create,p=c({TwineScript_TypeName:"a typed variable name",get TwineScript_ObjectName(){return this.TwineScript_ToSource()},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return u(l(p),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return o(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return a(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n;if(n=r.containsError(t)||r.containsError(e)||t.error)return n;var a=s(e);return a&&!p.isPrototypeOf(a)?r.create("syntax","The -type syntax can't have "+i(a)+" to its left."):u(l(this),{datatype:e,varRef:t})}});return p}),define("macros",["jquery","utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/hookset","datatypes/codehook","datatypes/typedvar","datatypes/datatype","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c,u,l,p,f){var d=n.insensitiveName,h=n.nth,y=n.plural,m=n.andList,g=n.lockProperty,v=(r.clone,r.objectName),b=r.typeName,w=r.singleTypeCheck,T=r.toSource,S=void 0,x={};function k(e,n,r){var i=n.fn,a=n.typeSignature,s=n.isChanger,u=void 0!==s&&s,l=r[0];r=function(e){return e.reduce(function(e,n){if(n&&!0===n.spreader){var r=n.value,i=f.containsError(r);if(i)e.push(i);else if(Array.isArray(r)||"string"==typeof r)for(var a=0;a<r.length;a++)e.push(r[a]);else r instanceof Set?e.push.apply(e,_toConsumableArray(Array.from(r).sort(t("en")))):e.push(f.create("operation","I can't spread out "+v(r)+", because it is not a string, dataset, or array."))}else e.push(n);return e},[])}(r.slice(1)),a=[].concat(a||[]);var p=!e,d=p?"":"("+(Array.isArray(e)&&e.length>1?e[0]:e)+":)";e=p?"this custom macro":"the "+d+" macro";var g=void 0;g=a.length>0?e+" must only be given "+m(a.map(b))+(a.length>1?", in that order":"."):e+" must not be given any data."+(p?"":" Just write "+d);for(var T=void 0,x=function(t,n){var i=a[t],s=r[t];if(f.containsError(s))return{v:s};if(c.isPrototypeOf(s)&&u)return{v:f.create("syntax","Please put this hook outside the parentheses of the changer macro, not inside it.","Hooks should appear after a macro"+(p?".":": "+d+"[Some text]"))};if(t>=a.length&&!T)return{v:f.create("datatype",r.length-a.length+" too many values were given to "+e+".",g)};if(i||(i=T),!i.innerType||"rest"!==i.pattern&&"zero or more"!==i.pattern||(T=i.innerType,"rest"===i.pattern&&(i=i.innerType)),!w(s,i)){if(void 0===s){var l=a.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length;return{v:f.create("datatype",e+" needs "+y(l-t,"more value")+".",g)}}return s&&s.TwineScript_Unstorable&&(i===S.TypeSignature.Any||i.innerType&&i.innerType===S.TypeSignature.Any)?{v:f.create("datatype",e+"'s "+h(t+1)+" value, "+v(s)+", is not valid data for this macro.",g)}:s&&o.isPrototypeOf(s)&&"lambda"===i.pattern?{v:f.create("datatype",e+"'s "+h(t+1)+" value (a lambda) should have "+m(["where","when","making","via","with"].filter(function(e){return i.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+m(["where","when","making","via","with"].filter(function(e){return e in s}).map(function(e){return"a '"+e+"' clause"}))+".")}:"insensitive set"===i.pattern?{v:f.create("datatype",v(s)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+m(i.innerType)+".")}:{v:f.create("datatype",e+"'s "+h(t+1)+" value is "+v(s)+", but should be "+b(i)+".",i.message||g)}}},k=0,O=Math.max(r.length,a.length);k<O;k+=1){var j=x(k);if("object"===(void 0===j?"undefined":_typeof(j)))return j.v}return i.apply(void 0,[l].concat(_toConsumableArray(r)))}function O(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={fn:t,typeSignature:n};r&&(i.isChanger=!0),Object.freeze(i),Array.isArray(e)?e.forEach(function(e){return g(x,d(e),i)}):g(x,d(e),i)}return S={has:function(e){return e=d(e),x.hasOwnProperty(e)},get:function(e){return e=d(e),x.hasOwnProperty(e)&&x[e]},add:function e(t,n,r){return O(t,n,r),e},addChanger:function e(t,n,r,a){return O(t,n,a,!0),i.register(Array.isArray(t)?t[0]:t,r),e},addCommand:function e(t,n,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return O(t,function(e,t,n,r){return function(i){for(var a=arguments.length,o=Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];var c=t.apply(void 0,o);if(c)return c;var u=p.create(),l=Object.assign({TwineScript_TypeID:"command",TwineScript_ObjectName:"a ("+e+":) command",TwineScript_TypeName:"a ("+e+":) command",TwineScript_Print:function(){return"`[A ("+e+":) command]`"},TwineScript_ToSource:function(){return"("+e+":"+o.map(T)+")"},TwineScript_is:function(e){return T(this)===T(e)}},r?{TwineScript_Attach:function(e,t){return u.section=e,t.run(u),l},TwineScript_Run:function(e){return n.apply(void 0,[u,e].concat(o))}}:{TwineScript_Run:function(e){return n.apply(void 0,[e].concat(o))}});return l}}([].concat(t)[0],n,r,a),i),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:e,max:t,range:function(n){return"number"==typeof n&&!Number.isNaN(n)&&n>=e&&n<=t}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&e>=0&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&e>=1&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t){return S.has(e)?k(e,S.get(e),t):f.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t){return a.isPrototypeOf(e)?k("",e,t):f.create("macrocall","I can't call "+v(e)+" because it isn't a custom macro.")}},Object.assign(S.TypeSignature,{positiveNumber:S.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:S.TypeSignature.numberRange(0,1/0),percent:S.TypeSignature.numberRange(0,1)}),Object.freeze(S)}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,i){var a=n.objectName;return r.on("set",function(n,r){n.TwineScript_VariableStore&&e(t.storyElement).find("[data-2bind]").each(function(t,i){var a=(i=e(i)).data("twoWayBindEvent");"function"==typeof a&&a(i,n,r)})}),Object.freeze({TwineScript_TypeName:"a bound variable",TwineScript_ObjectName:"a bound variable",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var t,n=this.varRef.set(e);if(t=i.containsError(n))return t},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"one way";return r.isPrototypeOf(e)?e.error?e.error:Object.assign(Object.create(this),{varRef:e,bind:t}):i.create("operation","I can only 'bind' a variable, not "+a(e)+".")}})}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,i){var a=e.objectName,o=e.matches;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a 'to' or 'into' expression",TwineScript_ObjectName:"a 'to' or 'into' expression",TwineScript_Unstorable:!0,set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=void 0,c=[],u=function e(s,c){var u,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=[],f=void 0;if(f=c&&r.isPrototypeOf(c)?c.get():c,u=i.containsError(f))return u;if(Array.isArray(f)&&Array.isArray(s)){for(var d=0,h=0;d<s.length&&h<f.length;){var y=s[d],m=f[h];if(t.isPrototypeOf(y)&&y.datatype.rest||n.isPrototypeOf(y)&&y.rest){for(var g=h;h<f.length&&o(y,m);)m=f[h+=1];t.isPrototypeOf(y)?y.datatype=[y.datatype]:n.isPrototypeOf(y)&&(y=n.create("array")),p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,{first:g+1,last:h+1}):f.slice(g,h)))}else p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,h+1):m)),h+=1;d+=1}return d<s.length?l&&i.create("operation","I can't unpack this array because it needs "+(s.length-d)+" more value"+(s.length-d>0?"s":"")+"."):p}if(s instanceof Map&&f instanceof Map){var v=!0,b=!1,w=void 0;try{for(var T,S=s.entries()[Symbol.iterator]();!(v=(T=S.next()).done);v=!0){var x=_slicedToArray(T.value,2),k=x[0],O=x[1];if(!f.has(k))return l&&i.create("operation","I can't unpack this datamap because it needs a '"+k+"' data name.");p=p.concat(e(O,r.isPrototypeOf(c)?r.create(c,k):f.get(k)))}}catch(e){b=!0,w=e}finally{try{!v&&S.return&&S.return()}finally{if(b)throw w}}return p}if(t.isPrototypeOf(s)){if("function"==typeof s.datatype.destructure)return[{dest:s,value:f,src:c}].concat(s.datatype.destructure(f));if(!o(f,s.datatype))return[l&&i.create("operation","I can't unpack "+a(f)+" into "+s.varRef.TwineScript_ToSource()+" because it doesn't match "+a(s.datatype)+".")];p=p.concat(e(s.datatype,f))}return r.isPrototypeOf(s)||t.isPrototypeOf(s)?p.concat({dest:s,value:f,src:c}):"function"==typeof s.destructure?p.concat(s.destructure(f)):o(f,s)?p:l&&i.create("operation","I tried to unpack, but "+a(s)+" in the pattern didn't match "+a(f)+".")}(this.dest,this.src);if(s=i.containsError(u))return s;if(!u.length)return i.create("operation","I can't store a new value inside "+a(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var l=!0,p=!1,f=void 0;try{for(var d,h=u.reverse()[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=y.dest,g=y.value,v=y.src;if(t.isPrototypeOf(m)){if(s=i.containsError(m.defineType()))return s;m=m.varRef}if(s=m.set(g),i.isPrototypeOf(s))return s;e&&v&&v.delete(),c.shift(a(m)+" is now "+a(g))}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return c.join("; ")},create:function(e,t,n){return Object.assign(Object.create(this),{dest:e,src:t,operator:n})}})}),define("twinescript/operations",["jquery","state","datatypes/assignmentrequest","utils/operationutils","internaltypes/varref","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s){var c=r.isObject,u=r.collectionType,l=r.is,p=r.isA,f=r.clone,d=r.unique,h=r.contains,y=r.matches,m=r.objectName,g=void 0,v=0;function b(e,t,n,r){return n=n||"do this to",function(i,a){1===t.length&&(a=i);var o;return(o=s.containsError(i,a))?o:(void 0===i?"undefined":_typeof(i))!==e||(void 0===a?"undefined":_typeof(a))!==e?s.create("operation","I can only "+n+" "+e+"s, not "+m((void 0===i?"undefined":_typeof(i))!==e?i:a)+".",r):t(i,a)}}function w(e){return function(t,n){var r;if(r=s.containsError(t,n))return r;if((void 0===t?"undefined":_typeof(t))!==(void 0===n?"undefined":_typeof(n))||c(t)&&"TwineScript_TypeName"in t&&c(n)&&"TwineScript_TypeName"in n&&t.TwineScript_TypeName!==n.TwineScript_TypeName||u(t)!==u(n)){var i=m(t)+" isn't the same type of data as "+m(n);return s.create("operation",i[0].toUpperCase()+i.slice(1))}return e(t,n)}}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function r(i,a){var o=void 0;if(o=s.containsError(i,a))return o;v=i;var c=i.determiner?[i,a]:a.determiner?[a,i]:[],u=_slicedToArray(c,2),l=u[0],p=u[1];if(l){var f=l.determiner;if("start"===f||"end"===f){if(t)return s.create("operation","I can't use '"+t+"' with the 'start' or 'end' of "+m(l)+".");if(p.determiner){if("start"===p.determiner||"end"===p.determiner)return s.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");var d=[p,l];l=d[0],p=d[1]}for(var h=l.string||l.array,y=0;y<h.length+1;y+=1){var g=y?"end"===f?h.slice(-y):h.slice(0,y):h.constructor(),b=l===i?r(g,a):r(i,g);if(o=s.containsError(b))return o;if(b!==n)return b}return n}var w="all"===f;return l.array.reduce(function(e,t){var n,o=l===i?r(t,a):r(i,t);return(n=s.containsError(e,o))?n:w?e&&o:e||o},w)}return e(i,a)}}function S(e,t){return T(function(t,n){var r=e(t,n);return s.containsError(r)?r:!r},t,!0)}var x="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.";return g={create:function(n){var r=Object.create(this);return r.Identifiers={TwineScript_Identifiers:!0,get it(){return v},get time(){return n.stackTop&&n.stackTop.evaluateOnly?s.create("operation","'time' can't be used in "+n.stackTop.evaluateOnly+"."):Date.now()-n.timestamp},get visits(){var e=n.stackTop.speculativePassage,r=function(n){return n===(e||t.passage)};return t.pastPassageNames().filter(r).length+t.mockVisits.filter(r).length+(!e||e===t.passage)},get visit(){return r.Identifiers.visits},get exits(){return n.stackTop&&n.stackTop.evaluateOnly?s.create("operation","'exit' and 'exits' can't be used in "+n.stackTop.evaluateOnly+"."):n.dom.find("tw-enchantment, tw-link").filter(function(t,n){return e(n).data("enchantmentEvent")||e(n).parent().data("linkPassageName")||e(n).parent().data("clickEvent")}).length},get exit(){return r.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:s.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}},r},elidedComparisonOperator:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.reduce(function(n,r){return"boolean"==typeof r?r:g[e](n,g[t](v,r))},"and"===e)},and:b("boolean",w(function(e,t){return e&&t}),"use 'and' to join",x),or:b("boolean",w(function(e,t){return e||t}),"use 'or' to join",x),not:b("boolean",function(e){return!e},"use 'not' to invert",x),"+":w(function(e,t){if(Array.isArray(e))return[].concat(_toConsumableArray(e),_toConsumableArray(t));var n=void 0;return e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(d).map(f)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(void 0===e?"undefined":_typeof(e))?e+t:s.create("operation","I can't use + on "+m(e)+".")}),"-":w(function(e,t){if(Array.isArray(e))return e.filter(function(e){return!t.some(function(t){return l(e,t)})});if(e instanceof Set){var n=[].concat(_toConsumableArray(t));return new Set([].concat(_toConsumableArray(e)).filter(function(e){return!n.some(function(t){return l(e,t)})}))}return"string"==typeof e?e.split(t).join(""):"number"==typeof e?e-t:s.create("operation","I can't use - on "+m(e)+".")}),"*":b("number",w(function(e,t){return e*t}),"multiply"),"/":b("number",w(function(e,t){return 0===t?s.create("operation","I can't divide "+m(e)+" by zero."):e/t}),"divide"),"%":b("number",w(function(e,t){return 0===t?s.create("operation","I can't modulo "+m(e)+" by zero."):e%t}),"modulus"),"<":T(b("number",w(function(e,t){return e<t}),"do < to"),"<"),">":T(b("number",w(function(e,t){return e>t}),"do > to"),">"),"<=":T(b("number",w(function(e,t){return e<=t}),"do <= to"),"<="),">=":T(b("number",w(function(e,t){return e>=t}),"do >= to"),">="),is:T(l),isNot:S(l),contains:T(h,"contains"),doesNotContain:S(h,"does not contain"),isIn:T(function(e,t){return h(t,e)},"is in"),isNotIn:S(function(e,t){return h(t,e)},"is not in"),isA:T(p,"is a"),isNotA:S(p,"is not a"),typifies:T(function(e,t){return p(t,e)}),untypifies:S(function(e,t){return p(t,e)}),matches:T(y),doesNotMatch:S(y),where:function(e,t,n){var r;return(r=s.containsError(e))?r:"boolean"!=typeof e?s.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+m(e)+"."):e?t:n},makeSpreader:function(e){if(a.isPrototypeOf(e)||o.isPrototypeOf(e)){var t=f(e);return(a.isPrototypeOf(e)?t.datatype:t).rest=!0,t}return{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:"a spreaded '...' value",TwineScript_Unstorable:!0}},makeAssignmentRequest:function(e,t,r){var i=s.containsError(e,t);return i||n.create(e,t,r)},setIt:function(e){return i.isPrototypeOf(e)||a.isPrototypeOf(e)?(v=e.get(),e):e},initialiseIt:function(e){v=e}},Object.freeze(g)}),define("twinescript/environ",["macros","state","utils","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","internaltypes/varref","internaltypes/twineerror","twinescript/operations"],function(Macros,State,Utils,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,VarRef,TwineError,OperationsProto){return function(section){"object"===(void 0===section?"undefined":_typeof(section))&&section||Utils.impossible("TwineScript.environ","no Section argument was given!");var Operations=OperationsProto.create(section);return section.eval=function(){try{return eval(arguments[0])}catch(e){return e}},section}}),define("section",["jquery","utils","renderer","twinescript/environ","twinescript/operations","state","utils/operationutils","utils/renderutils","datatypes/changercommand","datatypes/hookset","datatypes/colour","datatypes/lambda","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,i,a,o,s,c,u,l,p,f,d,h,y){var m,g=o.printBuiltinValue,v=o.objectName,b=o.typeID,w=s.collapse;function T(e,n,r){if(n&&"object"===(void 0===n?"undefined":_typeof(n))&&c.isPrototypeOf(n)){if(r.data("originalSource",r.popAttr("source")),!this.renderInto(r.data("originalSource"),r,n)){var i=t.insensitiveName(e.attr("name"));if(["if","elseif","unless","else","testfalse"].includes(i)&&(e.addClass("false"),"elseif"!==i&&(this.stackTop.lastHookShown=!1)),r.data("live")){var a=r.data("live"),o=a.delay,s=a.event;(function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;a&&t.assertMustHave(a,["when"]);var o=n.data("originalSource")||"",s=_slicedToArray(this.stack,1)[0].tempVariables,c=this.whenUnblocked.bind(this,function(){if(r.inDOM()){var t=a&&a.filter(r,[!0],s);h.containsError(t)?t.render(e.attr("title")).replaceAll(e):!a||t[0]?(r.renderInto(o,n,{append:"replace"}),t||n.find("tw-expression[name='stop']").length||r.inDOM()&&setTimeout(c,i)):setTimeout(c,i)}});setTimeout(c,i)}).call(this,e,r,o,s)}return}}else{if(!1===n)return r.attr("source")&&(r.data("originalSource",r.popAttr("source")),r.data("hidden",!0)),e.addClass("false"),void(this.stackTop.lastHookShown=!1);!0!==n&&e.replaceWith(h.create("datatype",v(n)+" cannot be attached to this hook.","Only Booleans and changers can be attached to hooks.").render(e.attr("title")))}this.stackTop.lastHookShown=!0}function S(t){var n=(t instanceof e?t[0]:t).nextSibling;if(n&&(n instanceof Text&&!n.textContent.trim()||["br","tw-consecutive-br"].includes((n.tagName||"").toLowerCase()))){var r=S(n),i=r.whitespace,a=r.nextElem;return{whitespace:e(n).add(i),nextElem:a}}return{whitespace:e(),nextElem:e(n)}}var x={add:[],remove:[]};return m={create:function(e){var n=Object.assign(Object.create(this),{timestamp:Date.now(),dom:e||t.storyElement,stack:[],enchantments:[],unblockCallbacks:[]});return n=r(n)},get stackTop(){return this.stack[0]},inDOM:function(){return e(t.storyElement).find(this.dom).length>0},evaluateTwineMarkup:function(t,n){var r=e("<p>");this.stack.unshift({desc:f.create({target:r,source:t,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:n,finalIter:!0}),this.execute();var i;return(i=r.find("tw-error")).length>0?i:r},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:Object.assign(Object.create(d),{TwineScript_VariableStoreName:n}),speculativePassage:t});var r=void 0;return r=p.isPrototypeOf(e)?e.apply(this,{fail:!1,pass:!0}):this.eval(e),this.stack.shift(),r},renderInto:function(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=f.create({target:n,source:t,section:this,append:"append"});if(r)if(c.isPrototypeOf(r)){var s=r.run(o);if(h.containsError(s))return s.render(n.attr("title")).replaceAll(n),!1}else Object.assign(o,r);if((n=o.target,this.stack.length>=50)&&this.stack.reduce(function(e,t){return e+!!t.finalIter},0)>=50)return h.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(n.attr("title")).replaceAll(n),!1;var u=function(t,r,a){var o=n instanceof e&&n.is("tw-hook")&&n.parents("tw-collapsed,[collapsing=true]").length>0;i.stack.unshift({desc:t,finalIter:a,tempVariables:r,collapses:o,evaluateOnly:i.stackTop&&i.stackTop.evaluateOnly})};if(a||(a=Object.create(this.stack.length?this.stackTop.tempVariables:d)),!a.hasOwnProperty("TwineScript_VariableStoreName")){var l=n&&n.tag();a.TwineScript_VariableStoreName="tw-hook"===l?n.attr("name")?"?"+n.attr("name"):"an unnamed hook":"tw-expression"===l?"a "+n.attr("type")+" expression":"tw-passage"===l?"this passage":"an unknown scope"}return Object.keys(o.loopVars).length?function(){var e=Object.assign({},o.loopVars),t=Math.min.apply(Math,_toConsumableArray(Object.keys(e).map(function(t){return e[t].length})));if(y.create(t+" loop"+(1!==t?"s":"")).render().prependTo(n),t){for(var r=function(n){u(o,Object.keys(e).reduce(function(t,r){return t[r]=e[r][n],t},Object.create(a),n===t-1))},s=t-1;s>=0;s-=1)r(s);for(s=t-1;s>=0&&!i.stackTop.blocked;s-=1)i.execute()}}():(u(o,a,!0),this.execute()),0===this.stack.length&&this.updateEnchantments(),o.enabled},execute:function(){var n=this,r=this.stackTop,a=r.desc,o=r.dom,s=r.collapses,u=r.evaluateOnly;a&&!o&&(o=a.render(),this.stackTop.dom=o,this.stackTop.desc=void 0),o.findAndFilter("tw-hook,tw-expression").each(function(r,a){if(n.stackTop.blocked)return!1;switch((a=e(a)).tag()){case"tw-hook":var o=a.popAttr("source")||"";if(o&&a.data("originalSource",o),a.data("tempVariables",n.stackTop.tempVariables),a.popAttr("hidden")){a.data("hidden",!0);break}o&&n.renderInto(o,a);break;case"tw-expression":if(a.attr("blockers")){if(u)return void a.removeAttr("blockers").removeAttr("js").replaceWith(h.create("syntax","I can't use a macro like (prompt:) or (confirm:) in "+u+".","Please rewrite this without putting such macros here.").render(a.attr("title"),a));var s=[];try{s=JSON.parse(a.popAttr("blockers")),a.data("blockers",s)}catch(e){t.impossible("Section.execute","JSON.parse blockers failed.")}}if(a.data("blockers")){var p=a.data("blockers");if(p.length){n.stackTop.blocked=!0;var d=n.eval(p.shift());return h.containsError(d)&&(n.stackTop.blocked=!1,a.removeData("blockers").replaceWith(d.render(a.attr("title"),a))),!1}a.removeData("blockers")}a.attr("js")&&function(n){var r=this.eval(n.popAttr("js")||"");this.stackTop.evaluateOnly&&r&&(c.isPrototypeOf(r)||"function"==typeof r.TwineScript_Run)&&(r=h.create("syntax","I can't work out what "+this.stackTop.evaluateOnly+" should evaluate to, because it contains a "+(c.isPrototypeOf(r)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var a=void 0,o=void 0,s=e();for(o=n;c.isPrototypeOf(r);){var u=S(o);if(a=u.whitespace,(o=u.nextElem)[0]instanceof Text&&"+"===o[0].textContent.trim()){var p,d=o,m=S(d);if(p=m.whitespace,(o=m.nextElem).is("tw-expression")){var w=this.eval(o.popAttr("js"));if(h.containsError(w)){r=w;break}var x=i["+"](r,w);e(a).add(d).add(p).remove(),r=h.containsError(x)?h.create("operation","I can't combine "+v(r)+" with "+v(w)+".","function"==typeof w.TwineScript_Run?"If you want to attach this changer to "+v(w)+", remove the + between them.":"Changers can only be added to other changers."):x;continue}}if(o.is("tw-expression")){var k=this.eval(o.popAttr("js"));if(h.containsError(k)){r=k;break}if(k&&"object"===(void 0===k?"undefined":_typeof(k))&&"function"==typeof k.TwineScript_Attach){r=k.TwineScript_Attach(this,r);break}return c.isPrototypeOf(k)?void n.replaceWith(h.create("operation","Changers like ("+r.macroName+":) need to be combined using + between them.","Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(n.attr("title"))):void n.replaceWith(h.create("operation",v(k)+" can't have changers like ("+r.macroName+":) attached.","Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(n.attr("title")))}if(o.is("tw-hook")){a.remove(),s=o;break}r.macroName||t.impossible("Section.runExpression","changer has no macroName");var O=n.attr("title")||"("+r.macroName+": ...)";return void n.replaceWith(h.create("syntax","The ("+r.macroName+":) changer should be stored in a variable or attached to a hook.","Macros like this should appear before a hook: "+O+"[Some text]").render(n.attr("title")))}n.attr("return",b(r)),s=s.length?s:S(n).nextElem.filter("tw-hook");var j=void 0;if(j=h.containsError(r))j instanceof Error&&(j=h.fromError(j)),n.replaceWith(j.render(n.attr("title"),n));else if(y.isPrototypeOf(r))n.append(r.render());else if(r&&"function"==typeof r.TwineScript_Run)if(r=r.TwineScript_Run(this),h.containsError(r))n.replaceWith(r.render(n.attr("title")));else if(f.isPrototypeOf(r)){if(r.data&&r.data.live)return void n.replaceWith(h.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(n.attr("title")));r.section=this,r.target=o,this.renderInto("",o,r)}else{if("blocked"===r)return this.stackTop.blocked=!0,void n.attr("js","section.blockedValue()");r&&t.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor "+(void 0===r?"undefined":_typeof(r))+': "'+r+'"')}else!s.length&&("string"==typeof r||"number"==typeof r||r instanceof Map||r instanceof Set||Array.isArray(r)||l.isPrototypeOf(r))||r&&"function"==typeof r.TwineScript_Print&&!c.isPrototypeOf(r)?(r=g(r),h.containsError(r)?(r instanceof Error&&(r=h.fromError(r)),n.replaceWith(r.render(n.attr("title")))):"string"!=typeof r?t.impossible("printBuiltinValue() produced a non-string "+(void 0===r?"undefined":_typeof(r))):this.renderInto(r,n)):s.length?T.call(this,n,r,s):c.isPrototypeOf(r)||"boolean"==typeof r||t.impossible("Section.runExpression","The expression evaluated to an unknown value: "+r)}.call(n,a)}}),this.stackTop.blocked||(o.length&&s&&w(o),o.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){w(e(this))}),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return x[e].push(t),this},addEnchantment:function(e){var t=this;this.enchantments.push(e),x.add.forEach(function(n){return n(t,e)})},removeEnchantment:function(e){var t=this,n=this.enchantments.indexOf(e);this.enchantments.splice(n,1),e.disenchant(),x.remove.forEach(function(n){return n(t,e)})},unblock:function(e){for(this.stack.length||t.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;this.unblockCallbacks.length>0;){if(this.unblockCallbacks.shift()(),this.stackTop&&this.stackTop.blocked)return}},whenUnblocked:function(e){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):e()},blockedValue:function(){var e=this.stackTop;return e||t.impossible("Section.blockedValue","stack is empty"),e.blockedValues&&e.blockedValues.length||t.impossible("Section.blockedValue","blockedValues is missing or empty"),e.blockedValues.shift()}},Object.preventExtensions(m)}),define("engine",["jquery","utils","state","section","passages"],function(e,t,n,r,i){var a,o=t.escape,s=t.impossible,c=t.passageSelector,u=t.transitionOut,l=Object.create(null);function p(e,t){return"<tw-include type="+e+" title='"+o(t.get("name"))+"'>"+t.get("source")+"</tw-include>"}function f(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.assertOnlyHas(o,["stretch","transition"]);var f=i.get(a),d=t.storyElement,h=d.parent(),y=o.stretch,m=o.transition,g=(m=void 0===m?{}:m).depart,v=void 0===g?"instant":g,b=m.arrive,w=void 0===b?"dissolve":b,T=m.departOrigin,S=m.arriveOrigin,x=m.time;h.findAndFilter("tw-enchantment").each(function(t,n){var r=(n=e(n)).data("enchantedProperties");r&&d.css(r.reduce(function(e,t){return e[t]="",e},{})),n[0]===h[0]&&(h=d.unwrap().parent())}),i.hasValid(a)||s("Engine.showPassage","There's no passage with the name \""+a+'"!');var k,O,j,A,C=d.children(c).not(".transition-out, .transition-out *"),E=(f.get("tags")||[]).join(" "),_=(k=e("<tw-passage><tw-sidebar>"),O=k.children("tw-sidebar"),j=e('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),A=e('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),n.pastLength<=0&&j.css("visibility","hidden"),n.futureLength<=0&&A.css("visibility","hidden"),O.append(j,A),k);"function"==typeof T&&(T=T.call(C)),"function"==typeof S&&(S=S.call(_)),d.detach(),_.appendTo(d).attr({tags:E}),!y&&v&&(u(C,v,x,0,0,0,T),C.css("position","absolute")),d.attr({tags:E});var N=r.create(_),P=f.get("source");P=i.getTagged("header").map(p.bind(0,"header")).join("")+(l.debug?i.getTagged("debug-header").map(p.bind(0,"debug-header")).join(""):"")+P+i.getTagged("footer").map(p.bind(0,"footer")).join("")+(l.debug?i.getTagged("debug-footer").map(p.bind(0,"debug-footer")).join(""):""),n.pastLength<=0&&(l.debug&&(P=i.getTagged("debug-startup").map(p.bind(0,"debug-startup")).join("")+P),P=i.getTagged("startup").map(p.bind(0,"startup")).join("")+P),N.renderInto(P,_,{transition:w,transitionTime:x,transitionOrigin:S}),h.append(d.parents().length?d.parents().last():d),scroll(0,y?_.offset().top-.05*e(window).height():d.offset().top)}return a={goBack:function(e){n.rewind()&&f(n.passage,e)},goForward:function(e){n.fastForward()&&f(n.passage,e)},goToPassage:function(e,t){n.play(e),f(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:f,options:l},Object.freeze(a)}),define("debugmode/panel",["jquery"],function(e){return Object.freeze({create:function(t){var n=t.className,r=t.rowAdd,i=t.rowCheck,a=t.columnHead,o=t.tabName,s=t.tabUpdate,c=e("<div class='panel panel-"+n+"' hidden><table class='panel-rows'></table></div>"),u=e("<button class='tab tab-"+n+"'>0 "+o+"s</button>");return u.click(function(){u.toggleClass("enabled"),u.parent().siblings(".panel").attr("hidden",""),u.is(".enabled")&&(u.siblings(".tab:not(.tab-"+n+")").removeClass("enabled"),c.removeAttr("hidden"))}),s||(s=function(e){return u.text(e+" "+o+(1!==e?"s":""))}),Object.assign(Object.create(this),{tabName:o,tab:u,panel:c,panelRows:c.find(".panel-rows"),rowAdd:r,rowCheck:i,columnHead:a,tabUpdate:s})},update:function(t,n){var r=this.rowCheck,i=this.rowAdd,a=this.panelRows,o=this.columnHead,s=[],c=a.children();t.forEach(function(t){var n=c.filter(function(n,i){return r(t,e(i))}),o=i(t);n.length?n.replaceWith(o):a.append(o),s.push(o[0])}),c.filter(function(e,t){return!s.includes(t)}).remove(),this.tabUpdate(n),n>0&&!a.find(".panel-head").length?a.prepend(o()):0===n&&a.find(".panel-head").remove()}})}),define("debugmode/mode",["jquery","utils","state","internaltypes/varref","internaltypes/twineerror","utils/operationutils","engine","passages","section","debugmode/panel"],function(e,t,n,r,i,a,o,s,c,u){var l=t.escape,p=t.nth,f=t.storyElement,d=t.debounce,h=a.objectName,y=a.isObject,m=a.toSource;return function(t,a){var g=e(document.documentElement),v=e("<tw-debugger>\n\t\t<div class='panel panel-errors' hidden><table></table></div>\n\t\t<div class='tabs'></div>\n\t\t<label style='user-select:none'>Turns: </label><select class='turns' disabled></select><button class='show-invisibles'>Debug View</button><button class='show-dom'>DOM View</button>\n\t\t<div class='resizer'>\n\t\t</tw-debugger>"),b=v.find(".tabs"),w=v.find(".show-dom"),T=v.find(".show-invisibles"),S=v.find(".turns");v.find(".resizer").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=v.width();g.on("mousemove.debugger-resizer",function(e){var r=e.pageX;v.width((n+t-r|0)+"px")}).on("mouseup.debugger-resizer",function(){g.off(".debugger-resizer")})}),T.click(function(){g.toggleClass("debug-mode").removeClass("dom-debug-mode"),T.toggleClass("enabled"),w.removeClass("enabled")}),w.click(function(){g.toggleClass("dom-debug-mode").removeClass("debug-mode"),w.toggleClass("enabled"),T.removeClass("enabled")}),n.timelinePassageNames().forEach(function(e,t){S.append("<option value="+t+">"+(t+1)+": "+e+"</option>")}),S.val(n.pastLength),n.pastLength>0&&S.removeAttr("disabled"),S.change(function(e){var t=e.target.value-n.pastLength;0!==t&&(n[t<0?"rewind":"fastForward"](Math.abs(t)),o.showPassage(n.passage))}),n.on("forward",function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=n.pastLength;i>=1&&S.removeAttr("disabled"),r?(S.find("[selected]").removeAttr("selected"),S.val(i)):(S.children().each(function(t,n){t>=i&&e(n).remove()}),S.append("<option value="+i+">"+(i+1)+": "+t+"</option>").val(i))}).on("back",function(){n.pastLength<=1&&S.attr("disabled"),S.find("[selected]").removeAttr("selected"),S.val(n.pastLength)}).on("load",function(e){S.empty(),S[e.length<=1?"attr":"removeAttr"]("disabled"),e.forEach(function(e,t){return S.append("<option value="+t+">"+(t+1)+": "+e.passage+"</option>")})});var x=new Set,k=u.create({className:"variables",tabName:"Variable",rowAdd:function(t){var n=t.name,r=t.path,i=t.value,a=t.tempScope,o=t.type,s=y(i)&&i.TwineScript_DebugName?i.TwineScript_DebugName():l(h(i)),c="";r.length&&(c=r.reduce(function(e,t){return e+t+"'s "},""));var u=o?m(o):"",p=s.length>48&&!i.TwineScript_DebugName,f="object"===(void 0===i?"undefined":_typeof(i))||p,d=p?s.slice(0,48)+"\u2026":s;return e('<div class="variable-row">').attr("data-name",n).attr("data-path",r+"").attr("data-scope",a||"").css("padding-left",Math.min(5,r.length)+"em").append("<td class='variable-type'>"+(u?u+"-type ":"")+"</td>","<td class='variable-name'>"+(c?"<span class='variable-path'>"+(a?"_":"$")+l(c)+"</span> ":"")+(c?"":a?"_":"$")+l(n+"")+"</td>","<td class='temporary-variable-scope'>"+(a||"")+"</td>","<td class='variable-value'>"+d+"</td><td class='panel-row-buttons'>"+(f?"<tw-folddown tabindex=0>(source:) </tw-folddown>":"")+"</td>").add(f?"<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'>"+l(m(i))+"</td></tr>":"")},rowCheck:function(e,t){var n=e.name,r=e.path,i=e.tempScope;return t.attr("data-name")===n&&t.attr("data-path")===r+""&&t.attr("data-scope")===i},columnHead:function(){return'<tr class="panel-head"><th>Type</th><th>Name</th><th>Scope</th><th>Value</th></tr>'}}),O=d(function(){var e=[],t=n.variables,r=e.length;function i(t){if(!(e.length>500)){e.push(t);var n=t.path.concat(t.name),r=t.value,a=t.tempScope;Array.isArray(r)?r.forEach(function(e,t){return i({name:p(t+1),path:n,value:e,tempScope:a})}):r instanceof Map?[].concat(_toConsumableArray(r)).forEach(function(e){var t=_slicedToArray(e,2),r=t[0],o=t[1];return i({name:r,path:n,value:o,tempScope:a})}):r instanceof Set&&[].concat(_toConsumableArray(r)).forEach(function(e){return i({name:"???",path:n,value:e,tempScope:a})})}}for(var a in t)a.startsWith("TwineScript")||(r+=1,i({name:a,path:[],value:t[a],tempScope:"",type:t.TwineScript_TypeDefs&&t.TwineScript_TypeDefs[a]}));e.push.apply(e,_toConsumableArray(x)),r+=x.size,k.update(e,r),k.panel[(r?"remove":"add")+"Class"]("panel-variables-empty")}),j=void 0;r.on("set",function(e,t,r){if(e!==n.variables&&e.TwineScript_VariableStoreName){var i=e.TwineScript_VariableStoreName,a=e.TwineScript_TypeDefs&&e.TwineScript_TypeDefs[t],o=[].concat(_toConsumableArray(x)).find(function(e){return e.name===t&&e.tempScope===i});o?o.value=r:x.add({name:t,path:[],value:r,tempScope:i,type:a})}O(),j()}).on("delete",function(){O(),j()}),k.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),k.tab.addClass("enabled");var A=k.panel.find(".clipboard");g.on("click",".panel-variables-copy",function(){var e=[];for(var t in n.variables)t.startsWith("TwineScript")||e.push("$"+t+" to "+m(n.variables[t]));A.val("(set:"+e+")")[0].select(),document.execCommand("copy")});var C=u.create({className:"enchantments",tabName:"Enchantment",rowAdd:function(t){var n=t.scope,r=t.changer,i=t.name,a=t.localHook,o=void 0;return o=r?l(h(r)):"<em>enchanted via ("+i+":)</em>",e('<div class="enchantment-row">').data("enchantment",t).append("<td><span class='enchantment-name'>"+m(n)+(a?"</span><span class=enchantment-local>"+(a.attr("name")?"?"+a.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value'>"+o+"</td>"+(r?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).add(r?"<tr class='panel-row-source' style='display:none'><td colspan='3'>"+l(m(r))+"</td></tr>":"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th>Scope</th><th>Value</th></div>'}}),E=d(function(e){C.update(e.enchantments,e.enchantments.length)});c.on("add",E).on("remove",E);var _=c.create(f),N=u.create({className:"storylets",tabName:"Storylet",rowAdd:function(t){var n=t.name,r=t.active,i=t.storyletSource,a=t.exclusive,o=t.urgent;return e('<tr class="storylet-row '+(r?"":"storylet-closed")+'">').attr("data-name",n).append("<td class='storylet-name'>"+n+"</td><td class='storylet-lambda'>"+i+"</td><td class='storylet-exclusive'>"+a+"</td><td class='storylet-urgent'>"+o+"</td>")},rowCheck:function(e,t){var n=e.name;return t.attr("data-name")===l(n+"")},columnHead:function(){return"<tr class=\"panel-head\"><th>Name</th><th>Condition</th><th class='storylet-exclusive'>Exclusivity</th><th class='storylet-urgent'>Urgency</th></tr>"}});N.tab.hide(),j=d(function(){var e=s.getStorylets(_),t=i.containsError(e),n=s.allStorylets();N.update(n.map(function(n){return{name:n.get("name"),storyletSource:n.get("storylet").TwineScript_ToSource(),active:!t&&e.some(function(e){return e.get("name")===n.get("name")}),exclusive:"number"==typeof n.get("exclusivity")?n.get("exclusivity"):0,urgent:"number"==typeof n.get("urgency")?n.get("urgency"):0}}),t?0:e.length),N.panel[(t?"add":"remove")+"Class"]("storylet-error");var r=n.some(function(e){return e.get("exclusivity")&&"number"==typeof e.get("exclusivity")}),a=n.some(function(e){return e.get("urgency")&&"number"==typeof e.get("urgency")});N.panel[(r?"add":"remove")+"Class"]("panel-exclusive"),N.panel[(a?"add":"remove")+"Class"]("panel-urgent"),n.length&&N.tab.show()});var P=u.create({className:"source",tabName:"Source",rowAdd:e.noop,rowCheck:e.noop,tabUpdate:e.noop,columnHead:e.noop});P.tab.text("Source");var I=u.create({className:"errors",tabName:"Error",rowAdd:e.noop,rowCheck:e.noop,columnHead:e.noop}),M=function(t,r){if("propagated"!==t.type){I.panelRows.children().length>500&&I.panelRows.children(":first-child").remove();var i=e('<tr class="error-row"><td class="error-passage">'+n.passage+'</td><td class="error-message">'+t.message+"</td></tr>");i.find(".error-message").attr("title",r),I.panelRows.append(i),I.tabUpdate(I.panelRows.children().length)}};function D(){x=new Set,O(),j(),C.panelRows.empty(),C.tabUpdate(0),n.passage&&P.panelRows.text(s.get(n.passage).get("source"))}i.on("error",M),v.prepend(k.panel,C.panel,I.panel,N.panel,P.panel),b.prepend(k.tab,C.tab,I.tab,N.tab,P.tab),n.on("forward",D).on("back",D).on("load",D),t&&(M(t,a),D()),e(document.body).append(v)}}),define("macrolib/values",["macros","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s){var c=t.realWhitespace,u=t.nth,l=t.anyRealLetter,p=n.subset,f=n.objectName,d=n.clone,h=n.toSource,y=e.TypeSignature,m=y.rest,g=y.zeroOrMore,v=y.either,b=y.optional,w=y.insensitiveSet,T=y.numberRange,S=y.percent,x=y.nonNegativeInteger,k=y.positiveInteger,O=y.Any,j=Math.max,A=Math.min,C=Math.round,E=Math.floor,_=Math.ceil;function N(e){return function(){var t=e.apply(void 0,arguments);return"number"!=typeof t||isNaN(t)?s.create("macrocall","This mathematical expression doesn't compute!"):t}}e.add(["str","string","text"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.join("")},[g(e.TypeSignature.either(String,Number,Boolean,Array))])("source",function(e,t){return t&&"command"===t.TwineScript_TypeID&&!t.TwineScript_ToSource?s.create("datatype","I can't construct the source code of a command created by a custom macro."):h(t)},[O])("substring",function(e,t,n,r){return p(t,n,r)},[String,parseInt,parseInt])("lowercase",function(e,t){return t.toLowerCase()},[String])("uppercase",function(e,t){return t.toUpperCase()},[String])("lowerfirst",function(e,t){return t.replace(RegExp(l+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst",function(e,t){return t.replace(RegExp(l+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words",function(e,t){return t.split(RegExp(c+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],function(e,t,n){return 0===n.length?s.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[x,String])(["str-reversed","string-reversed"],function(e,t){return[].concat(_toConsumableArray(t)).reverse().join("")},[String])("joined",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.join(t)},[m(String)])("plural",function(e,t,n,r){return n&&""!==r?t+" "+(1!==Math.abs(t)?r||n+"s":n):s.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,b(String)])(["str-nth","string-nth"],function(e,t){return u(t)},[parseInt])(["num","number"],function(e,t){return Number.isNaN(+t)?s.create("macrocall","I couldn't convert "+f(t)+" to a number."):+t},[String])("datatype",function(e,t){return a.from(t)},[O])("datapattern",function(e,t){return function e(t){var n,r=void 0;return Array.isArray(t)?r=t.map(e):t instanceof Map?(r=new Map,[].concat(_toConsumableArray(t)).forEach(function(t){var n=_slicedToArray(t,2),i=n[0],a=n[1];return r.set(i,e(a))})):r=a.from(t),(n=s.containsError(r))?n:r}(t)},[O])(["rgb","rgba"],function(e){return r.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[T(0,255),T(0,255),T(0,255),b(S)])(["hsl","hsla"],function(e,t,n,i,a){return(t=C(t)%360)<0&&(t+=360),r.create({h:t,s:n,l:i,a:a})},[Number,S,S,b(S)])(["lch","lcha"],function(e,t,n,i,a){return(i=C(i)%360)<0&&(i+=360),r.create({l:t,c:n,h:i,a:a})},[S,T(0,132),Number,b(S)])("complement",function(e,t){return t.LCHRotate(180)},[r])("palette",function(e,t,n){var i=n.toLCHA(),a=i.l,o={l:a<=.75?.75+a/3:.75-3*(1-a),c:80,h:i.h,a:1},s=void 0,c=void 0,u=void 0;return s=r.create(o),o.l+=a<=.75?-.1:.1,o.l<.5&&(o.l*=.5/o.l),c=r.create(o),o.l+=a<=.85?.15:-.15,u=r.create(o),"adjacent"===t?(c=(s=s.LCHRotate(-30)).LCHRotate(30),u=s.LCHRotate(60)):"triad"===t&&(u=s.LCHRotate(180),c=s.LCHRotate(140),s=s.LCHRotate(-140)),[n,s,c,u]},[w("mono","adjacent","triad"),r])("gradient",function(e,t){for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];if((t=C(t)%360)<0&&(t+=360),a.length<4)return s.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.");var c=void 0,u=[],l=a.reduce(function(e,t){if(s.containsError(e))return e;if(void 0===c)c=t;else{if("number"!=typeof c||!r.isPrototypeOf(t))return s.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");u.push({stop:c,colour:d(t)}),c=void 0}return e},!0);return s.containsError(l)?l:void 0!==c?s.create("macrocall","This gradient has a colour-stop percent without a colour."):i.create(t,u)},[Number,m(v(S,r))])("stripes",function(e,t,n){for(var r=arguments.length,a=Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];(t=C(t)%360)<0&&(t+=360);var s=0,c=[];return a.forEach(function(e){c.push({stop:s,colour:d(e)}),s+=n,c.push({stop:s,colour:d(e)})}),i.create(t,c,!0)},[Number,k,r,m(r)])("hooks-named",function(e,t){return t?o.create({type:"name",data:t}):s.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=2){var n=arguments.length<=t+1?void 0:arguments[t+1];if(t===(arguments.length<=1?0:arguments.length-1)-1||s.containsError(n))return n;if("boolean"!=typeof n)return s.create("datatype","(cond:)'s "+u(t+1)+" value is "+f(n)+", but should be a boolean.");if(n)return arguments.length<=t+1+1?void 0:arguments[t+1+1]}return s.create("macrocall","An odd number of values must be given to (cond:), not "+(arguments.length<=1?0:arguments.length-1),"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,O,m(O)]),{weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,m(Number)],max:[j,m(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return e>0?E(e):_(e)},Number],ceil:[_,Number],pow:[N(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[N(Math.sqrt),Number],log:[N(Math.log),Number],log10:[N(Math.log10),Number],log2:[N(Math.log2),Number],random:[function(e,t){var n=void 0,r=void 0;return t?(n=A(e,t),r=j(e,t)):(n=0,r=e),r+=1,~~(Math.random()*(r-n))+n},[parseInt,e.TypeSignature.optional(parseInt)]],either:[function(){var e;return e=~~(Math.random()*arguments.length),arguments.length<=e?void 0:arguments[e]},m(O)],nth:[function(e){var t;return e<=0?s.create("datatype","(nth:)'s first value should be a positive whole number, not "+e):(t=(e-1)%(arguments.length<=1?0:arguments.length-1)+1,arguments.length<=t?void 0:arguments[t])},[parseInt,m(O)]],"":function(){var t=this;Object.keys(this).forEach(function(n){if(n){var r=t[n][0],i=t[n][1];e.add(n,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return r.apply(void 0,n)},i)}})}}[""]()}),define("macrolib/commands",["jquery","macros","utils","state","passages","renderer","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/lambda","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(e,t,n,r,i,a,o,s,c,u,l,p,f,d,h,y,m,g,v,b){var w=v.printBuiltinValue,T=v.objectName,S=v.clone,x=v.toSource,k=b.dialog,O=b.geomParse,j=b.geomStringRegExp,A=t.TypeSignature,C=A.Any,E=A.Everything,_=A.rest,N=A.either,P=A.optional,I=A.zeroOrMore,M=A.positiveInteger,D=A.positiveNumber,R=Object.assign,L=Math.floor,q=Math.ceil,F=Math.abs,V=Math.max,H=Math.min,z=e.noop;function $(e){return"("+e+" "+o.options.ifid+") "}["set","put","unpack"].forEach(function(e){return t.add(e,function(t){for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n+=1){var r=arguments.length<=n+1?void 0:arguments[n+1];if("into"===r.operator&&"set"===e)return s.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===r.operator&&"set"!==e)return s.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((y.isPrototypeOf(r.dest)||m.isPrototypeOf(r.dest))===("unpack"===e))return s.create("macrocall","unpack"===e?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the ("+e+":) macro with just single variables and typed variables to the "+("set"===e?"left of 'to'.":"right of 'into'."));var i=r.set();if(s.containsError(i))return i}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a ("+e+":) operation",TwineScript_ObjectName:"a ("+e+":) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,""}}},[_(u)])}),t.add("move",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return s.create("macrocall","Please say 'into' when using the (move:) macro.");var r=n.set(!0);if(s.containsError(r))return r}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,""}}},[_(u)]),t.addCommand("display",function(e){if(!i.hasValid(e))return s.create("macrocall","I can't (display:) the passage '"+e+"' because it doesn't exist.")},function(e,t,r){return R(e,{source:n.unescape(i.get(r).get("source"))})},[String])("print",z,function(e,t,n){return R(e,{source:w(n)})},[C])(["verbatim-print","v6m-print"],z,function(e,t,n){return R(e,{verbatim:!0,source:w(n)})},[C])(["verbatim-source","v6m-source"],function(e){if(e&&"command"===e.TwineScript_TypeID&&!e.TwineScript_ToSource)return s.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return R(e,{verbatim:!0,source:w(x(n))})},[C])("go-to",function(e){if(!i.hasValid(e))return s.create("macrocall","I can't (go-to:) the passage '"+e+"' because it doesn't exist.")},function(e,t,n){return requestAnimationFrame(function(){return o.goToPassage(n,{transition:e.data.passageT8n})}),"blocked"},[String])("undo",z,function(e){return r.pastLength<1?s.create("macrocall","I can't (undo:) on the first turn."):(requestAnimationFrame(function(){return o.goBack({transition:e.data.passageT8n})}),"blocked")},[]),n.onStartup(function(){return e(n.storyElement).on("click.icon","tw-icon",function(t){var n=e(this),i=n.data("clickEvent"),a=n.attr("alt");i&&i(n),"Undo"===a&&(t.stopPropagation(),o.goBack()),"Redo"===a&&(t.stopPropagation(),o.goForward()),"Fullscreen"===a&&(t.stopPropagation(),o.toggleFullscreen()),"Reload"===a&&(r.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return r.pastLength>0}],["Redo","&#8631;",function(){return r.futureLength>0}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var n=_slicedToArray(e,3),r=n[0],i=n[1],a=n[2];t.addCommand("icon-"+r.toLowerCase(),function(e,t){if("string"==typeof e&&"string"==typeof t){var n=[].concat(_toConsumableArray(e)).length,i=[].concat(_toConsumableArray(t)).length;if(n>1&&i>1)return s.create("datatype","One of the two strings given to (icon-"+r.toLowerCase()+":) should be 1 character long, for its icon.");if(1===n&&1===i)return s.create("datatype","One of the two strings given to (icon-"+r.toLowerCase()+":) should be 2 or more characters long, for its label.")}},function(e,t,n,o){if("string"==typeof o&&1===[].concat(_toConsumableArray(o)).length||"string"==typeof n&&[].concat(_toConsumableArray(n)).length>1){var s=[o,n];n=s[0],o=s[1]}return R(e,{source:'<tw-icon tabindex=0 alt="'+r+'" '+(o?'data-label="'+o.replace('"',"&quot;")+'"':"")+' title="'+r+'" '+(a()?"":'style="visibility:hidden"')+">"+(n||i)+"</tw-icon>"})},[P(String),P(String)])}),t.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:s.create("datatype","The 2nd "+r):s.create("datatype","The 1st "+r)},function(e,t,r,i,a){e.attr.push({"data-2bind":!0}),e.data.twoWayBindEvent=function(t,n,o){if(r.varRef.matches(n,o)){var s=r.varRef.get();if("number"==typeof s)e.target.children("tw-icon").text(s>0?L(s):q(s)).attr("data-label",1!==F(s)&&void 0!==a?a:i)}};var o=r.varRef.get();return"number"!=typeof o?s.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not "+T(o)+"."):R(e,{source:'<tw-icon data-label="'+n.escape(1!==F(o)&&void 0!==a?a:i)+'">'+(o>0?L(o):q(o))+"</tw-icon>"})},[g,String,P(String)]),t.addCommand("meter",function(e,t,n,r){return"string"!=typeof r||r.trim()?-1===n.search(j)||!n.includes("=")&&n.length>1?s.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:s.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(e,t,n,r,i,a,o){a&&"string"!=typeof a&&(o=a,a=void 0),o||(o=d.create({h:0,s:0,l:.5,a:.5})),d.isPrototypeOf(o)&&(o=h.create(90,[{colour:o,stop:0},{colour:o,stop:1}]));var c=O(i),u=c.marginLeft,l=c.size,p=u>0&&Math.ceil(u+l)<100,f=function(e){var t=V(0,H(1,e/r)),n=o.repeating?o:o.multiply(r/e);return"height:100%;background-repeat:no-repeat;background-image:"+(p?R(n,n.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+R(n,n.repeating?{}:{angle:p||0===u?90:270}).toLinearGradientString()+";background-size:"+(p?Array(2).fill(50*t+"%"):100*t+"%")+";background-position-x:"+(p?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===u?"left":"right")+";text-align:"+(p?"center":0===u?"left":"right")};e.styles.push({"margin-left":u+"%",width:l+"%",height:"1.5em",display:"block"}),e.attr.push({"data-2bind":!0});var y=a&&t.stackTop.tempVariables;e.data.twoWayBindEvent=function(t,r,i){if(n.varRef.matches(r,i)){var o=n.varRef.get();if("number"==typeof o){var s=e.target.children("tw-meter");if(s.attr("style",f(o)),a){var c=R({},e,{source:a,target:s,append:"replace",transitionDeferred:!1});e.section.renderInto("",null,c,y)}}}};var m=n.varRef.get();return"number"!=typeof m?s.create("datatype","(meter:) can only be bound to a variable holding a number, not "+T(m)+"."):R(e,{source:'<tw-meter style="'+f(m)+'">'+(a||"")+"</tw-meter>"})},[g,D,String,P(N(String,d,h)),P(N(d,h))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(e,n){return t.addCommand(e,function(){return""===(arguments.length<=0?void 0:arguments[0])?s.create("datatype","The first string in a ("+e[0]+":) can't be empty."):arguments.length<=(g.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?s.create("datatype","I need two or more strings to "+(n?"sequence":"cycle")+" through, not just '"+(t=arguments.length-1,arguments.length<=t?void 0:arguments[t])+"'."):void 0;var t},function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];var o=void 0;g.isPrototypeOf(i[0])&&(o=i.shift());var c=0;if(o&&"two way"===o.bind){e.attr.push({"data-2bind":!0});var u=i.indexOf(o.varRef.get());u>-1&&(c=u)}var l=t.stackTop.tempVariables;function p(t,r){var a=c>=i.length-1&&n,u=""===i[c]?"":a?i[c]:"<tw-link>"+i[c]+"</tw-link>";if(a&&(e.data.clickEvent=void 0),o&&!r){var p=o.set(i[c]);if(s.containsError(p))return void t.replaceWith(p.render(i[c]))}var f=R({},e,{source:u,transitionDeferred:!1});e.section.renderInto("",null,f,l)}i[c]&&(e.data.clickEvent=function(e){c=(c+1)%i.length,p(e,!1)})&&(e.data.twoWayBindEvent=function(e,t,n){if(o.varRef.matches(t,n)){var r=o.varRef.get(),a=i.indexOf(r);a>-1&&a!==c&&(c=a,p(e,!0))}});var f="<tw-link>"+i[c]+"</tw-link>";if(o){var d=o.set(i[c]);if(s.containsError(d))return d}return R(e,{source:f,append:"replace",transitionDeferred:!0})},[N(g,String),_(String)])}),n.onStartup(function(){return e(n.storyElement).on("change.dropdown-macro","select",function(){var t=e(this),n=t.closest("tw-expression, tw-hook").data("dropdownEvent");n&&n(t)})}),t.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===(t=(arguments.length<=1?0:arguments.length-1)-1+1,arguments.length<=t?void 0:arguments[t])?s.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?s.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(t,r,i){for(var a=arguments.length,o=Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];var u=0;if("two way"===i.bind){t.attr.push({"data-2bind":!0});var l=o.indexOf(i.varRef.get());l>-1&&(u=l)}var p=Math.max.apply(Math,_toConsumableArray(o.map(function(e){return[].concat(_toConsumableArray(e)).length}))),f="<select>"+o.map(function(e,t){return"<option"+(t===u?" selected":"")+(""===e?" disabled":"")+">"+n.escape(e||"\u2500".repeat(p))+"</option>"}).join("\n")+"</select>";t.data.dropdownEvent=function(e){var t=e.val(),n=i.set(t);s.containsError(n)&&e.replaceWith(n.render(t))},t.data.twoWayBindEvent=function(e,t,n){if(i.varRef.matches(t,n)){var r=i.varRef.get(),a=o.indexOf(r);a>-1&&a!==u&&(e.find("select").val(r),u=a)}},t.styles.push({"background-color":function(){return n.parentColours(e(this)).backgroundColour}});var d=i.set(o[u]);return s.containsError(d)?d:R(t,{source:f,append:"replace"})},[g,String,_(String)]),n.onStartup(function(){return e(n.storyElement).on("input.checkbox-macro","input[type=checkbox]",function(){var t=e(this),n=t.closest("tw-expression").data("checkboxEvent");n&&n(t)})});var B=1;t.addCommand("checkbox",function(){},function(e,t,n,r){var i=!1,a="checkbox-"+ ++B;if("two way"===n.bind){e.attr.push({"data-2bind":!0});var o=n.varRef.get();"boolean"==typeof o&&(i=o),e.data.twoWayBindEvent=function(e,t,r){if(n.varRef.matches(t,r)){var i=n.varRef.get();"boolean"==typeof i&&e.children("input[type=checkbox]").prop("checked",i)}}}return e.data.checkboxEvent=function(e){var t=e.is(":checked"),r=n.set(t);s.containsError(r)&&e.replaceWith(r.render(""))},R(e,{source:'<input id="'+a+'" type="checkbox" '+(i?"checked":"")+'><label for="'+a+'">'+r+"</label>",append:"replace"})},[g,String]),n.onStartup(function(){return e(document).on("fullscreenchange",function(){e("input[type=checkbox][id^=fullscreen]",n.storyElement).each(function(t,n){(e(n).closest("tw-expression").data("fullscreenEvent")||Object)(n)})})}),t.addCommand("checkbox-fullscreen",function(){},function(t,n,r){var i="fullscreenCheckbox-"+ ++B;return t.data.fullscreenEvent=function(t){return e(t).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},t.data.checkboxEvent=function(){return o.toggleFullscreen()},R(t,{source:'<input id="'+i+'" type="checkbox" '+(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ")+(document.fullscreenElement||document.msFullscreenElement?"checked":"")+'><label for="'+i+'">'+r+"</label>",append:"replace"})},[String]),n.onStartup(function(){return e(n.storyElement).on("input.input-box-macro","textarea",function(){var t=e(this),n=t.closest("tw-expression").data("inputBoxEvent");n&&n(t)})}),["input-box","force-input-box"].forEach(function(e){return t.addCommand(e,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=g.isPrototypeOf(n[0]),a="number"==typeof n[1+i],o="string"==typeof n[1+i+a],c=n[+i];if("string"!=typeof c||-1===c.search(j)||!c.includes("=")&&c.length>1)return s.create("datatype","The ("+e+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(c)+".");if("force-input-box"===e&&!o)return s.create("datatype","The ("+e+":) macro requires a string of text to forcibly input.");var u=1+i+a+o;return n.length>u?s.create("datatype","An incorrect combination of values was given to this ("+e+":) macro."):void 0},function(t,r){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];var c="force-input-box"===e,u=g.isPrototypeOf(a[0]),l="number"==typeof a[1+u],p=u&&a[0],f=l?a[1+u]:3,d=O(a[+u]),h=d.marginLeft,y=d.size,m="string"==typeof a[1+u+l]?a[1+u+l]:"",v=c?"":m;if("two way"===p.bind){t.attr.push({"data-2bind":!0});var b=p.varRef.get();if("string"==typeof b){v=c?m.slice(0,b.length):b;var w=p.set(v);if(s.containsError(w))return w}t.data.twoWayBindEvent=function(e,t,n){if(p.varRef.matches(t,n)){var r=p.varRef.get();"string"==typeof r&&e.find("textarea").val(c?m.slice(0,r.length):r)}}}else if(p){var T=p.set(c?"":m);if(s.containsError(T))return T}c||(t.data.inputBoxEvent=function(e){var t=e.val(),n=p.set(t);s.containsError(n)&&e.replaceWith(n.render(""))});var S='<textarea style="width:100%" rows='+f+">"+n.escape(v)+"</textarea>";if(c){var x=Array.from(m);t.data.inputBoxEvent=function(e){var t=e.val().length,n=x.slice(0,t).join("");if(e.val(n),p){var r=p.set(n);s.containsError(r)&&e.replaceWith(r.render(""))}return!0}}return t.styles.push({display:"block","margin-left":h+"%",width:y+"%","border-style":function(){return this.style.borderStyle||"solid"}}),R(t,{source:S,append:"replace"})},[N(g,String),P(N(M,String)),P(N(M,String)),P(String)])}),["show","rerun"].forEach(function(n){return t.addCommand(n,z,function(t,r){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return a.forEach(function(i){return i.forEach(r,function(i){var a=i.data("hidden");if(void 0!==a!=("rerun"===n))if(i.removeData("hidden"),a instanceof e)i.empty().append(a);else{var o=i.data("tempVariables");r.renderInto("",null,R({},t,{append:"replace",source:i.data("originalSource")||"",target:i}),o&&Object.create(o))}})}),t},[_(l)])});var W=function(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]};t.addCommand("hide",z,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){return t.forEach(e,function(e){Boolean(e.data("hidden"))||e.data("hidden",e.contents().detach())})})},[_(l)],!1)("stop",z,z,[],!1)("load-game",z,function(e,t){var n=localStorage.getItem($("Saved Game")+t);if(!n)return s.create("saving","I can't find a save slot named '"+t+"'!");var i=r.deserialise(e,n);if(i instanceof Error){var a=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+i.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===a.find("input").last().val()&&localStorage.removeItem($("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]});return"blocked"}requestAnimationFrame(o.showPassage.bind(o,r.passage,!1))},[String],!1)("mock-visits",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!o.options.debug)return s.create("operation","(mock-visits:) cannot be used outside of debug mode.","This macro is not meant to be used outside of debugging your story.");var r=t.find(function(e){return!i.hasValid(e)});return r?s.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];r.mockVisits=S(n)},[_(String)],!1)(["dialog","alert"],function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(g.isPrototypeOf(e)){if("two way"===e.bind)return s.create("datatype","(dialog:) shouldn't be given two-way bound variables.");if(void 0===t)return s.create("datatype","(dialog:) needs a message string to display.")}else void 0!==t&&i.unshift(t);var o=i.findIndex(function(e){return""===e});if(o>-1)return s.create("datatype","(dialog:)'s "+n.nth(o+1)+" link text shouldn't be an empty string.")},function(e,t,n,r){for(var i=arguments.length,a=Array(i>4?i-4:0),o=4;o<i;o++)a[o-4]=arguments[o];return g.isPrototypeOf(n)||(void 0!==r&&a.unshift(r),r=n,n=void 0),a.length||(a=["OK"]),k({section:t,message:r,cd:e,buttons:a.map(function(e){return{name:e,callback:function(){t.unblock(n&&n.set(e)||"")}}})}),"blocked"},[N(g,String),I(String)])("open-url",z,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],z,function(){if(r.pastLength<1)return s.create("infinite","I mustn't (restart:) the story in the starting passage.");r.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()},[],!1)("goto-url",z,function(e,t){window.location.assign(t)},[String],!1)("ignore",z,z,[I(E)])("assert-exists",function(e){if(""===e)return s.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?l.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:s.create("assertion","I didn't see any "+("string"==typeof n?"text occurrences of":"hooks matching")+" "+x(n)+" in this passage.")},[N(l,String)]),t.add("assert",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:R(s.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game",function(e,t,n){if(n=n||"",!r.hasStorage)return!1;var i=r.serialise();if(s.containsError(i))return i;if(!1===i)return!1;try{return localStorage.setItem($("Saved Game")+t,i),localStorage.setItem($("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,P(String)])("prompt",function(e,t,n,r,i){if(e.stackTop&&e.stackTop.evaluateOnly)return s.create.apply(s,["macrocall"].concat(_toConsumableArray(W(e.stackTop.evaluateOnly))));if(""===i)return s.create("datatype","The text for (prompt:)'s confirm link can't be blank.");var a=k({section:e,message:t,defaultValue:n,buttons:[{name:i||"OK",confirm:!0,callback:function(){return e.unblock(a.find("input").last().val())}},{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}}]});setTimeout(function(){return a.find("input").last().focus()},100)},[String,String,P(String),P(String)])("confirm",function(e,t,n,r){return e.stackTop&&e.stackTop.evaluateOnly?s.create.apply(s,["macrocall"].concat(_toConsumableArray(W(e.stackTop.evaluateOnly)))):""===r?s.create("datatype","The text for (confirm:)'s confirm link can't be blank."):void k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}},{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}}]})},[String,P(String),P(String)])("page-url",function(){return window.location.href},[]),a.options.blockerMacros.push("prompt","confirm")}),define("macrolib/datastructures",["jquery","utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c,u,l,p,f){var d=t.shuffled,h=t.permutations,y=i.objectName,m=i.subset,g=i.collectionType,v=i.isValidDatamapName,b=i.is,w=i.unique,T=i.clone,S=i.range,x=r.TypeSignature,k=x.optional,O=x.rest,j=x.either,A=x.zeroOrMore,C=x.Any,E=x.nonNegativeInteger;r.add(["a","array"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},A(j(l,C)))("range",function(e,t,n){return S(t,n)},[parseInt,parseInt])("subarray",function(e,t,n,r){return m(t,n,r)},[Array,parseInt,parseInt])("reversed",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(T)},A(C))("shuffled",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return d.apply(void 0,n).map(T)},[C,O(C)])("sorted",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.sort(n("en"))},[j(Number,String),O(j(Number,String))])("rotated",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===(t*=-1)?f.create("macrocall","I can't rotate these values by 0 positions."):Math.abs(t)>=r.length?f.create("macrocall","I can't rotate these "+r.length+" values by "+t+" positions."):r.slice(t).concat(r.slice(0,t)).map(T)},[parseInt,C,O(C)])("rotated-to",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);if(f.containsError(a))return a;if(!a.length)return f.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.");var o=r.indexOf(a[0]);return r.slice(o).concat(r.slice(0,o)).map(T)},[c.TypeSignature("where"),C,O(C)])("repeated",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];for(var a=[];t-- >0;)a.push.apply(a,r);return a.map(T)},[E,O(C)])("interlaced",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),a=[],o=0;o<i;o+=1)for(var s=0;s<n.length;s+=1)a.push(T(n[s][o]));return a},[Array,O(Array)])("permutations",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?h.apply(void 0,n):[]},[A(C)]),r.add("altered",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.map(function(n,r){return t.apply(e,{loop:n,pos:r+1})})},[c.TypeSignature("via"),A(C)])("find",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.filter(e,r)},[c.TypeSignature("where"),A(C)])(["all-pass","pass"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||a.length===r.length},[c.TypeSignature("where"),A(C)])("some-pass",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||a.length>0},[c.TypeSignature("where"),A(C)])("none-pass",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||0===a.length},[c.TypeSignature("where"),A(C)])("folded",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return"where"in t&&(r=t.filter(e,r)),f.containsError(r)||r.reduce(function(n,r,i){return t.apply(e,{making:n,loop:r,pos:i+1})})},[j(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),O(C)]),r.add("datanames",function(e,t){return Array.from(t.keys()).sort(n("en"))},[Map])("datavalues",function(e,t){return Array.from(t.entries()).sort(n("en",function(e){return String(e[0])})).map(function(e){return T(e[1])})},[Map])("dataentries",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(n("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",T(e[1])]])})},[Map])("history",function(e,t){var n=a.mockVisits.concat(a.pastPassageNames());if(!t)return n;var r=t.filter(e,n.map(function(e){return s.get(e)}));return f.containsError(r)?r:r.map(function(e){return e.get("name")})},[k(c.TypeSignature("where"))])("passage",function(e,t){return T(s.get(t||a.passage))||f.create("macrocall","There's no passage named '"+t+"' in this story.")},[k(String)])("passages",function(e,t){var r=n("en"),i=[].concat(_toConsumableArray(s.values())).map(function(e){return T(e)}),a=t?t.filter(e,i):i,o=f.containsError(a);return o||a.sort(function(e,t){return r(e.get("name"),t.get("name"))})},[k(c.TypeSignature("where"))])("open-storylets",function(e,t){if(e.stackTop.evaluateOnly)return f.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+".");var n=s.getStorylets(e,t),r=f.containsError(n);return r||n.map(T)},[k(c.TypeSignature("where"))])("savedgames",function(){function e(e){return"("+e+" "+o.options.ifid+") "}var t=0,n=void 0,r=new Map;do{if(!a.hasStorage)break;n=localStorage.key(t),t+=1;var i=e("Saved Game");n&&n.startsWith(i)&&(n=n.slice(i.length),r.set(n,localStorage.getItem(e("Saved Game Filename")+n)))}while(n);return r},[])(["datamap","dm"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=void 0,a=new Map,o=n.reduce(function(e,t){var n=void 0;if(f.containsError(e))return e;if(void 0===i)i=t;else{if(n=f.containsError(v(a,i)))return n;if(a.has(i))return f.create("macrocall","You used the same data name ("+y(i)+") twice in the same (datamap:) call.");a.set(i,T(t)),i=void 0}return e},!0);return f.containsError(o)?o:void 0!==i?f.create("macrocall","This datamap has a data name without a value."):a},A(j(l,C)))(["dataset","ds"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(w).map(T))},A(C))("count",function e(t,n){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(i.length>1){var o,s=i.map(function(r){return e(t,n,r)});return(o=f.containsError(s))?o:s.reduce(function(e,t){return e+t},0)}var c=i[0];switch(g(n)){case"dataset":case"datamap":return f.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof c?f.create("macrocall",y(n)+" can't contain  "+y(c)+" because it isn't also a string."):c?n.split(c).length-1:0;case"array":return n.reduce(function(e,t){return e+b(t,c)},0);default:return f.create("macrocall",y(n)+" can't contain values, let alone "+y(c)+".")}},[C,O(C)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c,u,l){var p=r.geomParse,f=r.geomStringRegExp,d=Object.assign,h=t.TypeSignature,y=h.either,m=h.wrapped,g=h.optional,v=h.Any,b=h.Everything,w=h.zeroOrMore,T=h.rest,S=h.insensitiveSet,x=h.positiveNumber,k=h.positiveInteger,O=h.nonNegativeNumber,j=h.percent,A=[m(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')];n.onStartup(function(){return e(n.storyElement).on("mouseenter.hover-macro","[hover=false]",function(){var t=e(this),n=t.data("hoverChanger");t.data({mouseoutStyle:t.attr("style")||""}),u.create({target:t},n).update(),t.attr("hover",!0)}).on("mouseleave.hover-macro","[hover=true]",function(){var t=e(this),n=t.data("mouseoutStyle");t.attr("style",n).removeData("mouseoutStyle").attr("hover",!1)})});var C,E,_=S("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur"),N=S("dotted","dashed","solid","double","groove","ridge","inset","outset","none");t.addChanger("if",function(e,t){return s.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},A)("unless",function(e,t){return s.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},A)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?s.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):l.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},A)("else",function(e){return"lastHookShown"in e.stack[0]?s.create("else",[!1===e.stack[0].lastHookShown]):l.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return s.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return s.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return s.create("live",[t])},function(e,t){e.enabled=!1,e.data.live={delay:t}},g(Number))("event",function(e,t){return s.create("event",[t])},function(e,t){e.enabled=!1,e.data.live={event:t}},c.TypeSignature("when"))("more",function(){return s.create("more")},function(e){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return 0!==e.eval("Operations").Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return s.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,r){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return n.anyInputDown()&&(t-=r),e.eval("Operations").Identifiers.time>t?[!0]:[]}}}},[x,g(O)])("hook",function(e,t){return t?s.create("hook",[t]):l.create("datatype","(hook:) names can't be empty strings.")},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.loop?s.create("for",[t].concat(r)):l.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.")},function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a,o=t.filter(e.section,r);if(a=l.containsError(o))return a;e.loopVars[t.loop.getName()]=o||[]},[c.TypeSignature("where"),w(v)])(["transition","t8n"],function(e,t){return s.create("transition",[n.insensitiveName(t)])},function(t,r){return t.transition=r,"zoom"===r&&(t.transitionOrigin=function(){var t=e(this).offset(),r=t.left,i=t.top;return n.mouseCoords.x-r+"px "+(n.mouseCoords.y-i)+"px"}),t},[_])(["transition-time","t8n-time"],function(e,t){return s.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=d(e.data.passageT8n||{},{time:t}),e},[x])(["transition-delay","t8n-delay"],function(e,t){return s.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return s.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[x])(["transition-depart","t8n-depart"],function(e,t){return s.create("transition-depart",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{depart:r}),"zoom"===r&&(t.data.passageT8n.departOrigin=function(){var t=e(this).offset(),r=t.left,i=t.top;return n.mouseCoords.x-r+"px "+(n.mouseCoords.y-i)+"px"}),t},[_])(["transition-arrive","t8n-arrive"],function(e,t){return s.create("transition-arrive",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{arrive:r}),"zoom"===r&&(t.data.passageT8n.arriveOrigin=function(){var t=e(this),r=t.offset(),i=r.left,a=r.top,o=t.height();return{"transform-origin":100*(n.mouseCoords.x-i)/t.width()+"% "+100*(n.mouseCoords.y-a)/o+"%",height:o+"px"}}),t},[_])("button",function(){return s.create("button",[])},function(e){return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(this.className.length>0)+"enchantment-button")}}),e},[])(["border","b4r"],function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return s.create("border",r.map(n.insensitiveName))},function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.styles.push({display:function(){var t=e(this).css("display");return r.every(function(e){return"none"===e})||!t.includes("inline")?t:"inline-block"},"border-style":r.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),t},[N].concat(_toConsumableArray(Array(3).fill(g(N)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("border-size",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))("corner-radius",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("corner-radius",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("border-colour",n.map(function(e){return i.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[y(String,i)].concat(_toConsumableArray(Array(3).fill(g(y(String,i))))))("opacity",function(e,t){return s.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[j])("font",function(e,t){return s.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=void 0,r=t.indexOf("><");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(t))return l.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"');if(~r){var i=Math.round(r/(t.length-2)*50);n=d({"text-align":"center","max-width":"50%"},25===i?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":i+"%"})}else n="<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"};return n.display="inline-block",s.create("align",[n])},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return s.create("text-colour",[t])},function(e,t){return i.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[y(String,i)])(["text-size","size"],function(e,t){return s.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return s.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return s.create("text-rotate-z",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" rotate("+n+"deg)"}}),t},[Number])("text-rotate-y",function(e,t){return s.create("text-rotate-y",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" perspective(50vw) rotateY("+n+"deg)"}}),t},[Number])("text-rotate-x",function(e,t){return s.create("text-rotate-x",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" perspective(50vw) rotateX("+n+"deg)"}}),t},[Number])(["background","bg"],function(e,t){return s.create("background",[t])},function(t,r){var a=void 0;return i.isPrototypeOf(r)?r=r.toRGBAString(r):o.isPrototypeOf(r)&&(r=r.toLinearGradientString(r)),a=i.isHexString(r)||i.isCSS3Function(r)?{"background-color":r}:r.startsWith("linear-gradient(")||r.startsWith("repeating-linear-gradient(")?{"background-image":r}:{"background-size":"cover","background-image":"url("+r+")"},t.styles.push(a,{display:function(){var t=e(this);return!t.children().length||n.childrenProbablyInline(t)?e(this).css("display"):"block"}}),t},[y(String,i,o)]).apply(void 0,_toConsumableArray((C={color:function(){return"transparent"}},E=d(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var t=e(this).css("color");return"-1px -1px 0 "+t+", 1px -1px 0 "+t+",-1px  1px 0 "+t+", 1px  1px 0 "+t}},{color:function(){return n.parentColours(e(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+e(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+e(this).css("color")}},smear:[{"text-shadow":function(){var t=e(this).css("color");return"0em   0em 0.02em "+t+",-0.2em 0em  0.5em "+t+", 0.2em 0em  0.5em "+t}},C],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+e(this).css("color")}},C],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+e(this).css("color")},"user-select":"none"},C],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return s.create("text-style",r.map(n.insensitiveName))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0;i<n.length;i+=1)"none"===n[i]?e.styles=[]:e.styles=e.styles.concat(E[n[i]]);return e},[T(S.apply(void 0,_toConsumableArray(Object.keys(E))))]])))("collapse",function(){return s.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=u.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?s.create("hover-style",[t]):l.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[s])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),s.create("css",[t])},function(t,n){return t.attr.push({style:function(){return(e(this).attr("style")||"")+n}}),t},[String])("test-true",function(){return s.create("test-true",[])},function(e){return e.enabled=!0},w(b))("test-false",function(){return s.create("test-false",[])},function(e){return e.enabled=!1},w(b)),t.addCommand("animate",e.noop,function(e,t,r,i,a){r.forEach(t,function(t){var r=void 0;if("zoom"===name){var o=t.offset(),s=o.left,c=o.top;r=n.mouseCoords.x-s+"px "+(n.mouseCoords.y-c)+"px"}n.transitionIn(t,i,e.transitionTime||a,e.transitionDelay,e.transitionSkip,0,r)})},[T(a),S.apply(void 0,_toConsumableArray(_.innerType.filter(function(e){return"instant"!==e}))),g(x)]),["box","float-box"].forEach(function(r){return t.addChanger(r,function(e,t,n){var i=-1===t.search(f)||t.length>1&&!t.includes("="),a="float-box"===r&&(-1===n.search(f)||n.length>1&&!n.includes("="));return i||a?l.create("datatype","The ("+r+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(i?t:n)+'".'):s.create(r,[t,n].filter(function(e){return void 0!==e}))},function(t,i,a){var o,s=p(i),c=s.marginLeft,u=s.size,l=void 0;if("float-box"===r){var f=p(a);l=f.marginLeft,a=f.size}var h="box"===r?"%":"vw",y=(_defineProperty(o={display:"block",width:u+h,"max-width":u+h},"box"===r?"margin-left":"left",c+h),_defineProperty(o,"box-sizing","content-box"),_defineProperty(o,"overflow-y","auto"),_defineProperty(o,"padding",function(){return e(this).css("padding")||"1em"}),o);return void 0!==a&&(y.height=a+("box"===r?"em":"vh")),"float-box"===r&&d(y,{position:"fixed",top:l+"vh","background-color":function(){return n.parentColours(e(this)).backgroundColour}}),t.styles.push(y),t},[String,"box"===r?g(k):String])})}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(e,t,n,r,i,a,o){var s=i.objectName,c=o.collapse,u={create:function(n){return t.assertOnlyHas(n,["scope","localHook","section","attr","data","changer","functions","lambda","name"]),Object.assign(Object.create(this),{enchantments:e()},n)},enchantScope:function(){var i=this,o=this.attr,u=this.data,l=this.functions,p=this.section,f=this.scope,d=this.localHook,h=this.lambda,y=[];f.forEach(p,function(m,g){if(!d||d.has(m[0]).length){var v=void 0;if(h)if(v=h.apply(p,{loop:f.TwineScript_GetProperty(g),pos:g+1}),a.containsError(v))m.replaceWith(v.render("")),h=v=null;else if(r.isPrototypeOf(v)){var b=v.summary();(b.includes("newTargets")||b.includes("target"))&&(m.replaceWith(a.create("macrocall","The changer produced by the 'via' lambda given to (enchant:) can't include a revision or enchantment changer like (replace:) or (click:).").render("")),h=v=null)}else m.replaceWith(a.create("macrocall","The 'via' lambda given to (enchant:) must return a changer, not "+s(v)+".").render("")),h=v=null;else v=i.changer;var w=!o&&!u&&(!v||v.summary().every(function(e){return e.startsWith("transition")})),T=w?m:m.wrap("<tw-enchantment>").parent();if(o&&T.attr(o),u&&T.data(u),l&&l.forEach(function(e){return e(T)}),v){var S=n.create({section:p,target:T});if(v.run(S),S.update(),m.is(t.storyElement)){var x=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(S.styles))));m.css(x.reduce(function(e,t){return e[t]="inherit",e},{})),T.data({enchantedProperties:x})}else if(m.is("tw-passage")&&S.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})){var k="padding-left",O="padding-right";t.storyElement.css(k,"0px").css(O,"0px"),T.data({enchantedProperties:[k,O]})}}m.is(t.storyElement)&&T.css({width:"100%",height:"100%"}),"true"===T.attr("collapsing")&&(T.find("[collapsing=false]").each(function(){e(this).removeAttr("collapsing")}),c(T)),w||y.push(T)}}),this.enchantments=e(y)},disenchant:function(){this.enchantments.each(function(){e(this).contents().unwrap();var n=e(this).data("enchantedProperties");n&&t.storyElement.css(n.reduce(function(e,t){return e[t]="",e},{}))})}};return Object.freeze(u)}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/changercommand","datatypes/lambda","internaltypes/enchantment","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c,u,l,p){var f=n.is,d=o.TypeSignature,h=d.either,y=d.rest,m=d.optional;function g(e,t){if(c.isPrototypeOf(t)){var n=t.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return n.includes(e)}))return p.create("datatype","The changer given to ("+e+":) can't include a revision or enchantment changer like (replace:) or (click:).")}}["enchant","change"].forEach(function(e){o.addCommand(e,function(t,n){var r=g(e,n);if(r)return r},function(t,n,r){var i,a=l.create((_defineProperty(i={scope:s.from(n)},c.isPrototypeOf(r)?"changer":"lambda",r),_defineProperty(i,"section",t),i));return"enchant"===e?(t.addEnchantment(a),t.updateEnchantments()):a.enchantScope(),""},[h(s,String),h(c,u.TypeSignature("via"))],!1)}),o.addChanger("enchant-in",function(e,t,n){var r=g("enchant-in",n);return r||c.create("enchant-in",[t,n])},function(e,t,n){return e.functions=(e.functions||[]).concat(function(r){var i;e.section.addEnchantment(l.create((_defineProperty(i={scope:s.from(t),localHook:r},c.isPrototypeOf(n)?"changer":"lambda",n),_defineProperty(i,"section",e.section),i)))}),e},[h(s,String),h(c,u.TypeSignature("via"))]),[["link-style",s.create({type:"name",data:"link"})],["line-style",s.create({type:"base",data:s.create({type:"name",data:"page"})},"lines",void 0)],["char-style",s.create({type:"base",data:s.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];o.addChanger(n,function(e,t){var r=g(n,t);return r||c.create(n,[t])},function(e,t){return e.functions=(e.functions||[]).concat(function(n){var i;e.section.addEnchantment(l.create((_defineProperty(i={scope:r,localHook:n},c.isPrototypeOf(t)?"changer":"lambda",t),_defineProperty(i,"section",e.section),i)))}),e},[h(c,u.TypeSignature("via"))])});var v=["replace","append","prepend"];function b(n,i){return t.onStartup(function(){var r=n.classList.replace(/ /g,"."),i=n.blockClassList?n.blockClassList.replace(/ /g,"."):"",a="."+r+(i?",."+i:"");t.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),a,function(){var t=e(Array.from(e(this).parents(a).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data("enchantmentEvent");n&&n(t)})}),[function(e,t,n){if(!t)return p.create("datatype","A string given to this ("+i+":) macro was empty.");if(n){var r=g(i,n);if(r)return r}return c.create(i,[s.from(t)].concat(n?[n]:[]))},function(e,t,a){e.enabled=!1,e.transitionDeferred=!0,n.rerender&&(e.newTargets=(e.newTargets||[]).concat({target:t,append:n.rerender}));var o=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),s=l.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||"block"===e.children().css("display")?n.blockClassList:n.classList)}],attr:(n.classList+"").match(/\b(?:link|enchantment-clickblock)\b/)?{tabIndex:"0"}:{},data:{enchantmentEvent:function(){e.section.stackTop&&e.section.stackTop.blocked||(n.once&&e.section.removeEnchantment(s),n.goto?r.goToPassage(n.goto,{transition:n.transition}):n.undo?r.goBack({transition:n.transition}):e.section.renderInto(e.source,null,Object.assign({},e,{enabled:!0,transitionDeferred:!1}),o))}},scope:t,section:e.section,name:i},c.isPrototypeOf(a)?"changer":"lambda",a));return e.section&&(e.section.addEnchantment(s),s.enchantScope()),e},[h(s,String),m(h(c,u.TypeSignature("via")))]]}v.forEach(function(t){o.addChanger(t,function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.every(Boolean)?c.create(t,r.map(s.from)):p.create("datatype","A string given to this ("+t+":) macro was empty.")},function(n){for(var r,i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return e(n.target).parents().filter("tw-collapsed,[collapsing=true]").length>0||n.attr.some(function(e){return e.collapsing})||(n.attr=[].concat(_toConsumableArray(n.attr),[{collapsing:!1}])),n.newTargets=n.newTargets||[],(r=n.newTargets).push.apply(r,_toConsumableArray(a.filter(function(e){return!n.newTargets.some(function(n){var r=n.target,i=n.append;return f(e,r)&&t===i})}).map(function(e){return{target:e,append:t,before:!0}}))),n},y(h(s,String)))(t+"-with",function(e,n){return c.create(t+"-with",[n])},function(e,n){return e.appendSource=(e.appendSource||[]).concat({source:n,append:t}),e},String)});var w="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,T=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",w?"click":""].filter(Boolean),once:!0,rerender:"",classList:"enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",w?"click":""].filter(Boolean),once:!0,rerender:"",classList:"enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}}];T.forEach(function(e){return o.addChanger.apply(o,[e.name].concat(_toConsumableArray(b(e.enchantDesc,e.name))))}),t.onStartup(function(){T.forEach(function(n){var r=n.enchantDesc;r.blockClassList&&t.storyElement.on(r.event.map(function(e){return e+".enchantment"}).join(" "),function(){var t=e(Array.from(e(this).parents("."+r.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data("enchantmentEvent");n&&n(t)})})}),v.forEach(function(e){T.forEach(function(t){var n=Object.assign({},t.enchantDesc,{rerender:e}),r=t.name+"-"+e;o.addChanger.apply(o,[r].concat(_toConsumableArray(b(n,r))))})}),T.forEach(function(e){["goto","undo"].forEach(function(t){var n=e.name+"-"+t;o.addCommand(n,function(e,r){return!e||!r&&"goto"===t?p.create("datatype","A string given to this ("+n+":) macro was empty."):"goto"!==t||a.hasValid(r)?void 0:p.create("macrocall","I can't ("+n+":) the passage '"+r+"' because it doesn't exist.")},function(r,a,o,c){if("undo"===t&&i.pastLength<1)return p.create("macrocall","I can't (undo:) on the first turn.");var u=b(Object.assign({},e.enchantDesc,{transition:r.data.passageT8n},"undo"===t?{undo:!0}:{goto:c}),n);return(0,_slicedToArray(u,2)[1])({section:a},s.from(o)),Object.assign(r,{source:""})},[h(s,String)].concat("undo"===t?[]:String))})})}),define("macrolib/metadata",["macros","renderer","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(e,t,n,r,i){var a=n.clone,o=n.objectName,s=n.isValidDatamapName,c=e.TypeSignature,u=c.zeroOrMore,l=c.Any,p=t.options.metadataMacros,f=function(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}};[["storylet",r.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(t){var n=_slicedToArray(t,2),r=n[0],i=n[1];e.add(r,function(e,t){return e.stackTop.speculativePassage?t:f(r)},i),p.push(r)}),e.add("metadata",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var c=void 0,u=new Map,l=n.reduce(function(e,t){var n=void 0;if(i.containsError(e))return e;if(void 0===c)c=t;else{if(n=i.containsError(s(u,c)))return n;if(u.has(c))return i.create("macrocall","You used the same data name ("+o(c)+") twice in the same (metadata:) call.");u.set(c,a(t)),c=void 0}return e},!0);return i.containsError(l)?l:void 0!==c?i.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?u:f("storylet")},u(l)),p.push("metadata")}),define("macrolib/patterns",["jquery","macros","utils","utils/operationutils","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror"],function(e,t,n,r,i,a,o){var s=n.anyRealLetter,c=n.anyUppercase,u=n.anyLowercase,l=n.anyCasedLetter,p=n.realWhitespace,f=n.impossible,d=r.objectName,h=r.toSource,y=t.TypeSignature,m=y.rest,g=y.either,v=y.optional,b=y.nonNegativeInteger,w=Object.assign,T=Object.create,S=m(g(String,i,a)),x=function e(t){var n,r=t.name,y=t.fullArgs,m=t.args,g=t.makeRegExpString,v=void 0===g?function(e){return e.join("")}:g,b=t.insensitive,S=void 0!==b&&b,x=t.canContainTypedVars,k=void 0===x||x,O=t.canBeUsedAlone,j=void 0===O||O,A=m||y,C=A.map(function e(t){if(a.isPrototypeOf(t)){if(!k)return o.create("operation","Optional string patterns, like ("+r+":)"+("p-many"===r?" with min 0":"")+", can't have typed variables inside them.");var n=e(t.datatype);return o.containsError(n)?n:"("+n+")"}if(i.isPrototypeOf(t)){if(!k&&"typedVars"in t&&t.typedVars().length)return o.create("operation","("+r+":) can't have typed variables inside its pattern.");if(t.regExp)return(t.rest?"(?:":"")+(S?t.insensitive().regExp:t.regExp)+(t.rest?")*":"");var h=t.name,y=t.rest?"*":"";return"alnum"===h?s+y:"whitespace"===h?p+y:"uppercase"===h?(S?l:c)+y:"lowercase"===h?(S?l:u)+y:"anycase"===h?l+y:"digit"===h?"\\d"+y:"linebreak"===h?"(?:\\r|\\n|\\r\\n)"+y:"str"===h?".*?":["even","odd","int","num"].includes(h)?o.create("datatype","Please use string datatypes like 'digit' in ("+r+":) instead of number datatypes."):o.create("datatype","The ("+r+":) macro must only be given string-related datatypes, not "+d(t)+".")}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),S&&(t=t.replace(RegExp("("+c+"|"+u+")","g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"})),t):(f("createPattern","mapper() was given a non-string non-datatype "+t),"")});if(n=o.containsError(C))return n;var E=v(C),_=w(T(i),{name:r,regExp:E,insensitive:function(){return S?_:e({name:r,fullArgs:y,args:A.map(function(e){return i.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:v,insensitive:!0,canContainTypedVars:k,canBeUsedAlone:j})},typedVars:function(){return A.reduce(function(t,n){return a.isPrototypeOf(n)&&(t=t.concat(S?a.create(e({name:"p-ins",fullArgs:[n.datatype],insensitive:!0}),n.varRef):n),n=n.datatype),i.isPrototypeOf(n)&&"function"==typeof n.typedVars&&(t=t.concat(n.typedVars())),t},[])},destructure:function(t){if("string"!=typeof t)return[o.create("operation","I can't unpack "+d(t)+" into "+this.TwineScript_ToSource()+" because it isn't a string.")];var n=this.typedVars();if(!n.length)return[];var r=(RegExp("^"+(this.rest?"(?:":"")+E+(this.rest?")*":"")+"$").exec(t)||[]).slice(1);return r.length?r.map(function(t,r){var i=n[r];if(i)return i.datatype.rest&&!i.datatype.regExp&&((i=i.TwineScript_Clone()).datatype=e({name:"p",fullArgs:[i.datatype]})),{dest:i,value:t||"",src:void 0}}).filter(Boolean):[o.create("operation","I can't unpack "+d(t)+" because it doesn't match the pattern "+this.TwineScript_ToSource()+".")]},TwineScript_IsTypeOf:function(e){return j?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+E+(this.rest?")*":"")+"$"):o.create("operation","A ("+r+":) datatype must only be used with a (p:) macro.")},TwineScript_toTypeSignatureObject:function(){var e=this;return{pattern:"range",name:r,range:function(t){return e.TwineScript_IsTypeOf(t)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+r+":"+y.map(h)+")"}});return Object.defineProperty(_,"TwineScript_ObjectName",{get:function(){return"a ("+r+":) datatype"}}),_};t.add(["p","pattern"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p",fullArgs:n})},S)(["p-either","pattern-either"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},S)(["p-opt","pattern-opt","p-optional","pattern-optional"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},S)(["p-not","pattern-not"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==[].concat(_toConsumableArray(e)).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?o.create("datatype","(p-not:) should only be given single character"):x({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.join("")+"]"}})},S)(["p-many","pattern-many"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=n.slice(),c=void 0,u=void 0;if("number"==typeof n[0]&&(c=n.shift(),u="number"==typeof n[0]?n.shift():1/0),void 0!==u&&u<c)return o.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");if(!n.length)return o.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");var l=n.find(function(e){return"string"!=typeof e&&!i.isPrototypeOf(e)&&!a.isPrototypeOf(e)});return l?o.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+d(l)+"."):x({name:"p-many",args:n,fullArgs:s,canContainTypedVars:c>0,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==c?"{"+c+(u===1/0?",":u!==c?","+u:"")+"}":"+")}})},[m(g(b,String,i,a))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-ins",fullArgs:n,insensitive:!0})},S)(["split","splitted"],function(e,t,n){if(t=x({name:"split",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t))return t;if(!n)return[""];if(!t.regExp)return[].concat(_toConsumableArray(n));for(var r=RegExp(t.regExp),i=[],a=void 0;n&&(a=r.exec(n));){if(a.index+a[0].length===0)return i;i.push(n.slice(0,a.index)),n=n.slice(a.index+a[0].length)}return i.concat(n||[])},[g(String,i),String])("trimmed",function(e,t,n){return void 0===n||i.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=x({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[g(String,i),v(String)])}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c,u,l){var p=t.TypeSignature,f=p.optional,d=p.rest,h=p.either,y=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],m=Object.assign;function g(e,t,r){r=r||t;var a=i.hasValid(t)&&t===r,o=e.evaluateTwineMarkup(n.unescape(r),"a link's passage name"),s=void 0;if(a){var c=o.children().length>0?"`".repeat((r.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"";t=c+"\0".repeat(!!c)+t+"\0".repeat(!!c)+c}else o.findAndFilter("tw-error").length&&(s=o.findAndFilter("tw-error").data("TwineError")),r=o.text();return{text:t,passage:r,error:s}}n.onStartup(function(){e(n.storyElement).on("click.passage-link","tw-link",function(){var t=e(this),n=t.closest("tw-expression"),r=t.closest("tw-expression, tw-hook"),i=r.data("clickEvent"),o=r.data("section");if(!(o&&o.stackTop&&o.stackTop.blocked))if(i){if(t.find("tw-error").length>0)return;i(t)}else{var s=n.data("linkPassageName"),c=Object.assign({},n.data("passageT8n")||{});n.find("tw-enchantment").each(function(t,n){Object.assign(c,e(n).data("passageT8n")||{})}),s?a.goToPassage(s,{transition:c}):t.is("[undo]")?a.goBack({transition:c}):t.is("[fullscreen]")&&a.toggleFullscreen()}}),e(document).on("fullscreenchange",function(){e("tw-link[fullscreen]",n.storyElement).each(function(t,n){(e(n).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(n)})})}),[["link","link-replace"],["link-reveal"],["link-repeat"],["link-rerun"]].forEach(function(e){return t.addChanger(e,function(t,n,r){if(!n)return l.create("datatype",y[0]);if(r){var i=r.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return i.includes(e)}))return l.create("datatype","The changer given to ("+e[0]+":) can't include a revision or enchantment changer like (replace:) or (click:).")}return o.create(e[0],[n].concat(r||[]))},function(t,n,r){var i=e[0],a=t.section&&t.section.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=s.create({source:"<tw-link tabindex=0>"+n+"</tw-link>",target:function(){return t.target},append:"replace",data:{section:t.section,clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==o}),"link-reveal"===i&&e.contents().unwrap();var n=e.parent();"link-rerun"===i&&e.detach(),"link"!==i&&"link-rerun"!==i&&"click-block"!==i||n.empty(),t.section.renderInto("",null,t,a),"link-rerun"===i&&n.prepend(e)}}});return t.enablers=(t.enablers||[]).concat({descriptor:o,changer:r}),t},[String,f(o)])}),t.addCommand("link-goto",function(e){if(!e)return l.create.apply(l,["datatype"].concat(y))},function(e,t,a,o){var s,c=g(t,a,o);if(a=c.text,o=c.passage,s=c.error)return s;if(e.transition){var u="transition";return l.create("datatype","Please attach ("+u+"-depart:) or ("+u+"-arrive:) to a passage link, not ("+u+":).")}var p=void 0;return i.hasValid(o)||(p='<tw-broken-link passage-name="'+n.escape(o)+'">'+a+"</tw-broken-link>"),p=p||"<tw-link tabindex=0 "+(r.passageNameVisited(o)>0?'class="visited" ':"")+">"+a+"</tw-link>",e.data.linkPassageName=o,e.data.section=t,m(e,{source:p,transitionDeferred:!0})},[String,f(String)])("link-storylet",function(){var e,t=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1,arguments.length<=e?void 0:arguments[e]);if(!t||"string"==typeof t)return l.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n,a,o,s=(n=2+(1==(arguments.length<=2?0:arguments.length-2)?0:3==(arguments.length<=2?0:arguments.length-2)||"string"==typeof(arguments.length<=2?void 0:arguments[2])?1:2),arguments.length<=n?void 0:arguments[n]),c="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),p=(a=(arguments.length<=2?0:arguments.length-2)-1+2,(arguments.length<=a?void 0:arguments[a])!==s&&(o=(arguments.length<=2?0:arguments.length-2)-1+2,arguments.length<=o?void 0:arguments[o]));if(e.transition){var f="transition";return l.create("datatype","Please attach ("+f+"-depart:) or ("+f+"-arrive:) to (link-storylet:), not ("+f+":).")}var d=u.isPrototypeOf(s),h=i.getStorylets(t,d&&s),y=l.containsError(h);if(y)return y;var g=h[d?0:s<0?h.length+s:s-1],v=void 0;if(g)g=g.get("name"),c=c||g,v=v||"<tw-link tabindex=0 "+(r.passageNameVisited(g)>0?'class="visited" ':"")+">"+c+"</tw-link>",e.data.linkPassageName=g,e.data.section=t;else{if(!p)return e;v=p}return m(e,{source:v,transitionDeferred:!0})},[h(parseInt,String,u.TypeSignature("where")),f(h(parseInt,String,u.TypeSignature("where"))),f(String)])("link-undo",function(e){if(!e)return l.create("datatype",y[0])},function(e,t,n){return r.pastLength<1?l.create("macrocall","I can't use (link-undo:) on the first turn."):(e.data.section=t,m(e,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0}))},[String])("link-show",function(e){if(!e)return l.create("datatype",y[0])},function(t,n,r){for(var i=arguments.length,a=Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return t.data.section=n,t.data.clickEvent=function(r){r.contents().unwrap(),a.forEach(function(r){return r.forEach(n,function(r){var i=r.data("originalSource")||"",a=r.data("hidden");if(a)if(r.removeData("hidden"),a instanceof e)r.empty().append(a);else{var o=r.data("tempVariables");n.renderInto("",null,m({},t,{source:i,target:r,transitionDeferred:!1}),o&&Object.create(o))}})})},m(t,{source:"<tw-link tabindex=0>"+r+"</tw-link>",transitionDeferred:!0})},[String,d(c)])("link-fullscreen",function(e,t){if(!e||!t)return l.create("datatype",y[0])},function(e,t,n,r){var i=function(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""},a=t.stackTop.tempVariables;return e.data.section=t,e.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&e.data.section.whenUnblocked(function(){var t=m({},e,{append:"replace",source:i(),transitionDeferred:!1});e.section.renderInto("",null,t,a)})},m(e,{source:i(),transitionDeferred:!0})},[String,String,f(String)]),t.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return l.create.apply(l,["datatype"].concat(y));if(o.isPrototypeOf(n)){if(o.isPrototypeOf(r))return l.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}if(r){var i=r.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return i.includes(e)}))return l.create("datatype","The changer given to (link-reveal-goto:) can't include a revision or enchantment changer like (replace:) or (click:).")}var a=g(e,t,n);return t=a.text,n=a.passage,a.error||o.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}))},function(e,t,o,c){if(i.hasValid(o)){var u=r.passageNameVisited(o),l=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),p=s.create({source:"<tw-link tabindex=0 "+(u>0?'class="visited" ':"")+">"+t+"</tw-link>",target:e.target,append:"replace",data:{section:e.section,append:"replace",clickEvent:function(t){e.enablers=e.enablers.filter(function(e){return e.descriptor!==p}),t.contents().unwrap(),e.section.renderInto("",null,e,l),e.section.whenUnblocked(function(){return a.goToPassage(o,{transition:e.data.passageT8n})})}}});return e.enablers=(e.enablers||[]).concat({descriptor:p,changer:c}),e}e.source='<tw-broken-link passage-name="'+n.escape(o)+'">'+t+"</tw-broken-link>"},[String,f(h(o,String)),f(o)])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(e,t,n,r,i,a,o,s,c){var u=t.add,l=t.addChanger,p=t.addCommand,f=t.TypeSignature,d=f.rest,h=f.either,y=f.Any,m=r.objectName;u("macro",function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var u=void 0,l=[];for(u=0;u<i.length;u+=1){var p=u===i.length-1;if(s.isPrototypeOf(i[u])===p)return c.create("datatype","The "+(p?"":e.nth(i.length-u+1)+"-")+"last value given to (macro:) should be a "+(p?"code hook":"datatyped variable")+", not "+m(i[u]));if(!p){var f="A custom macro";if(i[u].varRef.object===n.variables)return c.create("datatype",f+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(i[u].varRef.propertyChain.length>1)return c.create("datatype",f+"'s typed variables can't be properties inside a data structure.");if(i[u].datatype.rest&&u!==i.length-2)return c.create("datatype",f+" can only have one spread variable, and it must be its last variable.");var d=i[u].varRef.propertyChain[0];if(l.includes(d))return c.create("datatype",f+"'s typed variables can't both be named '"+d+"'.");l.push(d)}}return a.create(i.slice(0,-1),i[i.length-1])},[d(h(s,o))]);var g=function(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return c.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")};p(["output-data","out-data"],function(){},function(e,t){var n=e.stack;return g("output-data",n,t)||"blocked"},[y],!1),l(["output","out"],function(e){return Object.assign(i.create("output",[e]))},function(e,t){var n=t.stack,r=t.stackTop;return e.loopVars=Object.keys(r.tempVariables).reduce(function(e,t){return e[t]=[r.tempVariables[t]],e},{}),g("output",n,e),r.blocked=!0,e},[]),p("error",function(e){if(!e)return c.create("datatype","This (error:) macro was given an empty string.")},function(e,t){var n=e.stack;return g("error",n,c.create("user",t))||"blocked"},[String],!1)}),define("repl",["utils","engine","markup","twinescript/compiler","twinescript/environ"],function(e,t,n,r,i){e.onStartup(function(){return setTimeout(function(){t.options.debug&&(window.REPL=function(e){var t=r(n.lex("(print:"+e+")"));console.log(t);var a=i({}).eval(t);return a.TwineScript_Run?a.TwineScript_Run().source:a},window.LEX=function(e){var t=n.lex(e);return 1===t.length?t[0]:t})})})}),require.config({paths:{jquery:"../node_modules/jquery/dist/jquery",almond:"../node_modules/almond/almond","es6-shim":"../node_modules/es6-shim/es6-shim",jqueryplugins:"utils/jqueryplugins",markup:"./markup/markup",lexer:"./markup/lexer",patterns:"./markup/patterns"},deps:["es6-shim","jqueryplugins"]}),require(["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref118,TwineError){var dialog=_ref118.dialog;function __HarloweEval(text){return eval(text+"")}var _installHandlers=function(){$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),Engine.options.debug?DebugMode():TwineError.on("error",function(e,t){return!$("tw-debugger").length&&DebugMode(e,t)}),_installHandlers=null},oldOnError;function printJSError(e){var t=e.name+": "+e.message;if(e.stack){var n=e.stack.split("\n"),r=n.findIndex(function(e){return e.includes("__HarloweEval")});t+="\n"+n.slice(0,r).join("\n").replace(/\([^\)]+\)/g,"")}return"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+t+"```</div>"}oldOnError=window.onerror,window.onerror=function(e,t,n,r,i){window.onerror=oldOnError,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n"+printJSError(i)+"\n(This is probably due to a bug in the Harlowe game engine.)"})),"function"==typeof oldOnError&&oldOnError.apply(void 0,arguments)},Utils.onStartup(function(){var e=$("tw-storydata");if(0!==e.length){var t=e.attr("options");t&&t.split(/\s/).forEach(function(e){Renderer.options[e]=Engine.options[e]=!0});var n=e.attr("startnode");Renderer.options.ifid=Engine.options.ifid=e.attr("ifid"),n||(n=[].reduce.call($("tw-passagedata"),function(e,t){var n=t.getAttribute("pid");return n<e?n:e},1/0)),n=$("tw-passagedata[pid="+n+"]").attr("name"),_installHandlers();var r=!1;$("[role=script]").each(function(e){try{__HarloweEval($(this).html())}catch(t){r||(r=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(e+1)+" script:\n\n"+printJSError(t)}))}}),$("[role=stylesheet]").each(function(e){$(document.head).append('<style data-title="Story stylesheet '+(e+1)+'">'+$(this).html())});var i=Section.create(),a=Passages.loadMetadata(i);if(a.length){var o=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"});a.forEach(function(e){return o.find("p").append(e.render(""))})}var s=!Engine.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session");s&&!0===State.deserialise(i,s)?Engine.showPassage(State.passage,!1):Engine.goToPassage(n)}})}),define("harlowe",function(){}),require(["harlowe"])}();
</script>

</body>
</html>
